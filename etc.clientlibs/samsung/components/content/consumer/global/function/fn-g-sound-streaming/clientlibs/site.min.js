(function(){function g(){b(a.section).target.forEach(function(a){new d(a)})}var b=window.sg.common.$q,a={section:".sound-streaming",audioWrap:".audio",audioPlayer:".audio-controller__controls",audioTarget:"audio",audioTime:".audio-controller__time",progressFill:".audio-controller__bar-filled",btnPlay:".audio-controller__play-pause",btnStop:".audio-controller__stop",playName:"audio-controller__controls--play",captionOpenBtn:".audio-controller__btn-caption",captionCloseBtn:".audio-caption-layer__close",
captionLy:".audio-caption-layer",captionCont:".audio-caption-layer__inner",activeClass:"is-active",openClass:"is-opened"},d=function(a){this.ele={window:b(window),section:b(a),captionOpenBtn:null,captionCloseBtn:null,captionCont:null};this.setProperty();this.event={outFocus:this.outFocus.bind(this),captionLyClose:this.captionLyClose.bind(this),captionLyOpen:this.captionLyOpen.bind(this),playControl:this.playControl.bind(this)};d.instances.set(a,this);this.init()};d.prototype.setProperty=function(){this.ele.audioSet=
b(".audio-controller");this.activeBtn=this.progressFill=null;this.ele.captionOpenBtn=this.ele.section.find(a.captionOpenBtn);this.ele.captionCloseBtn=this.ele.section.find(a.captionCloseBtn);this.ele.captionCont=this.ele.section.find(a.captionCont);this.ele.btnPlay=this.ele.section.find(a.btnPlay);this.ele.btnStop=this.ele.section.find(a.btnStop)};d.prototype.audioControl=function(){for(var e=this,f=0;f<this.ele.audioSet.target.length;f++)this.ele.audioSet.target[f].setAttribute("data-audio-index",
f);this.ele.section.find(a.audioWrap).target.forEach(function(c){function f(e){var f=b(c).find(a.btnPlay).attr("an-la");this.taggingText=null;"play"===e?this.taggingText=f.replace(":pause",":play"):"pause"===e&&(this.taggingText=f.replace(":play",":pause"));b(c).find(a.btnPlay).attr("an-la",this.taggingText)}b(c).find(a.audioTarget).target[0].load();var d="this.durationTimer"+c.getAttribute("data-audio-index");d=setInterval(function(){2<b(c).find(a.audioTarget).target[0].readyState&&(b(c).find(a.audioTime).target[0].textContent=
e.getTimeCodeFromNum(b(c).find(a.audioTarget).target[0].duration),b(c).find(a.audioTime).attr("data-duration-time",e.getTimeCodeFromNum(b(c).find(a.audioTarget).target[0].duration)),clearInterval(d),d=null)},200);b(c).find(a.audioTarget).target[0].addEventListener("playing",function(){e.progressFill=requestAnimationFrame(function(){return e.filledProgress(b(c))});f("pause")});b(c).find(a.audioTarget).target[0].addEventListener("pause",function(){cancelAnimationFrame(e.progressFill);e.progressFill=
null;f("play")});b(c).find(a.audioTarget).target[0].addEventListener("ended",function(){b(c).find(a.audioPlayer).removeClass(a.playName);b(c).closest(a.audioWrap).removeClass("playing");b(c).find(a.btnPlay).find(".hidden").text("play");setTimeout(function(){b(c).find(a.audioTime).text(b(c).find(a.audioTime).attr("data-duration-time"));b(c).find(a.progressFill).target[0].style.transform="scaleX(0)"},500);f("play")})})};d.prototype.playControl=function(e){function f(b){b.find(a.audioTarget).target[0].pause();
b.find(a.audioPlayer).removeClass(a.playName);b.removeClass("playing");b.find(a.btnPlay).find(".hidden").text("play")}var c=this;this.activeBtn=b(e.currentTarget);this.activeTarget=this.activeBtn.closest(a.audioWrap);this.activeBtn.target[0]===this.activeTarget.find(a.btnPlay).target[0]&&setTimeout(function(){c.activeTarget.find(a.audioPlayer).hasClass(a.playName)?(c.activeTarget.find(a.audioTarget).target[0].pause(),c.activeTarget.find(a.audioPlayer).removeClass(a.playName),c.activeTarget.removeClass("playing"),
c.activeTarget.find(a.btnPlay).find(".hidden").text("play")):(0<b(".audio.playing").target.length&&f(b(".audio.playing")),0<b(".audio-controller.playing").target.length&&f(b(".audio-controller.playing")),c.activeTarget.find(a.audioTarget).target[0].play(),c.activeTarget.find(a.audioPlayer).addClass(a.playName),c.activeTarget.addClass("playing"),c.activeTarget.find(a.btnPlay).find(".hidden").text("pause"))},100);this.activeBtn.target[0]===this.activeTarget.find(a.btnStop).target[0]&&(this.activeTarget.hasClass("playing")&&
(this.activeTarget.removeClass("playing"),this.activeTarget.find(a.btnPlay).find(".hidden").text("play")),this.activeTarget.find(a.audioPlayer).removeClass(a.playName),this.activeTarget.find(a.audioTarget).target[0].pause(),this.activeTarget.find(a.audioTarget).target[0].currentTime=0,this.activeTarget.find(a.audioTime).target[0].textContent=this.getTimeCodeFromNum(this.activeTarget.find(a.audioTarget).target[0].duration),this.activeTarget.find(a.progressFill).target[0].style.transform="scaleX(0)")};
d.prototype.filledProgress=function(b){var e=this;b.find(a.progressFill).target[0].style.transform="scaleX("+(b.find(a.audioTarget).target[0].currentTime/b.find(a.audioTarget).target[0].duration).toFixed(4)+")";b.find(a.audioTime).target[0].textContent=this.getTimeCodeFromNum(Math.floor(b.find(a.audioTarget).target[0].duration)-Math.floor(b.find(a.audioTarget).target[0].currentTime));this.progressFill=requestAnimationFrame(function(){return e.filledProgress(b)});b.find(a.audioTarget).target[0].currentTime===
b.find(a.audioTarget).target[0].duration&&(cancelAnimationFrame(this.progressFill),this.progressFill=null)};d.prototype.outFocus=function(e){var f=this;this.activeBtn=b(e.currentTarget);this.activeTarget=this.activeBtn.closest(a.audioPlayer);this.activeBtn.target[0]===this.activeTarget.find(a.captionCloseBtn).target[0]&&setTimeout(function(){document.activeElement!==f.activeTarget.find(a.captionCont).target[0]&&(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),
b(a.captionOpenBtn).find(".hidden").text("open"))},300);this.activeBtn.target[0]===this.activeTarget.find(a.captionCont).target[0]&&setTimeout(function(){document.activeElement!==f.activeTarget.find(a.captionCloseBtn).target[0]&&(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),b(a.captionOpenBtn).find(".hidden").text("open"))},300)};d.prototype.captionLyOpen=function(e){this.activeBtn=b(e.currentTarget);this.activeTarget=this.activeBtn.closest(".audio-controller__controls");
this.activeTarget.find(a.captionOpenBtn).hasClass(a.activeClass)?(this.activeTarget.find(a.captionOpenBtn).removeClass(a.activeClass),this.activeTarget.find(a.captionLy).removeClass(a.openClass),this.activeTarget.find(a.captionOpenBtn).find(".hidden").text("open")):(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),b(a.captionOpenBtn).find(".hidden").text("open"),this.activeBtn.addClass(a.activeClass),this.activeTarget.find(a.captionLy).addClass(a.openClass),this.activeBtn.find(".hidden").text("close"))};
d.prototype.captionLyClose=function(e){var f=this;this.activeBtn=b(e.currentTarget);this.activeTarget=this.activeBtn.closest(".audio-controller__controls");this.activeTarget.find(a.captionOpenBtn).removeClass(a.activeClass);this.activeTarget.find(a.captionLy).removeClass(a.openClass);this.activeTarget.find(a.captionOpenBtn).find(".hidden").text("open");setTimeout(function(){f.activeTarget.find(a.captionOpenBtn).focus()},300)};d.prototype.getTimeCodeFromNum=function(a){a=parseInt(a);var b=parseInt(a/
60);a-=60*b;var c=parseInt(b/60);b-=60*c;10>String(a%60)&&(a="0"+String(a%60));10>String(b%60)&&(b="0"+String(b%60));return b+":"+a};d.prototype.init=function(){this.bindEvents()};d.prototype.reInit=function(){this.setProperty();this.bindEvents()};d.prototype.bindEvents=function(){this.audioControl();this.ele.btnPlay.off("click",this.event.playControl).on("click",this.event.playControl);this.ele.btnStop.off("click",this.event.playControl).on("click",this.event.playControl);this.ele.captionOpenBtn.off("click",
this.event.captionLyOpen).on("click",this.event.captionLyOpen);this.ele.captionCloseBtn.off("click",this.event.captionLyClose).on("click",this.event.captionLyClose);this.ele.captionCloseBtn.off("blur",this.event.outFocus).on("blur",this.event.outFocus);this.ele.captionCont.off("blur",this.event.outFocus).on("blur",this.event.outFocus)};d.instances=new WeakMap;window.sg.components.soundStreaming={init:g,reInit:function(){b(a.section).target.forEach(function(a){d.instances.has(a)?d.instances.get(a).reInit():
new d(a)})}};b.ready(g)})();