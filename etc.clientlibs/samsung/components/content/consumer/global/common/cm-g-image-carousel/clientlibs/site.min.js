(function(){var d=window.sg.common.$q,h=window.sg.common.video,f=window.sg.common.swiperManager,k=window.sg.common.constants.BREAKPOINTS,n=window.sg.common.constants.KEY_CODE,g=window.sg.common.utils,l=window.sg.common.utils.extend,m=window.sg.common.lazyLoad,c=function(a){this.selector={section:".image-carousel",slider:".image-carousel__list",slideItem:".image-carousel__item",videoBtn:".image-carousel__anchor .image-carousel__btn-play",videoPopup:".image-carousel__video",videoPopupBtn:".image-carousel__video-wrap .image-carousel__btn-play",
videoClose:".image-carousel__close",thumbSlider:".image-carousel-thumbnail",thumbItem:".image-carousel-thumbnail__item",thumbImgWrap:".image-carousel-thumbnail__image-wrap",thumbActiveCls:"image-carousel-thumbnail__item--active",thumbAnchor:".image-carousel-thumbnail__anchor",isSetHeight:"image-carousel__video-embedded"};this.ele={body:d("body"),window:d(window),section:d(a),swiperEl:null,videoBtn:null,videoPopupBtn:null,videoClose:null};this.autoplaing=this.resizeTarget=this.focusPopup=null;this.handler=
{resize:this.resize.bind(this),setMaxHeight:this.setMaxHeight.bind(this),moveSlideItem:this.moveSlideItem.bind(this),activeSlideItem:this.activeSlideItem.bind(this),changeSlide:this.changeSlide.bind(this),deactiveFocus:this.deactiveFocus.bind(this)};c.instances.set(a,this);this.setElements();this.init()};c.prototype.setElements=function(){this.ele.swiperEl=this.ele.section.find(this.selector.slider).target[0];1===d(this.ele.swiperEl).find(".swiper-slide:not(.swiper-slide-duplicate)").target.length&&
(f.slideRemove(this.ele.swiperEl),f.slideInit(this.ele.swiperEl,{followFinger:!1,loop:!1}));this.ele.videoBtn=this.ele.section.find(this.selector.videoBtn);this.ele.videoClose=this.ele.section.find(this.selector.videoClose);this.ele.videoPopupBtn=this.ele.section.find(this.selector.videoPopupBtn);this.ele.thumbItem=this.ele.section.find(this.selector.thumbItem);this.ele.thumbSlider=this.ele.section.find(this.selector.thumbSlider).target[0];this.ele.thumbAnchor=this.ele.section.find(this.selector.thumbAnchor);
this.ele.moveBtn=this.ele.section.find(".swiper-button-prev, .swiper-button-next, .indicator");this.swiperOption=JSON.parse(this.ele.swiperEl.dataset.swiperOption);this.ele.mainSwiper=f.getSwiper(this.ele.swiperEl);this.videoFlag=this.keyFlag=this.minSlide=!1;this.prevIdx=0};c.prototype.removeOneSlider=function(){var a=!1;this.slideLength=this.ele.section.find(this.selector.thumbItem).target.length;this.minSlide=5>this.slideLength?!0:!1;this.optionMain={loopedSlides:4};this.optionThumb={loopedSlides:4,
watchSlidesVisibility:!0,watchSlidesProgress:!0};1>=this.slideLength&&(a=!0);if(a)return this.ele.moveBtn.css({display:"none"}),this.ele.thumbItem.eq(0).addClass("swiper-slide-active"),!0;this.ele.moveBtn.css({display:""});void 0===this.ele.swiperEl.swiper&&f.slideInit(this.ele.swiperEl,l(JSON.parse(this.ele.swiperEl.dataset.swiperOption),this.optionMain));this.ele.mainSwiper=f.getSwiper(this.ele.swiperEl);this.minSlide?this.activeSlideItem(0):(void 0===this.ele.thumbSlider.swiper&&f.slideInit(this.ele.thumbSlider,
l(JSON.parse(this.ele.thumbSlider.dataset.swiperOption),this.optionThumb)),this.ele.thumbSwiper=f.getSwiper(this.ele.thumbSlider),this.ele.mainSwiper.controller.control=this.ele.thumbSwiper,this.ele.thumbSwiper.controller.control=this.ele.mainSwiper);this.ele.section.find(this.selector.slider).addClass("basic-swiper");this.ele.section.find(this.selector.thumbSlider).addClass("basic-swiper");this.ele.thumbItem=this.ele.section.find(this.selector.thumbItem);this.ele.thumbImgWrap=this.ele.section.find(this.selector.thumbImgWrap);
return!1};c.prototype.init=function(){var a=this;setTimeout(function(){a.setElements();a.videoEvents();a.ele.section.hasClass("image-carousel__thumb-swiper")&&!a.removeOneSlider()&&(a.setHeight(),a.bindEvents(),a.setSlideAttr())},30)};c.prototype.reInit=function(){this.ele.section.find(".swiper-container").target.forEach(function(a){void 0!==a.swiper&&f.slideReInit(a)});this.init()};c.prototype.resize=function(){null!==this.resizeTarget&&(k.MOBILE<g.getViewPort().width?(this.focusPopup.css({height:this.resizeTarget.height()+
"px"}),this.focusPopup.hasClass("image-carousel__video-embedded")&&"fixed"===this.ele.body.css("position")&&g.visibleScroll()):(this.focusPopup.css({height:""}),this.focusPopup.hasClass("image-carousel__video-embedded")&&"fixed"!==this.ele.body.css("position")&&g.hiddenScroll()))};c.prototype.videoEvents=function(){this.ele.videoBtn.off("click").on("click",this.showPopup.bind(this));this.ele.videoPopupBtn.off("click").on("click",this.playVideo.bind(this));this.ele.videoClose.off("click").on("click",
this.closePopup.bind(this))};c.prototype.bindEvents=function(){this.ele.window.off("resize",this.handler.setMaxHeight).on("resize",this.handler.setMaxHeight);this.minSlide?(this.ele.thumbItem.off("click",this.handler.moveSlideItem).on("click",this.handler.moveSlideItem),this.ele.mainSwiper.off("slideChange",this.handler.activeSlideItem).on("slideChange",this.handler.activeSlideItem)):(this.ele.thumbItem.off("keydown",this.handler.moveSlideItem).on("keydown",this.handler.moveSlideItem),this.ele.thumbSwiper.off("slideChange",
this.handler.changeSlide).on("slideChange",this.handler.changeSlide),this.ele.moveBtn.off("keydown",this.handler.deactiveFocus).on("keydown",this.handler.deactiveFocus))};c.prototype.deactiveFocus=function(){this.keyFlag=!1};c.prototype.moveSlideItem=function(a){var b=d(a.target).closest(this.selector.thumbItem),e=Number(b.attr("data-swiper-slide-index"));this.minSlide?this.ele.mainSwiper.slideToLoop(b.index()):a.keyCode===n.ENTER&&(a=e-this.prevIdx,this.keyFlag=!0,b.hasClass("swiper-slide-active")||
(0<a?a===this.slideLength-1?this.ele.mainSwiper.slidePrev():this.ele.mainSwiper.slideNext():a===Number("-"+(this.slideLength-1))?this.ele.mainSwiper.slideNext():this.ele.mainSwiper.slidePrev()))};c.prototype.activeSlideItem=function(a){null!==this.focusPopup&&(this.videoFlag=!0,this.closePopup());a=void 0===a?this.ele.mainSwiper.realIndex:a;this.ele.thumbItem.removeClass("swiper-slide-active");this.ele.thumbItem.eq(a).addClass("swiper-slide-active")};c.prototype.changeSlide=function(){var a=this;
null!==this.focusPopup&&(this.videoFlag=!0,this.closePopup());this.setSlideAttr();if(0===this.ele.mainSwiper.realIndex)this.ele.thumbAnchor.off("click").on("click",function(b){b=Number(d(b.target).closest(a.selector.thumbItem).attr("data-swiper-slide-index"));var e=a.ele.mainSwiper.realIndex;b!==e+1&&b!==e+2||a.ele.thumbSwiper.slideToLoop(b)});else if(this.ele.mainSwiper.realIndex===this.slideLength-1)this.ele.thumbAnchor.off("click").on("click",function(b){b=Number(d(b.target).closest(a.selector.thumbItem).attr("data-swiper-slide-index"));
var e=a.ele.mainSwiper.realIndex;b!==e-1&&b!==e-2||a.ele.thumbSwiper.slideToLoop(b)});else this.ele.thumbAnchor.off("click");this.prevIdx=this.ele.thumbSwiper.realIndex};c.prototype.setSlideAttr=function(){var a=this,b=null;void 0!==event&&"transitionend"===event.type&&!0===this.keyFlag&&(b=!0,this.keyFlag=!1);setTimeout(function(){a.ele.thumbItem.target.forEach(function(e){e=d(e);var c=e.hasClass("swiper-slide-active")||e.hasClass("swiper-slide-prev")||e.hasClass("swiper-slide-next");a.minSlide?
(e.attr("aria-hidden",!1),e.find(a.selector.thumbAnchor).removeAttr("tabindex")):c?(e.attr("aria-hidden",!1),e.find(a.selector.thumbAnchor).attr("tabindex",0),e.hasClass("swiper-slide-active")&&!0===b&&e.find(a.selector.thumbAnchor).focus()):(e.attr("aria-hidden",!0),e.find(a.selector.thumbAnchor).attr("tabindex",-1))})},30)};c.prototype.showPopup=function(a){var b=d(a.currentTarget);a=b.closest(this.selector.slideItem);b=d("#"+b.attr("data-video-id"));var e=b.find("div.video").target[0];this.ele.videoPopupBtn.show();
b.css({display:"block"});b.attr("tabindex",0);b.focus();b.hasClass("image-carousel__video-layer-popup")&&g.hiddenScroll();"mobile"===g.getCurrentDevice()&&b.hasClass("image-carousel__video-embedded")&&g.hiddenScroll();this.focusPopup=b;b.hasClass(this.selector.isSetHeight)&&(k.MOBILE<g.getViewPort().width&&b.css({height:a.height()+"px"}),this.resizeTarget=a,this.ele.window.off("resize",this.handler.resize).on("resize",this.handler.resize));h.init(e);void 0!==this.swiperOption.autoplay&&this.swiperOption.autoplay.start&&
f.slideStop(this.ele.swiperEl)};c.prototype.closePopup=function(){this.focusPopup.css({display:"none"});this.focusPopup.attr("tabindex","");this.videoFlag||this.ele.section.find(".swiper-slide-active "+this.selector.videoBtn).focus();(this.focusPopup.hasClass("image-carousel__video-layer-popup")||this.focusPopup.hasClass("image-carousel__video-embedded"))&&g.visibleScroll();h.dispose(this.focusPopup.find("div.video").target[0]);this.resizeTarget=this.focusPopup=null;this.ele.window.off("resize",this.handler.resize);
void 0!==this.swiperOption.autoplay&&this.swiperOption.autoplay.start&&f.slideStart(this.ele.swiperEl)};c.prototype.playVideo=function(a){var b=d(a.currentTarget);a=d("#"+b.attr("data-video-id")).find("div.video").target[0];a.querySelector(".video-player").onended=function(){b.show()};window.sg.common.video.play(a);b.hide()};c.prototype.setHeight=function(){var a=this;this.ele.thumbImgWrap.target.forEach(function(b){b=d(b).find(".image__main");if(0<b.target[0].naturalWidth)a.setMaxHeight();else b.on("load",
function(){a.setMaxHeight()})})};c.prototype.setMaxHeight=function(){var a=[];this.ele.thumbImgWrap.css({height:""});this.ele.thumbImgWrap.target.forEach(function(b){a.push(d(b).height())});var b=Math.max.apply(null,a);this.ele.thumbImgWrap.target.forEach(function(a){d(a).css({height:b+"px"})})};c.instances=new WeakMap;window.sg.components.commonImageCarousel={reInit:function(){m.setLazyLoad();d(".image-carousel").target.forEach(function(a){c.instances.has(a)?c.instances.get(a).reInit():new c(a)})}};
d.ready(function(){m.setLazyLoad();d(".image-carousel").target.forEach(function(a){c.instances.has(a)||new c(a)})})})();(function(d){d(function(){0<d(".image-carousel").length&&d(".image-carousel").each(function(h){var f=d(this),k=f.find(".image-carousel__btn-play");f=f.find(".image-carousel__video");k.each(function(){var f=d(this),g=f.attr("data-video-id");f.attr("data-video-id",g+"-"+h)});f.each(function(){var f=d(this),g=f.attr("id");f.attr("id",g+"-"+h)})})})})(window.jQuery);