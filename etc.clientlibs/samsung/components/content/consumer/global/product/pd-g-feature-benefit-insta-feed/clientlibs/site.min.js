(function(){var l=window.sg.common.constants.BREAKPOINTS,g=window.sg.common.utils,m=window.sg.common.libs,d=window.sg.common.$q,f=window.sg.common.video,k=window.sg.common.lazyLoad,b=function(a){this.selector={section:".insta-feed",moreBtn:".insta-feed__inner \x3e .insta-feed__cta-wrap \x3e .cta",boxs:".insta-feed__item",showBox:".insta-feed__item:not(.is-item-visible)",openlayerBtn:".insta-feed__button",closelayerBtn:".insta-feed__layer-close",videoBtn:".insta-feed__layer-button.js-video",videoLayer:".insta-feed__video",
stopVideo:".insta-feed__layer-button.js-cta-pause"};this.ele={window:d(window),section:d(a),openlayerBtn:null,closelayerBtn:null,moreBtn:null,videoBtn:null};this.plaingVideo=this.focusLast=this.focusPopup=null;this.setProperty();this.handler={focusLock:function(a){a.keyCode===m.keyCode.TAB_KEY&&(this.focusLast.target[0]===document.activeElement&&!1===a.shiftKey?(a.preventDefault(),this.focusPopup.focus()):this.focusPopup.target[0]===document.activeElement&&!0===a.shiftKey&&(a.preventDefault(),this.focusLast.focus()))}.bind(this),
imageClass:function(a){this.setImgClass(a.currentTarget)}.bind(this)};b.instances.set(a,this);this.init()};b.prototype.setProperty=function(){this.ele.openlayerBtn=this.ele.section.find(this.selector.openlayerBtn);this.ele.closelayerBtn=this.ele.section.find(this.selector.closelayerBtn);this.ele.moreBtn=this.ele.section.find(this.selector.moreBtn);this.ele.videoBtn=this.ele.section.find(this.selector.videoBtn)};b.prototype.init=function(){this.bindEvents();this.showBox(!1)};b.prototype.reInit=function(){this.setProperty();
this.bindEvents()};b.prototype.bindEvents=function(){this.ele.openlayerBtn.off("click").on("click",this.openBoxLayer.bind(this));this.ele.closelayerBtn.off("click").on("click",this.closeBoxLayer.bind(this));this.ele.videoBtn.off("click").on("click",this.setVideo.bind(this));this.ele.moreBtn.off("click").on("click",this.showBox.bind(this))};b.prototype.setVideo=function(){var a=this;this.plaingVideo=this.focusPopup.find("div.video");if(void 0!==this.plaingVideo){var b=this.focusPopup.find(this.selector.videoLayer),
c=this.focusPopup.find(this.selector.stopVideo);this.focusPopup.find(this.selector.videoBtn).css({display:"none"});b.css({display:"block"});b.attr("tabindex",0);b.focus();f.init(this.plaingVideo.target[0]);if("mp4"===this.plaingVideo.attr("data-video-type")){var e=this.plaingVideo.find("video");c.css({display:"block"});c.removeClass("playing");c.removeClass("pause");e.off("ended").on("ended",function(){a.removeVideo(!1)});c.off("click").on("click",function(){e.target[0].paused?(e.target[0].play(),
(c.hasClass("playing")||c.hasClass("pause"))&&c.addClass("playing"),c.removeClass("pause")):(e.target[0].pause(),c.removeClass("playing"),c.addClass("pause"))})}}};b.prototype.removeVideo=function(a){a=void 0===a?!0:a;if(null!==this.plaingVideo){var b=this.focusPopup.find(this.selector.videoLayer),c=this.focusPopup.find(this.selector.stopVideo),e=this.focusPopup.find(this.selector.videoBtn),d=this.plaingVideo.find("video");f.dispose(this.plaingVideo.target[0]);e.css({display:""});b.css({display:""});
c.css({display:"none"});c.removeClass("playing");c.removeClass("pause");a&&(d.off("ended"),c.off("click"),this.plaingVideo=null)}};b.prototype.showBox=function(a){var b=this;a=void 0===a?!0:a;var c=l.MOBILE<g.getViewPort().width?this.ele.section.attr("data-desktop-per-page"):this.ele.section.attr("data-mobile-per-page"),e=d(this.ele.section.find(this.selector.showBox).target.slice(0,c)),h=0;e.target.forEach(function(a){d(a).addClass("is-item-visible")});var f=function(){var a=e.eq(h);h<c&&(a.addClass("is-item-active"),
setTimeout(f,100));h++}.bind(this);k.setLazyLoad();setTimeout(f,300);e.target.forEach(function(a){a=a.querySelector(".insta-feed__image img");null!==a&&(a.complete&&b.setImgClass(a),a.removeEventListener("load",b.handler.imageClass),a.addEventListener("load",b.handler.imageClass))});a&&e.eq(0).find(this.selector.openlayerBtn).focus();0===this.ele.section.find(this.selector.showBox).target.length&&this.ele.moreBtn.css({display:"none"})};b.prototype.setImgClass=function(a){var b=d(a).closest(".insta-feed__image");
a.naturalWidth<a.naturalHeight?b.addClass("is-portrait"):b.removeClass("is-portrait")};b.prototype.openBoxLayer=function(a){a=a.currentTarget.getAttribute("data-layer-id");this.focusPopup=a=d("#"+a);this.focusLast=a.find(this.selector.closelayerBtn);a.css({display:"block"});a.attr("tabindex",0);a.focus();this.ele.window.off("keydown",this.handler.focusLock).on("keydown",this.handler.focusLock);k.setLazyLoad();0<a.target.length&&g.hiddenScroll()};b.prototype.closeBoxLayer=function(){var a=this.focusPopup,
b=this.focusPopup.closest(this.selector.boxs).find(this.selector.openlayerBtn);a.css({display:"none"});a.attr("tabindex","");b.focus();this.ele.window.off("keydown",this.handler.focusLock);this.removeVideo();this.focusLast=this.focusPopup=null;g.visibleScroll()};b.instances=new WeakMap;window.sg.components.ProductInstaFeed={reInit:function(){d(".insta-feed").target.forEach(function(a){b.instances.has(a)&&b.instances.get(a).reInit()})}};d.ready(function(){d(".insta-feed").target.forEach(function(a){b.instances.has(a)||
new b(a)})})})();