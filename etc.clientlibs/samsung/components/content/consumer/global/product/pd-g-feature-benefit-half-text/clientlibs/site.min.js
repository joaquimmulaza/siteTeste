(function(){function g(){b(a.section).target.forEach(function(a){c.instances.has(a)||new c(a)});window.sg.common.popupVideo.initAll()}var m=window.sg.common.libs,b=window.sg.common.$q,f=window.sg.common.video,n=window.sg.common.lazyLoad,p=window.sg.common.utils.setMobileFocusLoop,q=window.sg.common.utils.removeMobileFocusLoop,k=window.sg.common.utils,l=window.sg.common.constants.BREAKPOINTS,a={section:".st-feature-benefit-half-text",btn:".st-feature-benefit-half-text__btn-play",pop:".feature-benefit-full-bleed__video",
video:"div.video",videoWrap:".st-feature-benefit-half-text__video",popup:".st-feature-benefit-half-text .popup-video",close:".video-area__btn-close",audioWrap:".audio-controller",audioPlayer:".audio-controller__controls",btnPlay:".audio-controller__play-pause",btnStop:".audio-controller__stop",playName:"audio-controller__controls--play",captionOpenBtn:".audio-controller__btn-caption",captionCloseBtn:".audio-caption-layer__close",captionLy:".audio-caption-layer",captionCont:".audio-caption-layer__inner",
activeClass:"is-active",openClass:"is-opened",audioWrapTarget:".audio",audioTarget:"audio",progressFill:".audio-controller__bar-filled",audioTime:".audio-controller__time",dimmClose:".popup-video__btn-video-close"},c=function(a){this.ele={window:b(window),section:b(a),btn:null,pop:null};this.setProperty();this.event={focusLock:this.eventFocusLock.bind(this),outFocus:this.outFocus.bind(this),captionLyClose:this.captionLyClose.bind(this),captionLyOpen:this.captionLyOpen.bind(this),playControl:this.playControl.bind(this),
closePopup:this.closePopup.bind(this)};c.instances.set(a,this);this.init()};c.prototype.setProperty=function(){this.ele.btn=this.ele.section.find(a.btn);this.ele.pop=b("#"+this.ele.btn.attr("data-div-id"));this.ele.video=this.ele.pop.find(a.video).target[0];this.ele.close=this.ele.pop.find(a.close);this.ele.videoWrap=this.ele.section.find(a.videoWrap);this.ele.popup=this.ele.section.find(a.popup);this.ele.popupClose=this.ele.section.find(a.popupClose);this.ele.audioWrap=this.ele.section.find(a.audioWrap);
this.ele.audioPlayer=this.ele.section.find(a.audioPlayer);this.ele.btnPlay=this.ele.section.find(a.btnPlay);this.ele.btnStop=this.ele.section.find(a.btnStop);this.ele.captionOpenBtn=this.ele.section.find(a.captionOpenBtn);this.ele.captionCloseBtn=this.ele.section.find(a.captionCloseBtn);this.ele.captionLy=this.ele.section.find(a.captionLy);this.ele.captionCont=this.ele.section.find(a.captionCont);this.ele.dimmClose=this.ele.section.find(a.dimmClose);this.isExpend=this.ele.section.hasClass("st-feature-benefit-half-text--video-expand");
this.isLayer=this.ele.section.hasClass("st-feature-benefit-half-text--video-layer");this.popup=window.sg.common.popupVideo;this.ele.audioSet=b(".audio-controller");this.activeBtn=this.progressFill=null};c.prototype.eventFocusLock=function(a){a.keyCode===m.keyCode.TAB_KEY&&(!1===a.shiftKey&&this.ele.close.target[0]===document.activeElement?(a.preventDefault(),this.ele.pop.focus()):!0===a.shiftKey&&this.ele.pop.target[0]===document.activeElement&&(a.preventDefault(),this.ele.close.focus()))};c.prototype.openPopup=
function(){var a=this;if(this.isLayer)this.popup.open(this.ele.popup.target[0],0,this.ele.btn.target[0]),l.MOBILE<k.getViewPort().width&&setTimeout(function(){p(a.ele.popup.target[0])},400);else{if(this.ele.videoWrap.hasClass("video-open"))return!1;f.init(this.ele.video);this.ele.videoWrap.addClass("video-open");this.ele.pop.stop().animate({opacity:"1"},300,function(){a.ele.pop.focus()})}this.ele.btn.attr("aria-hidden",!0);this.ele.btn.attr("tabindex","-1")};c.prototype.closePopup=function(){var a=
this;this.isLayer?(l.MOBILE<k.getViewPort().width&&q(),this.ele.btn.removeAttr("aria-hidden"),this.ele.btn.removeAttr("tabindex"),setTimeout(function(){f.dispose(a.ele.video);document.activeElement!==a.ele.btn.target[0]&&a.ele.btn.focus()},300)):(this.ele.btn.removeAttr("aria-hidden"),this.ele.btn.removeAttr("tabindex"),this.ele.btn.focus(),this.ele.pop.stop().animate({opacity:"0"},300,function(){a.ele.videoWrap.removeClass("video-open");a.ele.pop.css({opacity:""});f.dispose(a.ele.video)}))};c.prototype.filledProgress=
function(b){var e=this;b.find(a.progressFill).target[0].style.transform="scaleX("+(b.find(a.audioTarget).target[0].currentTime/b.find(a.audioTarget).target[0].duration).toFixed(4)+")";b.find(a.audioTime).target[0].textContent=this.getTimeCodeFromNum(Math.floor(b.find(a.audioTarget).target[0].duration)-Math.floor(b.find(a.audioTarget).target[0].currentTime));this.progressFill=requestAnimationFrame(function(){return e.filledProgress(b)});b.find(a.audioTarget).target[0].currentTime===b.find(a.audioTarget).target[0].duration&&
(cancelAnimationFrame(this.progressFill),this.progressFill=null)};c.prototype.audioControl=function(){for(var e=this,c=0;c<this.ele.audioSet.target.length;c++)this.ele.audioSet.target[c].setAttribute("data-audio-index",c);this.ele.section.find(a.audioWrap).target.forEach(function(d){function c(e){var c=b(d).find(a.btnPlay).attr("an-la");this.taggingText=null;"play"===e?this.taggingText=c.replace(":pause",":play"):"pause"===e&&(this.taggingText=c.replace(":play",":pause"));b(d).find(a.btnPlay).attr("an-la",
this.taggingText)}b(d).find(a.audioTarget).target[0].load();var h="this.durationTimer"+d.getAttribute("data-audio-index");h=setInterval(function(){2<b(d).find(a.audioTarget).target[0].readyState&&(b(d).find(a.audioTime).target[0].textContent=e.getTimeCodeFromNum(b(d).find(a.audioTarget).target[0].duration),b(d).find(a.audioTime).attr("data-duration-time",e.getTimeCodeFromNum(b(d).find(a.audioTarget).target[0].duration)),clearInterval(h),h=null)},200);b(d).find(a.audioTarget).target[0].addEventListener("playing",
function(){e.progressFill=requestAnimationFrame(function(){return e.filledProgress(b(d))});c("pause")});b(d).find(a.audioTarget).target[0].addEventListener("pause",function(){cancelAnimationFrame(e.progressFill);e.progressFill=null;c("play")});b(d).find(a.audioTarget).target[0].addEventListener("ended",function(){b(d).find(a.audioPlayer).removeClass(a.playName);b(d).closest(a.audioWrap).removeClass("playing");b(d).find(a.btnPlay).find(".hidden").text("play");setTimeout(function(){b(d).find(a.audioTime).text(b(d).find(a.audioTime).attr("data-duration-time"));
b(d).find(a.progressFill).target[0].style.transform="scaleX(0)"},500);c("play")})})};c.prototype.playControl=function(e){function c(b){b.find(a.audioTarget).target[0].pause();b.find(a.audioPlayer).removeClass(a.playName);b.removeClass("playing");b.find(a.btnPlay).find(".hidden").text("play")}var d=this;this.activeBtn=b(e.currentTarget);this.activeTarget=this.activeBtn.closest(a.audioWrap);this.activeBtn.target[0]===this.activeTarget.find(a.btnPlay).target[0]&&setTimeout(function(){d.activeTarget.find(a.audioPlayer).hasClass(a.playName)?
(d.activeTarget.find(a.audioTarget).target[0].pause(),d.activeTarget.find(a.audioPlayer).removeClass(a.playName),d.activeTarget.removeClass("playing"),d.activeTarget.find(a.btnPlay).find(".hidden").text("play")):(0<b(".audio.playing").target.length&&c(b(".audio.playing")),0<b(".audio-controller.playing").target.length&&c(b(".audio-controller.playing")),d.activeTarget.find(a.audioTarget).target[0].play(),d.activeTarget.find(a.audioPlayer).addClass(a.playName),d.activeTarget.addClass("playing"),d.activeTarget.find(a.btnPlay).find(".hidden").text("pause"))},
100);this.activeBtn.target[0]===this.activeTarget.find(a.btnStop).target[0]&&(this.activeTarget.hasClass("playing")&&(this.activeTarget.removeClass("playing"),this.activeTarget.find(a.btnPlay).find(".hidden").text("play")),this.activeTarget.find(a.audioPlayer).removeClass(a.playName),this.activeTarget.find(a.audioTarget).target[0].pause(),this.activeTarget.find(a.audioTarget).target[0].currentTime=0,this.activeTarget.find(a.audioTime).target[0].textContent=this.getTimeCodeFromNum(this.activeTarget.find(a.audioTarget).target[0].duration),
this.activeTarget.find(a.progressFill).target[0].style.transform="scaleX(0)")};c.prototype.getTimeCodeFromNum=function(a){a=parseInt(a);var b=parseInt(a/60);a-=60*b;var c=parseInt(b/60);b-=60*c;10>String(a%60)&&(a="0"+String(a%60));10>String(b%60)&&(b="0"+String(b%60));return b+":"+a};c.prototype.captionLyOpen=function(c){this.activeBtn=b(c.currentTarget);this.activeTarget=this.activeBtn.closest(".audio-controller__controls");this.activeTarget.find(a.captionOpenBtn).hasClass(a.activeClass)?(this.activeTarget.find(a.captionOpenBtn).removeClass(a.activeClass),
this.activeTarget.find(a.captionLy).removeClass(a.openClass),this.activeTarget.find(a.captionOpenBtn).find(".hidden").text("open")):(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),b(a.captionOpenBtn).find(".hidden").text("open"),this.activeBtn.addClass(a.activeClass),this.activeTarget.find(a.captionLy).addClass(a.openClass),this.activeBtn.find(".hidden").text("close"))};c.prototype.captionLyClose=function(c){var e=this;this.activeBtn=b(c.currentTarget);this.activeTarget=
this.activeBtn.closest(".audio-controller__controls");this.activeTarget.find(a.captionOpenBtn).removeClass(a.activeClass);this.activeTarget.find(a.captionLy).removeClass(a.openClass);this.activeTarget.find(a.captionOpenBtn).find(".hidden").text("open");setTimeout(function(){e.activeTarget.find(a.captionOpenBtn).focus()},300)};c.prototype.outFocus=function(c){var e=this;this.activeBtn=b(c.currentTarget);this.activeTarget=this.activeBtn.closest(a.audioPlayer);this.activeBtn.target[0]===this.activeTarget.find(a.captionCloseBtn).target[0]&&
setTimeout(function(){document.activeElement!==e.activeTarget.find(a.captionCont).target[0]&&(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),b(a.captionOpenBtn).find(".hidden").text("open"))},300);this.activeBtn.target[0]===this.activeTarget.find(a.captionCont).target[0]&&setTimeout(function(){document.activeElement!==e.activeTarget.find(a.captionCloseBtn).target[0]&&(b(a.captionOpenBtn).removeClass(a.activeClass),b(a.captionLy).removeClass(a.openClass),b(a.captionOpenBtn).find(".hidden").text("open"))},
300)};c.prototype.init=function(){this.bindEvents()};c.prototype.reInit=function(){this.setProperty();this.ele.video&&f.init(this.ele.video);this.bindEvents()};c.prototype.bindEvents=function(){var a=this;this.ele.btn.off("click").on("click",function(){a.openPopup()});this.ele.close.off("click").on("click",function(){a.closePopup()});this.ele.dimmClose.off("click",this.event.closePopup).on("click",this.event.closePopup);this.ele.audioWrap.target[0]&&(this.audioControl(),this.ele.btnPlay.off("click",
this.event.playControl).on("click",this.event.playControl),this.ele.btnStop.off("click",this.event.playControl).on("click",this.event.playControl),this.ele.captionOpenBtn.off("click",this.event.captionLyOpen).on("click",this.event.captionLyOpen),this.ele.captionCloseBtn.off("click",this.event.captionLyClose).on("click",this.event.captionLyClose),this.ele.captionCloseBtn.off("blur",this.event.outFocus).on("blur",this.event.outFocus),this.ele.captionCont.off("blur",this.event.outFocus).on("blur",this.event.outFocus))};
c.instances=new WeakMap;window.sg.components.featureBenefitHalfText={init:g,reInit:function(){b(a.section).target.forEach(function(a){c.instances.has(a)?c.instances.get(a).reInit():(n.setLazyLoad(),(new c(a)).reInit())});window.sg.common.popupVideo.initAll()}};b.ready(g);b.load(g)})();