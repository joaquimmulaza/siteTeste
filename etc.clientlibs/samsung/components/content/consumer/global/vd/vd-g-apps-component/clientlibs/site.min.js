(function(){var k=window.sg.common.$q,e=window.sg.common.constants.KEY_CODE,m=function(a){this.ele={tabWrap:k(a)};this.selector={tabCta:".tab__item-title"};this.handler={setTabAria:this.setTabAria.bind(this)};m.instances.set(a,this);this.init()};m.prototype.init=function(){this.setProperty();this.bindEvents()};m.prototype.setProperty=function(){this.ele.tabCta=this.ele.tabWrap.find(this.selector.tabCta)};m.prototype.bindEvents=function(){this.ele.tabCta.off("click",this.handler.setTabAria).on("click",
this.handler.setTabAria)};m.prototype.setTabAria=function(){var a=this.ele.tabCta;setTimeout(function(){a.target.forEach(function(a){a=k(a);"true"===a.attr("aria-selected")?(a.attr("aria-controls","appsIconLists"),a.blur(),a.focus()):a.removeAttr("aria-controls")})},300)};var b=function(a){this.element=a;b.instances.set(a,this);this.handler={};this.focusElement=null;this.scrollSize=0;this.init()};b.prototype.init=function(){this.getScrollSize()};b.prototype.reInit=function(){this.getScrollSize()};
b.prototype.openModal=function(a){var c=this;k(c.element).show();document.body.style.overflow="hidden";document.body.scrollHeight>window.innerHeight&&(document.body.style.paddingRight=c.scrollSize+"px");c.focusElement=a;b.ctrAriaHidden(c.element,!0);k(c.element).find(".layer-popup__close").target[0].addEventListener("click",c.closeModal.bind(c),{once:!0});k(window).trigger("resize");0<document.querySelectorAll(".QSIFeedbackButton").length&&(document.querySelectorAll(".QSIFeedbackButton").forEach(function(a){k(a).removeAttr("aria-hidden")}),
k(c.element).removeAttr("aria-modal"));setTimeout(function(){c.setFocus()},200)};b.prototype.closeModal=function(){var a=this;b.ctrAriaHidden(a.element,!1);k(a.element).find(".layer-popup__close").target[0].removeEventListener("click",a.closeModal);setTimeout(function(){k(a.element).hide();document.body.style.overflow="";document.body.style.paddingRight="0";k(a.element).attr("aria-modal","true");a.focusElement&&a.focusElement.focus()},200)};b.prototype.setFocus=function(){var a,c=!1;k(this.element).find(".layer-popup__inner").target.forEach(function(t){0!==
t.offsetWidth&&0!==t.offsetHeight&&(a=t)});var h=k(a).find('a, button, [tabindex\x3d"0"]').target.filter(function(a){return 0<a.offsetWidth&&0<a.offsetHeight});0<document.querySelectorAll(".QSIFeedbackButton").length&&document.querySelectorAll(".QSIFeedbackButton").forEach(function(a){a.hasAttribute("role")||(h.push(k(a).find('a, button, [tabindex\x3d"0"]').target[0]),c=!0)});if(0!==h.length)if(setTimeout(function(){h[0].focus()},200),c){var b=h[0],m=h[h.length-1],q=h[h.length-2];b.addEventListener("keydown",
function(a){e.TAB===a.keyCode&&a.shiftKey&&(a.preventDefault(),m.focus())});m.addEventListener("keydown",function(a){e.TAB===a.keyCode&&a.shiftKey&&(a.preventDefault(),q.focus())});q.addEventListener("keydown",function(a){e.TAB!==a.keyCode||a.shiftKey||(a.preventDefault(),m.focus())});m.addEventListener("keydown",function(a){e.TAB!==a.keyCode||a.shiftKey||(a.preventDefault(),b.focus())})}else h[h.length-1].addEventListener("keydown",function(a){e.TAB!==a.keyCode||a.shiftKey||(a.preventDefault(),h[0].focus())}),
h[0].addEventListener("keydown",function(a){e.TAB===a.keyCode&&a.shiftKey&&(a.preventDefault(),h[h.length-1].focus())})};b.prototype.setElements=function(){this.el={section:k(this.element)}};b.prototype.bindEvents=function(){this.el.checkbox.on("change",this.handler.statusChange)};b.prototype.unBindEvents=function(){this.el.checkbox.off("change",this.handler.statusChange)};b.prototype.getScrollSize=function(){var a=document.createElement("div"),c=document.body;a.style.position="absolute";a.style.top=
"-9999em";a.style.width="50px";a.style.height="50px";a.style.overflow="scroll";c.appendChild(a);this.scrollSize=a.offsetWidth-a.clientWidth;c.removeChild(a)};b.ctrAriaHidden=function(a,c){var b;if(c){do{c=a.previousElementSibling;for(b=a.nextElementSibling;c;)c.setAttribute("aria-hidden",!0),c=c.previousElementSibling;for(;b;)b.setAttribute("aria-hidden",!0),b=b.nextElementSibling;a=a.parentNode}while("BODY"!==a.nodeName)}else{do{c=a.previousElementSibling;for(b=a.nextElementSibling;c;)c.removeAttribute("aria-hidden"),
c=c.previousElementSibling;for(;b;)b.removeAttribute("aria-hidden"),b=b.nextElementSibling;a=a.parentNode}while("BODY"!==a.nodeName)}};var q=function(a){this.ele={section:k(a)};q.instances.set(a,this)};q.prototype.focusTarget=function(a){k(a).focus()};b.instances=new WeakMap;m.instances=new WeakMap;q.instances=new WeakMap;window.sg.components.personalizeAppsComponent={openModal:function(a,c){a=document.querySelector(a);(b.instances.has(a)?b.instances.get(a):new b(a)).openModal(c)},closeModal:function(a){a=
document.querySelector(a);(b.instances.has(a)?b.instances.get(a):new b(a)).closeModal()},focusTarget:function(a){k(".personalize").target.forEach(function(b){q.instances.has(b)?q.instances.get(b).focusTarget(a):(new q(b)).focusTarget(a)})}};k.load(function(){k(".personalize-apps__custom-tab-wrap").target.forEach(function(a){new m(a)})})})();
(function(){function k(a,d,p,b,u){d||(d=f.LastSearchCategory);null==p&&(p=f[d].offset);b||(b=f[d].order);"category"===a?x.getCategoryAppList(d,p,b).done(function(a){r.hideLoader();$.when(x.processApiData(d,p,b,a)).done(function(){u()})}):"paging"===a?f[d]&&f[d]["history-"+p]?(f[d].tvApp=f[d]["history-"+p],u()):x.getCategoryAppList(d,p,b).done(function(a){r.hideLoader();$.when(x.processApiData(d,p,b,a)).done(function(){u()})}):u()}var e=$("div.personalize"),m=e.find("button.tab__item-title");e.find(".menu");
var b=e.find(".menu .menu__select"),q=e.find(".menu .menu__select-field-text"),a=e.find(".menu__select-field"),c=e.find(".personalize-apps__sort-total"),h=e.find(".apps-icon__content"),B=e.find(".personalize-apps__paging .page-num-wrap"),v=e.find(".personalize-apps__paging .page-prev"),w=e.find(".personalize-apps__paging .page-next"),t=e.find(".personalize-apps__paging-more .cta"),y=e.find(".vd-js-loader"),z=e.find(".personalize-apps__popup .layer-popup__title"),C=e.find(".personalize-apps__popup .thumb-img"),
D=e.find(".personalize-apps__popup .decs"),A=e.find(".personalize-apps__popup .scrollbar__contents p"),E=$("#localLang").val().toLowerCase(),F=$("#vdApiDomain").val(),G=$("#swCountryCode").val(),H=$("#appLanguageCode").val(),n={device:window.sg.common.utils.getCurrentDevice(),offset:0,size:function(){return"desktop"===window.sg.common.utils.getCurrentDevice()?60:48},category:m.first().data("category"),order:"asc"},f={LastSearchCategory:n.category},I=Granite.I18n.get("vd.pmt.loading"),J=Granite.I18n.get("price"),
K=Granite.I18n.get("Free"),L=Granite.I18n.get("Categories"),M=Granite.I18n.get("By"),N=Granite.I18n.get("Updated"),r={showLoader:function(){y.find("span.blind").text("");y.show();setTimeout(function(){y.find("span.blind").text(I)},100)},hideLoader:function(){y.hide()},getPageIndex:function(){return Number(e.find(".page-link.is-active").text())},getLangAttr:function(a){var g="";a&&E!==a.toLowerCase()&&(g=a);return g},processAppPopupDescription:function(a,d){var g=a;d.forEach(function(a){g=g.replace(new RegExp("\\"+
a,"g"),"\x3cbr/\x3e")});return g},processDate:function(a){return a.replace(/-/g,"/")}},x={getCategoryAppList:function(a,d,b){d={country_code:G,language_code:H,offset:d,size:n.size(),order:b};"All"!=a&&(d.productCategoryName=a);return $.ajax({url:F+"/tvs/tvpersonalize/api/tvapps/appserver/list",type:"GET",data:d,contentType:"application/json",beforeSend:function(){r.showLoader()}})},processApiData:function(a,d,b,c){var g=$.Deferred();null!=c&&(null==f[a]&&(f[a]={}),f[a].tvApp=[],f[a].allCount=c.data.allCount,
c.data.tvApp.forEach(function(g){var d=g.appImageUrl||"";d=d.replace("{w}","198");d=d.replace("{h}","198");f[a].tvApp.push({appId:g.appId,appZipSize:g.appZipSize,appImageUrl:d,appName:g.appName,appCategoryName:g.appCategoryName,appDescription:g.appDescription,appLanguage:g.appLanguage,appVendorName:g.appVendorName,modificationDateTime:g.modificationDateTime})}),f[a].offset=d,f[a].order=b,"desktop"===n.device?f[a]["history-"+d]=f[a].tvApp:(0!==d&&f[a].mobile||(f[a].mobile=[]),f[a].mobile=f[a].mobile.concat(f[a].tvApp),
f[a].tvApp=f[a].mobile));g.resolve("complete");return g.promise()}},l={init:function(){k("category",n.category,n.offset,n.order,function(){l.categoryArea();l.appPaging()});l.bindEvent()},bindEvent:function(){l.events.categoryClick();l.events.sortChange();l.events.menuClick();l.events.prevPageClick();l.events.nextPageClick();l.events.viewMoreClick()},categoryArea:function(a){var g=f.LastSearchCategory,p=f[g],k=p.offset,u=p.allCount;"mobile"===n.device&&u>48*(k+1)?t.show():t.hide();var e="";p.tvApp.forEach(function(a,
d){langAttr="";""!==r.getLangAttr(a.appLanguage)&&(langAttr+="lang\x3d"+r.getLangAttr(a.appLanguage));e+='\x3cli class\x3d"list" role\x3d"listitem"\x3e\n\t\t\t\t\t\t\x3cbutton type\x3d"button" class\x3d"personalize-apps__icon" aria-label\x3d"'+a.appName+' view detail" data-app-id\x3d"'+a.appId+'" data-app-idx\x3d"'+d+'"\n\t\t\t\t\t\t\tan-tr\x3d"vd03_apps component-vd marketing page-app click-content_click" an-ca\x3d"content click" an-ac\x3d"feature" an-la\x3d"browse more apps:'+g.toLowerCase()+":"+
a.appName.toLowerCase()+'" '+langAttr+' onclick\x3d"window.sg.components.personalizeAppsComponent.openModal(\'.personalize .personalize-apps__popup\', this)"\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"s-box"\x3e\n\t\t\t\t\t\t\t\t\x3cimg src\x3d"'+a.appImageUrl+'" alt\x3d"" class\x3d"mCS_img_loaded"\x3e\n\t\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"icon-name"\x3e'+a.appName+"\x3c/span\x3e\n\t\t\t\t\t\t\x3c/button\x3e\n\t\t\t\t\t\x3c/li\x3e"});c.html(Granite.I18n.get("vd.apps.all.count",
"\x3cspan\x3e"+p.allCount+"\x3c/span\x3e"));h.html(e);b.val(p.order);q.text(b.find("option:selected").text());p=h.find(".personalize-apps__icon");a&&"mobile"===n.device&&48<p.length&&p.eq(48*k).focus();p.click(function(){var a=$(this).data("app-idx");l.appPopup(a,g)})},appPopup:function(a,d){a=f[d].tvApp[a];var g=new Date(r.processDate(a.modificationDateTime));d='\x3cimg src\x3d"'+a.appImageUrl+'" alt\x3d""\x3e';g='\x3cli role\x3d"listitem"\x3e\n\t\t\t\t\t\x3cstrong class\x3d"hidden"\x3e'+J+'\x3c/strong\x3e\n\t\t\t\t\t\x3cspan class\x3d"txt price"\x3e'+
K+'\x3c/span\x3e\n\t\t\t\t\x3c/li\x3e\n\t\t\t\t\x3cli role\x3d"listitem"\x3e\n\t\t\t\t\t\x3cstrong\x3e'+L+' :\x3c/strong\x3e\n\t\t\t\t\t\x3cspan class\x3d"txt"\x3e'+a.appCategoryName+'\x3c/span\x3e\n\t\t\t\t\x3c/li\x3e\n\t\t\t\t\x3cli role\x3d"listitem"\x3e\n\t\t\t\t\t\x3cstrong\x3e'+M+' :\x3c/strong\x3e\n\t\t\t\t\t\x3cspan class\x3d"txt"\x3e'+a.appVendorName+'\x3c/span\x3e\n\t\t\t\t\x3c/li\x3e\n\t\t\t\t\x3cli role\x3d"listitem"\x3e\n\t\t\t\t\t\x3cstrong\x3e'+N+' :\x3c/strong\x3e\n\t\t\t\t\t\x3cspan class\x3d"txt"\x3e'+
g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear()%1E3+"\x3c/span\x3e\n\t\t\t\t\x3c/li\x3e";var b=r.getLangAttr(a.appLanguage);""!==b?(z.attr("lang",b),A.attr("lang",b)):(z.removeAttr("lang"),A.removeAttr("lang"));z.html(a.appName);C.html(d);D.html(g);A.html(r.processAppPopupDescription(a.appDescription,["\\n"]))},appPaging:function(a){null==a&&(a=1);var d=f[f.LastSearchCategory].allCount,b=0;b=0<d%n.size()?Math.ceil(d/n.size()):Math.round(d/n.size());0===b&&(b=1);d=[1,1,2,3,4,5,b];if(5<=a)for(var g=
1,c=a-2;c<=a+2;c++)d[g++]=c;if(a>b-4)for(g=1,c=b-4;c<=b;c++)d[g++]=c;var e=c=!1;0<d[1]-d[0]&&(c=!0);1<d[d.length-1]-d[d.length-2]&&(e=!0);g="";g=c?'\x3cspan class\x3d"page-blind page-left-dot"\x3e...\x3c/span\x3e':'\x3cspan class\x3d"page-blind page-left-dot" style\x3d"display:none;"\x3e...\x3c/span\x3e';c="";c=e?'\x3cspan class\x3d"page-blind page-right-dot"\x3e...\x3c/span\x3e':'\x3cspan class\x3d"page-blind page-right-dot" style\x3d"display:none;"\x3e...\x3c/span\x3e';e=[];for(var h=1;h<=b;h++){for(var m=
!1,q=0;q<d.length;q++)if(h==d[q]){m=!0;break}h==a?e.push('\x3ca href\x3d"javascript:void(0)" class\x3d"page-link is-active" aria-current\x3d"page"\n\t\t\t\t\t\t\t\t\t\tan-tr\x3d"vd03_apps component-vd marketing page-index-indication" an-ca\x3d"indication" an-ac\x3d"carousel" an-la\x3d"carousel:index:'+h+'"\x3e'+h+"\x3c/a\x3e"):m?e.push('\x3ca href\x3d"javascript:void(0)" class\x3d"page-link"\n\t\t\t\t\t\t\t\t\t\t\tan-tr\x3d"vd03_apps component-vd marketing page-index-indication" an-ca\x3d"indication" an-ac\x3d"carousel" an-la\x3d"carousel:index:'+
h+'"\x3e'+h+"\x3c/a\x3e"):e.push('\x3ca href\x3d"javascript:void(0)" class\x3d"page-link" style\x3d"display: none;"\n\t\t\t\t\t\t\t\t\t\t\tan-tr\x3d"vd03_apps component-vd marketing page-index-indication" an-ca\x3d"indication" an-ac\x3d"carousel" an-la\x3d"carousel:index:'+h+'"\x3e'+h+"\x3c/a\x3e")}e.splice(1,0,g);e.splice(e.length-1,0,c);1!=a?(v.removeClass("is-disabled"),v.attr("aria-disabled",!1)):(v.addClass("is-disabled"),v.attr("aria-disabled",!0));a!=b?(w.removeClass("is-disabled"),w.attr("aria-disabled",
!1)):(w.addClass("is-disabled"),w.attr("aria-disabled",!0));B.html(e);$(".page-link").click(function(){var a=$(this);if(!a.hasClass("is-active")){var b=Number(a.text());k("paging",null,b-1,null,function(){l.categoryArea();l.appPaging(b);window.sg.components.personalizeAppsComponent.focusTarget($(".page-link")[r.getPageIndex()-1])})}})},events:{categoryClick:function(){m.click(function(){var a=$(this).data("category");f.LastSearchCategory=a;f[a]?(l.categoryArea(),l.appPaging(f[a].offset+1)):k("category",
a,n.offset,n.order,function(){l.categoryArea();l.appPaging()})})},menuClick:function(){a.click(function(){var a=e.find("li.menu__list-option-wrap"),d=b.find("option").index(b.find("option:selected"));a.removeClass("active");a.eq(d).addClass("active")})},sortChange:function(){b.on("change",function(){var a=f.LastSearchCategory,b=$(this).val(),c=f[a].offset;if(""!=$.trim(b)){for(var e=Object.keys(f[a]),h=0;h<e.length;h++)/history-[0-9]/.test(e[h])&&delete f[a][e[h]];"mobile"===n.device&&(c=0,f[a].offset=
0);k("category",a,c,b,function(){l.categoryArea();l.appPaging(c+1)})}})},prevPageClick:function(){v.click(function(){if(!$(this).hasClass("is-disabled")){var a=r.getPageIndex()-1;k("paging",null,a-1,null,function(){l.categoryArea();l.appPaging(a)})}})},nextPageClick:function(){w.click(function(){if(!$(this).hasClass("is-disabled")){var a=r.getPageIndex()+1;k("paging",null,a-1,null,function(){l.categoryArea();l.appPaging(a)})}})},viewMoreClick:function(){var a=!1;t.click(function(){if(!a){var b=f.LastSearchCategory,
c=f[b].order,e=f[b].offset+1,g=f[b].allCount,h=e+1,m=0;m=0<g%n.size()?Math.ceil(g/n.size()):Math.round(g/n.size());m>=h&&(a=!0,k("category",b,e,c,function(){l.categoryArea(!0);l.appPaging(h);a=!1}))}})}}};$(window).bind("resize",function(){if(n.device!=window.sg.common.utils.getCurrentDevice()){n.device=window.sg.common.utils.getCurrentDevice();var a=f.LastSearchCategory;k("category",a,n.offset,f[a].order,function(){l.categoryArea();l.appPaging()})}});$(function(){l.init()})})();