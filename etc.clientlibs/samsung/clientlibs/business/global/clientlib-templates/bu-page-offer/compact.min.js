(() => {
  const $q = window.sg.common.$q;
  const selector = {
    section: '.notification-bar',
  };
  
  class NotificationBar {
    constructor(component) {
      this.selector = {
        section: selector.section,
        btn: '.notification-bar__toggle-btn',
        hidden: '.notification-bar__toggle-btn .hidden',
        content: '.notification-bar__inner',
        nomarl: '.notification-bar__column--collapsed',
        expend: '.notification-bar__column--expanded',
      };
      
      this.timer = null;
      this.ele = {
        window: $q(window),
        section: $q(component),
        btn: null,
        content: null,
        nomarl: null,
        expand: null,
      };

      this.handler = {
        resize: () => {
          this.ele.section.css({
            'height': '',
          });

          if (this.timer) {
            clearTimeout(this.timer);
          }
          setTimeout(() => {
            this.setHeight();
          }, 400);
        },
      };

      this.setProperty();

      NotificationBar.instances.set(component, this);

      this.init();
    }
    
    setProperty() {
      this.ele.btn = this.ele.section.find(this.selector.btn);
      this.ele.hidden = this.ele.section.find(this.selector.hidden);
      this.ele.content = this.ele.section.find(this.selector.content);
      this.ele.pdBanner = this.ele.section.find(this.selector.pdBanner);
      this.ele.nomarl = this.ele.section.find(this.selector.nomarl);
      this.ele.expand = this.ele.section.find(this.selector.expend);
    }

    init() {
      this.bindEvents();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
    }

    setHeight() {
      this.ele.section.css({
        'height': `${this.ele.content.outerHeight()}px`,
      });
    }

    bindEvents() {
      this.ele.btn.off('click').on('click', () => {
        if (this.ele.section.hasClass('is-expanded')) {
          this.closeBanner();
        } else {
          this.openBanner();
        }
      });

      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      this.setHeight();
    }

    openBanner() {
      this.ele.section.addClass('is-expanded');
      this.ele.section.attr('aria-expanded', true);
      this.ele.nomarl.hide();
      this.ele.expand.show();
      this.ele.hidden.innerHTML('Click to Collapse');
      this.setHeight();
    }

    closeBanner() {
      this.ele.section.removeClass('is-expanded');
      this.ele.section.attr('aria-expanded', false);
      this.ele.nomarl.show();
      this.ele.expand.hide();
      this.ele.hidden.innerHTML('Click to Expand');
      this.setHeight();
    }
  }

  function init() {
    $q(selector.section).target.forEach((element) => {
      if (!NotificationBar.instances.has(element)) {
        new NotificationBar(element);
      }
    });
  }
  
  function reInit() {
    $q(selector.section).target.forEach((element) => {
      if (NotificationBar.instances.has(element)) {
        const instances =  NotificationBar.instances.get(element);
        instances.reInit();
      } else {
        new NotificationBar(element);
      }
    });
  }

  function closeBanner(motion = true) {
    $q(selector.section).target.forEach((element) => {
      if (NotificationBar.instances.has(element)) {
        const instances =  NotificationBar.instances.get(element);
        instances.closeBanner(motion);
      }
    });
  }

  NotificationBar.instances = new WeakMap();

  window.sg.components.notificationBar = { 
    init,
    reInit,
    closeBanner,
  };

  $q.ready(init);
})();


(() => {
  const $q = window.sg.common.$q;
  const layerPopupMaxHeight = window.sg.common.layerPopupMaxHeight;
  const scrollbar = window.sg.common.scrollbar;
  const utils = window.sg.common.utils;

  let eipPopupEls = {};

  const selector = {
    section: '.eip-popup',
    layerPopup: '.layer-popup',
    close: '.layer-popup__close',
  };

  let tabIndex = -1;
  let selectItemIndex = -1;

  function init() {
    const eipPopup = document.querySelector('.eip-popup');

    if (!eipPopup) {
      return;
    }

    setElements(eipPopup);

    layerPopupMaxHeight.init(eipPopupEls.layerEl);

    bindEvents();
  }

  function setElements(el) {
    eipPopupEls = {
      el,
      layerEl: el.querySelector('.layer-popup'),
      closeEl: el.querySelector('.layer-popup__close'),
      tabEl: el.querySelectorAll('.eip-popup__tab'),
      parentEl: null,
    };
  }

  function bindEvents() {
    eipPopupEls.closeEl.addEventListener('click', closePopup);

    const closeBtn = document.querySelector(`${selector.section} ${selector.close}`);
    closeBtn.removeEventListener('keydown', keydownCloseBtn);
    closeBtn.addEventListener('keydown', keydownCloseBtn);
    
    const layer = document.querySelector(`${selector.section} ${selector.layerPopup}`);
    layer.removeEventListener('keydown', keydownLayer);
    layer.addEventListener('keydown', keydownLayer);

    if (eipPopupEls.tabEl[tabIndex]) {
      window.addEventListener('resize', () => {
        scrollbar.resize(eipPopupEls.tabEl[tabIndex].querySelector('.eip-popup__tab--select-wrap'));
        scrollbar.resize(eipPopupEls.tabEl[tabIndex].querySelector('.eip-popup__tab--table-wrap'));
      });
    }
  }

  function keydownLayer(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      const firstFocusEl = eipPopupEls.layerEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];

      if (firstFocusEl && evt.target === firstFocusEl) {
        evt.preventDefault();
        document.querySelector(`${selector.section} ${selector.close}`).focus();
      }
    }
  }

  function keydownCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      const firstFocusEl = eipPopupEls.layerEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];

      if (firstFocusEl) {
        firstFocusEl.focus();
      }
    }
  }


  function originFocus() {
    if (eipPopupEls.parentEl !== null) {
      eipPopupEls.parentEl.focus();
      eipPopupEls.parentEl = null;
    } else {
      utils.buyingFocus('eipPopup');
      // if (document.querySelector('.pd-buying-tool [data-target-popup="eipPopup"]') !== null) {
      //   document.querySelector('.pd-buying-tool [data-target-popup="eipPopup"]').focus();
      // }
    }
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
    utils.setMobileFocusLoop(eipPopupEls.el);
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
    utils.removeMobileFocusLoop();
  }

  function closePopup() {
    if (document.querySelector('.eip-popup__frame iframe')) {
      document.querySelector('.eip-popup__frame iframe').src = '';
    }

    tabIndex = -1;
    selectItemIndex = -1;

    eipPopupEls.layerEl.classList.remove('eip-popup--show');
    eipPopupEls.el.removeAttribute('style');
    utilsHide();
    originFocus();
  }

  function showPopup(btn) {
    eipPopupEls.el.style.display = 'block';
    eipPopupEls.layerEl.classList.add('eip-popup--show');
    // eipPopupEls.el.focus();

    const firstFocusEl = eipPopupEls.layerEl.querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];
    firstFocusEl.focus();

    layerPopupMaxHeight.reInit(eipPopupEls.layerEl);
    utilsShow();

    if (btn !== undefined) {
      eipPopupEls.parentEl = btn;
    }
  }

  function bindAdditionalEvent() {
    tabIndex = 0;
    selectItemIndex = 0;

    const selectTabEl = eipPopupEls.tabEl[tabIndex];
    const moDropdownEl = selectTabEl.querySelector('.eip-popup__tab--dropdown');
    const selectWrapEl = selectTabEl.querySelector('.eip-popup__tab--select-wrap');
    const tableWrapEl = selectTabEl.querySelector('.eip-popup__tab--table-wrap');
    const selectItemEls = selectTabEl.querySelectorAll('.eip-popup__tab--select-item');

    selectTabEl.classList.add('active');
    selectItemEls[selectItemIndex].classList.add('active');

    scrollbar.resize(selectWrapEl);
    scrollbar.resize(tableWrapEl);

    moDropdownEl.removeEventListener('click', dropdownEvent);
    moDropdownEl.addEventListener('click', dropdownEvent);

    selectWrapEl.querySelectorAll('.eip-popup__tab--select-item button').forEach((el) => {
      el.removeEventListener('click', selectItemEvent);
      el.addEventListener('click', selectItemEvent);
    });
  }

  function dropdownEvent(e) {
    const eTarget = $q(e.target);
    if (eTarget.hasClass('open')) {
      eTarget.removeClass('open');
      eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--select-wrap').removeClass('open');
    } else {
      eTarget.addClass('open');
      eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--select-wrap').addClass('open');
    }
  }

  function selectItemEvent(e){
    const eTarget = $q(e.target);
    eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--select-item').removeClass('active');
    eTarget.closest('.eip-popup__tab--select-item').addClass('active');
    eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--dropdown').target[0].innerHTML = eTarget.target[0].innerHTML;
    eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--dropdown').removeClass('open');
    eTarget.closest('.eip-popup__tab').find('.eip-popup__tab--select-wrap').removeClass('open');
    selectItemIndex = eTarget.closest('.eip-popup__tab--select-item').index();
  }

  function resizeTableWrap() {
    scrollbar.resize(eipPopupEls.tabEl[tabIndex].querySelector('.eip-popup__tab--table-wrap'));
  }

  window.sg.components.eipPopup = { init, showPopup, bindAdditionalEvent, resizeTableWrap };

  $q.ready(init);
})();

(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const layerPopupMaxHeight = window.sg.common.layerPopupMaxHeight;
  const commonTab = window.sg.common.tab;

  const selector = {
    section: '.finance-popup',
    close: '.finance-popup .layer-popup__close',
    activeCls: 'is-active',
    tooltipOpenBtn: '.finance-popup__tooltip-btn',
    tooltipCloseBtn: '.finance-popup__tooltip-close-btn',
    placeholder: '.installment-select__placeholder',
    paymentSelect: '.installment-select',
    paymentSelectOptions: '.installment-select__options',
  };

  class FinancePopup {
    constructor(el) {
      this.els = {
        el,
        section: $q(el),
        financePopupContents: el.querySelector('.finance-popup .layer-popup__contents'),
        financePopupCloseBtn: el.querySelector('.layer-popup__close'),
        financePopup: el.querySelector('.finance-popup .layer-popup'),
      };

      this.handler = {
        tooltipOpen: this.tooltipOpen.bind(this),
        tooltipClose: this.tooltipClose.bind(this),
        activeSelect: this.activeSelect.bind(this),
        activeOption: this.activeOption.bind(this),
      };
      this.init();
    }


    init() {
      if(FinancePopup.instances.get(this.els.el)) {
        return;
      }
      FinancePopup.instances.set(this.els.el, this);
      this.setProperty();
      this.bindEvents();
      this.deviceOpen();
      layerPopupMaxHeight.init(this.els.financePopup);
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      this.deviceOpen();
      layerPopupMaxHeight.init(this.els.financePopup);
    }

    setProperty() {
      this.els.tooltipOpenBtn = this.els.section.find(selector.tooltipOpenBtn);
      this.els.tooltipCloseBtn = this.els.section.find(selector.tooltipCloseBtn);
      this.els.placeholder = this.els.section.find(selector.placeholder);
      this.els.paymentSelectOptions =  this.els.section.find(`${selector.paymentSelectOptions} li`);
    }

    tabInit(open = false) {
      if (open === true) {
        Array.from(this.els.el.querySelectorAll('.finance-popup__panel')).forEach((item) => {
          const $item = $q(item);
          $item.removeClass(selector.activeCls);
        });
        this.els.el.querySelectorAll('.finance-popup__panel')[0].classList.add(selector.activeCls);

        commonTab.init(this.els.el.querySelector('.tab'), 0);
        layerPopupMaxHeight.setMax(this.els.financePopup);
      }

      Array.from(this.els.el.querySelectorAll('.tab__item')).forEach((item, idx) => {
        const $item = $q(item).find('button');
        const activeIdx = idx;

        $item.off('click').on('click', () => {
          this.activeTab(activeIdx);
        });
      });
    }

    bindEvents() {
      this.els.financePopupCloseBtn.addEventListener('click', this.close.bind(this));

      $q(window).on('resize', () => {
        layerPopupMaxHeight.setMax(this.els.financePopup);
      });

      const closeBtn = document.querySelector(selector.close);
      closeBtn.removeEventListener('keydown', keydownCloseBtn);
      closeBtn.addEventListener('keydown', keydownCloseBtn);

      this.els.el.removeEventListener('keydown', keydownLayer);
      this.els.el.addEventListener('keydown', keydownLayer);

      this.els.tooltipOpenBtn.off('click', this.handler.tooltipOpen).on('click', this.handler.tooltipOpen);
      this.els.tooltipCloseBtn.off('click', this.handler.tooltipClose).on('click', this.handler.tooltipClose);

      if(this.els.el.querySelectorAll('.finance-popup__panel').length){
        this.tabInit();
      }

      if(this.els.placeholder) {
        this.els.placeholder.off('click', this.handler.activeSelect).on('click', this.handler.activeSelect);
      }
    }

    deviceOpen() {
      this.els.el.paymentSelectOptions = this.els.el.querySelectorAll(`${selector.paymentSelectOptions} li`);
      [...this.els.el.paymentSelectOptions].forEach((option) => {
        option.querySelector('a').removeEventListener('click', this.handler.activeOption);
        option.querySelector('a').addEventListener('click', this.handler.activeOption);
      });
    }

    activeSelect(event) {
      event.preventDefault();
      const eTarget = event.target.closest(selector.paymentSelect).querySelector(selector.placeholder);
      const itemSelect = eTarget.closest(selector.paymentSelect);
      if (!itemSelect.classList.contains('is-opened')) {
        this.openSelect(eTarget);
      } else {
        this.closeSelect(eTarget);
      }
    }

    openSelect(item) {
      const itemSelect = item.closest(selector.paymentSelect);
      const itemSelectOption = itemSelect.querySelector(selector.paymentSelectOptions);
      const globalText = JSON.parse(itemSelect.dataset.globalText);

      item.setAttribute('aria-expanded', true);
      item.querySelector('.hidden').innerText = globalText.Collapse;
      itemSelect.classList.add('is-opened');
      itemSelectOption.setAttribute('aria-hidden', false);

      /* P6 Modify => 그리는 시점과 이벤트 먹이는 시점이 안맞아서 0.3초 딜레이 */
      setTimeout(() => {
        this.els.el.paymentSelectOptions = this.els.el.querySelectorAll(`${selector.paymentSelectOptions} li`);
        [...this.els.el.paymentSelectOptions].forEach((option) => {
          option.querySelector('a').removeEventListener('click', this.handler.activeOption);
          option.querySelector('a').addEventListener('click', this.handler.activeOption);
        });
      }, 300);
    }

    closeSelect(item) {
      const itemSelect = item.closest(selector.paymentSelect);
      const itemSelectOption = itemSelect.querySelector(selector.paymentSelectOptions);
      const globalText = JSON.parse(itemSelect.dataset.globalText);

      item.setAttribute('aria-expanded', false);
      item.querySelector('.hidden').innerText = globalText.Expand;
      itemSelect.classList.remove('is-opened');
      itemSelectOption.setAttribute('aria-hidden', true);
    }

    activeOption(event) {
      event.preventDefault();
      const item = event.target.closest('li');
      const itemWrap = event.target.closest(selector.paymentSelect);

      itemWrap.querySelectorAll(`${selector.paymentSelectOptions} li`).forEach((li) => {
        li.classList.remove('is-selected');
      });
      item.classList.add('is-selected');
      if (!itemWrap.classList.contains('is-selected')) {
        itemWrap.classList.add('is-selected');
      }
      itemWrap.querySelector('.installment-select__placeholder-name span').innerText = item.querySelector('.finance-popup__installment-select__choose-name').textContent;

      this.activeSelect(event);
    }
    close() {
      this.els.el.style.display = 'none';

      utilsHide();

      if (utils.getMobileOS() === 'ios') {
        setTimeout(() => originFocus(this.focusTargetEl), 200);
      } else {
        originFocus(this.focusTargetEl);
      }
    }
    open(targetEl) {
      this.focusTargetEl = targetEl;
      this.els.el.style.display = 'block';
      if(this.els.el.querySelectorAll('.finance-popup__panel').length) {
        this.tabInit(true);
      }

      if (utils.getMobileOS() === 'ios') {
        setTimeout(() => utils.setFocusFirstFocusableEl(this.els.el), 200);
      } else {
        setTimeout(() => utils.setFocusFirstFocusableEl(this.els.el), 0);
      }

      utilsShow(this.els.el);
    }

    activeTab(idx) {
      Array.from(this.els.el.querySelectorAll('.finance-popup__panel')).forEach((tabEl, tabIdx) => {
        const $tabEl = $q(tabEl);

        if (tabIdx === idx) {
          $tabEl.addClass(selector.activeCls);
        } else {
          $tabEl.removeClass(selector.activeCls);
        }
      });

      layerPopupMaxHeight.setMax(this.els.financePopup);
    }

    tooltipOpen(e) {
      this.els.section.find('.finance-popup__tooltip').removeClass('finance-popup__tooltip--show');
      this.els.section.find('.finance-popup__tooltip').removeClass('finance-popup__tooltip--left');
      $q(e.target).closest('.finance-popup__tooltip').addClass('finance-popup__tooltip--show');

      const tooltipX = utils.isRtl() ? this.els.section.find('.finance-popup__content').target[0].getBoundingClientRect().right - $q(e.target).closest('.finance-popup__tooltip').find('.finance-popup__tooltip-box').target[0].getBoundingClientRect().right : $q(e.target).closest('.finance-popup__tooltip').find('.finance-popup__tooltip-box').target[0].getBoundingClientRect().left - this.els.section.find('.finance-popup__content').target[0].getBoundingClientRect().left;
      
      if(tooltipX <= 0) {
        $q(e.target).closest('.finance-popup__tooltip').addClass('finance-popup__tooltip--left');
      }
    }

    tooltipClose(e) {
      $q(e.target).closest('.finance-popup__tooltip').removeClass('finance-popup__tooltip--show');
      $q(e.target).closest('.finance-popup__tooltip').removeClass('finance-popup__tooltip--left');
    }
  }

  FinancePopup.instances = new WeakMap();

  function keydownLayer(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      const firstEl = document.querySelector(`${selector.section}`)
        .querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0];

      if (firstEl && evt.target === firstEl) {
        evt.preventDefault();
        document.querySelector(`${selector.close}`).focus();
      }
    }
  }

  function keydownCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();

      document.querySelector(`${selector.section}`)
        .querySelectorAll('a, button, input:not([type="hidden"]), textarea')[0].focus();
    }
  }

  function originFocus(focusTargetEl) {
    if (focusTargetEl && focusTargetEl  instanceof Element) {
      focusTargetEl.focus();
    } else {
      utils.buyingFocus('financePopup');
    }
  }

  function utilsShow(popupEl) {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
    utils.setMobileFocusLoop(popupEl);
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
    utils.removeMobileFocusLoop();
  }

  function showPopup(targetEl = null) {
    FinancePopup.instances.get(document.querySelector(selector.section)).open(targetEl);
  }

  function closePopup() {
    FinancePopup.instances.get(document.querySelector(selector.section)).close();
  }

  const financePopup = {
    initAll() {
      [...document.querySelectorAll(selector.section)].forEach((el) => {
        if (!FinancePopup.instances.has(el)) {
          new FinancePopup(el);
        }
      });
    },
    showPopup,
    reInit() {
      document.querySelectorAll(selector.section).forEach((el) => {
        if (FinancePopup.instances.has(el)) {
          FinancePopup.instances.get(el).reInit();
        } else {
          new FinancePopup(el);
        }
      });
    },
  };

  window.sg.components.financePopup = financePopup;

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', financePopup.initAll);
  } else {
    financePopup.initAll();
  }
})();

(function ($) {

	const Monthly_I18N = Granite.I18n.get("Monthly payment");
	const Cost_I18N = Granite.I18n.get("Cost of purchase");
	const Instalment_I18N = Granite.I18n.get("Instalment rate");
	const Total_I18N = Granite.I18n.get("Total cost inc. interest");
	const Instant_I18N = Granite.I18n.get("Instant decision at checkout");

	let storeDomain = $("#storeDomain").val();
	const siteCode = $("#siteCode").val();
	const priceCurrency = $("#tempTitle").val() == "page-pf" ? $("#pfPriceCurrency").val() : $("#priceCurrency").val();
	
	//calculateInstallment API를 호출하는 대상 국가가 추가되는 경우에 siteCode추가 
	const calculateInstallmentList = ["uk", "ee", "lv", "lt", "pl", "hu", "es", "ro", "ua","nz","sg","my","ph","vn","th","sk","cz","cn"]; 
	const calculateInstallmentSet = new Set(calculateInstallmentList);
	const isCalculateInstallment = calculateInstallmentSet.has(siteCode);

	
	// b2b 분기 추가
	const isB2B = $("#b2bFlag").val() === "Y" ? true : false;
	/**
	 * 각 국가의 code 별 Description html
	 */
	var emiDescEachSiteCode = function(siteCode, code, descriptionText){
		var descriptionHtml = "";

		if(!code){
			return "";
		}

		var lowerCode = code.toLowerCase();
		if(siteCode == "id"){ //new-hybris
			/* TODO id 요건에 맞게 추가 예정 */
		}else if(siteCode == "uk" && isB2B){
			//COMP6FE-1590 [SMB] Financing Calculator& Leasing
			descriptionHtml +=  '<div class="finance-popup__description">'+
									'<p>The Representative Example below shows the typical costs of using Samsung Finance to purchase your Samsung products: <strong>0.0% APR Representative (fixed)</strong>. Based on an initial 10% deposit of <strong>£76.90</strong>, and an assumed credit totaling <strong>£692.10</strong> over <strong>12 months</strong> at an interest rate of <strong>0.0% p.a. (fixed).</strong> Monthly repayment <strong>£57.67</strong>. Total amount payable <strong>£769.00</strong>.</p>'+
								'</div>'+
								'<div class="finance-popup__disclaimer">'+
									'<p>*All credit is subject to status and available to UK Sole Traders over 18, with a UK bank account and valid driver’s license, passport or identity card. The displayed quote is VAT inclusive, final estimates are made upon checkout.</p>'+
									'<br><p>Credit duration is variable, and you could be offered a rate of 9.9% APR, based on your financial circumstances and what you tell us. Minimum upfront payment of 10% is required and fixed monthly repayments. By accepting our credit offer, you consent to a credit check being completed, which will appear on your credit file.</p>'+
								'</div>'+
								'<div class="finance-popup__credit">'+
									'<div class="finance-popup__credit-img">'+
										'<img src="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/logo-samsung-finance.png" alt="Samsung Finance">'+
									'</div>'+
									'<div class="finance-popup__credit-text">'+
										'Samsung Electronics (UK) Limited (Registered no: 03086621), registered at Samsung House, 2000 Hillswood Drive, Chertsey, Surrey KT16 0RS, United Kingdom, acts as a credit broker and not as a lender. Samsung is authorised and regulated by the Financial Conduct Authority (FRN 727333). Credit is provided by Glow Financial Services Limited, 71 Queen Victoria Street, London EC4V 4BE. Registered in England No. 09127663. Glow Financial Services Limited is authorised and regulated by the Financial Conduct Authority (Reference No. 751308). Glow Financial Services acting as lender, under brand license as Samsung Finance (powered by Glow) through Samsung Electronics (UK) Limited. The Financial Services Register can be accessed through <a href="http://www.fca.org.uk" target="_blank" aria-label="www.fca.org.uk Open in a New Window">www.fca.org.uk</a>.'+
									'</div>'+
								'</div>';
		}else if(siteCode == "uk"){
			if(lowerCode == "uk-paypalcreditpaymentmode"){
				descriptionHtml +=  '<div class="finance-popup__description">'+
										'<strong>What is the cost of PayPal Credit outside of promotional offers?</strong>'+
										'<p>The Representative Example below shows the typical costs of using a PayPal Credit Limit, without using <br>promotional offers:</p>'+
										'<p><b>Representative example:</b></p>'+
										'<p><b>Purchase Rate: 23.9 % p.a. (variable)</b></p>'+
										'<p><b>Representative: 23.9 % APR (variable)</b></p>'+
										'<p><b>Assumed credit limit: £1,200.00</b></p>'+
										'<p><i>Subject to credit status and T&C’s</i></p>'+
									'</div>'+
									'<div class="finance-popup__credit">'+
										'<div class="finance-popup__credit-img">'+
											'<img src="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/logo-paypal-credit.png" alt="paypal credit">'+
										'</div>'+
										'<div class="finance-popup__credit-text">'+
											'Subject to status and credit approval. Finance provided by PayPal Credit. S amsung Electronics (UK) Limited acts as a broker and offers finance from a limited number of providers. PayPal Credit and PayPal Pay in 3 are trading names of PayPal UK Ltd, Whittaker House, Whittaker Avenue, Richmond-Upon-Thames, Surrey, United Kingdom, TW9 1EH. Please be aware that late or missing repayments may also affect your credit rating, which could make it more difficult or expensive for you to obtain credit in the future. T&Cs apply.'+
										'</div>'+
									'</div>';
				
			}else if(lowerCode == "uk-klarnathreeinstallmentspaymentmode" || lowerCode == "uk-klarnasliceitpaymentmode"){
				descriptionHtml +=  '<div class="finance-popup__description">'+
					                	'<p>'+
						                'Representative Example without 0% or 9.90% offers: Representative 14.9% APR (variable)<br>'+
						                'Purchase interest rate 14.9%p.a (variable) Assumed credit limit £1,200*<br>'+
						                'Displayed quote is not generated by Klarna, final estimates are made upon checkout.'+
						                '</p>'+
					                '</div>'+
					                '<div class="finance-popup__credit">'+
						                '<div class="finance-popup__credit-img">'+
						                	'<img src="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/logo-klarna.png" alt="Klarna slice it">'+
						                '</div>'+
						                '<div class="finance-popup__credit-text">'+
					                	'*Subject to financial circumstances. You must be at least 18. Credit is provided by Klarna Bank AB, which is authorised and regulated by the Swedish Financial Services Authority, with limited supervision by the Financial Conduct Authority and Prudential Regulation Authority in the UK. Registered office: Sveavägen 46, 111 34 Stockholm, Sweden. Corporation ID number: 556737-0431. If you already have a Klarna Credit account, this purchase will be added to your balance. In case of partial approval, a down payment may be required. <a href="https://cdn.klarna.com/1.0/shared/content/legal/terms/0/en_gb/account_agreement" target="_blank" aria-label="T&Cs apply Open in a New Window">T&Cs apply.</a>'+
						                '</div>'+
					                '</div>';
			}else if(lowerCode == "uk-glowpaymentmode"){
				descriptionHtml +=  '<div class="finance-popup__description">'+
										'<p>The Representative Example below shows the typical costs of using Samsung Finance to purchase your Samsung products: <strong>0.0% APR Representative (fixed)</strong>. Based on an initial 10% deposit of <strong>£76.90</strong>, and an assumed credit totaling <strong>£692.10</strong> over <strong>12 months</strong> at an interest rate of <strong>0.0% p.a. (fixed).</strong> Monthly repayment <strong>£57.67</strong>. Total amount payable <strong>£769.00</strong>.</p>'+
									'</div>'+
									'<div class="finance-popup__disclaimer">'+
										'<p>*All credit is subject to status and available to UK residents over 18, with a UK bank account and valid driver’s license, passport or identity card. Credit duration is variable, and you could be offered a rate of 9.9% APR, based on your financial circumstances and what you tell us. Minimum upfront payment of 10% is required and fixed monthly repayments. By accepting our credit offer, you consent to a credit check being completed, which will appear on your credit file.</p>'+
									'</div>'+
									'<div class="finance-popup__credit">'+
										'<div class="finance-popup__credit-img">'+
											'<img src="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/logo-samsung-finance.png" alt="Samsung Finance">'+
										'</div>'+
										'<div class="finance-popup__credit-text">'+
											'Samsung Electronics (UK) Limited (Registered no: 03086621), registered at Samsung House, 2000 Hillswood Drive, Chertsey, Surrey KT16 0RS, United Kingdom, acts as a credit broker and not as a lender. Samsung is authorised and regulated by the Financial Conduct Authority (FRN 727333). Credit is provided by Glow Financial Services Limited, 71 Queen Victoria Street, London EC4V 4BE. Registered in England No. 09127663. Glow Financial Services Limited is authorised and regulated by the Financial Conduct Authority (Reference No. 751308). Glow Financial Services acting as lender, under brand license as Samsung Finance (powered by Glow) through Samsung Electronics (UK) Limited. The Financial Services Register can be accessed through <a href="http://www.fca.org.uk" target="_blank" aria-label="www.fca.org.uk Open in a New Window">www.fca.org.uk</a>.'+
										'</div>'+
									'</div>';
			}
		} else if(siteCode == "ee" || siteCode ==  "lv" || siteCode ==  "lt" || siteCode == "pl" || siteCode == "hu" || siteCode == "ro" || siteCode == "ua" || siteCode == "nz" || siteCode == "sg" || siteCode == "my" || siteCode == "ph" || siteCode == "vn" || siteCode == "sk" || siteCode == "cz" || siteCode == "cn"){
			descriptionHtml +=  '<div class="finance-popup__description">'+
									'<p>'+
										descriptionText+
									'</p>'+
								'</div>';
			
		}
		
		
		return descriptionHtml;
	}

	function emiDataGrid(values, siteCode) {
		//COMP6FE-1590 [SMB] Financing Calculator& Leasing
		if(isB2B && siteCode ==='uk'){
			values = values.filter(list => list.code === 'uk-glowFinancePaymentMode');
		}
		var tabHtml = "";
		var contentHtml = "";
		var $eipArea = $(".finance-popup");
		var $contentArea = $eipArea.find(".finance-popup__content");
		var reg = /[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/ ]/gim; //특수문자 공백 제거 정규식
		
		/* content영역 remove */
		if($contentArea.length > 0){
			$contentArea.children().remove();
		}
		/* Tab 전체 틀 */
		tabHtml += 	'<div class="tab">';
		tabHtml += 		'<ul class="tab__list" role="tablist">';

		for(var idx=0; idx<values.length; idx++){
			/* 하나의 탭 data */
			var tabData = values[idx];
			const tabNameOnlyText = tabData.name?tabData.name.replace(reg, ""):'';
			tabHtml += '<li class="tab__item" role="presentation">';
			tabHtml += '	<button class="tab__item-title" role="tab" aria-controls="tabPanel'+tabNameOnlyText+'">';
			tabHtml += 			tabData.name;
			tabHtml += '		<span class="tab__item-line"></span>';
			tabHtml += '	</button>';
			tabHtml += '</li>';
			
			if(idx==0){
				contentHtml += 	'<div class="finance-popup__panel is-active" role="tabpanel" id="tabPanel'+tabNameOnlyText+'">'; 
			}else{
				contentHtml += 	'<div class="finance-popup__panel" role="tabpanel" id="tabPanel'+tabNameOnlyText+'">';
			}
			contentHtml +=  	'<h3 class="hidden">'+tabData.name+'</h3>'+
								'<div class="finance-popup__site-content">'+
								'<div class="finance-popup__box-wrap">';
			
			if(siteCode === "uk" && isB2B){
				//COMP6FE-1590 [SMB] Financing Calculator& Leasing
				contentHtml += 	'<div class="finance-popup__additional">'+
									'<strong class="finance-popup__additional-title">Business essentials on demand</strong>'+
									'<div class="finance-popup__additional-content">'+
										'<p>Discover flexible ways to pay for the Samsung products you need to make your business run effectively.</p>'+
									'</div>'+
								'</div>';

			}else if(siteCode == "uk" && tabData.code.toLowerCase() == "uk-glowpaymentmode"){
				contentHtml += 	'<div class="finance-popup__additional">'+
									'<strong class="finance-popup__additional-title">See it. Love it. Spread the cost.</strong>'+
									'<div class="finance-popup__additional-content">'+
										'<p>Discover flexible ways to pay for your favourite Samsung products</p>'+
										'<p>Pay as little as <strong>10%</strong> upfront and the balance with interest-free credit*</p>'+
									'</div>'+
								'</div>';
			}
			
			var descriptionText = "";
			/* content data Grid */
			if(tabData.values && tabData.values.length > 0){
				contentHtml += 	'<div class="finance-popup__box-list" role="list">';
							
				for(var jdx=0; jdx<tabData.values.length; jdx++){
					var contentData = tabData.values[jdx];
					
					if(siteCode == "uk" || siteCode == "ro" || siteCode == "ua" || siteCode == "nz" || siteCode == "sg" || siteCode == "my" || siteCode == "ph" || siteCode == "vn" || siteCode == "cn"){
						contentHtml += 	'<div class="finance-popup__box" role="listitem">'+
											'<strong class="finance-popup__box-title">'+(siteCode == "ro" ? contentData.periodLabel+' rate' :
																						 siteCode == "nz" ? contentData.code+' '+contentData.period :
																						 siteCode == "ua" ? contentData.code + " місяців" :
																						 contentData.code)+'</strong>'+
											'<div class="finance-popup__box-payment" role="list">'+
												'<p class="finance-popup__box-payment-price" role="listitem">'+(siteCode == "ro" ? currencyComma(contentData.monthlyContractFee,priceCurrency) : contentData.periodicValue)+'</p>'+
												'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Monthly payment")+'</p>'+
											'</div>'+
											'<div class="finance-popup__box-payment" role="list">'+
												'<p class="finance-popup__box-payment-price" role="listitem">'+(siteCode == "ro" ? currencyComma(contentData.purchaseCost,priceCurrency) : contentData.purchaseCost)+'</p>'+
												'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Cost of purchase")+'</p>'+
											'</div>'+
											'<div class="finance-popup__box-payment" role="list">'+
												'<p class="finance-popup__box-payment-price" role="listitem">'+((siteCode == "uk" || siteCode == "nz") ? contentData.interestRate+' %p.a. (fixed)' : (siteCode=="ro" || siteCode=="ua") ? parseInt(contentData.totalInterest)+'%' : contentData.interestRate+'%')+'</p>'+
												'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Instalment rate")+'</p>'+
											'</div>'+
											'<div class="finance-popup__box-payment" role="list">'+
												'<p class="finance-popup__box-payment-price" role="listitem">'+(siteCode == "ro" ? currencyComma(contentData.totalCost,priceCurrency) : contentData.totalCost)+'</p>'+
												'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Total cost inc. interest")+'</p>'+
											'</div>'+
											(siteCode == "uk" ? '<p class="finance-popup__box-description">'+Granite.I18n.get("Instant decision at checkout")+'</p>' : '')+
										'</div>';	//.finance-popup__box End
					}else if(siteCode == "ee" || siteCode == "lv" || siteCode == "lt" || siteCode == "pl" || siteCode == "hu" || siteCode == "sk"  || siteCode == "cz"){
						contentHtml += 	'<div class="finance-popup__box" role="listitem">';
						if((siteCode == "sk" || siteCode == "cz") && (contentData.periodLabel !== null && contentData.periodLabel !== undefined && contentData.periodLabel !== "")){
							contentHtml += 	'    <div class="finance-popup__box-title-wrap">';
						}
						
						if(contentData.period !== null && contentData.period !== undefined && contentData.period !== "" && contentData.code !== null && contentData.code !== undefined && contentData.code !== "" && contentData.apr !== null && contentData.apr !== undefined && contentData.apr !== "") {
							if(contentData.period == "MONTHLY") {
								if(contentData.periodLabel !== null && contentData.periodLabel !== undefined && contentData.periodLabel !== "") {
									//periodLabel이 영문인 Months로 오는 경우는 i18n처리 Months가 아닌 경우 즉, 로컬어인 경우는 그대로 노출
									if(contentData.periodLabel == "Months") {
										contentHtml += '<strong class="finance-popup__box-title">'+contentData.code+' '+Granite.I18n.get("Months")+'</strong>';
									} else {
										contentHtml += '<strong class="finance-popup__box-title">'+contentData.code+' '+contentData.periodLabel+'</strong>';
									}
								} else {
									contentHtml += '	<strong class="finance-popup__box-title">'+contentData.code+' '+Granite.I18n.get("Months")+'</strong>';
								}
							} else {
								if(siteCode == "sk" || siteCode == "cz") {
									contentHtml += '		<strong class="finance-popup__box-title">'+contentData.period+'</strong>';
								} else if(siteCode != "sk" && siteCode != "cz") {
									contentHtml += '		<strong class="finance-popup__box-title">'+contentData.code+' '+contentData.periodLabel+'</strong>';
								}
							}
						} else if(contentData.period !== null && contentData.period !== undefined && contentData.period !== "" && contentData.code !== null && contentData.code !== undefined && contentData.code !== "") {
							//CRHQ-9494 [B2C] hu EMI(finance) 팝업내 정보 변경
							if(siteCode == "hu") {
								contentHtml += '<strong class="finance-popup__box-title">'+contentData.code+' '+'hónap futamidő</strong>';
							}
						}
						
						
						//sk, cz tooltip (NOTICE : 다른 국가도 동일 요소를 툴팁으로 사용하는 경우에는 siteCode만 OR조건으로 추가하면 되나 다른 요소일때는 별도 분기구조를 고려 해야 함. ) 
						if(siteCode == "sk"  || siteCode == "cz"){
							if(contentData.periodLabel !== null && contentData.periodLabel !== undefined && contentData.periodLabel !== "") {
								contentHtml += 	'<div class="finance-popup__tooltip">';
								contentHtml += 	'    <button class="finance-popup__tooltip-btn">';
								contentHtml += 	'        <span class="hidden"></span>';
								contentHtml += 	'            <svg class="icon finance-popup__tooltip-icon" focusable="false" aria-hidden="true">';
								contentHtml += 	'            <use xlink:href="#icon-info-bold" href="#icon-info-bold"></use>';
								contentHtml += 	'            </svg>';
								contentHtml += 	'    </button>';
								contentHtml += 	'    <div class="finance-popup__tooltip-box">';
								contentHtml += 	'        <div class="finance-popup__tooltip-box-text">'+contentData.periodLabel+'</div>';
								contentHtml += 	'        <button class="finance-popup__tooltip-close-btn">';
								contentHtml += 	'            <span class="hidden"></span>';
								contentHtml += 	'            <svg class="icon finance-popup__tooltip-close-icon" focusable="false" aria-hidden="true">';
								contentHtml += 	'                <use xlink:href="#delete-bold" href="#delete-bold"></use>';
								contentHtml += 	'            </svg>';
								contentHtml += 	'        </button>';
								contentHtml += 	'    </div>';
								contentHtml += 	'</div>';
							}
						}

						if((siteCode == "sk" || siteCode == "cz") && (contentData.periodLabel !== null && contentData.periodLabel !== undefined && contentData.periodLabel !== "")){
							contentHtml += 	'</div>'; //finance-popup__box-title-wrap 닫는태그
						}
						
						if(contentData.purchaseCost !== null && contentData.purchaseCost !== undefined && contentData.purchaseCost !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.purchaseCost+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Amount to be financed")+'</p>'+
														'</div>';
						}
						if(contentData.periodicValue !== null && contentData.periodicValue !== undefined && contentData.periodicValue !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.periodicValue+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Monthly payment")+'</p>'+
														'</div>';
						}
						if(contentData.interestRate !== null && contentData.interestRate !== undefined && contentData.interestRate !== "") {
							if(siteCode == "hu") {
								//only hu 
								contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
								'<p class="finance-popup__box-payment-price" role="listitem">'+(contentData.interestRate*100).toFixed(2)+'%</p>'+
								'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Fixed annual interest rate")+'</p>'+
							'</div>';

							} else {
								//기존 로직 
								contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
								'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.interestRate+'</p>'+
								'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Fixed annual interest rate")+'</p>'+
							'</div>';

							}
						}
						if(contentData.annualContractFee !== null && contentData.annualContractFee !== undefined && contentData.annualContractFee !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.annualContractFee+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Contract award fee")+'</p>'+
														'</div>';
						}
						if(contentData.monthlyContractFee !== null && contentData.monthlyContractFee !== undefined && contentData.monthlyContractFee !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.monthlyContractFee+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Monthly contract fee")+'</p>'+
														'</div>';
						}
						if(contentData.apr !== null && contentData.apr !== undefined && contentData.apr !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.apr+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Annual percentage rate of charge for consumer credit")+'</p>'+
														'</div>';
						}
						if(contentData.totalCost !== null && contentData.totalCost !== undefined && contentData.totalCost !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.totalCost+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Total amount payable")+'</p>'+
														'</div>';
						}
						if(contentData.code !== null && contentData.code !== undefined && contentData.code !== "") {
							if(siteCode == "sk" || siteCode == "cz") {
								contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
								'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.period+'</p>'+
								'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Term of the contract")+'</p>'+
								'</div>';
							} else if(siteCode != "sk" && siteCode != "cz") {
								contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
								'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.code+'</p>'+
								'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Term of the contract")+'</p>'+
								'</div>';
							}
						}
						if(contentData.downPayment !== null && contentData.downPayment !== undefined && contentData.downPayment !== "") {
							contentHtml += 				'<div class="finance-popup__box-payment" role="list">'+
															'<p class="finance-popup__box-payment-price" role="listitem">'+contentData.downPayment+'</p>'+
															'<p class="finance-popup__box-payment-text" role="listitem">'+Granite.I18n.get("Downpayment")+'</p>'+
														'</div>';
						}
						
						contentHtml += 			'</div>';	//.finance-popup__box End
						
					}
					if(jdx == tabData.values.length-1){
						if(siteCode == "ee"){
							descriptionText = 	'Tähelepanu, tegemist on finantsteenusega! Inbank järelmaksu krediidikulukuse määr on '+contentData.interestRate+'% aastas järgmistel näidistingimustel: '+
												'lepingueseme hind kohe tasudes (netohind) '+contentData.purchaseCost+', krediidisumma '+contentData.totalCost+', sissemakse '+contentData.downPayment+' , lepinguperiood '+contentData.code+' kuud, fikseeritud intressimäär aastas '+contentData.interestRate+'% arvestatuna ostusummalt, lepingutasu '+contentData.annualContractFee+', igakuine haldustasu '+contentData.monthlyContractFee+'. '+
												'Igakuine osamakse '+contentData.periodicValue+', krediidi kogusumma ja tagasimaksete summa '+contentData.totalCost+'. '+ 
												'Finantsteenuse osutajaks on AS Inbank Finance (Niine 11, Tallinn, www.inbank.ee, tel 640 8080). Enne lepingu sõlmimist tutvu tingimustega ja vajadusel pea nõu.';
						} else if(siteCode == "lv") {
							descriptionText = 	'Reprezentatīvs piemērs:<br>'+
												'Aizdevuma summa - '+contentData.purchaseCost+', līguma termiņš – '+contentData.code+' mēn., procentu likme - '+contentData.interestRate+'%, noformēšanas maksa - '+contentData.annualContractFee+' , ikmēneša apkalpošanas maksa – '+contentData.monthlyContractFee+' , ikmēneša maksājums – '+contentData.periodicValue+' , kopējā atmaksājamā summa – '+contentData.totalCost+' , gada procentu likme (GPL) - '+contentData.apr+'%.<br>'+
												'Kalkulatora aprēķinātie dati ir informatīvi un sniedz aptuvenu priekšstatu. Informācija var mainīties balstoties uz Jūsu maksātspēju vai izvēloties citu līguma termiņu un maksājuma datumu.';
						} else if(siteCode == "lt") {
							descriptionText = 	'Pavyzdžiui, skolinantis '+contentData.purchaseCost+' , kai sutartis sudaroma '+contentData.code+' mėn. terminui, metinė palūkanų norma – '+contentData.interestRate+'%, sutarties sudarymo mokestis - '+contentData.annualContractFee+' , mėnesio sutarties mokestis – '+contentData.monthlyContractFee+' , BVKKMN – '+contentData.apr+'%, bendra mokėtina suma – '+contentData.totalCost+' , mėnesio įmoka – '+contentData.periodicValue+'.';
						} else if(siteCode == "pl") {
							if(!checkEppSite() && !isB2B) {
								//only B2C (CRHQ-1026 [B2C] PL - EMI 팝업 내 disclaimer 변경)
								descriptionText = 	`**Przykłady reprezentatywne
									<br><br><br>
									"Raty 20x0%"
									<br><br>
									Dla kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A. z siedzibą we Wrocławiu, dla propozycji „20 rat 0%” wyliczenia na podstawie przykładu reprezentatywnego na dzień 04.01.2024 r.
									są następujące: cena towaru 4700 zł, stała stopa oprocentowania kredytu: 0%, całkowity koszt kredytu: 0 zł, Rzeczywista Roczna Stopa Oprocentowania (RRSO) 0%, całkowita kwota kredytu: 4700 zł; czas obowiązywania umowy: 20 miesięcy; całkowita kwota do zapłaty 4700 zł; wysokość 20 miesięcznych równych rat 235 zł.
									Propozycja obowiązuje dla umów zawartych od 08.04.2024 do 30.06.2024 r.
									<br><br>
									Niniejsza propozycja nie jest ofertą w rozumieniu art. 66 Kodeksu Cywilnego. Decyzja o przyznaniu i warunkach kredytu z uwzględnieniem oceny aktualnej sytuacji Klienta zostanie podjęta przez Bank. Szczegóły na www.samsung.com oraz www.santanderconsumer.pl. Samsung Electronics Polska Sp. z o.o. występujący w roli pośrednika kredytowego informuje swoich Klientów o możliwości skorzystania z propozycji kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A., udostępnia swoim Klientom wniosek o kredyt na zakup towarów i usług oraz przyjmuje oświadczenia o odstąpieniu od umów o kredyt na zakup towarów i usług zawartych przez Santander Consumer Bank S.A. za pośrednictwem Samsung Electronics Polska Sp. z o.o.
									<br><br><br>
									"Do 60 rat"
									<br><br>
									Dla kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A. z siedzibą we Wrocławiu, dla propozycji „Do 60 rat” wyliczenia na podstawie przykładu reprezentatywnego na dzień 07.02.2024 r. są następujące: cena towaru 3700 zł, stała stopa oprocentowania kredytu: 18,50%, całkowity koszt kredytu: 585,22 zł obejmuje: prowizję: 185 zł, odsetki: 400,22 zł, Rzeczywista Roczna Stopa Oprocentowania (RRSO) 31,91%, całkowita kwota kredytu (bez kredytowanych kosztów): 3700 zł; czas obowiązywania umowy: 12 miesięcy; całkowita kwota do zapłaty 4285,22 zł; wysokość 11 miesięcznych równych rat 357,10 zł; ostatnia 12 rata w wysokości 357,12 zł.      
									<br><br>
									Niniejsza propozycja nie jest ofertą w rozumieniu art. 66 Kodeksu Cywilnego. Decyzja o warunkach i przyznaniu kredytu z uwzględnieniem oceny aktualnej sytuacji Klienta, zostanie podjęta przez Santander Consumer Bank S.A. Szczegóły na www.santanderconsumer.pl.
									<br><br>
									Samsung Electronics Polska Sp. z o.o. występujący w roli pośrednika kredytowego informuje swoich Klientów o możliwości skorzystania z propozycji kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A., udostępnia swoim Klientom wniosek o kredyt na zakup towarów i usług oraz przyjmuje oświadczenia o odstąpieniu od umów o kredyt na zakup towarów i usług  zawartych przez Santander Consumer Bank S.A. za pośrednictwem Samsung Electronics Polska Sp. z o.o.`;
							} else {
								//B2C외 (B2B 또는 EPP)
								descriptionText = 	`Przykłady reprezentatywne
									<br><br><br>
									"Raty 20x0%"
									<br><br>
									Dla kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A. z siedzibą we Wrocławiu, dla propozycji „20 rat 0%” wyliczenia na podstawie przykładu reprezentatywnego na dzień 01.07.2023 r. są następujące: cena towaru 4800 zł, stała stopa oprocentowania kredytu: 0%, całkowity koszt kredytu: 0 zł, Rzeczywista Roczna Stopa Oprocentowania (RRSO) 0%, całkowita kwota kredytu: 4800 zł; czas obowiązywania umowy: 20 miesięcy; całkowita kwota do zapłaty 4800 zł; wysokość 20 miesięcznych równych rat 240 zł. Propozycja obowiązuje dla umów zawartych od 03.07.2023 do 31.12.2023 r.<br>
									Niniejsza propozycja nie jest ofertą w rozumieniu art. 66 Kodeksu Cywilnego. Decyzja o przyznaniu i warunkach kredytu z uwzględnieniem oceny aktualnej sytuacji Klienta zostanie podjęta przez Bank. Szczegóły na www.santanderconsumer.pl<br>
									Samsung Electronics Polska Sp. z o.o. występujący w roli pośrednika kredytowego Santander Consumer Bank S.A., udostępnia swoim Klientom wniosek o kredyt na zakup towarów i usług oraz przyjmuje oświadczenia o odstąpieniu od umów o kredyt.<br>
									<br><br><br>
									"Do 60 rat"
									<br><br>
									Dla kredytu na zakup towarów i usług oferowanego przez Santander Consumer Bank S.A. z siedzibą we Wrocławiu, dla propozycji „Do 60 rat” wyliczenia na podstawie przykładu reprezentatywnego na dzień 15.02.2023 r. są następujące: cena towaru 2800 zł, stała stopa oprocentowania kredytu: 19%, całkowity koszt kredytu: 402,05 zł obejmuje: prowizję: 140 zł, odsetki: 262,05 zł, Rzeczywista Roczna Stopa Oprocentowania (RRSO) 34,76%, całkowita kwota kredytu (bez kredytowanych kosztów): 2800 zł; czas obowiązywania umowy: 10 miesięcy; całkowita kwota do zapłaty 3202,05 zł; wysokość 9 miesięcznych równych rat 320,21 zł; ostatnia 10 rata w wysokości 320,16 zł.<br>
									Niniejsza propozycja nie jest ofertą w rozumieniu art. 66 Kodeksu Cywilnego. Decyzja o przyznaniu i warunkach kredytu z uwzględnieniem oceny aktualnej sytuacji Klienta zostanie podjęta przez Bank. Szczegóły na www.santanderconsumer.pl<br>
									Samsung Electronics Polska Sp. z o.o. występujący w roli pośrednika kredytowego Santander Consumer Bank S.A., udostępnia swoim Klientom wniosek o kredyt na zakup towarów i usług oraz przyjmuje oświadczenia o odstąpieniu od umów o kredyt.`;
							}
						} else if(siteCode == "hu") {
							descriptionText = `A részletfizetésről bővebb tájékoztatást a <a href="https://www.samsung.com/hu/campaign/cofidis-instalment-payment/" target="_blank" title="Open in a new window">Cofidis Áruhitel</a> oldalon találsz.`;
						} else if(siteCode == "ro") {
							descriptionText = `Exemplu reprezentantiv de calcul:<br><br>
												Pentru un Contract de Credit prin acordarea si utilizarea Liniei de Credit in vederea unei achizitii de Bunuri/Servicii cu Asigurare de Viata in valoare de 5,000 lei, rambursata in 24 luni, rata anuala a dobanzii este 0%, comisionul de analiza a dosarului este de 95 lei, prima de asigurare de viata este de 244.56 lei, rata lunara este de 222.48 lei, valoarea totala platibila este de 5,339.56 lei si dobanda anuala efectiva (DAE) este de 1.74%. Comision adminstrare lunara a creditui: 5 lei/luna. Prezenta oferta se aplica in cazul in care nu se efectueaza nicio alta tranzactie pana la rambursarea integrala a creditului, iar fiecare rata lunara este achitata integral de catre client. Credit oferit de tbi bank
												<br><br>
												Exemplu reprezentativ de calcul:<br><br>
												Pentru un Contract de Credit prin acordarea si utilizarea Liniei de Credit in vederea unei achizitii de Bunuri/Servicii cu Asigurare de Viata in valoare de 2,500 lei, rambursata in 24 luni, rata anuala a dobanzii este 29%, comisionul de analiza a dosarului este de 95 lei, prima de asigurare de viata este de 124.56 lei, rata lunara este de 150.66 lei, valoarea totala platibila este de 3,615.89 lei si dobanda anuala efectiva (DAE) este de 38.31%. Comision adminstrare lunara a creditui: 5 lei/luna. Prezenta oferta se aplica in cazul in care nu se efectueaza nicio alta tranzactie pana la rambursarea integrala a creditului, iar fiecare rata lunara este achitata integral de catre client. Credit oferit de tbi bank`;
						} else if(siteCode == "sg"){
							descriptionText = `We have interest-free monthly instalment options of varying tenures. Monthly amount above is only a representative example over 36-month period & is based on the Recommended Retail Price. This is available using OCBC or UOB credit cards when the checkout value is above $500 at https://shop.samsung.com/sg. Instalment is not available for purchases with trade-in.`;
						} else if(siteCode == "my"){
							descriptionText = `*The displayed quote above is an estimation only. The final installment details will be made available at checkout page.
												<br><br>
												0% interest instalment is a repayment scheme that allows you to use your credit card to make a transaction and then repay the amount to your financier in installments over the course of 6, 12, 24 or 36 months with 0% interest. We currently have 4 banks that offer installment payment plans: 1. Public Bank 2. Maybank 3. HSBC 4. Hong Leong Bank<br>
												Minimum spend applies in order to be eligible for 0% interest installment plan and it is based on the checkout value (after deduction of discount vouchers, if any) instead of a single order/item value. Click
												<a href="https://www.samsung.com/my/shop-faq/payment-and-financing/what-is-the-minimum-spend-for-instalment-plan/" target="_blank" title="Open in a new window">
													here
												</a>
												for more info.`;
						} else if(siteCode == "ph"){
							descriptionText = `0% interest installment is a repayment scheme that allows you to use your credit card to make a transaction and then repay the amount in installments over the course of 3, 6, 9, 12, 18 and 24 months with 0% interest free.<br>
												We currently have 2 banks that offers installment payment plans<br>
												1. BDO<br>
												2. Metrobank<br>
												Minimum spend applies in order to be eligible for 0% interest installment plan and it is based on the checkout value (after deduction of discount vouchers) instead of a single order/item value.<br>
												Click 
												<a href="https://www.samsung.com/ph/shop-faq/payment-and-financing/what-payment-methods-do-you-accept/" target="_blank" title="Open in a new window">
													here
												</a>
												for more info.`;
						
						} else if(siteCode == "nz"){
							if(tabData.code == "nz-flexiCardPaymentMode"){
								descriptionText = `<strong>For Flexi Card:</strong><br/>*36, 24, or 12 months interest free is available on Long Term Finance (LTF) for online purchases only. Min spend $200. Lending criteria, $50 annual Account Fee, fees, Ts&Cs apply. $55 Establishment Fee applies to your first LTF transaction, $35 Advance Fee applies to subsequent LTF transactions. After applicable Payment Holiday ends, minimum payments of 3% of the monthly closing balance or $10 (whichever is greater) are required throughout interest free period. Paying only the minimum monthly payments will not fully repay the loan before the end of the interest free period. At end of interest free period, Q Mastercard Expired Promotional Rate or Q Card Standard Interest Rate of 27.99% p.a. applies. Standard Interest Rate applies to Standard Purchases after 3 months interest free period ends (Q Mastercard 26.69% p.a. and Q Card 27.99% p.a.). Rates and fees subject to change. Columbus Financial Services Limited and Consumer Finance Limited reserve the right to amend, suspend or terminate the offer and these Ts&Cs at any time without notice. Mastercard and the circles design are registered trademarks of Mastercard International Incorporated.`;
							}else if(tabData.code == "nz-laybuyPaymentMode"){
								descriptionText = `<strong>For LayBuy:</strong><br/>*Laybuy weekly payments are available for Laybuy customers only. For Terms and Conditions refer to 
								<a href="https://www.laybuy.com/nz/consumer-terms" target="_blank" title="Open in a new window">
									https://www.laybuy.com/nz/consumer-terms
								</a>`;
							}
						} else if(siteCode == "vn"){
							//CRHQ-9091(vn추가)
							let strOpenTitle = Granite.I18n.get("Open in a new window");
							descriptionText = `Ưu đãi trả góp 0% lãi suất đối với đơn hàng trên 5 Triệu. Tham khảo tại: <a href="https://www.samsung.com/vn/galaxy/tan-huong-tra-gop/" target="_blank" title="${strOpenTitle}">https://www.samsung.com/vn/galaxy/tan-huong-tra-gop/</a>`;
                        } else if(siteCode == "th"){
							descriptionText = ` `;
						} else if(siteCode == "sk"){
							descriptionText = ` `;
                        } else if(siteCode == "cz"){
							descriptionText = ` `;
						} else if(siteCode == "cn"){//[cn new-hybris 전환] - ph와 동일 분기처리
							descriptionText = ` `;
						} 
					}//:~ if(jdx == tabData.values.length-1){
				}
				contentHtml += 			'</div>';	//.finance-popup__box-list End
			}
			contentHtml += 			'</div>';		//.finance-popup__box-wrap End
			
			/* 탭에 해당되는 desc 및 footer html get */
			contentHtml += 		emiDescEachSiteCode(siteCode, tabData.code, descriptionText);
			
			contentHtml += 		'</div>';		//.finance-popup__site-content End
			contentHtml += 	'</div>';			// .finance-popup__panel End
		}
		tabHtml += 			'</ul>';			
		tabHtml += 		'</div>';				//.tab End
						
		$contentArea.html(tabHtml+contentHtml);
		
		//탭 클릭시 해당하는 .finance-popup__panel 노출
		$(".finance-popup__content li.tab__item .tab__item-title").click(function(){
		    $(".finance-popup__panel").attr("class", "finance-popup__panel");
		    $($(".finance-popup__panel")[$(this).index()]).addClass(" is-active");
		});
	};
	
	function emiDataGridID(data) {
		var innerPriceHtml = "";
		var name = data.modes[0].name;
		var price = data.productPrice;
		var banks = data.modes[0].banks;
		var tableContent = "";
		var tableHtml = "";
		$(".eip-popup__top-text--price").text(price);
		$(".eip-popup__wrap .tab .tab__item-title").html(name+'<span class="tab__item-line"></span>');
		$(".eip-popup__tab--dropdown").text(banks[0].name);
		
		for(let idx = 0; idx < banks.length; idx++){
			/*
			innerPriceHtml += '<li>';
			innerPriceHtml += '	<div class="hubble-eip--select-radio">';
			if(idx == 0){
				innerPriceHtml += '		<input type="radio" name="radio-01" class="hidden" id="radio-'+idx+ '"'+ ' checked>'
			}else{
				innerPriceHtml += '		<input type="radio" name="radio-01" class="hidden" id="radio-'+idx+ '"'+ '>'
			}
			innerPriceHtml += '		<label class="hubble-eip--select-radio__label" for="radio-' + idx + '"' +' tabindex="0">';
			innerPriceHtml += '			<span class="hubble-eip--select-radio__label-text">' + banks[idx].name + '</span>';
			innerPriceHtml += '		</label>';
			innerPriceHtml += '	</div>';
			innerPriceHtml += '</li>';
			*/
			innerPriceHtml += '<li class="eip-popup__tab--select-item">';
			 
			if(idx == 0){
				innerPriceHtml += '		<input type="radio" name="radio-01" class="hidden" id="radio-'+idx+ '"'+ ' checked>'
			}else{
				innerPriceHtml += '		<input type="radio" name="radio-01" class="hidden" id="radio-'+idx+ '"'+ '>'
			} 
			
			innerPriceHtml += '			<button>' + banks[idx].name + '</button>';
			innerPriceHtml += '</li>';
		}
		$(".eip-popup__tab--select-wrap .scrollbar__contents > ul").html(innerPriceHtml);
		window.sg.components.eipPopup.bindAdditionalEvent();
		//NOTICE 
		/*
		좌측 select 영역의 마크업과 우측 table 영역의 마크업이 그려지면,
		window.sg.components.eipPopup.bindAdditionalEvent() 함수를 호출해 주시고
		좌측 select 영역이 선택될 때, 우측 table 영역의 마크업을 변경하신 후,
		window.sg.components.eipPopup.resizeTableWrap() 함수를 호출해 주시기 바랍니다.
		*/
		
		
		for(let i = 0 ; i < banks.length; i++){
			var innerValue = banks[i].plans;
			for(let j = 0; j < innerValue.length; j++){
				tableContent += '<tr>';
				tableContent += '	<td>'+ innerValue[j].periodicValue + '</td>';
				tableContent += '	<td>'+ innerValue[j].code + '</td>';
				tableContent += '	<td>'+ innerValue[j].purchaseCost + '</td>';
				tableContent += '</tr>';
			}
			
			tableHtml += '<div class="scrollbar__contents" style="display:none">';
			tableHtml += '	<p class="eip-popup__tab--table-title">' + banks[i].name + '</p>';
			tableHtml += '	<table class="eip-popup__tab--table">';
			tableHtml += '		<caption><span class="blind"> Table Caption</span></caption>';
			tableHtml += '		<colgroup>';
			tableHtml += '			<col>';
			tableHtml += '			<col style="width:25%">';
			tableHtml += '			<col>';
			tableHtml += '		</colgroup>';
			tableHtml += '	<thead>';
			tableHtml += '		<tr>';
			tableHtml += '			<th scope="col">Cician<br>Per Bulan</th>';
			tableHtml += '			<th scope="col">Tenor<br>(bulan)</th>';
			tableHtml += '			<th scope="col">Total<br>Pembayaran</th>';
			tableHtml += '		</tr>';
			tableHtml += '	</thead>';
			tableHtml += '	<tbody>';
			tableHtml += 		tableContent
			tableHtml += '	</tbody>';
			tableHtml += '	</table>';
			tableHtml += '</div>';
			tableContent = "";
		}
		if($(".eip-popup__tab--table-wrap").next().length){
			$(".eip-popup__tab--table-wrap").nextAll().remove();
        }
		$(".eip-popup__tab--table-wrap").after(tableHtml);
		
	}

	// CRHQ-24 [B2C][MX][UA] Interactive Credit Calculator on PDP and PLP
	var emiDataGridUa = function(values){

		///////////////////////////  여기까지 로직 //////////////////////////////////
		var $eipArea = $(".finance-popup");
		var $contentArea = $eipArea.find(".finance-popup__content");

		$contentArea.html( (values||[]).length > 0 ? contentGrid(values[0].values||[]) : '' );

		if($contentArea.find('.installment-select__options ul li a').length > 0){
			$contentArea.find('.installment-select__placeholder-name .select-txt').text($contentArea.find('.installment-select__options ul li a:eq(0)').data('code'))
		}

		// month 이벤트 처리
		$contentArea.find('.installment-select__options ul li a').click(function(){
			const selectedOption = $(this).data("code");
			$(this).closest('.finance-popup__content').find('li.finance-popup__installment-list-item[data-code]').each(function(){
				if($(this).data("code") == selectedOption){
					$(this).show();
				}else {
					$(this).hide();
				}
			});
		});		
		///////////////////////////  여기까지 로직 //////////////////////////////////

		function contentGrid(tabDataValues){

			// api 에서 소팅이 되어 있지 않은 경우를 대비해 월 숫자 오름차순 정리
			tabDataValues.sort(function(a, b){
				const acode = parseFloat(a.code);
				const bcode = parseFloat(b.code);
				return acode - bcode;
			});

			return `
				<div class="finance-popup__installment-wrap">
				<ul class="finance-popup__installment-list">
					<li class="finance-popup__installment-list-item">
					<span>${Granite.I18n.get("Loan term (months)")}</span>
					<div class="finance-popup__installment-select">
						<div class="finance-popup__installment-select__choose">
						<div class="finance-popup__installment-select__choose-wrap">
							<div class="installment-select" data-global-text='{
								"Expand" : "Click to Expand",
								"Collapse" : "Click to Collapse"
							}'>
							<a href="#" class="installment-select__placeholder" role="button" aria-disabled="false" aria-expanded="true">
								<button class="installment-select__placeholder-btn installment-select__placeholder-btn-open">
								<span class="hidden">Open Down</span>
								<svg class="icon" focusable="false" aria-hidden="true">
									<use xlink:href="#open-down-regular" href="#open-down-regular"></use>
								</svg>
								</button>
								<button class="installment-select__placeholder-btn installment-select__placeholder-btn-close">
								<span class="hidden">Close Up</span>
								<svg class="icon" focusable="false" aria-hidden="true">
									<use xlink:href="#close-up-regular" href="#close-up-regular"></use>
								</svg>
								</button>
								<div class="installment-select__placeholder-name">
								<span class="select-txt">${Granite.I18n.get("Month")}</span>
								</div>
								<!--/*
								expand(확장) 상태일 경우 data-global-text='{expand에 설정된 문구}'와
								<span class="hidden">{expand에 설정된 문구}</span>
								Collapse(축소) 상태일 경우 data-global-text='{collapse에 설정된 문구}'와
								<span class="hidden">{collapse에 설정된 문구}</span> 지정된 문구로 동일하게 출력

								data-global-text='{}' :
								"Expand" : "Click to Expand",
								"Collapse" : "Click to Collapse"
								*/-->
								<span class="hidden">Click to Expand</span>
							</a>
							<div class="installment-select__options" aria-hidden="false">
								<ul role="list">
									${listItem(tabDataValues)}
								</ul>
							</div>
							</div>
						</div>
						</div>
					</div>
					</li>
					${list(tabDataValues)}
				</ul>
				</div>
				${paymentCeditDescGrid()}
				${paymentCreditFooterGrid()}
			`;
		}

		function listItem(tabDataValues) {

			return $.map(tabDataValues, function(monthItem){
				return `
				<li role="listitem" class="">
					<a href="#" role="option" data-code="${monthItem.code}">
					<div class="finance-popup__installment-select__choose-item">
						<span class="finance-popup__installment-select__choose-name">${monthItem.code}</span>
					</div>
					</a>
				</li>
				`
			}).join("");
		}

		function list(tabDataValues){
			
			return $.map(tabDataValues, function(item, index){

				return `
				<li class="finance-popup__installment-list-item" data-code="${item.code}" ${index == 0 ? '' : 'style="display:none;"'} >
					<span>${Granite.I18n.get("Monthly Payments")}</span>
					<span>${item.periodicValue}</span>
				</li>
				<li class="finance-popup__installment-list-item" data-code="${item.code}" ${index == 0 ? '' : 'style="display:none;"'} >
					<span>${Granite.I18n.get("Order cost")}</span>
					<span>${item.purchaseCost}</span>
				</li>				
				`;
			}).join("");
			
		}

		function paymentCeditDescGrid(){
			return `
			<div class="finance-popup__description">
				<p>
					${Granite.I18n.get("Representative Example without 0% or 9.90% offers: Representative 18.9% APR (variable)")+ " " +
					//Granite.I18n.get("Purchase interest rate 18.9%p.a (variable) Assumed credit limit £1,200*") + " " + 
					Granite.I18n.get("Displayed quote is not generated by Klarna, final estimates are made upon checkout.")}
				</p>
		  	</div>
			`;	
		}

		function paymentCreditFooterGrid(){
			return `
			<div class="finance-popup__credit">
				<div class="finance-popup__credit-text">
					${Granite.I18n.get("*Subject to financial circumstances. You must be at least 18. Credit is provided by Klarna Bank AB, which is authorised and regulated by the Swedish Financial Services " + 
					"Authority, with limited supervision by the Financial Conduct Authority and Prudential Regulation Authority in the UK. Registered office: Sveavägen 46, 111 34 " + 
					"Stockholm, Sweden. Corporation ID number: 556737-0431. If you already have a Klarna Credit account, this purchase will be added to your balance. " + 
					"<a href=\"https://www.samsung.com/ua/online-credit/\" title=\"Terms and conditions\" target=\"_blank\">T&amp;Cs apply</a>.")}
				</div>
			</div>
			`;
		}		
	}

	function showEmiPopup(modelCode, closeFocus) {
		// EMI API 호출
		var siteCode = $("#siteCode").val();
		
		// epp shop분기 추가
		const siteCodeWithEpp = checkEppSite() ? (window.sg.epp != null && window.sg.epp.common != null ? window.sg.epp.common.companyCode : "") : siteCode;

		let shopParm = '';
		if( $('#shopParmLang').val() ){
			shopParm=`&lang=${$('#shopParmLang').val()}`;
		}
		
		var _xhrFields = $('#isEppPage').val() === 'true' ? { withCredentials: true } : {};
		
		if(siteCode == 'id'){
				$.ajax({
					url : storeDomain + "/tokocommercewebservices/v2/"+ siteCodeWithEpp+ "/products/getInstallmentPlans?fields=DEFAULT&sku=" + modelCode+shopParm,
					type: "GET",
					dataType: "json",
					xhrFields: _xhrFields,
					crossDomain: true,
					timeout: 10000,
					success: function (data) {
						if (data && data.modes.length > 0) {
							emiDataGridID(data);
							//window.sg.components.hubbleEipPopup.reInit();
							window.sg.components.eipPopup.init();
							//window.sg.components.hubblePdPopup.openPopup(document.querySelector("#hubble-eip-layer"), closeFocus);
							window.sg.components.eipPopup.showPopup();
							$(".hubble-eip-select-area").off("click",".hubble-eip--select-radio input[name=radio-01]")
							$(".hubble-eip-select-area").on("click",".hubble-eip--select-radio input[name=radio-01]", function(){
								var id = $(this).attr('id');
								var tabIdx = id.split('-')[1];
								var tables = $('.hubble-eip-table-area');
								for(let i = 0; i < tables.length; i++){
									if(i == tabIdx){
										tables[i].style.display = 'block';
									}else{
										tables[i].style.display = 'none';
									}
								}
							});
							
							$(document).on("click",".eip-popup__tab--select-item", function(){
								var selectWrap = $(".eip-popup__tab--select-item");
								var tableWrap = $(".eip-popup__tab--table-wrap").siblings(".scrollbar__contents");
								var selectedTable = "";
								
								for(var i=0; i<selectWrap.length; i++){
									if(selectWrap[i].classList.value.indexOf("active") > -1){
										selectedTable = tableWrap.clone()[i];
										selectedTable.removeAttribute("style");
									}
								}
								$(".eip-popup__tab--table-wrap .scrollbar__wrap").html(selectedTable);
								window.sg.components.eipPopup.resizeTableWrap();
							});
							
							$(".eip-popup__tab--select-item.active").click();
						}
					},
					error: function (e) {
						errLayerPop(e);
					}
				});
		}else if(isCalculateInstallment){
			//uk와 uk외 국가들에 대한 적용  (ee, lv, lt) + pl
			let apiUrl = '';
			//COMP6FE-1590 [SMB] Financing Calculator& Leasing es추가
			if(isB2B){
				let storeSiteCode = $("#store_sitecode").val();
				shopParm = `lang=${$('#language').val()}&`;
				
				if($('#priceCurrency').val()){
					shopParm +=`curr=${$('#priceCurrency').val().toUpperCase()}`;
				}else{
					shopParm +=`curr=${$('#pfPriceCurrency').val().toUpperCase()}`;
				}
				apiUrl = storeDomain + "/tokocommercewebservices/v2/" + storeSiteCode + "/products/" + modelCode + "/calculateInstallment?"+shopParm;
			}else{
				//[EPP] &EPPONLY 도메인 변경
				if(checkEppSite() && ($('#shopIntegrationFlag').val() === 'Hybris'|| $('#shopIntegrationFlag').val() === 'Hybris-intg')){
					storeDomain = window.sg.epp.common.orgNewHyvStoreDomain;
				}
				//B2C
				apiUrl = storeDomain + "/tokocommercewebservices/v2/" + siteCodeWithEpp + "/products/" + modelCode + "/calculateInstallment?fields=DEFAULT"+shopParm;
			}
 
			$.ajax({
				url : apiUrl,
				type: "GET",
				dataType: "json",
				xhrFields: _xhrFields,
				crossDomain: true,
				timeout: 10000,
				success: function (data) {
					if (data && data.values.length > 0) {
						if(siteCode == 'ua'){ // CRHQ-24
							emiDataGridUa(data.values);
						}else{
							emiDataGrid(data.values, siteCode);
						}
						window.sg.components.financePopup.reInit(); //reInit 호출
						//api호출 data가 있는 경우 팝업 오픈, data 없으면 동작 X
						window.sg.components.financePopup.showPopup(closeFocus[0]);
					}
				},
				error: function (e) {
					errLayerPop(e);
				}
			});
		}  
	}

	// hubbleEipPopup 마크업 js 이후 세팅
	// window.sg.components.hubbleEipPopup.showEmiPopup(modelCode, clickBtn);
	//window.sg.components.hubbleEipPopup.showEmiPopup = showEmiPopup;
	window.sg.components.financePopup.showEmiPopup = showEmiPopup;
	
})($);
(function (win, $) {
	
	var siteCode = $("#siteCode").val();			// GNB에서 사용되는 SiteCode
	var storeDomain = $("#storeDomain").val();		// GNB Store Domain
	var storeWebDomain = $("#storeWebDomain").val();								//new-hybris
	var countryIsoCode = $("#countryIsoCode").val();
	var multiLanguageYN = $("#multiLanguageYn").val();		// multilanguage Y/N
	var hreflang = $("#localLang").val();					// hreflang 값
	var shopIntegrationFlag = $("#shopIntegrationFlag").val();	// shop 통합 국가 여부
	var isNewHybris = (shopIntegrationFlag === "Hybris-new")?true:false;			//new-hybris	
	var isB2B = $('#b2bFlag').val() === "Y" ? true : false;
	var isOldHybrisSiteCode = ["ch","ch_fr","hk","hk_en","hu","levant","levant_ar","es","pt","ca","ca_fr","sg"]; //wishlist 사용하는 old hybris 국가
	// Store API 호출 시 사용하는 SiteCode
	var storeSiteCode = $('#store_sitecode').val();
	var csrfToken = "";
	
	// epp shop분기 추가
	storeSiteCode = checkEppSite() ? (window.sg.epp != null && window.sg.epp.common != null ? window.sg.epp.common.companyCode : "") : storeSiteCode;
	
	/* layer popup에서 사용될 code 및 name */
	var tempProductCode = "";
	var tempProductName = "";
	//var dtmProductCode = "";
	var stockLevelStatus= "";
	var tempPrice= "";
	var loginFlag = false;
	var wishArea = "";
	var priceCurrency = $("#priceCurrency").val();	// 가격 통화단위
	var useComponent = ""; // wishlist 사용 컴포넌트
	
	/* wishlist 팝업 html */
	var wishlistCategory = '';
	var wishlistPopup = $('.wishlist-popup');
	var wishlistPopupTitle = $('.wishlist-popup').find('.layer-popup__title');
	var wishlistPopupDesc = $('.wishlist-popup').find('.wishlist-popup__desc');
	var wishlistPopupCtaWrap = $('.wishlist-popup').find('.wishlist-popup__cta-wrap'); 
	var wishlistSelectBox = $('.wishlist-popup').find('.wishlist-popup__selectbox__wrap');
	var wishlistSelect = $('.wishlist-popup').find('.wishlist-popup__selectbox-inner select');	// PC, Mobile
	
	var pageTrack = digitalData.page.pageInfo.pageTrack;
	
	// epp shop분기 추가
	const isEppSite = checkEppSite();
	if(isEppSite && window.sg.epp == null ){
		window.sg.epp = {};
		window.sg.epp.common = {};
	}
	let siteCodeWithEpp = isEppSite ? window.sg.epp.common.companyCode : siteCode;
	/*
	if (siteCode === "ae" || siteCode === "ae_ar") {
		var dotcomMultistore = window.cookies.getCookie("estoreSitecode");
		if(dotcomMultistore) {
			if(dotcomMultistore === "ae" || dotcomMultistore === "ae_ar" || dotcomMultistore === "kw" || dotcomMultistore === "kw_ar" || dotcomMultistore === "om" 
				|| dotcomMultistore === "om_ar" || dotcomMultistore === "bh" || dotcomMultistore === "bh_ar" || dotcomMultistore === "qa" || dotcomMultistore === "qa_ar") {
				siteCodeWithEpp = dotcomMultistore;
				storeSiteCode = dotcomMultistore;
			} else {
				siteCodeWithEpp = siteCode;
				storeSiteCode = siteCode;
			}
		} else {
			siteCodeWithEpp = siteCode;
			storeSiteCode = siteCode;
		}
	} else if (siteCode === "n_africa") {
		siteCodeWithEpp = "ma";
		storeSiteCode = "ma";
	} else */
	if ( !isEppSite ){
		if (siteCode === "levant") { // /wishlist, /addProductToExistingWishlist, /addProductToNewWishlist api 호출시 사용
			siteCodeWithEpp = "jo";
			storeSiteCode = "jo";
		} else if (siteCode === "levant_ar") {
			siteCodeWithEpp = "jo_ar";
			storeSiteCode = "jo_ar";
		}
	}
	
	let wislhistAriaLabelForPD07 = "";
	let selectedWislhistAriaLabelForPD07 = "";
	
	Granite.I18n.setLocale($("#language").val());
	
	//[EPP] WishlistPopupUrl url변경
	if(checkEppSite() && (shopIntegrationFlag === 'Hybris-intg' || isOldHybrisSiteCode.includes(siteCode))) {
		$("#WishlistPopupUrl").val(window.sg.epp.common.WishlistPopupUrl);
	}
	
	function showErrorText(e){
		var errorText = "";
		if (e.responseJSON != null) {
			if (e.responseJSON.message != null && e.responseJSON.message !== "") {
				errorText = e.responseJSON.message;
			}else{
				errorText = Granite.I18n.get("ERROR");
			}
		}else{
			errorText = Granite.I18n.get("ERROR");
		}
		
		return errorText;
	}
	/**
	 * Popup Text Setting
	 */
	function changePopup(wishlistCategory) {
		$('.wishlist-popup').find('.wishlist-popup__cta').remove();
		
		var ctaBlackDiv = document.createElement('div');
		var ctaEmphasisDiv = document.createElement('div');
		var aTagBlack = document.createElement("a");
		var aTagEmphasis = document.createElement("a");
		ctaBlackDiv.setAttribute("class","wishlist-popup__cta");
		ctaEmphasisDiv.setAttribute("class","wishlist-popup__cta");
		
		aTagBlack.setAttribute("class","cta cta--outlined cta--black js-black");
		aTagBlack.setAttribute("href","javascript:;");
		aTagBlack.setAttribute("role","button");
		
		useComponent = useComponent.toUpperCase();
		if(useComponent === "PD03"){
			aTagBlack.setAttribute("an-tr","pd03_product finder:wishlist-"+pageTrack+"-cta-button");
		}else if(useComponent === "PD07"){
			aTagBlack.setAttribute("an-tr","pd07_offers product card list-"+pageTrack+"-text-button");
		}else if(useComponent === "HDD01"){
			aTagBlack.setAttribute("an-tr","header(pim)_product Info-"+pageTrack+"-cta-button");
		}else if(useComponent === "PD10"){
			aTagBlack.setAttribute("an-tr","curation card-"+pageTrack+"-text-button");
		}else if(useComponent === "PD12"){
			aTagBlack.setAttribute("an-tr","pd12_product card|wishlistPopup");
		}else if(useComponent === "PD13"){
			aTagBlack.setAttribute("an-tr","pd13_offers product card list|wishlistPopup");
		}else if(useComponent === "PDD17"){
			aTagBlack.setAttribute("an-tr","pdd17_pd header|wishlistPopup");
		}else if(useComponent === "MYD15"){
			aTagBlack.setAttribute("an-tr","myd15_recommended products-"+pageTrack+"-wishlist popup-account");
		}

		aTagBlack.setAttribute("an-ca","account");
		aTagBlack.setAttribute("an-ac","wishlist");
		aTagBlack.setAttribute("data-modelcode",tempProductCode);
		aTagBlack.setAttribute("data-modelname",tempProductName);
		
		aTagEmphasis.setAttribute("class","cta cta--contained cta--black js-emphasis");
		aTagEmphasis.setAttribute("href","javascript:;");
		aTagEmphasis.setAttribute("role","button");
		if(useComponent === "PD03"){
			aTagEmphasis.setAttribute("an-tr","pd03_product finder:wishlist-"+pageTrack+"-cta-button");
		}else if(useComponent === "PD07"){
			aTagEmphasis.setAttribute("an-tr","pd07_offers product card list-"+pageTrack+"-text-button");
		}else if(useComponent === "HDD01"){
			aTagEmphasis.setAttribute("an-tr","header(pim)_product Info-"+pageTrack+"-cta-button");
		}else if(useComponent === "PD10"){
			aTagEmphasis.setAttribute("an-tr","curation card-"+pageTrack+"-text-button");
		}else if(useComponent === "PD12"){
			aTagEmphasis.setAttribute("an-tr","pd12_product card|wishlistPopup");
		}else if(useComponent === "PD13"){
			aTagEmphasis.setAttribute("an-tr","pd13_offers product card list|wishlistPopup");
		}else if(useComponent === "PDD17"){
			aTagEmphasis.setAttribute("an-tr","pdd17_pd header|wishlistPopup");
		}else if(useComponent === "MYD15"){
			aTagEmphasis.setAttribute("an-tr","myd15_recommended products-"+pageTrack+"-wishlist popup-account");
		}
		aTagEmphasis.setAttribute("an-ca","account");
		aTagEmphasis.setAttribute("an-ac","wishlist");
		aTagEmphasis.setAttribute("data-modelcode",tempProductCode);
		aTagEmphasis.setAttribute("data-modelname",tempProductName);
		
		var wishlistTitle = '';
		var wishlistDesc = '';
		var ctaText = '';
		var ctaTextEmphasis = '';
		var ctaTextTagging = '';
		var ctaTextEmphasisTagging = '';
		
		if(wishlistCategory === 'notForSale'){
			wishlistTitle = Granite.I18n.get('Not for sale', siteCode);
			ctaTextEmphasis = Granite.I18n.get('Keep browsing', siteCode);
			ctaTextEmphasisTagging = 'Keep browsing';
			$(ctaEmphasisDiv).addClass('cta--single');
			// CRHQ-1014 [B2C] wishlist 팝업 마크업 변경 건
			$(wishlistPopupDesc).addClass('popup__desc--align-center');
			$(wishlistPopupDesc).addClass('wishlist-popup__desc--only');
		}else if(wishlistCategory === 'createWishlist'){
			wishlistTitle = Granite.I18n.get('Create your wishlist', siteCode);
			wishlistDesc = Granite.I18n.get('Don’t miss out on the products you love.', siteCode) +' '+ Granite.I18n.get('Sign in/Sign up now to access your wishlist on all your devices and get updates on great promotions.', siteCode);
			ctaText = Granite.I18n.get('Keep browsing', siteCode);
			ctaTextEmphasis = Granite.I18n.get('Continue', siteCode);
			if(siteCode == 'cz' || siteCode == 'sk' ){
			    ctaTextEmphasis = Granite.I18n.get('Continue_wishlist', siteCode);
			}else if(siteCode == 'cn'){
				ctaTextEmphasis = Granite.I18n.get('Log In', siteCode);
			}
			if(siteCode == 'pe'){
				ctaTextEmphasis = Granite.I18n.get('Add', siteCode);
			}
			ctaTextTagging = 'Keep browsing';
			ctaTextEmphasisTagging = 'Continue';
		}else if(wishlistCategory === 'selectWishlist'){
			wishlistTitle = Granite.I18n.get('Add to wishlist', siteCode);
			wishlistDesc = Granite.I18n.get('Do you want to add this product to your wishlist?', siteCode);
			ctaText = Granite.I18n.get('Keep browsing', siteCode);
			ctaTextEmphasis = Granite.I18n.get('Add to wishlist', siteCode);
			if(siteCode == 'cz'){
			    ctaText = Granite.I18n.get('Keep browsing_cta', siteCode);
			}
			if(siteCode == 'cz' || siteCode == 'sk' ){
			    ctaTextEmphasis = Granite.I18n.get('Add to wishlist_cta', siteCode);
			}
			ctaTextTagging = 'Keep browsing';
			ctaTextEmphasisTagging = 'Add to wishlist';
		}else if(wishlistCategory === 'completeWishlist'){
			wishlistTitle = Granite.I18n.get('Wishlist', siteCode);
			wishlistDesc = Granite.I18n.get('This product has been added to your wishlist.', siteCode);
			if(shopIntegrationFlag === 'GPv2' || isNewHybris || isB2B){				//new-hybris	
				ctaTextEmphasis = Granite.I18n.get('Continue shopping', siteCode);
				ctaTextEmphasisTagging = 'Continue shopping';
				$(ctaEmphasisDiv).addClass('cta--single');
			}else if(shopIntegrationFlag === 'Hybris-intg' || isOldHybrisSiteCode.includes(siteCode)){
				ctaText = Granite.I18n.get('Change', siteCode);
				ctaTextEmphasis = Granite.I18n.get('Continue shopping', siteCode);
				ctaTextTagging = 'Change';
				ctaTextEmphasisTagging = 'Continue shopping';
			}
		};
		
		// CRHQ-1014 [B2C] wishlist 팝업 마크업 변경 건
		if(wishlistCategory === 'notForSale'){
			$(wishlistPopupTitle).hide();
			$(wishlistPopupDesc).html(wishlistTitle);
		}else{
			$(wishlistPopupTitle).html(wishlistTitle);
			$(wishlistPopupDesc).html(wishlistDesc);
		}
		
		aTagBlack.setAttribute("an-la",ctaTextTagging.toLowerCase());
		aTagEmphasis.setAttribute("an-la",ctaTextEmphasisTagging.toLowerCase());
		
		if(ctaText){
			aTagBlack.innerHTML = ctaText;
			aTagBlack.setAttribute("aria-label", ctaText);
			ctaBlackDiv.appendChild(aTagBlack);
			wishlistPopupCtaWrap.append(ctaBlackDiv);
		}
		aTagEmphasis.innerHTML = ctaTextEmphasis;
		aTagEmphasis.setAttribute("aria-label", ctaTextEmphasis);
		ctaEmphasisDiv.appendChild(aTagEmphasis);
		wishlistPopupCtaWrap.append(ctaEmphasisDiv);
	}
	
	function changePopupEvent(wishlistCategory, wishareaTarget) {
		wishlistSelectBox.hide(); // shop 통합 hybris - select 경우에만 show
		if(shopIntegrationFlag === 'GPv2' || isNewHybris || isB2B){				//new-hybris	
			$(document).off("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis");
			$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-black", function () {
				wishlistPopup.hide();
				window.sg.components.wishPopup.closePopup();
				window.sg.components.wishlistIcon.closeWishlistPop(wishareaTarget);
			});
			if(wishlistCategory === 'notForSale' || wishlistCategory === 'completeWishlist'){
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					wishlistPopup.hide();
					window.sg.components.wishPopup.closePopup();
					window.sg.components.wishlistIcon.closeWishlistPop(wishareaTarget);
				});
			}else if(wishlistCategory === 'createWishlist'){
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					if(isEppSite){
						window.sg.epp.common.signIn(location.href);
					} else {
						goAccountLogin();
					}
				});
			}else if(wishlistCategory === 'selectWishlist'){
				$(document).on("click" , ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					if(isNewHybris || isB2B || isOldHybrisSiteCode.includes(siteCode)){				//new-hybris	
						newHybrisAddWishlist();
					} else {
						gpv2AddWishlist();
					}
				});
			}
		}else if(shopIntegrationFlag === 'Hybris-intg' || isOldHybrisSiteCode.includes(siteCode)){
			$(document).off("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis");
			$(document).off("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-black");
			$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-black", function () {
				wishlistPopup.hide();
				window.sg.components.wishlistIcon.closeWishlistPop(wishareaTarget);
			});
			if(wishlistCategory === 'notForSale'){
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishareaTarget);
				});
			}else if(wishlistCategory === 'createWishlist'){
				$(document).on("click" , ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					if(isEppSite){
						window.sg.epp.common.signIn(location.href);
					} else {
						goAccountLogin();
					}
				});
			}else if(wishlistCategory === 'selectWishlist'){
				//wishlistSelectBox.show();
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					shopIntgAddWishlist();
				});
			}else if(wishlistCategory === 'completeWishlist'){
				$(document).off("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-black");
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-emphasis", function () {
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishareaTarget);
				});
				$(document).on("click", ".wishlist-popup .wishlist-popup__cta-wrap .js-black", function () {
					window.location.href = $("#WishlistPopupUrl").val();
				});
			}
		};
	}
	
	/**
	 * pd, pf 템플릿에 따른 icon 동작
	 * 
	 * addClassText : wishlist 추가 할때 사용
	 * deleteClassText : 추가 되어 있는 wishlist 삭제 할때 사용 
	 */
	function useFunctionPdPf(addClassText, removeClassText, AddTooltipText, ariaLebelText, el, shopIntegrationFlag, actionFlag, modelCode){
		if('undefined' !== typeof window.sg.components){
			
			if('undefined' !== typeof window.sg.components.dynamic && 'undefined' !== typeof window.sg.components.dynamic.DetailAfterEvent){
				if(shopIntegrationFlag === 'hybrisIntg'){
					window.sg.components.dynamic.DetailAfterEvent.wishlistPopup( addClassText+' cta--disabled', removeClassText,  '' );
				}else{					
					window.sg.components.dynamic.DetailAfterEvent.wishlistPopup( addClassText, removeClassText, AddTooltipText ); 
				}
			}else if('undefined' !== typeof window.sg.components.pfdevfn ){
				if(!addClassText){
					addClassText = removeClassText;
				}
				window.sg.components.pfdevfn.afterAddWishlist(el, addClassText, AddTooltipText, shopIntegrationFlag, tempProductCode, ariaLebelText);
				if(actionFlag === 'delete'){
					window.sg.components.pfdevfn.spliceAddedWishList(modelCode);
				}
			}
		}
	}
	
	/**
	 * Account Login Page로 Redirect
	 */
	function goAccountLogin(){
		var returnURL = window.location.href;
		var $signInForm = $("#signInForm");

		$("#signInGoBackURL", $signInForm).val(encodeURIComponent(returnURL));

		var registCheckUrl = $("#redirect_uri", $signInForm).val();

		var domainTemp = "";
		var winPort = window.location.port;
		/* port가 없거나 80, 8080 일 경우에는 https://로 호출 */
		if(winPort == null || winPort === "" || winPort === "80" || winPort === "8080"){
			domainTemp = "https://" + window.location.host;
		}else{
			domainTemp = "http://" + window.location.host;
		}

		if(registCheckUrl.indexOf(window.location.hostname) < 0){
			var registFullUrl = domainTemp + registCheckUrl;
			$("#redirect_uri", $signInForm).val(registFullUrl);
		}

		var glbState = "GLB" + Math.random().toString(36).substr(2,11);
		$.cookies.set("glbState", glbState, {domain : ".samsung.com"});
		if(siteCode === "cn") $.cookies.set("glbState", glbState, {domain : ".samsung.com.cn"}); //CRHQ 798 [AEM][CN] Hybris 전환 

		$("#response_type", $signInForm).val("code");
		$("#countryCode", $signInForm).val($("#countryCode", $signInForm).val());
		$("#signInState", $signInForm).val(glbState);
		$("#signInGoBackURL", $signInForm).val(returnURL);
		$("#scope", $signInForm).val("");

		var client_idCheck = $("#loginAccountServiceId").val();
		if(client_idCheck){
			$("#client_id", $signInForm).val(client_idCheck);
		}

		var languageCodeCheck = $("#languageCode").val();
		var countryCodeCheck = $("#countryCode").val()
		if(languageCodeCheck && countryCodeCheck){
			var locale = languageCodeCheck + "_" + countryCodeCheck;
			$("#locale", $signInForm).val(locale);
		}

		$.cookies.set("returnURL", returnURL, {domain : ".samsung.com"});
		if(siteCode === "cn") $.cookies.set("returnURL", returnURL, {domain : ".samsung.com.cn"}); // CRHQ 798 [AEM][CN] Hybris 전환 
		if(isB2B){ // 2021.04.12 B2B 로그인 추가
			$.cookies.set("dotcomReturnURL", returnURL, {domain : ".samsung.com"});
			if(siteCode === "cn") $.cookies.set("dotcomReturnURL", returnURL, {domain : ".samsung.com.cn"}); // CRHQ 798 [AEM][CN] Hybris 전환 
		}

		$signInForm.submit();
	}
	
	function loginJwtCheck(loginJwt) {
		var loginJwtFlag = true;
		if(loginJwt == null || loginJwt === ""){
			if(isEppSite){
				window.sg.epp.common.signIn(location.href);
			} else {
				goAccountLogin();
			}
			loginJwtFlag = false;
		}
		return loginJwtFlag;
	}
	
	//new-hybris
	function newHybrisAddWishlist(){
		var guid = $.cookies.get("guid",{domain:".samsung.com"});
		if(siteCode === "cn") guid = $.cookies.get("guid",{domain:".samsung.com.cn"});	//CRHQ 798 [AEM][CN] Hybris 전환 
		if(guid != null){
			commonLoginCheck( function(isLogin){
				if(isLogin) {
					let shopParm = '';
					if( $('#shopParmLang').val() ){
						shopParm=`&lang=${$('#shopParmLang').val()}`;
					}

					$.ajax({
						url : storeDomain + "/tokocommercewebservices/v2/" + storeSiteCode + "/users/current/wishlist/default/product/add?productCode="+tempProductCode + shopParm,		// 20210413 query parameter 로 변경, header 제거
						type : "POST",
						dataType : "json",
						timeout : 20000,
						xhrFields: { withCredentials: true },
						crossDomain: true,
						async : true,
						success : function(data){
							if(data != null){
								useFunctionPdPf('pd-wishlist-cta--on','', Granite.I18n.get("Remove wishlist"), selectedWislhistAriaLabelForPD07,  wishArea, 'GPv2', tempProductCode);
								
								//[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가
								if(siteCode !== "cn"){
									changePopup('completeWishlist');
									changePopupEvent('completeWishlist', wishArea[0]);
									window.sg.components.wishPopup.showPopup();
								}
								
							}else{
								confirmPopup(Granite.I18n.get("ERROR"));
							}
						},
						error : function(e){
							confirmPopup(showErrorText(e),"error");
							wishlistPopup.hide();
							window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
						}
					});
				} else {
					confirmPopup(Granite.I18n.get("ERROR"));
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
				}
			})
			
		}else{
			confirmPopup(Granite.I18n.get("ERROR"));
			wishlistPopup.hide();
			window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
		}
	};

	function gpv2AddWishlist(){
		var loginJwt = $.cookies.get("jwt_"+countryIsoCode, {domain : ".samsung.com"});

		var checkJwt = loginJwtCheck(loginJwt);
		
		if(checkJwt){
			var paramObj = {
				"sku": tempProductCode,
				"price": {
					"amount": tempPrice,
					"currency": priceCurrency
				}
			};

			$.ajax({
				headers: {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin" : "*",
					"x-ecom-app-id" : "identity-store-global",
					"x-ecom-jwt" : loginJwt
				},
				url : storeDomain + "/v4/identity/wishlist/",
				type : "POST",
				data : JSON.stringify([paramObj]),
				dataType : "json",
				timeout : 20000,
				xhrFields: { withCredentials: true },
				async : true,
				beforeSend : function(xhr){
					if(multiLanguageYN === "Y"){
						xhr.setRequestHeader("x-ecom-locale", hreflang);
					}
				},
				success : function(data){
					if(data != null){
						useFunctionPdPf('pd-wishlist-cta--on','', Granite.I18n.get("Remove wishlist"),selectedWislhistAriaLabelForPD07, wishArea, 'GPv2', tempProductCode);
						changePopup('completeWishlist');
						changePopupEvent('completeWishlist', wishArea[0]);
						window.sg.components.wishPopup.showPopup();
					}else{
						confirmPopup(Granite.I18n.get("ERROR"));
					}
				},
				error : function(e){
					confirmPopup(showErrorText(e),"error");
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
				}
			});
		}else{
			confirmPopup(Granite.I18n.get("ERROR"));
			wishlistPopup.hide();
			window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
		}
	};
	
	function shopIntgAddWishlist(){
		var wishListName = '';
		var wishlistFlag = '';
		wishListName = $('.wishlist-popup').find('.wishlist-popup__selectbox-inner select').val();
		wishlistFlag = $('.wishlist-popup').find('.wishlist-popup__selectbox-inner select').find('option:selected').attr('data-check');

		if(wishlistFlag === "true"){
			var urlExistWishlist = storeDomain + "/" + siteCodeWithEpp + "/wishlist/addProductToExistingWishlist";
			$.ajax({
				url : urlExistWishlist,
				type : "POST",
				contentType : "application/x-www-form-urlencoded",
				async: false,
				data : {
					"CSRFToken" : csrfToken,
					"wishlistName" : wishListName,
					"productCode" : tempProductCode
				},
				xhrFields: {
					withCredentials: true
				},
				headers : {
					Accept : "application/json"
				},
				crossDomain : true,
				dataType : "json",
				timeout : 20000,
				success : function(data){
					if(data.success === true){
						useFunctionPdPf('pd-wishlist-cta--on','', Granite.I18n.get("Remove wishlist"),selectedWislhistAriaLabelForPD07, wishArea, 'hybrisIntg');
						changePopup('completeWishlist');
						changePopupEvent('completeWishlist', wishArea[0]);
						window.sg.components.wishPopup.showPopup();
					}else{
						wishlistPopup.hide();
						window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
					}
				},
				error : function(e){
					confirmPopup(showErrorText(e),"error");
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
				}
			});
		}else{
			var urlNewWishlist = storeDomain + "/" + siteCodeWithEpp + "/wishlist/addProductToNewWishlist";
			$.ajax({
				url : urlNewWishlist,
				type : "POST",
				contentType : "application/x-www-form-urlencoded",
				async: false,
				data : {
					"CSRFToken" : csrfToken,
					"wishlistName" : wishListName,
					"productCode" : tempProductCode
				},
				xhrFields: {
					withCredentials: true
				},
				headers : {
					Accept : "application/json"
				},
				crossDomain : true,
				dataType : "json",
				timeout : 20000,
				success : function(data){
					if(data.success === true){
						useFunctionPdPf('pd-wishlist-cta--on','', Granite.I18n.get("Remove wishlist"),selectedWislhistAriaLabelForPD07, wishArea, 'hybrisIntg');
						changePopup('completeWishlist');
						changePopupEvent('completeWishlist', wishArea[0]);
						window.sg.components.wishPopup.showPopup();
					}
				},
				error : function(e){
					confirmPopup(showErrorText(e),"error");
					wishlistPopup.hide();
					window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
				}
			});
		}
	};

	/**
	 * [GPv2, New-Hybris] Wishlist Remove api 이후 호출
	 */
	function afterRemoveWishlist(data){
		if(data != null){
			useFunctionPdPf('','pd-wishlist-cta--on', Granite.I18n.get("Add to wishlist"),wislhistAriaLabelForPD07, wishArea, 'GPv2', 'delete', tempProductCode);
			window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
		}else{
			confirmPopup(Granite.I18n.get("ERROR"));
			wishlistPopup.hide();
			window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
		}

	}

	/**
	 * [GPv2, New-Hybris] Wishlist 버튼 클릭시 팝업 표시
	 */
	function wishlistBtnPopup(){
		
		let wishStatus = ""; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
		if(stockLevelStatus === "NOORDER" || stockLevelStatus === "LEARNMORE"){ // 재고가 없는 경우
			wishStatus = "notForSale"; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
			changePopup('notForSale');
			changePopupEvent('notForSale', wishArea[0]);
		}else{ // 재고가 있는 경우
			if(tempPrice){
				if ( siteCode === "pl" && stockLevelStatus === "OUTOFSTOCK" ) {
					wishStatus = "notForSale"; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
					changePopup('notForSale');
					changePopupEvent('notForSale', wishArea[0]);
				} else {
					if(loginFlag){ // 로그인 시
						wishStatus = "selectWishlist"; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
						//[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가
						if(siteCode === "cn"){
							newHybrisAddWishlist();
							window.sg.components.wishPopup.closePopup(); //scroll 및 팝업시 발생하는 event 때문에 추가
						}else{
							changePopup('selectWishlist');
							changePopupEvent('selectWishlist', wishArea[0]);
						}
					}else{ // 비로그인
						wishStatus = "createWishlist"; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
						changePopup('createWishlist');
						changePopupEvent('createWishlist', wishArea[0]);
					}
				}
			}else{ // 'NOORDER'가 아니고 가격이 없는 경우
				wishStatus = "notForSale"; //[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가 - wish 상태 
				changePopup('notForSale');
				changePopupEvent('notForSale', wishArea[0]);
			}
		}
		
		//[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가
		if(siteCode === "cn"){
			if(wishStatus !== "selectWishlist"){
				window.sg.components.wishPopup.showPopup();
			}
		}else{
			window.sg.components.wishPopup.showPopup();
		}
	}
	
	//new-hybris	
	function newHybrisClickEventListener(){
		$(document).off("click", ".pd-wishlist-cta");
		$(document).on("click", ".pd-wishlist-cta", function(e){
			wishArea = $(this);
			tempProductCode = $(this).attr("data-modelcode");
			tempProductName = $(this).attr("data-modelname");
			stockLevelStatus = $(this).attr("data-stock").toUpperCase();
			tempPrice = $(this).attr("data-modelprice");
			if($(this).attr("data-component")){
				useComponent = $(this).attr("data-component");
			}
			if(useComponent == "PD07"){
				wislhistAriaLabelForPD07 = Granite.I18n.get("Add to wishlist") +' '+ $(this).attr("data-arialabeltext");
				selectedWislhistAriaLabelForPD07 =  Granite.I18n.get("Remove wishlist")+' '+$(this).attr("data-arialabeltext") +' '+Granite.I18n.get("Selected");
			}
			if(useComponent == "MYD15"){
				wislhistAriaLabelForPD07 = Granite.I18n.get("Add to wishlist") +' '+ $(this).attr("data-arialabeltext");
				selectedWislhistAriaLabelForPD07 =  Granite.I18n.get("Remove wishlist")+' '+$(this).attr("data-arialabeltext");
			}
			
			if(wishArea.hasClass("pd-wishlist-cta--on")){	// wishlist로 추가 되어 있는 경우 삭제 로직 
				var guid = $.cookies.get("guid",{domain:".samsung.com"});

				var queryParam = "?productCode="+tempProductCode+"&fields=DEFAULT&loadEntries=true&wishlistName=My Wishlist";

				if( $('#shopParmLang').val() ){
					queryParam+=`&lang=${$('#shopParmLang').val()}`;
				}
				
				//[cn new-hybris] [SRD-13860] 로그인시 wishlist 추가시 팝업없이 추가
				if(siteCode === "cn")
					window.sg.components.wishPopup.closePopup(); //scroll 및 팝업시 발생하는 event 때문에 추가
					
				$.ajax({
					url : storeDomain + "/tokocommercewebservices/v2/" + storeSiteCode + "/users/current/wishlist/removeProductFromWishlist"+queryParam,
					type : "POST",
					dataType : "json",
					timeout : 20000,
					xhrFields: { withCredentials: true },
					async : true,
					success : function(data){
						afterRemoveWishlist(data);
					},
					error : function(e){
						afterRemoveWishlist();
					}
				});
			}else{// wishlist로 추가 X
				wishlistBtnPopup();
			}
		});
	};

	function gpv2ClickEventListener(){ // complete 후, gpv2와 다르게 a버튼 disabled 시킴
		$(document).off("click", ".pd-wishlist-cta");
		$(document).on("click", ".pd-wishlist-cta", function(e){
			wishArea = $(this);
			tempProductCode = $(this).attr("data-modelcode");
			tempProductName = $(this).attr("data-modelname");
			stockLevelStatus = $(this).attr("data-stock").toUpperCase();
			tempPrice = $(this).attr("data-modelprice");
			if($(this).attr("data-component")){
				useComponent = $(this).attr("data-component");
			}
			
			if(wishArea.hasClass("pd-wishlist-cta--on")){	// wishlist로 추가 되어 있는 경우 삭제 로직 
				var loginJwt = $.cookies.get("jwt_"+countryIsoCode, {domain : ".samsung.com"});
				var paramObj = {
					"sku": tempProductCode
				};
				
				$.ajax({
					headers: {
						"Cache-Control": "no-cache",
						"Content-Type": "application/json",
						"Access-Control-Allow-Origin" : "*",
						"x-ecom-app-id" : "identity-store-global",
						"x-ecom-jwt" : loginJwt
					},
					url : storeDomain + "/v4/identity/wishlist",
					type : "DELETE",
					data : JSON.stringify([paramObj]),
					dataType : "json",
					timeout : 20000,
					xhrFields: { withCredentials: true },
					async : true,
					beforeSend : function(xhr){
						if(multiLanguageYN === "Y"){
							xhr.setRequestHeader("x-ecom-locale", hreflang);
						}
					},
					success : function(data){
						afterRemoveWishlist(data);
					},
					error : function(e){
						afterRemoveWishlist();
					}
				});
			}else{// wishlist로 추가 X
				wishlistBtnPopup();
			}
		});
	};
	
	function shopIntgClickEventListener(){
		$(document).off("click", ".pd-wishlist-cta");
		$(document).on("click", ".pd-wishlist-cta", function(e){
			wishArea = $(this);
			tempProductCode = $(this).attr("data-modelcode");
			tempProductName = $(this).attr("data-modelname");
			if($(this).attr("data-component")){
				useComponent = $(this).attr("data-component");
			}

			if(!$(this).hasClass("js-learnmore")){
				
				/* Not For Sale 제품이 아닐경우 */
				if(loginFlag){
					if(wishArea.hasClass("pd-wishlist-cta--on")){ // shop 통합 hybris에서는 wishlist api 데이터 삭제 X - 화면에서만 삭제 
						useFunctionPdPf('','pd-wishlist-cta--on', Granite.I18n.get("Add to wishlist"), wislhistAriaLabelForPD07, wishArea, 'hybrisIntg', 'delete', tempProductCode);
						wishlistPopup.hide();
						window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
					}else{
						var url = storeDomain + "/" + siteCodeWithEpp + "/wishlist?loadEntries=false";
						$.ajax({
							url : url,
							type : "GET",
							dataType : "json",
							xhrFields: {
								withCredentials: true
							},
							crossDomain : true,
							timeout : 20000,
							success : function(data){
								wishlistSelect.empty();
								$('.wishlist-popup').find('.dropdown__list-wrap .scrollbar__wrap ul').empty();
								
								var myWishListHtml = "";
								var myWishListHtmlDropBox = "";
								if(data.wishlists != null && data.wishlists.length > 0){
									for(var idx=0; idx<data.wishlists.length; idx++){
										myWishListHtml += '<option value="'+data.wishlists[idx].name+'" data-check="true">'+data.wishlists[idx].name+'</option>';
									}
								}else{
									myWishListHtml += '<option value="'+Granite.I18n.get("My WishList")+'1" data-check="false">'+Granite.I18n.get("My WishList")+'1</option>';
								}
								wishlistSelect.append(myWishListHtml);
								
								window.sg.components.wishPopup.reInit(0); // reinit후 첫번째 인덱스 선택
								window.sg.components.wishPopup.showPopup();
								
								changePopup('selectWishlist');
								changePopupEvent('selectWishlist', wishArea[0]);
								
							},
							error : function(e){
								confirmPopup(showErrorText(e),"error");
								wishlistPopup.hide();
								window.sg.components.wishlistIcon.closeWishlistPop(wishArea[0]);
							}
						});
					}
				}else{
					changePopup('createWishlist');
					changePopupEvent('createWishlist', wishArea[0]);
					window.sg.components.wishPopup.showPopup();
				}
			}else{
				changePopup('notForSale');
				changePopupEvent('notForSale', wishArea[0]);
				window.sg.components.wishPopup.showPopup();
			}
		});
	};
		
	function init(){ // 로그인 flag 설정, 이벤트 리스너 등록
		if(shopIntegrationFlag === 'GPv2'){
			loginFlag = commonLoginCheck();
			gpv2ClickEventListener();
		}else if(shopIntegrationFlag === 'Hybris-intg' || isNewHybris || isB2B || isOldHybrisSiteCode.includes(siteCode)){				//new-hybris	
			var logCheck = document.cookie.match("xsdcxyn");
			var xsdcxyn = "";
			if(logCheck !== undefined && logCheck != null){
				xsdcxyn = $.cookies.get("xsdcxyn", {domain : ".samsung.com"});
				if(siteCode === "cn") xsdcxyn = $.cookies.get("xsdcxyn", {domain : ".samsung.com.cn"});  // CRHQ 798 [AEM][CN] Hybris 전환  
			}
			const xsdcbxyn = $.cookies.get("xsdcbxyn", {domain : ".samsung.com"});
			if(xsdcxyn === "YG" && !isB2B){
				"au,cn,nz,es,fr,it,nl,de,se,uk,sec,ru,be,be_fr,pl,dk,fi,no,ch,ch_fr,pt,cz,at,sk,my,id,ph,ro,lt,lv,ee,kz_kz,kz_ru,ua,hr,si,pe,cl,co,mx,iq_ar,iq_ku,gr,hk,hk_en,levant,levant_ar,hu,ca,ca_fr,sg".indexOf(siteCode)>-1 ? loginFlag = true : loginFlag = false;
			} else if(isB2B && $('#useLogin').val()=='Y' && $("#loginLinkURL").val() != null && $("#loginLinkURL").val() != '' && xsdcbxyn ==="YGB"){
				loginFlag = true
			}else{
				loginFlag = false;
			}
			
			if(isEppSite){
				loginFlag = window.sg.epp.common.isLogged;
			}

			var csrfUrl = storeDomain + "/" + storeSiteCode + "/security/csrf";
			if(isNewHybris) csrfUrl = storeWebDomain + "/" + siteCodeWithEpp + "/security/csrf";				//new-hybris
			if(isB2B){
				csrfUrl = storeWebDomain + "/security/csrf";
			}
			if(loginFlag){
				$.ajax({
					url : csrfUrl,
					type : "GET",
					dataType : "json",
					xhrFields: {
						withCredentials: true
					},
					crossDomain : true,
					timeout : 20000,
					success : function(data){
						if(data.token != null && data.token !== ""){
							csrfToken = data.token;
						}
					},
					error : function(){}
				});
			}
			if(isNewHybris || isB2B){
				newHybrisClickEventListener();
			} else if(shopIntegrationFlag === 'Hybris-intg' || isOldHybrisSiteCode.includes(siteCode)){
				shopIntgClickEventListener();
			} else {
				shopIntgClickEventListener();
			}
		}
	}
	
	$(function () {
		init();
	});
}(window, $));

(() => {
  const $q = window.sg.common.$q;
  const menu = window.sg.common.menu;
  const utils = window.sg.common.utils;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  const selector = {
    section: '.wishlist-popup',
    layerPopup: '.layer-popup',
    close: '.layer-popup__close',
  };

  const el = {
    section: null,
    close: null,
  };

  function init() {
    const wishPopup = document.querySelector('.wishlist-popup');

    if (!wishPopup) {
      return;
    }

    bindEvents();
  }

  function reInit(index = -1) {
    $q('.wishlist-popup .menu').target.forEach((drop) => {
      menu.reInit(drop, index);
    });

    bindEvents();
  }

  function bindEvents() {
    el.section = $q(selector.section);
    el.close = el.section.find(selector.close);
    el.ctaWrap = el.section.find('.wishlist-popup__cta-wrap');

    el.close.off('click').on('click', closePopup);
  }

  function keydownLayer(evt) {
    let firstEl = null;

    if (el.section.find('.wishlist-popup__selectbox__wrap').css('display') === 'block') {
      firstEl = $q(el.section.find('a, button, input').target[0]);
    } else {
      firstEl = el.ctaWrap.find('.wishlist-popup__cta').eq(0).find('.cta');
    }


    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode && evt.target === firstEl.target[0]) {
      evt.preventDefault();
      document.querySelector(`${selector.section} ${selector.close}`).focus();
    }
  }

  function keydownCloseBtn(evt) {
    let firstEl = null;

    if (el.section.find('.wishlist-popup__selectbox__wrap').css('display') === 'block') {
      firstEl = $q(el.section.find('a, button, input').target[0]);
    } else {
      firstEl = el.ctaWrap.find('.wishlist-popup__cta').eq(0).find('.cta');
    }

    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      firstEl.focus();
    }
  }

  function originFocus() {
    const pddCheck = document.querySelector('.pdd-buying-tool');
    const pdCheck = document.querySelector('.pd-buying-tool');

    if (pddCheck) {
      document.querySelector('.pdd-buying-tool [data-target-popup="wishPopup"]').focus();
    } else {
      if (pdCheck) {
        document.querySelector('.pd-buying-tool [data-target-popup="wishPopup"]').focus();
      } else {
        return false;
      }
    }
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
  }


  function showPopup() {
    el.section.show();
    window.sg.common.utils.hideOverDimEls();
    if (el.section.find('.wishlist-popup__selectbox__wrap').css('display') === 'block') {
      el.section.find('a, button, input').target[0].focus();
      el.section.find('a, button, input').target[0].removeEventListener('keydown', keydownLayer);
      el.section.find('a, button, input').target[0].addEventListener('keydown', keydownLayer);
    } else {
      el.ctaWrap.find('.wishlist-popup__cta').eq(0).find('.cta').focus();
      el.ctaWrap.find('.wishlist-popup__cta').eq(0).find('.cta').target[0].removeEventListener('keydown', keydownLayer);
      el.ctaWrap.find('.wishlist-popup__cta').eq(0).find('.cta').target[0].addEventListener('keydown', keydownLayer);
    }

    const closeBtn = document.querySelector(`${selector.section} ${selector.close}`);
    closeBtn.removeEventListener('keydown', keydownCloseBtn);
    closeBtn.addEventListener('keydown', keydownCloseBtn);
    
    utilsShow();

    if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
      setMobileFocusLoop(el.section.target[0]);
    }
  }

  function closePopup() {
    el.section.hide();
    window.sg.common.utils.showOverDimEls();
    removeMobileFocusLoop();

    utilsHide();

    originFocus();
  }

  window.sg.components.wishPopup = {
    reInit,
    showPopup,
    closePopup,
  };

  $q.ready(init);
})();


(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  const selector = {
    section: '.confirm-popup',
    close: '.confirm-popup__close',
    focusEl: 'a:not([style*="display: none"]):not([style*="display:none"]), button:not([style*="display: none"]):not([style*="display:none"]), input',
  };

  class PopupConfirm {
    constructor(el) {
      this.els = {
        el,
        popupConfirmCloseBtn: el.querySelector('.confirm-popup__close'),
        popupConfirmNoBtn: el.querySelector('.confirm-popup .confirm-popup__cta-wrap Button:first-of-type'),
        popupConfirmYesBtn: el.querySelector('.confirm-popup .confirm-popup__cta-wrap Button:last-of-type'),
      };
      this.init();
    }

    init() {
      if(PopupConfirm.instances.get(this.els.el)) {
        return;
      }

      PopupConfirm.instances.set(this.els.el, this);

      this.bindEvents();
    }

    bindEvents() {
      this.els.popupConfirmCloseBtn.addEventListener('click', () => {
        this.close();
      });
      this.els.popupConfirmNoBtn.addEventListener('click', () => {
        this.close();
      });
      this.els.popupConfirmYesBtn.addEventListener('click', () => {
        this.close();
      });

      const closeBtn = document.querySelector(`${selector.section} ${selector.close}`);
      closeBtn.removeEventListener('keydown', keydownCloseBtn);
      closeBtn.addEventListener('keydown', keydownCloseBtn);

      const layer = $q(selector.section).find(selector.focusEl).target[0];
      layer.removeEventListener('keydown', keydownLayer);
      layer.addEventListener('keydown', keydownLayer);
    }

    close() {
      const productCardList = $q('.pd13-offers-product-card-list');
      const productFinder = $q('.pd12-product-finder');

      if (productCardList.target.length > 0 || productFinder.target.length > 0) {
        const confirmPop = $q('.confirm-popup');
        if (confirmPop.attr('data-aria-hidden')) { //call in popup
          confirmPop.attr('aria-hidden', 'true');

          const callLayer = ['.pd-get-stock-alert-popup', '.compare-popup'];

          callLayer.forEach((layerEl) => {
            if ($q(layerEl).css('display') === 'block') {
              $q(layerEl).removeAttr('data-aria-hidden');
              $q(layerEl).removeAttr('aria-hidden');
            }
          });
        } else {
          removeMobileFocusLoop();
        }
      } else {
        if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
          removeMobileFocusLoop();
        }
      }

      this.els.el.style.display = 'none';
      utilsHide();
      
      const agent = window.navigator.userAgent;
      const isIphone = agent.match(/(iPhone\sOS|iOS)\s([\d_]+)/);
      const iosVersion = isIphone ? parseFloat(isIphone[2].replace('_', '.')) : 0;
      if(iosVersion >= 16.1){
        setTimeout(() => {
          if (window.sg.components.confirmPopup.popupCallCta !== null) {
            window.sg.components.confirmPopup.popupCallCta.focus();
            window.sg.components.confirmPopup.popupCallCta = null;
          }
        },200);
      } else {
        if (window.sg.components.confirmPopup.popupCallCta !== null) {
          window.sg.components.confirmPopup.popupCallCta.focus();
          window.sg.components.confirmPopup.popupCallCta = null;
        }
      }
    }
  }

  PopupConfirm.instances = new WeakMap();

  function keydownLayer(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode && evt.target === $q(selector.section).find(selector.focusEl).target[0]) {
      evt.preventDefault();
      document.querySelector(`${selector.section} ${selector.close}`).focus();
    }
  }

  function keydownCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      $q(selector.section).find(selector.focusEl).target[0].focus();
    }
  }

  function showPopup(callCta = null) {
    document.querySelector('.confirm-popup').style.display = 'block';

    const agent = window.navigator.userAgent;
    const isIphone = agent.match(/(iPhone\sOS|iOS)\s([\d_]+)/);
    const iosVersion = isIphone ? parseFloat(isIphone[2].replace('_', '.')) : 0;
    const focusEl = $q('.confirm-popup').find(selector.focusEl).target[0];
    if(iosVersion >= 16.1){
      focusEl.blur();
      setTimeout(() => {
        focusEl.focus();
      },200);
    } else {
      focusEl.focus();
    }

    const firstFocusEl = $q(selector.section).find(selector.focusEl).target[0];
    firstFocusEl.removeEventListener('keydown', keydownLayer);
    firstFocusEl.addEventListener('keydown', keydownLayer);

    utilsShow();

    const productCardList = $q('.pd13-offers-product-card-list');
    const productFinder = $q('.pd12-product-finder');
    const confirmPop = $q('.confirm-popup');

    if (window.sg.components.confirmPopup.popupCallCta !== null) {
      window.sg.components.confirmPopup.popupCallCta = null;
    }

    if (callCta !== null) {
      if (callCta instanceof Element) {
        window.sg.components.confirmPopup.popupCallCta = callCta;
      } else if (callCta instanceof Object) {
        if (callCta[0] instanceof Element) {
          window.sg.components.confirmPopup.popupCallCta = callCta[0];
        } else {
          window.sg.components.confirmPopup.popupCallCta = callCta.target[0];
        }
      }
    }

    if (productCardList.target.length > 0 || productFinder.target.length > 0) {
      if (confirmPop.attr('data-aria-hidden')) { //call in popup
        confirmPop.attr('aria-hidden', 'false');
        const callLayer = ['.pd-get-stock-alert-popup', '.compare-popup'];

        callLayer.forEach((layerEl) => {
          if ($q(layerEl).css('display') === 'block') {
            $q(layerEl).attr('data-aria-hidden', null);
            $q(layerEl).attr('aria-hidden', 'true');
          }
        });
      } else {
        setMobileFocusLoop(confirmPop.target[0]);
      }
    } else {
      if (document.querySelectorAll('[data-aria-hidden]').length === 0) {
        setMobileFocusLoop(confirmPop.target[0]);
      }
    }
  }

  function closePopup() {
    PopupConfirm.instances.get(document.querySelector('.confirm-popup')).close();
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
  }

  const popupConfirm = {
    initAll() {
      [...document.querySelectorAll('.confirm-popup')].forEach((el) => {
        if (!PopupConfirm.instances.has(el)) {
          new PopupConfirm(el);
        }
      });
    },
    showPopup,
  };

  window.sg.components.confirmPopup = popupConfirm;

  $q.ready(popupConfirm.initAll);
})();

//alert layer popup
function confirmPopup(msg, type, id, $focusEl) {
    /* confirm 활성화 된 경우는 스킵 */
    if ($(".confirm-popup").is(":visible")) {
        return false;
    }

    var alertlayer = $(".confirm-popup");
    var alertTitle = alertlayer.find(".confirm-popup__title");
    //COMP6FE-1492(ca국가 추가 할인)
    var alertDisclaimer = alertlayer.find(".confirm-popup__disclaimer");
    var alertText = alertlayer.find(".confirm-popup__desc");
    var alertClose = alertlayer.find(".confirm-popup__close");
    var alertYes = alertlayer.find(".cta--contained");
    var alertNo = alertlayer.find(".cta--outlined");
    var pageTrack = digitalData.page.pageInfo.pageTrack;

    //COMP6FE-1492(ca국가 추가 할인)
    alertlayer.removeClass("error-popup-style");
    
    alertTitle.html("");
    initCta(alertClose);
    initCta(alertYes);
    initCta(alertNo);
    alertYes.attr("id", (id || null));

    if (msg != null && msg !== "") {
        alertText.html(msg);
    } else {
        alertText.html(Granite.I18n.get("We're sorry, an error occurred."));
    }

    //DTM
    if (null == type || "error" === type) {
        alertYes.html(Granite.I18n.get("Close"));
        alertNo.hide();
        alertYes.attr("an-tr", "error popup-" + pageTrack + "-cta-button")
            .attr("an-ca", "other interaction")
            .attr("an-ac", "error popup:close")
            .attr("an-la", "error popup:close");
        alertClose.attr("an-tr", "error popup-" + pageTrack + "-cta-button")
            .attr("an-ca", "other interaction")
            .attr("an-ac", "error popup:close")
            .attr("an-la", "error popup:close");
    } else if ("tnc" === type) {
        alertYes.html(Granite.I18n.get("Confirm"));
        alertNo.hide();
    } else if ("delete" === type) {
        alertYes.html(Granite.I18n.get("YES"));
        alertNo.html(Granite.I18n.get("NO"));
        alertNo.show();
    } else if ("voucherDelete" === type) {
    	alertTitle.html(Granite.I18n.get("Delete options"))
        alertYes.html(Granite.I18n.get("YES"));
        alertNo.html(Granite.I18n.get("NO"));
        alertNo.show();
        alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-delete")
            .attr("an-ca", "option click")
            .attr("an-ac", "bridge")
            .attr("an-la", "evoucher:delete option:yes");
        alertNo.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-delete")
            .attr("an-ca", "option click")
            .attr("an-ac", "bridge")
            .attr("an-la", "evoucher:delete option:no");
    } else if ("addToCart" === type) {
        alertYes.html(Granite.I18n.get("Continue shopping"));
        alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-add")
            .attr("an-ca", "option click")
            .attr("an-ac", "bridge")
            .attr("an-la", "add on:add item popup:continue shopping");
        alertNo.hide();
    } else if ("redeem" === type) {
        alertTitle.html(Granite.I18n.get("Are you sure?"));
        alertNo.html(Granite.I18n.get("Redeem"));
        alertNo.show();
        alertYes.html(Granite.I18n.get("Skip"));
        if (id === "voucherGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
                .attr("an-ca", "ecommerce")
                .attr("an-ac", "addToCart")
                .attr("an-la", "evoucher:no addition:skip");
            setVoucherYes(alertYes);
        }else if(id === "voucherGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
            .attr("an-ca", "ecommerce")
            .attr("an-ac", "addToCart")
            .attr("an-la", "evoucher:no addition:skip");
        setVoucherYes(alertYes);
        } else if (id === "skipGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
                .attr("an-ca", "content click")
                .attr("an-ac", "feature")
                .attr("an-la", "evoucher:no addition:skip");
        }else if(id === "skipGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:no addition:skip");
        }
        alertNo.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:no addition:redeem");
        alertClose.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:no addition:close");
    } else if ("voucher" === type) {
    	alertTitle.html(Granite.I18n.get("Are you sure?"));
        alertNo.html(Granite.I18n.get("Back"));
        alertNo.show();
        alertYes.html(Granite.I18n.get("Continue"));
        if (id === "voucherGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
                .attr("an-ca", "ecommerce")
                .attr("an-ac", "addToCart")
                .attr("an-la", "evoucher:below evoucher:continue");
            setVoucherYes(alertYes);
        }else if(id === "voucherGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
            .attr("an-ca", "ecommerce")
            .attr("an-ac", "addToCart")
            .attr("an-la", "evoucher:below evoucher:continue");
        	setVoucherYes(alertYes);
        }else if (id === "skipGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
                .attr("an-ca", "content click")
                .attr("an-ac", "feature")
                .attr("an-la", "evoucher:below evoucher:continue");
        }else if(id === "skipGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:below evoucher:continue");
        }
        alertNo.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:below evoucher:back");
        alertClose.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:below evoucher:close");
    } else if ("allVoucher" === type) {
    	alertTitle.html(Granite.I18n.get("Great!"));
        alertNo.html(Granite.I18n.get("Select again"));
        alertNo.show();
        alertYes.html(Granite.I18n.get("Continue"));
        if (id === "voucherGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
                .attr("an-ca", "ecommerce")
                .attr("an-ac", "addToCart")
                .attr("an-la", "evoucher:over evoucher:continue");
            setVoucherYes(alertYes);
        }else if(id === "voucherGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-text")
            .attr("an-ca", "ecommerce")
            .attr("an-ac", "addToCart")
            .attr("an-la", "evoucher:over evoucher:continue");
        setVoucherYes(alertYes);
        }else if (id === "skipGoCart") {
            alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
                .attr("an-ca", "content click")
                .attr("an-ac", "feature")
                .attr("an-la", "evoucher:over evoucher:continue");
        }else if(id === "skipGoCartAddOn"){
        	alertYes.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-popup-notadded")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:over evoucher:continue");
        }
        alertNo.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:over evoucher:back");
        alertClose.attr("an-tr", "pdd10_product bought together-" + pageTrack + "-button-text")
            .attr("an-ca", "content click")
            .attr("an-ac", "feature")
            .attr("an-la", "evoucher:over evoucher:close");
    } else if ("freeGift" === type) {
        alertYes.html(Granite.I18n.get("YES"));
        alertNo.html(Granite.I18n.get("NO"));
        alertNo.show();
        alertYes.attr("an-tr", "header(pim)_offer option:bundle offer:free gift-" + pageTrack + "-alert-link")
            .attr("an-ca", "option click")
            .attr("an-ac", "pd buying tool")
            .attr("an-la", "bundle offer:free gift:reset option:yes");
        alertNo.attr("an-tr", "header(pim)_offer option:bundle offer:free gift-" + pageTrack + "-alert-link")
            .attr("an-ca", "option click")
            .attr("an-ac", "pd buying tool")
            .attr("an-la", "bundle offer:free gift:reset option:no");
    } else if ("combo" === type) {
        alertTitle.html(Granite.I18n.get("Delete"));
        alertYes.html(Granite.I18n.get("YES"));
        alertNo.html(Granite.I18n.get("NO"));
        alertNo.show();
        alertYes.attr("an-tr", "header(pim)_offer option:bundle offer:add-on -" + pageTrack + "-delete-confirm")
            .attr("an-ca", "option click")
            .attr("an-ac", "pd buying tool")
            .attr("an-la", "bundle offer:add-on:delete option:yes");
        alertNo.attr("an-tr", "header(pim)_offer option:bundle offer:add-on -" + pageTrack + "-delete-confirm")
            .attr("an-ca", "option click")
            .attr("an-ac", "pd buying tool")
            .attr("an-la", "bundle offer:add-on:delete option:no");
    }else if ("ebt" === type) {
        alertTitle.html($("#successTitle").val());
        alertText.html($("#successMessageDesc").val());
        alertYes.html(Granite.I18n.get("Close Layer"));
    } else if("continue" === type) {
        alertYes.html(Granite.I18n.get("Continue"));
        alertNo.html(Granite.I18n.get("CANCEL"));
        alertNo.show();
    }else if(type === 'OverPrice'){
        //COMP6FE-1492(ca국가 추가 할인)
    	alertYes.html(Granite.I18n.get("OK"));
    	alertText.html('');
    	alertText.hide();
    	alertNo.hide();
    	alertDisclaimer.html(msg);
    	alertlayer.addClass("error-popup-style");
    } else if ("tradeInClose" === type) { // CRHQ-8132 [B2C][MX][KZ] New Trade-In Telekom
        alertYes.html(Granite.I18n.get("Yes"));
        alertNo.html(Granite.I18n.get("No"));
        alertNo.show();
        alertYes.attr("data-event-type", type);
        alertNo.attr("data-event-type", type);
        alertClose.attr("data-event-type", type);
    }

    window.sg.components.confirmPopup.showPopup($focusEl);
};

//api 에러 발생시 layer pop
function errLayerPop(e) {
    var errorText = "";
    if (e.responseJSON != null) {
        var errmsg = e.responseJSON;
        if (errmsg.message != null && errmsg.message !== "") {
            errorText = errmsg.message;
        }
    }
    if (errorText === "") {
        errorText = Granite.I18n.get("We're sorry, an error occurred.");
    }
    //t&c && error alert popup
    confirmPopup(errorText, "error");
};

function setVoucherYes(ctaEl) {
    var bridgeCartEl = $("#primaryInfoGoCart");
    ctaEl.attr("data-modelname", bridgeCartEl.attr("data-modelname"))
        .attr("data-modeldisplay", bridgeCartEl.attr("data-modeldisplay"))
        .attr("data-modelprice", bridgeCartEl.attr("data-modelprice"))
        .attr("data-discountprice", bridgeCartEl.attr("data-discountprice"))
        .attr("data-pvitype", bridgeCartEl.attr("data-pvitype"))
        .attr("data-pvisubtype", bridgeCartEl.attr("data-pvisubtype"))
        .attr("data-pimsubtype", bridgeCartEl.attr("data-pimsubtype"))
        .attr("data-modelrevenue", bridgeCartEl.attr("data-modelrevenue"))
        .attr("data-modelqty", bridgeCartEl.attr("data-modelqty"))
        .attr("data-modelcurrency", bridgeCartEl.attr("data-modelcurrency"));
}

// cta tagging 초기화
function initCta(ctaEl) {
    ctaEl.removeAttr("an-tr")
        .removeAttr("an-ca")
        .removeAttr("an-ac")
        .removeAttr("an-la")
        .removeAttr("data-modelname")
        .removeAttr("data-modeldisplay")
        .removeAttr("data-modelprice")
        .removeAttr("data-discountprice")
        .removeAttr("data-pvitype")
        .removeAttr("data-pvisubtype")
        .removeAttr("data-pimsubtype")
        .removeAttr("data-modelrevenue")
        .removeAttr("data-modelqty")
        .removeAttr("data-modelcurrency");
}
(() => {
  const $q = window.sg.common.$q;
  const utils = window.sg.common.utils;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;

  let getStockAlertPopupElements = {};
  let requiredCheckboxesCount = 0;
  let focusTargetEl = {};

  const selector = {
    section: '.pd-get-stock-alert-popup',
    // layerPopup: '.layer-popup',
    close: '.pd-get-stock-alert-popup__close',
  };

  function getElements() {
    getStockAlertPopupElements = {
      getStockAlertPopup: document.querySelector('.pd-get-stock-alert-popup'),
      getStockAlertPopupDimmed: document.querySelector('.pd-get-stock-alert-popup__dimmed'),
      getStockAlertPopupContents: document.querySelector('.pd-get-stock-alert-popup__contents'),
      getStockAlertPopupInnerWrap: document.querySelector('.pd-get-stock-alert-popup__inner-wrap'),
      getStockAlertPopupInputWrap: document.querySelector('.pd-get-stock-alert-popup__text-field-wrap .text-field-v2'),
      getStockAlertPopupInput: document.querySelector('.pd-get-stock-alert-popup__text-field-wrap input'),
      getStockAlertPopupCheckboxes: document.querySelectorAll('.pd-get-stock-alert-popup__checkbox-wrap .checkbox-v2__input'),
      getStockAlertPopupRequiredCheckboxes: document.querySelectorAll('.pd-get-stock-alert-popup__checkbox-wrap.is-required .checkbox-v2__input'),
      getStockAlertPopupBtnWrap: document.querySelector('.pd-get-stock-alert-popup__btn-wrap'),
      getStockAlertPopupBtnClose: document.querySelector('.pd-get-stock-alert-popup__btn-close'),
      getStockAlertPopupBtnSubmit: document.querySelector('.pd-get-stock-alert-popup__btn-submit'),
      getStockAlertPopupClose: document.querySelectorAll('.pd-get-stock-alert-popup__close'),
      getStockAlertPopupFinalWrap: document.querySelector('.pd-get-stock-alert-popup__final-wrap'),
      getStockAlertPopupFinalDesc: document.querySelector('.pd-get-stock-alert-popup__final-desc'),
      getStockAlertPopupFinalBtnWrap: document.querySelector('.pd-get-stock-alert-popup__final-btn-wrap'),
      getStockAlertPopupFinalBtnClose: document.querySelector('.pd-get-stock-alert-popup__final-btn-close'),
      scrollbarEl: document.querySelector('.pd-get-stock-alert-popup .scrollbar'),
      vertScrollbarWrapEl: document.querySelector('.pd-get-stock-alert-popup .scrollbar__wrap'),
    };
  }

  function init() {
    const scrollbarEl = document.querySelector('.pd-get-stock-alert-popup .scrollbar');
    if(scrollbarEl){
      window.sg.common.scrollbar.init(document.querySelector('.pd-get-stock-alert-popup .scrollbar'));
    }

    getElements();

    if (!getStockAlertPopupElements.getStockAlertPopup) {
      return;
    }

    bindEvents();
    changeInnerWrapMaxHeight();
  }

  function bindEvents() {
    getStockAlertPopupElements.getStockAlertPopupInput.addEventListener('input', () => {
      bindInputEvent();
    });

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length; i++) {
      getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes[i].addEventListener('click', () => {
        bindCheckboxEvent();
      });
    }

    if (getStockAlertPopupElements.getStockAlertPopupBtnClose) {
      getStockAlertPopupElements.getStockAlertPopupBtnClose.addEventListener('click', () => {
        closePopup();
      });
    }

    getStockAlertPopupElements.getStockAlertPopupFinalBtnClose.addEventListener('click', () => {
      closePopup();
    });

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupClose.length; i++) {
      getStockAlertPopupElements.getStockAlertPopupClose[i].addEventListener('click', () => {
        closePopup();
      });
    }

    window.addEventListener('resize', () => {
      changeInnerWrapMaxHeight();
    });

    const closeBtn = document.querySelector(`${selector.section} ${selector.close}`);
    closeBtn.removeEventListener('keydown', keydownCloseBtn);
    closeBtn.addEventListener('keydown', keydownCloseBtn);

    const layer = document.querySelector(`${selector.section}`);
    layer.removeEventListener('keydown', keydownLayer);
    layer.addEventListener('keydown', keydownLayer);

    const firstEl = $q(getStockAlertPopupElements.getStockAlertPopup).find('a, button, input').target[0];
    firstEl.removeEventListener('keydown', keydownLayerFirst);
    firstEl.addEventListener('keydown', keydownLayerFirst);

    const closeFinalBtn = document.querySelector('.pd-get-stock-alert-popup__final-wrap .pd-get-stock-alert-popup__close');
    closeFinalBtn.removeEventListener('keydown', keydownFinalCloseBtn);
    closeFinalBtn.addEventListener('keydown', keydownFinalCloseBtn);

    const finalFirstEl = $q(getStockAlertPopupElements.getStockAlertPopupFinalWrap).find('a, button, input').target[0];
    finalFirstEl.removeEventListener('keydown', keydownFinalLayerFirst);
    finalFirstEl.addEventListener('keydown', keydownFinalLayerFirst);
  }

  function showFinalPopup() {
    getStockAlertPopupElements.getStockAlertPopupContents.style.display = 'none';
    getStockAlertPopupElements.getStockAlertPopupDimmed.style.display = 'block';
    getStockAlertPopupElements.getStockAlertPopupFinalWrap.style.display = 'block';
    changeFinalPopupMaxHeight();

    window.addEventListener('resize', () => {
      changeFinalPopupMaxHeight();
    });

    $q(getStockAlertPopupElements.getStockAlertPopupFinalWrap).find('a, button, input').target[0].focus();
  }

  function bindInputEvent() {
    if (getStockAlertPopupElements.getStockAlertPopupInput.value.length !== 0) {
      requiredCheckboxesCount = 0;

      for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length; i++) {
        if (getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes[i].checked) {
          requiredCheckboxesCount++;
        }
      }

      if (getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length === requiredCheckboxesCount) {
        getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.remove('cta--disabled');
        getStockAlertPopupElements.getStockAlertPopupBtnSubmit.removeAttribute('disabled');
      } else {
        getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.add('cta--disabled');
        getStockAlertPopupElements.getStockAlertPopupBtnSubmit.setAttribute('disabled', '');
      }
    } else {
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.add('cta--disabled');
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.setAttribute('disabled', '');
    }
  }

  function bindCheckboxEvent() {
    requiredCheckboxesCount = 0;

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length; i++) {
      if (getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes[i].checked) {
        requiredCheckboxesCount++;
      }
    }

    if (getStockAlertPopupElements.getStockAlertPopupInput.value.length !== 0 && (getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length === requiredCheckboxesCount)) {
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.remove('cta--disabled');
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.removeAttribute('disabled');
    } else {
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.add('cta--disabled');
      getStockAlertPopupElements.getStockAlertPopupBtnSubmit.setAttribute('disabled', '');
    }
  }

  function closePopup() {
    const productCardList = $q('.pd13-offers-product-card-list');
    const productFinder = $q('.pd12-product-finder');

    if (productCardList.target.length > 0 || productFinder.target.length > 0) {
      const getStockPopup = $q('.pd-get-stock-alert-popup');
      if (getStockPopup.attr('data-aria-hidden')) { //call in popup
        getStockPopup.attr('aria-hidden', 'true');

        const callLayer = ['.compare-popup'];

        callLayer.forEach((layerEl) => {
          if ($q(layerEl).css('display') === 'block') {
            $q(layerEl).removeAttr('data-aria-hidden');
            $q(layerEl).removeAttr('aria-hidden');
          }
        });
      } else {
        removeMobileFocusLoop();
      }
    } else {
      if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
        removeMobileFocusLoop();
      }
    }

    getStockAlertPopupElements.getStockAlertPopupInput.value = '';
    getStockAlertPopupElements.getStockAlertPopupInputWrap.className = 'text-field-v2';

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupCheckboxes.length; i++) {
      getStockAlertPopupElements.getStockAlertPopupCheckboxes[i].checked = false;
    }

    getStockAlertPopupElements.getStockAlertPopupBtnSubmit.classList.add('cta--disabled');
    getStockAlertPopupElements.getStockAlertPopupContents.style.display = 'block';
    getStockAlertPopupElements.getStockAlertPopupDimmed.removeAttribute('style'); //not display:none
    getStockAlertPopupElements.getStockAlertPopupFinalWrap.style.display = 'none';
    getStockAlertPopupElements.getStockAlertPopup.style.display = 'none';

    // document.body.removeAttribute('style');

    utilsHide();
    originFocus();
  }

  function changeInnerWrapMaxHeight() {
    getStockAlertPopupElements.vertScrollbarWrapEl.style.maxHeight = `${window.innerHeight - ((getStockAlertPopupElements.getStockAlertPopupInnerWrap.getBoundingClientRect().top - getStockAlertPopupElements.getStockAlertPopupContents.getBoundingClientRect().top) * 2) - getStockAlertPopupElements.getStockAlertPopupBtnWrap.getBoundingClientRect().height}px`;
    window.sg.common.scrollbar.resize(getStockAlertPopupElements.scrollbarEl);
  }

  function changeFinalPopupMaxHeight() {
    getStockAlertPopupElements.vertScrollbarWrapEl.style.maxHeight = `${window.innerHeight - ((getStockAlertPopupElements.getStockAlertPopupFinalDesc.getBoundingClientRect().top - getStockAlertPopupElements.getStockAlertPopupFinalWrap.getBoundingClientRect().top) * 2) - getStockAlertPopupElements.getStockAlertPopupFinalBtnWrap.getBoundingClientRect().height}px`;
    window.sg.common.scrollbar.resize(getStockAlertPopupElements.scrollbarEl);
  }

  function reInit() {
    getStockAlertPopupElements.getStockAlertPopupInput.removeEventListener('input', () => {
      bindInputEvent();
    });

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length; i++) {
      getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes[i].removeEventListener('click', () => {
        bindCheckboxEvent();
      });
    }

    getElements();

    getStockAlertPopupElements.getStockAlertPopupInput.addEventListener('input', () => {
      bindInputEvent();
    });

    for (let i = 0; i < getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes.length; i++) {
      getStockAlertPopupElements.getStockAlertPopupRequiredCheckboxes[i].addEventListener('click', () => {
        bindCheckboxEvent();
      });
    }
  }

  function showPopup(el) {
    if (el instanceof Element) {
      focusTargetEl = el;
    } else if (el instanceof Object) {
      if (el.target[0] instanceof Element) {
        focusTargetEl = el.target[0];
      }
    }

    // document.body.style.overflow = 'hidden';
    getStockAlertPopupElements.getStockAlertPopup.style.display = 'block';
    $q(getStockAlertPopupElements.getStockAlertPopup).find('a, button, input').target[0].focus();

    utilsShow();
    changeInnerWrapMaxHeight();

    const productCardList = $q('.pd13-offers-product-card-list');
    const productFinder = $q('.pd12-product-finder');

    if (productCardList.target.length > 0 || productFinder.target.length > 0) {
      const getStockPopup = $q('.pd-get-stock-alert-popup');
      if (getStockPopup.attr('data-aria-hidden')) { //call in popup
        getStockPopup.attr('aria-hidden', 'false');
        const callLayer = ['.compare-popup'];

        callLayer.forEach((layerEl) => {
          if ($q(layerEl).css('display') === 'block') {
            $q(layerEl).attr('data-aria-hidden', null);
            $q(layerEl).attr('aria-hidden', 'true');
          }
        });
      } else {
        setMobileFocusLoop(getStockPopup.target[0]);
      }
    } else {
      if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
        setMobileFocusLoop(getStockAlertPopupElements.getStockAlertPopup);
      }
    }

    if(checkIOS() && utils.getCurrentDevice() === 'mobile') {
      setTimeout(() => {
        window.scrollTo(0,0);
      }, 100);
    }
  }

  function keydownLayer(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode && evt.target === document.querySelector(`${selector.section}`)) {
      evt.preventDefault();
      document.querySelector(`${selector.section} ${selector.close}`).focus();
    }
  }

  function keydownCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      $q(getStockAlertPopupElements.getStockAlertPopup).find('a, button, input').target[0].focus();
    }
  }

  function keydownLayerFirst(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode && evt.target === $q(getStockAlertPopupElements.getStockAlertPopup).find('a, button, input').target[0]) {
      evt.preventDefault();
      document.querySelector(`${selector.section} ${selector.close}`).focus();
    }
  }

  function keydownFinalCloseBtn(evt) {
    if (!evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode) {
      evt.preventDefault();
      $q(getStockAlertPopupElements.getStockAlertPopupFinalWrap).find('a, button, input').target[0].focus();
    }
  }

  function keydownFinalLayerFirst(evt) {
    if (evt.shiftKey && window.sg.common.constants.KEY_CODE.TAB === evt.keyCode && evt.target === $q(getStockAlertPopupElements.getStockAlertPopupFinalWrap).find('a, button, input').target[0]) {
      evt.preventDefault();
      document.querySelector('.pd-get-stock-alert-popup__final-wrap .pd-get-stock-alert-popup__close').focus();
    }
  }

  function checkIOS() {
    return [
      'iPad Simulator',
      'iPhone Simulator',
      'iPod Simulator',
      'iPad',
      'iPhone',
      'iPod',
    ].includes(navigator.platform) || (navigator.userAgent.includes('Mac') && 'ontouchend' in document);
  }

  function originFocus() {
    if (focusTargetEl instanceof Element) {
      focusTargetEl.focus();
    }
  }

  function utilsShow() {
    utils.popupControl.open(closePopup);
    utils.hiddenScroll();
  }

  function utilsHide() {
    utils.popupControl.close();
    utils.visibleScroll();
  }

  function setFirstFocus() {
    $q(getStockAlertPopupElements.getStockAlertPopup).find('.text-field-v2__input').focus();
  }

  window.sg.components.pdGetStockAlertPopup = { init, reInit, showPopup, closePopup, showFinalPopup, setFirstFocus };

  $q.ready(() => init());
})();

(function ($) {

    var storeDomain = $("#storeDomain").val();
    var hreflang = $("#localLang").val();
    var multiLanguageYN = $("#multiLanguageYn").val();
    var isGpv2 = $("#isGpv2Flag").val();
    var isNewHybris = $("#shopIntegrationFlag").val() === "Hybris-new"? true:false;			//new-hybris
	var isB2B = $('#b2bFlag').val() === "Y" ? true : false;
	// Store API 호출 시 사용하는 SiteCode
	var storeSiteCode = $('#store_sitecode').val();
    var siteCode = $("#siteCode").val();
    var countryIsoCode = $("#countryIsoCode").val();
    var TnC_SITE = ["uk", "fr", "be", "be_fr", "nl", "de", "pl","id","ph"];					//new-hybris
    var getStockAlertPopup = $(".pd-get-stock-alert-popup");
    var getStockTextField = getStockAlertPopup.find(".text-field-v2");
    var tempProductCode = "";
    var emailStr = "";
	var numberStr = "";
	var strResult = "";
    var b2bApiCal = true;
    Granite.I18n.setLocale($("#language").val());
    var getStockFlag = "GetStock";
    
    let isInAppWebViewSessionStorage = sessionStorage.getItem('isInAppWebViewSessionStorage');
    console.log("[pd-g-getstock-popup.op.js] isInAppWebViewSessionStorageValue =["+isInAppWebViewSessionStorage +"]");

    //[EPP] epp 관련 변수 추가
    const isEppSite = checkEppSite();
    if(isEppSite && window.sg.epp == null){
        window.sg.epp = {};
        window.sg.epp.common = {};
    }
    const eppStoreId = isEppSite ? window.sg.epp.common.companyCode: "";
    
    // epp shop분기 추가
    storeSiteCode = isEppSite ? window.sg.epp.common.companyCode : storeSiteCode;

    var hideError = function () {
        $("#getStockAlertEmailInput").removeAttr("aria-describedby");
        getStockTextField.removeClass("error");
    }
    var showError = function () {
        $("#getStockAlertEmailInput").attr("aria-describedby", "getstock-popup-error-txt");
        getStockTextField.addClass("error");
        window.sg.components.pdGetStockAlertPopup.setFirstFocus();
    }
    var popupClose = function () {
        getStockAlertPopup.find(".pd-get-stock-alert-popup__close").trigger("click");
    }

    var showFinalWrap = function (text) {
        var finalDesc = getStockAlertPopup.find(".pd-get-stock-alert-popup__final-desc")

        finalDesc.html(text);
        window.sg.components.pdGetStockAlertPopup.showFinalPopup();
    }

    var openSuccess = function () {
        var successText = "";
        
        if(siteCode === "cn"){ // SCIC hybris전환
        	if(getStockFlag === "ComingSoon"){
        		successText = Granite.I18n.get("comingSoonPopup.requestText");
        	}else{
        		successText = Granite.I18n.get("oosPopup.requestText");
        	}
        }else{
        	successText = Granite.I18n.get("We will email you when inventory is added.");
            successText += "<br>" + Granite.I18n.get("Thank you.");
        }
        
        showFinalWrap(successText);
    }

    var emailValidCheck = function (addr) {
        if (!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(addr)) {
            return false;
        }
        return true;
    }
    
    var emailNumberValidCheck = function (addrnum){
    	if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(addrnum)) {
    		emailStr = addrnum;
            return true;
        }else if(/^[0-9]+$/.test(addrnum) && addrnum.length == 10){
        	numberStr = addrnum;
        	return true;
        }
        return false;
    }
    
    var mobileNumberValidCheck = function (addrnum){
    	if(/^[0-9]+$/.test(addrnum) && addrnum.length == 11){
        	numberStr = addrnum;
        	return true;
        }
        return false;
    }

    var InStockApiCallback = function (data) {
        var resultCode, resultMessage;
        if (data != null && data.hasOwnProperty("resultCode") && data.hasOwnProperty("resultMessage")) {
            resultCode = data.resultCode;
            resultMessage = data.resultMessage;
        }

        if (data != null) {
            if ((resultCode === "0000" && resultMessage === "SUCCESS") || isNewHybris || isB2B) {				//new-hybris
                hideError();
                openSuccess();
            } else {
                showError();
            }
        } else {
            showError();
        }
    }

    var callInStockApi = function (emailAddr) {
        // epp shop분기 추가
        const siteCodeWithEpp =isEppSite ? window.sg.epp.common.companyCode : siteCode;
        
        var stockAlertUrl = storeDomain + "/" + siteCodeWithEpp + "/ng/p4v1/stockNotification/register";
        var callInStockParam;
        var callInStockParamObj = {};
        
        if(siteCode === "cn"){ // SCIC hybris전환
        	var submitGetStockFlag = "";
        	
        	if(getStockFlag === "ComingSoon"){
        		submitGetStockFlag = "COMING_SOON";
        	}else{
        		submitGetStockFlag = "OUT_OF_STOCK";
        	}
        	
        	callInStockParamObj = {
                "phoneNo": emailAddr,
                "productCode": tempProductCode,
                "stockAlertSubscriptionType" : submitGetStockFlag
            };
        }else{
        	callInStockParamObj = {
                "emailAddress": emailAddr,
                "productCode": tempProductCode
            };
        }
        
        if( $('#shopParmLang').val() ){
            callInStockParamObj['lang']=$('#shopParmLang').val();
        }

        if(isNewHybris || isB2B){		//new-hybris
            stockAlertUrl = storeDomain + "/tokocommercewebservices/v2/" + storeSiteCode + "/notifications/stockAlert";
            $.ajax({
                headers: {
                    "Content-Type": "application/json"
                },
                url: stockAlertUrl,
                type: 'POST',
                dataType : 'json',
                data: JSON.stringify(callInStockParamObj),
                crossDomain : true,
                xhrFields: {
                    withCredentials: true
                },
                timeout: 20000,
                cache: true,
                success: function (data) {
                    InStockApiCallback(data);
                },
                error: function () {
                    hideError();
                    popupClose();
                }
            });

        } else {
            callInStockParam = callInStockParamObj;
            $.ajax({
                url: stockAlertUrl,
                type: "POST",
                contentType: "application/x-www-form-urlencoded",
                data: callInStockParam,
                xhrFields: {
                    withCredentials: true
                },
                crossDomain: true,
                dataType: "json",
                timeout: 10000,
                success: function (data) {
                    InStockApiCallback(data)
                },
                error: function () {
                    /* nonshop 예외처리
                    if(siteCode=="ae" || siteCode=="ae_ar"){
                        // TODO 예외처리 (체크박스)
                        $("#remIdChkYN").attr('value','N');
                        $("#remIdChkYN").attr('checked',false);
                    }
                    */
                    hideError();
                    popupClose();
                }
            });
        }
    };

    var callInStockApiGpv2 = function (validJwtTkn, loginJwt, paramObj) {
        // 샵통합
        $.ajax({
            headers: {
                "Cache-Control": "no-cache",
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
                "x-ecom-app-id": "identity-store-global"
            },
            url: storeDomain + "/v4/identity/notification/preferences/in-stock",
            type: "PUT",
            data: paramObj,
            dataType: "json",
            timeout: 20000,
            xhrFields: {
                withCredentials: true
            },
            beforeSend: function (xhr) {
                /* Login 여부 체크 후 Login 되어있을 시 헤더값 추가 */
                if (validJwtTkn) {
                    xhr.setRequestHeader("x-ecom-jwt", loginJwt);
                }
                /* GPv2 api 호출 시 multiLanguageYN 이 Y인 경우  헤더 추가 */
                if (multiLanguageYN === "Y") {
                    xhr.setRequestHeader("x-ecom-locale", hreflang);
                }
            },
            success: function (data) {
                if (data != null) {
                    if (data["notification"] != null) {
                        if (data["notification"]["in-stock"]["is_active"]) {
                        	if(validJwtTkn && siteCode == "in"){
                                $(".pd-get-stock-alert-popup__contents").hide();
                                getStockAlertPopup.show();
                                $(".pd-get-stock-alert-popup__final-wrap").show();
                        	}else{
	                            hideError();
	                            openSuccess();
	                        }
                        	emailStr="";
                        	numberStr="";
                        } else {
                            showError();
                        }
                    }
                } else {
                    showError();
                }
            },
            error: function (e) {
                hideError();

                /* 네트워크 에러 시 error message 노출 */
                var errorText = Granite.I18n.get("ERROR");
                if (e.responseJSON != null) {
                    var errmsg = e.responseJSON;
                    if (errmsg.message != null && errmsg.message !== "") {
                    	window.sg.components.pdGetStockAlertPopup.showPopup();
                        showFinalWrap(errmsg.message);
                    } else {
                        showFinalWrap(errorText);
                    }
                } else {
                    showFinalWrap(errorText);
                }
            }
        });
    };
    
    var ssoJwtDetail = function(loginJwt) {
    	validJwtTkn = true;
        let jwtDetailParam = {
            "jwt": loginJwt
        };
    	$.ajax({
    		headers: {
		         "Cache-Control": "no-cache",
		         "Content-Type": "application/json",
		         "Access-Control-Allow-Origin" : "*"
    		},
		    url: storeDomain + "/v1/sso/jwt/details",
			type: "POST",
    		dataType : "json",
	    	data: JSON.stringify (jwtDetailParam),
			xhrFields : {
				withCredentials: true
			},
			beforeSend : function(xhr){
				if(multiLanguageYN === "Y"){
					xhr.setRequestHeader("x-ecom-locale", hreflang);
				}
			},
		    success: function (data) {
		    	if(data != null && data !== ""){
		    		if(data.login_type == "otp"){ // 로그인 타입 otp인 경우
		    			if (data.user_info.email_address != null && data.user_info.email_address != "" && data.user_info.phone_number != null && data.user_info.phone_number != "") { //이메일 + 번호 있는 경우
			    			emailStr = data.user_info.email_address;
			    			numberStr = data.user_info.phone_number;
			    			strResult = "You will be notified on registered email <b>"+data.user_info.email_address+"</b> & registered mobile number <b>+91 "+data.user_info.phone_number+"</b>";
					    }else if(data.user_info.email_address != null && data.user_info.email_address !== "" && (data.user_info.phone_number == null || data.user_info.phone_number == "")){ //이메일만 있는 경우
					    	emailStr = data.user_info.email_address;
					    	strResult = "You will be notified on registered email <b>"+data.user_info.email_address+"</b>";
					    }else if(data.user_info.phone_number != null && data.user_info.phone_number !== "" && (data.user_info.email_address == null || data.user_info.email_address == "")){ //번호만 있는 경우
					    	numberStr = data.user_info.phone_number;
					    	strResult = "You will be notified on registered mobile number <b>+91 "+data.user_info.phone_number+"</b>";
					    }else if((data.user_info.email_address == null || data.user_info.email_address == "") && (data.user_info.phone_number == null || data.user_info.phone_number == "")){ //이메일 번호 모두 비어있는 경우
					    	emailNumberValidCheck(data.user_identity.user_id);
					    	if(emailStr){
					    		strResult = "You will be notified on registered email <b>"+data.user_identity.user_id+"</b>";
					    	}
					    	if(numberStr){
					    		strResult = "You will be notified on registered mobile number <b>+91 "+data.user_identity.user_id+"</b>";
					    	}
					    }
		    		}else{ // 로그인 타입 otp가 아닌 경우
		    			if (data.user_info.email_address != null && data.user_info.email_address != "" && data.user_info.otp_verified_phone_number != null && data.user_info.otp_verified_phone_number != "") { //이메일 + 번호 있는 경우
			    			emailStr = data.user_info.email_address;
			    			numberStr = data.user_info.otp_verified_phone_number;
			    			strResult = "You will be notified on registered email <b>"+data.user_info.email_address+"</b> & registered mobile number <b>+91 "+data.user_info.otp_verified_phone_number+"</b>";
					    }else if(data.user_info.email_address != null && data.user_info.email_address !== "" && (data.user_info.otp_verified_phone_number == null || data.user_info.otp_verified_phone_number == "")){ //이메일만 있는 경우
					    	emailStr = data.user_info.email_address;
					    	strResult = "You will be notified on registered email <b>"+data.user_info.email_address+"</b>";
					    }else if(data.user_info.otp_verified_phone_number != null && data.user_info.otp_verified_phone_number !== "" && (data.user_info.email_address == null || data.user_info.email_address == "")){ //번호만 있는 경우
					    	numberStr = data.user_info.otp_verified_phone_number;
					    	strResult = "You will be notified on registered mobile number <b>+91 "+data.user_info.otp_verified_phone_number+"</b>";
					    }
		    		}
		    		strResult += " once the stock is available.<br><br>"+
			    				 "By providing your email/mobile number you agree to marketing communications & inventory alerts from Samsung on Email, SMS & WhatsApp.<br>"+
			    				 "By clicking submit you are agreeing to the above Terms and Conditions.";
		    	 }
            	
            	var consents = "";
            	var paramStr = "{}";
            	if(emailStr != "" && numberStr != ""){ // 이메일 + 번호 있을 때
             		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"email\" : \"" + emailStr + "\",\"mobile\" : \"" + numberStr + "\"" + consents + "}";
             	}else if(emailStr != "" && numberStr == ""){ // 이메일만 있을 때
             		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"email\" : \"" + emailStr + "\"" + consents + "}";
             	}else if(emailStr == "" && numberStr != ""){ // 번호만 있을 때
             		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"mobile\" : \"" + numberStr + "\"" + consents + "}";
             	}
            	var paramJson = JSON.parse(paramStr);
            	var paramObj = JSON.stringify(paramJson);
            	var loginJwt = $.cookies.get("jwt_" + countryIsoCode, {
            		domain: ".samsung.com"
            	});
            	
                callInStockApiGpv2(validJwtTkn, loginJwt, paramObj);
                $(".pd-get-stock-alert-popup__final-desc").html(strResult);
		     }
    	 });
    };

    $(document).on("click", ".js-cta-stock", function () {
    	tempProductCode = $(this).attr("data-modelcode");
    	if (isGpv2 === 'Y'){
    		tempProductCode = $(this).attr("data-sku-code");
    	}
        if($(this).attr("data-virtual-modelcode") != null ){
            //[EPP] Refurbish, Flash sale 관련 로직 추가
            tempProductCode = $(this).attr("data-virtual-modelcode");
        }
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-submit").attr( 'data-modelcode',$(this).attr("data-modelcode"));
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-submit").attr( 'data-modelname', $(this).attr("data-modelname") );
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-close").attr( 'data-modelcode', $(this).attr("data-modelcode") );
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-close").attr( 'data-modelname', $(this).attr("data-modelname") );
    	
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-submit").attr( 'an-tr', $(this).attr("data-antr") ? $(this).attr("data-antr") : "pd03_product finder:stock alert-"+ digitalData.page.pageInfo.pageTrack +"-cta-popup");
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-close").attr( 'an-tr', $(this).attr("data-antr") ? $(this).attr("data-antr") : "pd03_product finder:stock alert-"+ digitalData.page.pageInfo.pageTrack +"-cta-popup");
    	getStockAlertPopup.find(".pd-get-stock-alert-popup__close").attr( 'an-tr', $(this).attr("data-antr") ? $(this).attr("data-antr") : "pd03_product finder:stock alert-"+ digitalData.page.pageInfo.pageTrack +"-cta-popup");
    	
    	if(siteCode == 'in'){
    		var loginJwt = $.cookies.get("jwt_" + countryIsoCode, {
                domain: ".samsung.com"
            });
    		var validJwtTkn = false;
    		
    		//로그인 여부 확인
            if (loginJwt != null) { //로그인
                let validateParam = {
                    "jwt": loginJwt
                };
                if(isEppSite){
                    validateParam["store_id"] = eppStoreId;
                }
            	// jwt validate 체크
                $.ajax({
                    headers: {
                        "Cache-Control": "no-cache",
                        "Content-Type": "application/json",
                        "Access-Control-Allow-Origin": "*"
                    },
                    url: storeDomain + "/v1/sso/user/validate",
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(validateParam),
                    timeout: 10000,
                    xhrFields: {
                        withCredentials: true
                    },
                    beforeSend: function (xhr) {
                        if (multiLanguageYN === "Y") {
                            xhr.setRequestHeader("x-ecom-locale", hreflang);
                        }
                    },
                    success: function (data) {
                        if (data.statusCode === 200 || data.statusCode === "200") {
                            validJwtTkn = true;
                        }
                        ssoJwtDetail(loginJwt);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                    	console.log(jqXHR.responseText);
                    }
                });
            }else{	//비로그인
            	window.sg.components.pdGetStockAlertPopup.showPopup($(this)[0]);
            }
    	}else{
    		if(siteCode === "cn"){ // SCIC hybris전환
            	getStockFlag = $(this).attr("data-gs-flag");
            	
            	var checkboxHtml = '';
            	checkboxHtml +=
    	        	'<div class="pd-get-stock-alert-popup__checkbox-wrap is-required">'+
    	        		'<div class="checkbox-v2">'+
    	        			'<input class="checkbox-v2__input js-pd-get-stock-alert-popup__checkbox" type="checkbox" name="checkbox" id="cn_StockAlert_TC_1" aria-required="true">'+
    	    				'<label class="checkbox-v2__label" for="cn_StockAlert_TC_1">'+
    	        				'<span class="checkbox-v2__label-box-wrap">'+
    	        					'<span class="checkbox-v2__label-box">'+
    			        				'<svg class="checkbox-v2__label-box-icon" focusable="false" aria-hidden="true">'+
    			        					'<use xlink:href="#done-bold" href="#done-bold"></use>'+
    			        				'</svg>'+
    			        			'</span>'+
    			        		'</span>'+
    			        		'<span class="checkbox-v2__label-text">'+Granite.I18n.get("stockAlert T&C Policy")+'</span>'+
    		        		'</label>'+
    			        '</div>'+
    			    '</div>'+
    			    '<div class="pd-get-stock-alert-popup__checkbox-desc is-required" style="display:block">'+Granite.I18n.get("stockAlert required Text")+'</div>';
            	
            	getStockAlertPopup.find(".pd-get-stock-alert-popup__checkbox-container").html(checkboxHtml);
            	getStockAlertPopup.find("div.pd-get-stock-alert-popup__disclaimer").html( Granite.I18n.get("stockAlert Disclaimer") );
            	getStockAlertPopup.find(".pd-get-stock-alert-popup__btn-submit").attr("data-gs-flag", getStockFlag);
            	
            	if(getStockFlag === "ComingSoon"){
            		getStockAlertPopup.find(".pd-get-stock-alert-popup__header h2.text-title").html(Granite.I18n.get("comingSoonPopup.mainTitle"));
            		getStockAlertPopup.find(".pd-get-stock-alert-popup__header p.pd-get-stock-alert-popup__desc").html(Granite.I18n.get("comingSoonPopup.subtitle"));
            	}
            	
            	window.sg.components.pdGetStockAlertPopup.reInit();
            }
    		
            if(IS_B2B){
            	if(siteCode !== "cn"){ // SCIC hybris전환 cn국가가 아닌경우에만 tnc 호출하도록 처리
            		if(b2bApiCal){
                		b2bApiCal = false;
                		
                		getTncInfoForNewHybris();
                	}
            	}
            	
                window.sg.components.pdGetStockAlertPopup.showPopup($(this)[0]);
            } else {
            	window.sg.components.pdGetStockAlertPopup.showPopup($(this)[0]);
            }
    	}
    });
    
     /* Get Stock Alerts 팝업 SUBMIT 클릭 Event */
    $(document).on("click", ".pd-get-stock-alert-popup .pd-get-stock-alert-popup__btn-submit", function () {
    	if(siteCode === "in"){
    		var emailNumber = $("#getStockAlertEmailInput").val();
	        if (emailNumberValidCheck(emailNumber)) {
	            hideError();
	        } else {
	            showError();
	            return false;
	        }
    	}else if(siteCode === "cn"){ // SCIC hybris전환
    		var mobileNumber = $("#getStockAlertEmailInput").val();
	        if (mobileNumberValidCheck(mobileNumber)) {
	            hideError();
	        } else {
	            showError();
	            return false;
	        }
    	}else{
    		var emailAddr = $("#getStockAlertEmailInput").val();
	        if (emailValidCheck(emailAddr)) {
	            hideError();
	        } else {
	            showError();
	            return false;
	        }
    	}
    	
        if (isGpv2 === 'Y') {
            //샵통합
            var consents = "";
            /* eu 국가 T&C data */
            //if (siteCode == "uk" || siteCode == "fr" || siteCode == "be" || siteCode == "be_fr" || siteCode == "nl" || siteCode == "de") {
            if (TnC_SITE.includes(siteCode)) {
                var checkBox = getStockAlertPopup.find(".js-pd-get-stock-alert-popup__checkbox");
                var idStr = "";
                consents = ",\"consents\": {";
                checkBox.each(function () {
                    var _this = $(this);
                    if (idStr.length > 0) {
                        idStr += ",";
                    }
                    idStr += "\"" + _this.attr("id") + "\": {\"is_accepted\": " + _this.is(":checked") + "}";
                });
                consents += idStr;
                consents += "}";
                if (idStr === "") {
                    consents = "";
                }
            }

            var paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"email\" : \"" + emailAddr + "\"" + consents + "}";
            if(siteCode == "in"){
            	if(emailStr != "" && numberStr != ""){ // 이메일 + 번호 있을 때
            		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"email\" : \"" + emailStr + "\",\"mobile\" : \"" + numberStr + "\"" + consents + "}";
            	}else if(emailStr != "" && numberStr == ""){ // 이메일만 있을 때
            		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"email\" : \"" + emailStr + "\"" + consents + "}";
            	}else if(emailStr == "" && numberStr != ""){ // 번호만 있을 때
            		paramStr = "{\"notification\":{\"in-stock\":{\"is_active\": true,\"skus\":{\"" + tempProductCode + "\":{}}}},\"mobile\" : \"" + numberStr + "\"" + consents + "}";
            	}
            }
            var paramJson = JSON.parse(paramStr);
            var paramObj = JSON.stringify(paramJson);
            var loginJwt = $.cookies.get("jwt_" + countryIsoCode, {
                domain: ".samsung.com"
            });
            var validJwtTkn = false;

            if (loginJwt != null) {
                // jwt validate 체크
                let validateParam = {
                    "jwt": loginJwt
                };
                if(isEppSite){
                    validateParam["store_id"] = eppStoreId;
                }
                $.ajax({
                    headers: {
                        "Cache-Control": "no-cache",
                        "Content-Type": "application/json",
                        "Access-Control-Allow-Origin": "*"
                    },
                    url: storeDomain + "/v1/sso/user/validate",
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(validateParam),
                    timeout: 10000,
                    xhrFields: {
                        withCredentials: true
                    },
                    beforeSend: function (xhr) {
                        if (multiLanguageYN === "Y") {
                            xhr.setRequestHeader("x-ecom-locale", hreflang);
                        }
                    },
                    success: function (data) {
                        if (data.statusCode === 200 || data.statusCode === "200") {
                            validJwtTkn = true;
                        }
                        callInStockApiGpv2(validJwtTkn, loginJwt, paramObj);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        callInStockApiGpv2(validJwtTkn, loginJwt, paramObj);
                    }
                });
            } else {
                callInStockApiGpv2(validJwtTkn, loginJwt, paramObj);
            }

        } else {
            // shop, nonshop
            if(siteCode === "cn"){ // SCIC hybris전환
            	callInStockApi(mobileNumber);
            }else{
            	callInStockApi(emailAddr);
            }
        }
        return true;
    });
  //new-hybris
    var tncError = function(data){
        var errorText = "";
        if (data && data.responseJSON) {
            if (data.responseJSON.message !== null && data.responseJSON.message !== "") {
                errorText = data.responseJSON.message;
            }
        }
        if ((Granite && Granite.author) || document.URL.indexOf("/container") > -1) {
            console.error("[pd-g-getstock-popup] " + errorText);
        } else {
            confirmPopup(errorText);
        }
    };

	var getTncInfoForGPv2 = function () {
		$(".pd-get-stock-alert-popup .pd-get-stock-alert-popup__checkbox-container").html("");

		var url = storeDomain + "/v1/tnc";
		var param = {
			"display": "in_stock"
		};
        if(isEppSite){
            param["store_id"] = eppStoreId;
        }
		$.ajax({
			headers: {
				"Cache-Control": "no-cache",
				"Content-Type": "application/json",
				"Access-Control-Allow-Origin": "*"
			},
			type: "GET",
			url: url,
			data: param,
			dataType: "json",
			cache: true,
			timeout: 20000,
			xhrFields: {
				withCredentials: true
			},
			beforeSend: function (xhr) {
				if (multiLanguageYN === "Y") {
					xhr.setRequestHeader("x-ecom-locale", hreflang);
				}
			},
			success: function (data) {
				if (data != null && data.length > 0) {
					var checkHtml = "";
					var tncCheckCount = 0;
					var isreqFlag =false;
					for (var i = 0; i < data.length; i++) {
						var resultData = data[i].data;

						if (resultData != null && resultData.is_active === true) {
							var id = data[i].id;

							if (resultData.read_only) {
								checkHtml +=
									'<div class="pd-get-stock-alert-popup__checkbox-desc">' +
										'<p>' + resultData.content + '</p>' +
									'</div>';
							} else {
								
								if (resultData.is_required === true) {
									isreqFlag = true;
								}
								
								checkHtml += 
									'<div class="pd-get-stock-alert-popup__checkbox-wrap' + (resultData.is_required ? ' is-required' : '') + '">' +
                                        '<div class="checkbox-v2">'+
                                            '<input class="checkbox-v2__input js-pd-get-stock-alert-popup__checkbox" type="checkbox" name="checkbox" id="' + id + '" name="receive notification checkbox' + tncCheckCount + '"'+ (resultData.is_required ?' aria-required="true"':'')+'>'+
                                            '<label class="checkbox-v2__label" for="' + id + '">'+
                                                '<span class="checkbox-v2__label-box-wrap">'+
                                                    '<span class="checkbox-v2__label-box">'+
                                                        '<svg class="checkbox-v2__label-box-icon" focusable="false" aria-hidden="true">'+
                                                        '<use xlink:href="#done-bold" href="#done-bold"></use>'+
                                                        '</svg>'+
                                                    '</span>'+
                                                '</span>'+
                                                '<span class="checkbox-v2__label-text">'+ resultData.content +'</span>'+
                                            '</label>'+
                                        '</div>'+
									'</div>' +
									'<div class="pd-get-stock-alert-popup__checkbox-desc"></div>';

								tncCheckCount++;
							}
						}
					}
					checkHtml += '<div class="pd-get-stock-alert-popup__checkbox-desc is-required" style="display:' + (isreqFlag ? 'block' : 'none') + '">'+ Granite.I18n.get("* Required field") +'</div>';
					$(".pd-get-stock-alert-popup .pd-get-stock-alert-popup__checkbox-container").html(checkHtml);
					window.sg.components.pdGetStockAlertPopup.reInit();
				}
			},
			error: function (data) {
            	tncError(data);
            }
		});
	}
	//new-hybris
    var getTncInfoForNewHybris = function () {
		$(".pd-get-stock-alert-popup .pd-get-stock-alert-popup__checkbox-container").html("");
		var disClaimer = '<p class="pd-get-stock-alert-popup__disclaimer-text">' + Granite.I18n.get("By providing your email you agree to marketing communications & inventory alerts from Samsung.") + '</p>';
		var url = storeDomain + "/tokocommercewebservices/v2/"+storeSiteCode+"/tnc";
		var param = {
			"context": "PRODUCT",
            "value" : "stock_alert_tc"
		};
        
        if( $('#shopParmLang').val() ){
            param['lang']=$('#shopParmLang').val();
        }
		$.ajax({
			type: "GET",
			url: url,
			data: param,
			dataType: "json",
			cache: true,
			timeout: 20000,
			xhrFields: {
				withCredentials: true
			},
            crossDomain: true,
			success: function (data) {
				if (data != null && data.length > 0) {
					var checkHtml = "";
					var tncCheckCount = 0;
					var isreqFlag =false;
					for (var i = 0; i < data.length; i++) {
						var resultData = data[i];

						if (resultData != null) {
							var id = resultData.code;

							if (resultData.type === "DISCLAIMER") {
								var content = resultData.content;
								if(isB2B && $("#shopIntegrationFlag").val() ==='true' && content == null){
									content = '';
								}
								disClaimer = '<p class="pd-get-stock-alert-popup__disclaimer-text">' + content + '</p>';
							} else {
								
								if (!isreqFlag && resultData.required === true) {
									isreqFlag = true;
								}
								
								checkHtml += 
									'<div class="pd-get-stock-alert-popup__checkbox-wrap' + (resultData.required ? ' is-required' : '') + '">' +
                                        '<div class="checkbox-v2">'+
                                            '<input class="checkbox-v2__input js-pd-get-stock-alert-popup__checkbox" type="checkbox" name="checkbox" id="' + id + '" name="receive notification checkbox' + tncCheckCount + '"'+ (resultData.required ?' aria-required="true"':'')+'>'+
                                            '<label class="checkbox-v2__label" for="' + id + '">'+
                                                '<span class="checkbox-v2__label-box-wrap">'+
                                                    '<span class="checkbox-v2__label-box">'+
                                                        '<svg class="checkbox-v2__label-box-icon" focusable="false" aria-hidden="true">'+
                                                        '<use xlink:href="#done-bold" href="#done-bold"></use>'+
                                                        '</svg>'+
                                                    '</span>'+
                                                '</span>'+
                                                '<span class="checkbox-v2__label-text">'+ resultData.content +'</span>'+
                                            '</label>'+
                                        '</div>'+
									'</div>' +
									'<div class="pd-get-stock-alert-popup__checkbox-desc"></div>';

								tncCheckCount++;
							}
						}
					}
					checkHtml += '<div class="pd-get-stock-alert-popup__checkbox-desc is-required" style="display:' + (isreqFlag ? 'block' : 'none') + '">'+ Granite.I18n.get("* Required field") +'</div>';
					$(".pd-get-stock-alert-popup .pd-get-stock-alert-popup__checkbox-container").html(checkHtml);
				}
			},
			error: function (data) {
                //epp service error 팝업 제거 요청
            	//tncError(data);
            }, complete : function(){
            	$(".pd-get-stock-alert-popup .pd-get-stock-alert-popup__disclaimer").html(disClaimer);
            	window.sg.components.pdGetStockAlertPopup.reInit();
            }
		});
	}

	$(function () {
        // [EPP] error 페이지 제외 
        let isEppErrorPage = false;
        if(isEppSite){
            if($('#wtbCurrentPagePath').val() != null){
                const currentPagePath = $('#wtbCurrentPagePath').val();
                if(currentPagePath.indexOf("/common/error") > -1){
                    isEppErrorPage = true;
                }
            }
        }
		if (getStockAlertPopup.length > 0 && !isEppErrorPage) {
			// b2c인 경우
			if(!isB2B && TnC_SITE.includes(siteCode) && (isGpv2 === 'Y' || isNewHybris)) {			//new-hybris
                if(isNewHybris){
                    getTncInfoForNewHybris();
                } else {
                    getTncInfoForGPv2();
                }
			}
		}
	});

})(window.jQuery);

(() => {
  const $q = window.sg.common.$q;
  const layerPopupMaxHeight = window.sg.common.layerPopupMaxHeight;
  const menu = window.sg.common.menu;
  const scrollbar = window.sg.common.scrollbar;
  const selector = { section: '.finance-ee-popup' };

  class FinanceEePopup {
    constructor(component) {
      this.selector = {
        section: selector.section,
        layerScroll: '.layer-popup',
        focusStart: '.layer-popup__inner',
        focusLast: '.layer-popup__close',
        popupClose: '.layer-popup__close',
        menuSelect: '.menu select',
        menuBar: '.menu__select-field',
        menuTitle: '.menu__select-field-text',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        layerScroll: null,
        closeFocus: null,
      };

      this.setProperty();

      this.handler = {
        resize: this.resize.bind(this),
        menuChange: (event) => {
          setTimeout(() => {
            this.resizeMenu($q(event.target).closest('.menu').target[0]);
          },100);
        },
      };

      FinanceEePopup.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.layerScroll = this.ele.section.find(this.selector.layerScroll);

      if (this.ele.section.css('display') !== 'none') {
        window.sg.common.utils.hiddenScroll();
        this.ele.section.setLayerFocus(this.selector.focusStart, this.selector.focusLast);
      }
    }

    showPopup(btn = null) {
      if (btn !== null) {
        this.ele.closeFocus = btn;
      }
      
      this.ele.section.show();
      window.sg.common.utils.hiddenScroll();
      this.ele.section.setLayerFocus(this.selector.focusStart, this.selector.focusLast);
    }

    hidePopup() {
      window.sg.common.utils.visibleScroll();
      this.ele.section.offLayerFocus();
      this.ele.section.hide();
      if (this.ele.closeFocus !== null) {
        this.ele.closeFocus.focus();
      }
    }

    init() {
      this.bindEvents();
      this.resize();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      this.resize();
    }

    bindEvents() {
      this.ele.window.off('resize',this.handler.resize).on('resize',this.handler.resize);
      this.ele.section.find(this.selector.menuSelect).off('change',this.handler.menuChange).on('change',this.handler.menuChange);
    }

    resize() {
      this.ele.section.find('.menu').target.forEach((element) => {
        this.resizeMenu(element);
      });
    }

    resizeMenu(element) {
      const itemHeight = element.querySelector(this.selector.menuTitle).getBoundingClientRect().height;
      element.style.height = '';
      element.querySelector(this.selector.menuBar).style.height = '';

      if (element.getBoundingClientRect().height < itemHeight) {
        element.querySelector(this.selector.menuBar).style.height = `${itemHeight}px`;
        element.style.height = `${itemHeight}px`;
      }

      this.ele.section.find('.scrollbar').target.forEach((element) => {
        scrollbar.resize(element);
      });
    }
  }

  function init() {
    $q(`${selector.section} .menu`).target.forEach((element) => {
      menu.init(element);
    });

    $q(`${selector.section} .layer-popup`).target.forEach((element) => {
      if (layerPopupMaxHeight.reInit(element) === null) {
        layerPopupMaxHeight.init(element);
      }
    });

    $q(selector.section).target.forEach((element) => {
      if (!FinanceEePopup.instances.has(element)) {
        new FinanceEePopup(element);
      }
    });
  }
  
  function reInit() {
    $q(`${selector.section} .menu`).target.forEach((element) => {
      menu.reInit(element);
    });

    $q(`${selector.section} .layer-popup`).target.forEach((element) => {
      if (layerPopupMaxHeight.reInit(element) === null) {
        layerPopupMaxHeight.init(element);
      }
    });

    $q(selector.section).target.forEach((element) => {
      if (FinanceEePopup.instances.has(element)) {
        const instances =  FinanceEePopup.instances.get(element);
        instances.reInit();
      } else {
        new FinanceEePopup(element);
      }
    });
  }

  FinanceEePopup.instances = new WeakMap();

  window.sg.components.financeEePopup = {
    init,
    reInit,
    show: (btn = null) => {
      $q(selector.section).target.forEach((element) => {
        if (FinanceEePopup.instances.has(element)) {
          const instances =  FinanceEePopup.instances.get(element);
          instances.showPopup(btn);
        }
      });
    },
    hide: () => {
      $q(selector.section).target.forEach((element) => {
        if (FinanceEePopup.instances.has(element)) {
          const instances =  FinanceEePopup.instances.get(element);
          instances.hidePopup();
        }
      });
    },
  };

  $q.ready(init);
})();


var installmentPlansData = {};
(function ($, document) {
	"use strict";
	
	var siteCode = $("#siteCode").val();
	var storeDomain = $("#storeDomain").val();
	var countryIsoCode = $("#countryIsoCode").val();
	var priceCurrency = $("#priceCurrency").val();
	var multiLanguageYN = $("#multiLanguageYn").val();
	var hreflang = $("#localLang").val();
	var headers = {
					"Cache-Control": "no-cache",
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin": "*"
				  };

	if (multiLanguageYN === "Y") {
		headers["x-ecom-locale"] = hreflang;
	}
	
	var modelCode = "";    	//본품의 모델코드
	var dataPrice = "";
	var emiFinanceInfoData = [];
	var monthdataset ={};
	var focusTarget;
	//[EPP] epp 관련 변수 추가
	const isEppSite = checkEppSite();
	if(isEppSite && window.sg.epp == null){
		window.sg.epp={};
		window.sg.epp.common ={};
	}
	let eppCompanyCode = isEppSite ? window.sg.epp.common.companyCode : "";

	var installmentPlansGrid = function() {
		if(emiFinanceInfoData !== null && emiFinanceInfoData !== "") {
			var selectPlanHtml = "";
			for(var key in emiFinanceInfoData){
			  if(emiFinanceInfoData[key].length !== 0){
				  selectPlanHtml += '<option value="'+key+'">'+key+'</option>';
			  }
			}
			$('.finance-ee-popup #selectplan').html(selectPlanHtml);
			
			if($('.finance-ee-popup #selectplan option').length > 0){
				planGrid($('.finance-ee-popup #selectplan option').first().val());
			}
		}
		window.sg.components.financeEePopup.show(focusTarget);
	}

	var planGrid = function(selectPlan) {
		var firstdatalist = emiFinanceInfoData[selectPlan];
		var selectMonthsHtml = "";
		if(firstdatalist !== null && firstdatalist.length !== 0){
			for(var i =0 ; i< firstdatalist.length; i++){
				selectMonthsHtml += '<option value="'+firstdatalist[i].tenure.value+'">'+firstdatalist[i].tenure.value+'</option>';
			}
		}
		$(".finance-ee-popup #selectmonths").html(selectMonthsHtml);
		window.sg.components.financeEePopup.reInit();
		
		getPlansCalculator(selectPlan, $('.finance-ee-popup #selectmonths option').first().val());
	}
	
	var getPaymentData = function (dataPriceParm, focusTargetParm, modelCodeParm) {
		focusTarget = focusTargetParm
		dataPrice = dataPriceParm
		modelCode = modelCodeParm;
		var pdJwtToken = $.cookies.get("jwt_"+countryIsoCode, {domain:".samsung.com"});
		var paramObj = {"cart":{ "skus": [modelCode],"total_price": dataPrice}};
		if(isEppSite){
			paramObj["store_id"] =eppCompanyCode;
		}
		$.ajax({
			headers: headers,
			url: storeDomain + "/v4/configurator/payment-options",
			//url: "https://www.samsung.com/ee/api/v4/configurator/payment-options",
			type: "POST",
			dataType: "json",
			xhrFields: { withCredentials: true },
			crossDomain: true,
			async: true,
			data: JSON.stringify(paramObj),
			beforeSend : function(xhr){
				/* jwtToken 있으면  헤더값 추가 */
				if(pdJwtToken != null && pdJwtToken != ""){
					xhr.setRequestHeader("x-ecom-jwt", pdJwtToken);
				}
			},
			success : function ( data) {
				if(data != null && data != ""){
					$(".finance-ee-popup #productprice").html(currencyComma(dataPrice, priceCurrency));
					if(data.payment_methods.LS){
						if(data.payment_methods.LS.finance_plans){
							if(data.payment_methods.LS.finance_plans){
								emiFinanceInfoData = data.payment_methods.LS.finance_plans;
								installmentPlansGrid();
							}
						}
					}
				}
			}
		});
	}
	
	var getPlansCalculator = function (plan, months) {
		var pdJwtToken = $.cookies.get("jwt_"+countryIsoCode, {domain:".samsung.com"});
		var paramObj = { 
					"total_price": Number(dataPrice),
					"payment_option": plan,
					"tenure": {
						"unit": "M",
						"value": months
						}
					};
		
		if(isEppSite){
			paramObj["store_id"] = eppCompanyCode;
		}

		$(".finance-ee-popup #interestrate").text("");
		$(".finance-ee-popup #monthlypayment").text("");
		if(monthdataset[String(dataPrice) + plan + months]){
			var data = monthdataset[String(dataPrice) + plan + months];
			if(data != null && data != ""){
				monthdataset[String(dataPrice) + plan + months] = data;
				if(data.interest_rate){
					$(".finance-ee-popup #interestrate").html(data.interest_rate + "%");
				}
				if(data.installment_amount){
					var installment_amount = Granite.I18n.get("{0}/month", (currencyComma(Number(data.installment_amount), priceCurrency)));
					$(".finance-ee-popup #monthlypayment").html(installment_amount);
				}
			}
		}else{
			$.ajax({
				headers: {
					"Cache-Control" : "no-cache",
					"Content-Type" : "application/json",
					"Access-Control-Allow-Origin" : "*"
				},
				url: storeDomain + "/v1/payment/LS/emi_calculator",
				//url:"https://www.samsung.com/ee/api/v1/payment/LS/emi_calculator",
				data: JSON.stringify(paramObj),
				type: "POST",
				dataType: "json",
				timeout: 20000,
				xhrFields: { withCredentials: true },
				async : true,
				beforeSend : function(xhr){
					/* jwtToken 있으면  헤더값 추가 */
					if(pdJwtToken != null && pdJwtToken != ""){
						xhr.setRequestHeader("x-ecom-jwt", pdJwtToken);
					}
				},
				success : function (data){
					if(data != null && data != ""){
						monthdataset[String(dataPrice) + plan + months] = data;
						if(data.interest_rate){
							$(".finance-ee-popup #interestrate").html(data.interest_rate + "%");
						}
						if(data.installment_amount){
							var installment_amount = Granite.I18n.get("{0}/month", (currencyComma(Number(data.installment_amount), priceCurrency)));
							$(".finance-ee-popup #monthlypayment").html(installment_amount);
						}
					}
				}
			});
		}
	}
	
	$(".finance-ee-popup .layer-popup__close").on("click", function() {
		window.sg.components.financeEePopup.hide(focusTarget);
	});
	
	$(".finance-ee-popup #selectplan").on("change", function() {
		planGrid($("#selectplan option:selected").val());
	});
	
	$(".finance-ee-popup #selectmonths").on("change", function() {
		getPlansCalculator($("#selectplan option:selected").val(), $("#selectmonths option:selected").val());
	});

	installmentPlansData = (function(){
		return {
			getPaymentData : getPaymentData
		}
	})();
	
})(window.jQuery, window.document);
(() => {
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const $q = window.sg.common.$q;
  const selector = { section: '.compare-popup' };
  const layerPopupMaxHeight = window.sg.common.layerPopupMaxHeight;
  const optionSelector = window.sg.common.OptionSelector;
  const menu = window.sg.common.menu;
  const setMobileFocusLoop = window.sg.common.utils.setMobileFocusLoop;
  const removeMobileFocusLoop = window.sg.common.utils.removeMobileFocusLoop;


  class ComparePopup {
    constructor(component) {
      this.selector = {
        section: selector.section,
        samePart: ['.compare-popup__rating', '.compare-popup__fiche-cta-wrap', '.compare-popup__fiche', '.compare-popup__price', '.compare-popup__product-card', '.compare-popup__spec', '.compare-popup__spec-wrap'],
        sameItemsWrap: '.compare-popup__spec',
        sameItems: '.compare-popup__spec-item',
        fixed: '.compare-popup__product-wrap',
        fixedPaddingPC: '.compare-popup__product-card',
        fixedOffsetMobile: '.layer-popup__close',
        scrollMobile: '.layer-popup',
        scrollPc: '.scrollbar__wrap',
        first: 'layer-popup__looping--first',
        end: 'layer-popup__looping--end',
        productList: '.compare-popup__product-item',
        filterSwitchBtn: '.compare-popup__filter-switch .switch-v2__button',
        filterSwitchTargets: '.compare-popup__detail-spec-table-body .compare-popup__detail-spec-row',
      };

      this.ele = {
        window: $q(window),
        section: $q(component),
        fixed: null,
        fixedPaddingPC: null,
        samePart: null,
        scrollMobile: null,
        scrollPc: null,
        fixedOffsetMobile: null,
      };

      this.statePC = BREAKPOINTS.MOBILE < utils.getViewPort().width;
      this.fixedTop = null;
      this.stateFixed = false;
      this.resizeTimer = null;
      this.optionFlag = null;
      this.saleCta = null;

      this.setProperty();

      this.handler = {
        resize: this.resize.bind(this),
        scroll: (event) => {
          this.scroll($q(event.target));
        },
        change: this.optChange.bind(this),
        onClickSwitchBtn: (e) => {
          const target = $q(e.currentTarget);
          const watchedTargets = target.closest(selector.section).find(this.selector.filterSwitchTargets).target;
          if (target.hasClass('on')) {
            this.setFilterCompare(watchedTargets);
          } else {
            this.setClearBody(watchedTargets);      
          }
          this.handler.resize();
        },
        popupClose: this.popupClose.bind(this),
      };

      ComparePopup.instances.set(component, this);

      this.init();
    }

    setProperty() {
      this.ele.fixed = this.ele.section.find(this.selector.fixed);
      this.ele.scrollMobile = this.ele.section.find(this.selector.scrollMobile);
      this.ele.scrollPc = this.ele.section.find(this.selector.scrollPc);
      this.ele.fixedPaddingPC = this.ele.section.find(this.selector.fixedPaddingPC);
      this.ele.fixedOffsetMobile = this.ele.section.find(this.selector.fixedOffsetMobile);

      this.ele.sameItems = [];
      this.ele.section.find(this.selector.sameItemsWrap).target.forEach((el) => {
        this.ele.sameItems.push([...el.querySelectorAll(this.selector.sameItems)]);
      });

      this.ele.samePart = [
        this.ele.section.find(this.selector.samePart[0]),
        this.ele.section.find(this.selector.samePart[1]),
        this.ele.section.find(this.selector.samePart[2]),
        this.ele.section.find(this.selector.samePart[3]),
        this.ele.section.find(this.selector.samePart[4]),
        this.ele.section.find(this.selector.samePart[5]),
      ];

      if (this.ele.section.find('.compare-popup__product-item').target.length <= 2) {
        this.ele.section.addClass('compare-popup--item2');
      } else {
        this.ele.section.removeClass('compare-popup--item2');
      }
      this.ele.filterSwitchBtn = this.ele.section.find(this.selector.filterSwitchBtn);
    }

    init() {
      this.bindEvents();
      this.resize();
    }

    reInit() {
      this.setProperty();
      this.bindEvents();
      this.resize();
    }

    cardInit() {
      this.setProperty();
      this.resize();
    }

    scroll($scroll) {
      if ($scroll.target[0].scrollTop > this.fixedTop) {
        if (!this.stateFixed) {
          this.setFixed();
        }
      } else {
        if (this.stateFixed) {
          this.clearFixed();
        }
      }
    }

    popupClose() {
      this.ele.filterSwitchBtn.removeClass('on');
    }

    getFilterHighlight(watchedTargets) {
      return watchedTargets.filter((target) => $q(target).find('.highlight').target.length > 0);
    }

    setFilterCompare(watchedTargets) {
      const resultTargets = this.getFilterHighlight(watchedTargets);
      this.setHideBody(watchedTargets);
      this.setShowBody(resultTargets);
    }

    setShowBody(targets) {
      targets.forEach((target) => {
        $q(target).css({ display: 'flex' });
      });
    }

    setHideBody(targets) {
      targets.forEach((target) => {
        $q(target).css({ display: 'none' });
      });
    }

    setClearBody(targets) {
      targets.forEach((target) => {
        $q(target).css({ display: '' });
      });
    }

    clearFixed() {
      this.ele.fixed.removeClass('compare-popup__product-wrap--fixed');

      this.ele.fixed.css({
        marginTop: '',
      });

      this.ele.fixedPaddingPC.css({
        marginTop: '',
      });

      this.stateFixed = false;
    }

    setFixed() {
      const $title = this.ele.section.find('.compare-popup__headline-wrap');
      const titleHeight = $title.target.length === 0 ? 0 : $title.offset().height;

      this.ele.fixed.addClass('compare-popup__product-wrap--fixed');

      if (this.statePC) {
        this.ele.fixed.css({
          marginTop: `${titleHeight * -1}px`,
        });
      } else {
        this.ele.fixed.css({
          marginTop: '',
        });
      }

      if (this.statePC) {
        const $menu = this.ele.section.find('.compare-popup__product-menu');
        const menuHeight = $menu.target.length === 0 ? 0 : $menu.offset().height;

        this.ele.fixedPaddingPC.css({
          marginTop: `${(titleHeight + menuHeight)}px`,
        });
      } else {
        this.ele.fixedPaddingPC.css({
          marginTop: '',
        });
      }

      this.stateFixed = true;
    }

    resize() {
      this.statePC = BREAKPOINTS.MOBILE < utils.getViewPort().width;

      this.sameHeight();

      this.clearFixed();

      if (this.statePC) {
        this.fixedTop = this.ele.scrollPc.target[0].scrollTop - this.ele.scrollPc.offset().top + this.ele.fixed.offset().top;

        this.scroll(this.ele.scrollPc);
      } else {
        this.fixedTop = this.ele.scrollMobile.target[0].scrollTop + this.ele.fixed.offset().top - this.ele.fixedOffsetMobile.target[0].getBoundingClientRect().height - parseFloat(this.ele.fixedOffsetMobile.css('margin-top'));

        this.scroll(this.ele.scrollMobile);
      }

      layerPopupMaxHeight.setMax(this.ele.section.find('.layer-popup').target[0]);

      clearTimeout(this.resizeTimer);
      this.resizeTimer = null;
      this.resizeTimer = setTimeout(() => {
        this.sameHeight();
      }, 400);
    }

    sameHeight() {
      const sameItemHeight = [];
      this.ele.sameItems.forEach((els) => {
        els.forEach((el, idx) => {
          el.style.height = '';
          if (sameItemHeight[idx] === undefined) {
            sameItemHeight[idx] = el.getBoundingClientRect().height;
          } else {
            const elHeight = el.getBoundingClientRect().height;
            if (sameItemHeight[idx] < elHeight) {
              sameItemHeight[idx] = elHeight;
            }
          }
        });
      });

      this.ele.sameItems.forEach((els) => {
        els.forEach((el, idx) => {
          el.style.height = `${sameItemHeight[idx]}px`;
        });
      });

      this.ele.samePart.forEach(($els) => {
        let max = 0;

        $els.target.forEach((el) => {
          el.style.height = '';
          const height = el.getBoundingClientRect().height;
          if (height > max) {
            max = height;
          }

          if (el.classList.contains('compare-popup__fiche-cta-wrap')) {
            if (el.childElementCount === 0) {
              el.classList.add('no-energy-label');
            }
          }

          if (el.classList.contains('compare-popup__fiche')) {
            if (el.querySelector('.badge-repairability')) {
              el.classList.add('with-repairability');
            }
          }
        });

        $els.css({
          height: `${max}px`,
        });
      });
    }

    openPopup(btnEl) {
      utils.hiddenScroll();

      this.ele.section.show();

      this.ele.section.find('.scrollbar__wrap').target.forEach((element) => {
        element.scrollTop = 0;
        // window.sg.common.scrollbar.scrollTo(element,0,1,true);
      });

      this.resize();

      this.ele.section.find('.menu').target.forEach((mn) => {
        menu.reInit(mn);
      });

      ComparePopup.setOptipSwier(this.ele.section);

      if (btnEl !== undefined) {
        this.openBtn = $q(btnEl);
      }
    }

    compareFirstFocus() {
      this.setLayerFocus(this.ele.section.find('a, button, input').target[0]);
    }

    setLayerFocus(firstStr) {
      const firstEl = $q(firstStr);
      firstEl.addClass('layer-popup__looping');

      if (!this.ele.section.find(`.${this.selector.first}`).target.length) {
        firstEl.prepend(`<button class="${this.selector.first} hidden" aria-hidden="true"></button>`);
      }

      const endEl = this.ele.fixedOffsetMobile;
      if (!this.ele.section.find(`.${this.selector.end}`).target.length) {
        endEl.after(`<button class="${this.selector.end} hidden" aria-hidden="true"></button>`);
      }

      const loopingFirst = this.ele.section.find(`.${this.selector.first}`);
      const loopingEnd = this.ele.section.find(`.${this.selector.end}`);

      loopingFirst.off('focus').on('focus', () => {
        endEl.focus();
      });

      loopingEnd.off('focus').on('focus', () => {
        firstEl.focus();
      });

      firstEl.focus();

      if (document.querySelectorAll('[data-aria-hidden]').length <= 0) {
        setMobileFocusLoop(this.ele.section.target[0]);
      }
    }

    closePopup() {
      utils.visibleScroll();

      if (document.querySelectorAll('[data-aria-hidden]').length > 0) {
        removeMobileFocusLoop();
      }

      if (this.openBtn === null || this.openBtn === undefined) {
        return;
      } else {
        this.openBtn.focus();

        this.openBtn = null;
      }

      this.ele.section.hide();

      this.ele.section.find('.layer-popup__looping--first').off('focus').remove();
      this.ele.section.find('.layer-popup__looping--end').off('focus').remove();
    }

    reInitCardSet(item) {
      if (this.optionFlag !== null) {
        if (this.optionFlag === 'color') {
          $q(item).find('.option-selector__wrap--color-chip').find('input:checked').focus();
        } else if (this.optionFlag === 'capacity') {
          $q(item).find('.option-selector__wrap--capacity').find('input:checked').focus();
        }
      }
      $q(item).find('.option-selector__wrap input').off('change', this.handler.change).on('change', this.handler.change);
    }

    optChange(e) {
      this.optionFlag = null;
      const currentTarget = $q(e.currentTarget).closest('.option-selector__wrap');
      if (currentTarget.hasClass('option-selector__wrap--color-chip')) {
        this.optionFlag = 'color';
      } else {
        this.optionFlag = 'capacity';
      }
    }

    bindEvents() {
      this.ele.window.off('resize', this.handler.resize).on('resize', this.handler.resize);

      this.ele.scrollPc.off('scroll', this.handler.scroll).on('scroll', this.handler.scroll);
      this.ele.scrollMobile.off('scroll', this.handler.scroll).on('scroll', this.handler.scroll);

      this.ele.section.find('.option-selector__wrap input').off('change', this.handler.change).on('change', this.handler.change);

      this.ele.fixedPaddingPC.target.forEach((card) => {
        const ctaLength = $q(card).find('.compare-popup__cta-area .cta').target.length;
        if (ctaLength > 1) {
          this.saleCta = true;
          this.ele.section.removeClass('compare-popup--not-sale');
        } else {
          if (this.saleCta !== true) {
            this.saleCta = false;
            this.ele.section.addClass('compare-popup--not-sale');
          }
        }
      });

      this.ele.filterSwitchBtn.off('click', this.handler.onClickSwitchBtn).on('click', this.handler.onClickSwitchBtn);
      this.ele.fixedOffsetMobile.off('click', this.handler.popupClose).on('click', this.handler.popupClose);
    }

    static setOptipSwier($section) {
      // .option-selector__wrap--color-chip show mobile
      // item.length 1~4 no Arrow, item.length 5 has Arrow
      // item.length 3 : O O O
      // item.length 4 : O O O O
      // item.length 5 : < O O >

      $section.find('.option-selector .option-selector__wrap').target.forEach((opt) => {
        const isMobileLess = opt.classList.contains('option-selector__wrap--color-chip') && opt.querySelectorAll('.option-selector__swiper-slide').length <= 4;
        if (!isMobileLess) {
          const $option = $q(opt);
          $option.removeClass('unbind-option');
          optionSelector.reInit($option);
        }
      });
    }
  }

  function init() {
    const $section = $q(selector.section);
    ComparePopup.setOptipSwier($section);

    $q(selector.section).target.forEach((element) => {
      layerPopupMaxHeight.init(element.querySelector('.layer-popup'));

      if (!ComparePopup.instances.has(element)) {
        new ComparePopup(element);
      } else {
        const instances =  ComparePopup.instances.get(element);
        instances.reInit();
      }
    });
  }

  function reInit() {
    window.sg.common.lazyLoad.setLazyLoad();
    window.sg.common.switchv2.reInit('.compare-popup .switch-v2');

    const $section = $q(selector.section);

    $section.find('.scrollbar').target.forEach((element) => {
      window.sg.common.scrollbar.init(element);
    });

    $section.find('.menu').target.forEach((element) => {
      menu.reInit(element);
    });

    ComparePopup.setOptipSwier($section);

    $section.target.forEach((element) => {
      layerPopupMaxHeight.reInit(element.querySelector('.layer-popup'));

      if (ComparePopup.instances.has(element)) {
        const instances =  ComparePopup.instances.get(element);
        instances.reInit();
      }
    });
  }

  function cardInit(wrap) {
    window.sg.common.lazyLoad.setLazyLoad();

    const $wrap = $q(wrap);
    const $section = $q(selector.section);

    ComparePopup.setOptipSwier($section);

    $section.target.forEach((element) => {
      if (ComparePopup.instances.has(element)) {
        const instances =  ComparePopup.instances.get(element);
        instances.cardInit();
        instances.reInitCardSet(wrap);
      }
    });

    $wrap.find('.scrollbar').target.forEach((element) => {
      window.sg.common.scrollbar.resize(element);
    });
  }

  function openPopup(element, btn = null) {
    if (ComparePopup.instances.has(element)) {
      const instances =  ComparePopup.instances.get(element);
      instances.openPopup(btn);
    } else {
      new ComparePopup(element);

      const instances =  ComparePopup.instances.get(element);
      instances.openPopup(btn);
    }
  }

  function closePopup(element) {
    if (ComparePopup.instances.has(element)) {
      const instances =  ComparePopup.instances.get(element);
      instances.closePopup();
    }
  }

  function compareFirstFocus() {
    $q(selector.section).target.forEach((element) => {
      if (ComparePopup.instances.has(element)) {
        const instances =  ComparePopup.instances.get(element);
        instances.compareFirstFocus();
      }
    });
  }

  ComparePopup.instances = new WeakMap();

  window.sg.components.comparePopup = {
    init,
    reInit,
    cardInit,
    openPopup,
    closePopup,
    compareFirstFocus,
  };

  $q.ready(init);
})();

; (function($, document) {
	'use strict';
	/*
		cl{name} defined : Compare Layout
	*/
	window.sg.components.pf = window.sg.components.pf || {};
	const pf = window.sg.components.pf;
	
	// (nv-g-gnb.html)
	const addToCartPostYn = $("#addToCartPostYn").val() ? $("#addToCartPostYn").val() : "N";
	
	const clStoreDomain = $('#storeDomain').val();
	const clSearchDomain = $('#searchDomain').val();
	const clScene7domain = $('#scene7domain').val();
	const clReviewUseYN = $('#reviewUseYN').val();
	const clReevooUseYN = $('#reevooUseYN').val();
	const clApiStageInfo = $('#apiStageInfo').val();
	const clPriceDisplayYn = $("#pfPriceDisplayYn").val();
	const clPriceCurrency = $("#pfPriceCurrency").val();
	const clShopIntegrationFlag = $("#shopIntegrationFlag").val();
	const clPdurlAnchorCheckYn = $("#pfPdurlAnchorCheckYn").val();
	const clWtbCtaBtnYn = $("#pfWtbCtaBtnYn").val();		// SEPOL, SEB ( ee, lt, lv, pl )국가 >  WTB와 Learn More 의 위치가 바뀜
	const clOfferCheckYn = $("#pfOfferCheckYn").val();
	const clPageTrack = $("#pfPageTrack").val();
	const clHybrisApiJson = $("#pfHybrisApiJson").val(); 		//hybris api 호출 시 json 으로 호출하는 국가 ( N : jsonp )
	const clIsGPv2 = (clShopIntegrationFlag === 'GPv2') ? true : false;
	const clIsHybrisIntg = (clShopIntegrationFlag === 'Hybris-intg') ? true : false;
	const isNewHybris = (clShopIntegrationFlag === 'Hybris-new') ? true : false;		//new-hybris		
	const isNonShop = fnIsNull(clShopIntegrationFlag)?true : false;
	const isB2bhybris = (clShopIntegrationFlag === "true")?true : false;
	const isB2b = ($("#b2bFlag").val() === "Y")?true : false;
	const productGroupCode = $("#pfCategoryGroupCode").val();
	const storeSiteCode = $("#store_sitecode").val();
	const storeWebDomain = $("#storeWebDomain").val();

	const isEppSite = checkEppSite();
	if(isEppSite && window.sg.epp == null){
		window.sg.epp = {};
		window.sg.epp.common = {};
	}
	const eppCompanyCode = isEppSite ? window.sg.epp.common.companyCode : "";
	const eppIsUserGroupPricing = isEppSite ? window.sg.epp.common.isUserGroupPricing : false;
	const eppUserGroupName = eppIsUserGroupPricing ? window.sg.epp.common.groupName : "";
	const pfType = isEppSite ? $("#pfType").val() : "";
	const offerId = isEppSite ? $("#pfOfferId").val() : "";
	const eppIsRefurbish = pfType =="R" ? true : false;
	const eppIsFlash = pfType == "F" ? true : false;
	const eppOmniPricingUseYn = isEppSite ? $('#pfEppOmniPricingUseYn').val():"";
	
	const clImagePresetDesktop = "240_240";
	const clImagePresetMobile = "GNB_CARD_FULL_M_PNG";
	const clImageLazyloadPreset = "LazyLoad_Home";
	
	const GROUPCODE_VD = "04000000";
	const GROUPCODE_HA = "08000000";
	const GROUPCODE_IM = "01000000";
	
	let clSiteCode = $("#siteCode").val();
	
	let clCartUrl = $("#pfCartUrl").val();
	if(clSiteCode === "levant"){
		clCartUrl = clCartUrl.replace("/levant/","/jo/");
	} else if(clSiteCode === "levant_ar"){
		clCartUrl = clCartUrl.replace("/levant_ar/","/jo_ar/");
	}
	// lowestWasPrice 없을 시 strikethrough 제거
	const LOWEST_WAS_PRICE_STRIKETHROUGH_SITE_CODE = ["pl", "gr", "si", "fi", "it", "dk", "no", "se", "fr"]; // lowestWasPrice strikethrough siteCode 
	const isStrikethroughRmSite = $.inArray(siteCode, LOWEST_WAS_PRICE_STRIKETHROUGH_SITE_CODE) >= 0 ? true : false;
	
	if(clSiteCode=="in" && isEppSite){
		// epp in 사이트 cart url 적용
		clCartUrl = storeWebDomain + "/in/web/store/"+eppCompanyCode+"/cart/";
	}
	
	let isButtonShow = true;
	let productListData = {};
	let groupData = {};
	
	let originPrice = ""; // 기본 가격 (Tagging Data)
	let discountPrice = ""; // 할인후 가격  (Tagging Data)
	
	let clSearchApiParam = {
		"siteCode": clSiteCode,
		"onlyRequestSkuYN": "N"
	};
	
	// {b2c/b2b}/product/card/detail api 관련 변수
	const apiSiteInfo = isEppSite ? 'epp/v2' : 'b2c';
	let clSearchApiUrl = clSearchDomain + '/' + clApiStageInfo + '/'+apiSiteInfo+'/product/card/detail/global';
	if(isB2b){
		if(isB2bhybris){
			clSearchApiParam.shopType = "b2bhybris";
		}
		clSearchApiParam.commonCodeYN = "N";
		clSearchApiParam.saleSkuYN = "N";
		clSearchApiUrl = clSearchDomain + '/' + clApiStageInfo + '/b2b/product/card/detail';
	}else{
		if (clIsGPv2) {
			clSearchApiParam.commonCodeYN = "N";
			clSearchApiParam.saleSkuYN = "N";
			clSearchApiUrl = clSearchDomain + '/' + clApiStageInfo + '/'+apiSiteInfo+'/product/card/detail/gpv2';
		} else if (clIsHybrisIntg) {
			clSearchApiParam.saleSkuYN = "N";
			clSearchApiUrl = clSearchDomain + '/' + clApiStageInfo + '/'+apiSiteInfo+'/product/card/detail/hybris';
		} else if (isNewHybris) {		//new-hybris
			clSearchApiParam.commonCodeYN = "N";
			clSearchApiParam.saleSkuYN = "N";
			clSearchApiUrl = clSearchDomain + '/' + clApiStageInfo + '/'+apiSiteInfo+'/product/card/detail/newhybris';
		}
		if(isEppSite){
			clSearchApiParam.companyCode = eppCompanyCode;
			if(eppIsUserGroupPricing){
				clSearchApiParam['groupName'] = eppUserGroupName;
			}
			if(eppIsFlash || eppIsRefurbish){
				clSearchApiParam['offerId'] =  offerId;
			}
			//[24.02.27][EPP][CN][O2O] : o2oId 파라미터 추가
			if(window.sg.epp.common.userStoreId != ""){
				clSearchApiParam['o2oId'] = window.sg.epp.common.userStoreId;
			}
		}
	}
	
	function isNotNull(_str){
		return !fnIsNull(_str) && _str !== "null";
	};
	
	// 멀티스토어 파라미터 &shopSiteCode 추가
	let dotcom_multistore = $.cookies.get("estoreSitecode") ? $.cookies.get("estoreSitecode").toString() : '';
	let shopSiteCd = '';
	if(clSiteCode === "ae" || clSiteCode === "ae_ar"){
		//NOTICE : dotcom_multistore 값이 존재 하는 경우 ae, ae_ar, kw, kw_ar, om, om_ar, bh, bh_ar 인 경우만 세팅 
		if(dotcom_multistore === "ae" || dotcom_multistore === "ae_ar" || dotcom_multistore === "kw" || dotcom_multistore === "kw_ar" || dotcom_multistore === "om" || dotcom_multistore === "om_ar" || dotcom_multistore === "bh" || dotcom_multistore === "bh_ar"
			|| dotcom_multistore === "qa" || dotcom_multistore === "qa_ar"
			) {
			shopSiteCd = isNotNull(dotcom_multistore) ? dotcom_multistore : clSiteCode;
		}else{
			shopSiteCd = clSiteCode;
		}
	} else if(clSiteCode === "levant"){
		shopSiteCd = "jo";
	} else if(clSiteCode === "levant_ar"){
		shopSiteCd = "jo_ar";
	} else if(clSiteCode === "n_africa"){
		shopSiteCd = "ma";
	}
	
	if(clSiteCode === "ae"){
    	clCartUrl = clCartUrl.replace("/ae/","/"+shopSiteCd+"/");
    } else if(clSiteCode === "ae_ar"){
    	clCartUrl = clCartUrl.replace("/ae_ar/","/"+shopSiteCd+"/");
    }
    
	if(isNotNull(shopSiteCd)){
		clSearchApiParam['shopSiteCode'] = shopSiteCd;
	}
	
	//only SECA 
	let dotcom_countryRegion = $.cookies.get("country_region") ? $.cookies.get("country_region").toString() : '';
	let regionCode = ''; // default CA-ON
	if(clSiteCode === "ca" || clSiteCode ==="ca_fr"){
		if(isNotNull(dotcom_countryRegion)) {
			regionCode = dotcom_countryRegion;
		} else {
			regionCode = 'CA-ON'; // default CA-ON
		}
		clSearchApiParam['regionCode'] = regionCode;
	}
	
	/* b2b smb user 로직 필요한 변수 셋팅 :: S */
	const isTieredPriceSite = $('#tieredPriceUseYn').val()=="Y"? true:false;
	
	let isSMBUser = "";
	let isLogedin = "";
	let useTaxExPrice = "";
	/* b2b smb user 로직 필요한 변수 셋팅 :: E */
	
	function _trimToNull(str) {
		let s = $.trim(str);
		return s.length > 0 ? s : null;
	}

	function arrayContains(array, element) {
		for (let i = 0; i < array.length; i++) {
			if (array[i] === element) {
				return true;
			}
		}
		return false;
	};
	
	function escapeHtml(text) {
		let newText = text;
		if(isNotNull(newText)){
			newText = newText
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
		return newText;
	};
	
	function unescapeHtml(text){
		var newText = text;
		if(isNotNull(newText)){
			newText = newText
				.replace(/&amp;/g, "&")
				.replace(/&lt;/g, "<")
				.replace(/&gt;/g, ">")
				.replace(/&quot;/g, "\"")
				.replace(/&#039;/g, "\'");
		}
		return newText;
	};
	
	function clPrdPreset(presetStr) {
		let preset = "?$" + presetStr;
		preset += "_PNG$";

		return preset;
	};
	
	/**
	 * imageUrl 앞에 scene7domain을 붙여준다
	 * 
	 * @param imgUrl 이미지 url
	 * @param presetType : lazy, desktop, mobile, none 
	 * @return newUrl scene7domain 을 붙인 imgUrl
	 */
	function clImgDomain(imgUrl, presetType) {
		let newUrl = "";
		let useScene7domain = clScene7domain;
		if(fnIsNull(imgUrl) || imgUrl.indexOf("http:") > -1 || imgUrl === "" || imgUrl.indexOf("//image-us.samsung.com/") > -1 || 
				imgUrl.indexOf("//stg-images.samsung.com.cn/") > -1 || imgUrl.indexOf("//images.samsung.com.cn/") > -1 || imgUrl.indexOf("image.samsung.com.cn/") > -1 ||
				imgUrl.indexOf("//stg-images.samsung.com/") > -1 || imgUrl.indexOf("//images.samsung.com/") > -1 || imgUrl.indexOf("image.samsung.com/") > -1){
			newUrl = imgUrl;
		}else{
			newUrl = useScene7domain + imgUrl;
		}
		
		if(newUrl.indexOf("?$") < 0){
			if(presetType === "lazy"){
				newUrl += clPrdPreset(clImageLazyloadPreset);
			}else if (presetType === "desktop"){
				newUrl += clPrdPreset(clImagePresetDesktop);
			}else if (presetType === "mobile"){
				newUrl += clPrdPreset(clImagePresetMobile);
			}
		}
		return newUrl;
	};
	// saveText EURO -> KUNA  변환
	/**
	var euroToKunaPrice = function(saveText){
		let tempDecimalPoint = Math.pow(10, 2);
		let euroPriceTemp = Number(saveText)*7.53450;
		euroPriceTemp = Math.round(euroPriceTemp * tempDecimalPoint) / tempDecimalPoint;
		return currencyComma(euroPriceTemp, "HRK");
	}*/
	// 할인율
	var getDiscountRate = function(savePrice, originPrice){
		let tempDecimalPoint = Math.pow(10, 2);
		let discountRateTemp = Number(savePrice) / Number(originPrice) * tempDecimalPoint;
		discountRateTemp = Number(discountRateTemp).toFixed(2);
		return discountRateTemp.replace('.', ',');
	}
	/**
	 * Price 영역
	 * 
	 * Global - monthlyPriceInfo, priceDisplay, formattedPriceSave
	 * Hybris-Intg - monthlyPriceInfo, priceDisplay, promotionPriceDisplay, price, promotionPrice
	 * GPv2 - leasingInfo, priceDisplay, promotionPriceDisplay, listPriceDisplay, price. promotionPrice, listPrice
	 * b2bHybris - priceDisplay, promotionPriceDisplay, listPriceDisplay, price. promotionPrice, listPrice
		<promotionPrice 에 표시하는 우선순위>
		SMB User (VAT OFF): taxExTieredPrice > smbPromotionPrice > taxExPrice
		SMB USer (VAT ON) : tieredPrice > smbPromotionPrice > promotionPrice
		Guest User : promotionPrice
	 */
	function buildPriceArea(product, upperStock){
		originPrice = ""; // 기본 가격 (Tagging Data)
		discountPrice = ""; // 할인후 가격  (Tagging Data)
	
		let productCardTemplate = "";
		let frontModel = product.modelList[product.frontModelIdx];
		let priceDisplay = frontModel.priceDisplay;
		let priceTextForCompare = "";
		
		let useTieredPrice = false;
		let useSMBPromotionPrice = false;
		if(isSMBUser){
			if(isNotNull(frontModel.tieredPriceDisplay) && isTieredPriceSite && frontModel.tieredPriceDisplayYN === "Y"){
				useTieredPrice = true;
			} else if(isNotNull(frontModel.smbPromotionPriceDisplay)){
				useSMBPromotionPrice = true;
			}
		}
		
		if((clSiteCode === "nl" || clSiteCode === "be" || clSiteCode === "be_fr") && isNotNull(priceDisplay)){
			priceDisplay = deleteCurrency(priceDisplay, clPriceCurrency);
		}
		
		let usePriceArea = false;
		if(clPriceDisplayYn === "Y" && isNotNull(priceDisplay) && clSiteCode !== "mx" && (clSiteCode !== "pl" || upperStock !== "OUTOFSTOCK")){
			/* pl 국가이면서 Out Of Stock일경우 가격 미노출 */
			usePriceArea = true;
		}
		
		//Hybris Intg > tradeIn price text 표시
		let tradeInPriceText = "";
		if(clIsHybrisIntg && isNotNull(frontModel.tradeInPriceText)) {
			tradeInPriceText = frontModel.tradeInPriceText;
		}
		
		// Samcol Only 추가
		let covatClass = "";
		if(clSiteCode === "co" && frontModel.vatEligible === "true"){
			covatClass = " compare-popup__price--samcol";
		}
		let seiClass = "";
		if(clSiteCode === "it"){
			seiClass = " compare-popup__price--sei";
		}
		productCardTemplate +=
			'<div class="compare-popup__price'+covatClass + seiClass+'">';
		if(usePriceArea){
			let promotionDisplay = "";
			let currentDisplay = priceDisplay;
			
			// tagging data - originPrice Set ( data-modelprice )
			if(isNotNull(frontModel.price)){
				originPrice = frontModel.price;
			} else if( isNotNull(frontModel.priceDisplay)){
				originPrice = deleteCurrencyComma(frontModel.priceDisplay, clPriceCurrency);
			}
			
			// monthlyPrice data
			let useMonthlyPrice = false;
			let monthlyPrice = "";
			let tenureVal = "";
			
			// leasingInfo data
			let useLeasingInfo = false;
			let leasingInterest = "";
			let downPaymentFormatted = "";
			let tenureUnit = "";
			let monthlyRate = "";
			
			// [US-EppDiscount] US Epp Discount Price 
			let usEppCurrentPrice = 0; // epp discount 적용된 가격
			let usEppSavePrice = 0;
			let usDefaultCurrentPrice = 0; // epp discount 전 기본 할인가격 
			let usCurrentPriceAttr = "";
			let usSuggestPriceAttr = "";
			let usUseTradeInDiscount = false;
			
			if(clSiteCode === "us"){
				// 기본 가격정보 셋팅 ( exit epp 할 경우 api 호출 없이 가격정보만 변경처리 )
				usDefaultCurrentPrice = frontModel.price;
				let usPromotionPriceForTradeIn = frontModel.listPrice;
				if(isNotNull(frontModel.promotionPrice)){
					usDefaultCurrentPrice = frontModel.promotionPrice;
					usPromotionPriceForTradeIn = frontModel.promotionPrice;
				}
				
				//[US] tradeInDiscount 가 있는 경우 > listPrice : 원가 , tradeInDiscount : save
				if(isNotNull(frontModel.tradeInDiscount) && isNotNull(frontModel.listPrice) 
						&& frontModel.tradeInDiscount != 0 && frontModel.listPrice != 0 && Number(frontModel.listPrice) > Number(frontModel.tradeInDiscount)){
					usUseTradeInDiscount = true;
					priceDisplay = currencyComma(frontModel.listPrice, clPriceCurrency);
					usDefaultCurrentPrice = Number(usPromotionPriceForTradeIn) - Number(frontModel.tradeInDiscount);
					currentDisplay = 'From '+currencyComma(usDefaultCurrentPrice, clPriceCurrency)+' with trade-in<sup>θ</sup>';
					
					// tagging data - originPrice Set ( data-modelprice )
					originPrice = frontModel.listPrice;
					// tagging data - discountPrice Set ( data-discountprice )
					discountPrice = usDefaultCurrentPrice;
				}
				
				usCurrentPriceAttr = ' data-de-currentprice="'+usDefaultCurrentPrice+'"';
				if(usUseTradeInDiscount){
					usCurrentPriceAttr += ' data-de-use-tradein="true"';
				}
				usSuggestPriceAttr = ' data-de-originpricetxt="'+priceDisplay+'"';
				
				// US Epp 가격표시 관련 정보 셋팅
				if((isNotNull(frontModel.prdSavePriceInf) || isNotNull(frontModel.tradeDiscountPrice)) && isNotNull(frontModel.prdPriceInf)){
					usEppSavePrice = 0;
					if(isNotNull(frontModel.prdSavePriceInf)){
						usEppSavePrice += frontModel.prdSavePriceInf;
					}
					if(isNotNull(frontModel.tradeDiscountPrice)){
						usEppSavePrice += frontModel.tradeDiscountPrice;
					}
					
					// US Epp 할인 가격 : prdSavePriceInf + tradeDiscountPrice
					usEppCurrentPrice = frontModel.prdPriceInf - usEppSavePrice;
					
					// tagging data - originPrice Set ( data-modelprice )
					originPrice = frontModel.prdPriceInf;
					// tagging data - discountPrice Set ( data-discountprice )
					discountPrice = usEppCurrentPrice;
				}
			}
			//new-hybris
			if(clIsGPv2 || isNewHybris || isB2bhybris){
				if(isNotNull(frontModel.leasingInfo) && clSiteCode === "nl" && frontModel.upgrade === "Y"){
					// nl 사이트만 leasingInfo 사용
					let leasingInfo = frontModel.leasingInfo;
					monthlyRate = deleteCurrency(leasingInfo.monthlyRate, clPriceCurrency);
					tenureVal = leasingInfo.tenureVal;
					downPaymentFormatted = deleteCurrency(leasingInfo.downPaymentFormatted, clPriceCurrency);
					tenureUnit = leasingInfo.tenureUnit;
					
					useLeasingInfo = true;
					
				}else if( isNotNull(frontModel.monthlyPriceInfo) 
						&& isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) && isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && isNotNull(frontModel.monthlyPriceInfo.interest)){
					let monthlyPriceInfo = frontModel.monthlyPriceInfo;
					monthlyPrice = currencyComma(monthlyPriceInfo.leasingMonthly, clPriceCurrency);
					tenureVal = monthlyPriceInfo.leasingMonths;
					leasingInterest = monthlyPriceInfo.interest;
					
					useMonthlyPrice = true;
				}
				
				promotionDisplay = frontModel.promotionPriceDisplay;
				if(isB2b && isLogedin && isSMBUser){
					if(useTieredPrice){
						promotionDisplay = frontModel.tieredPriceDisplay;
					} else if(useSMBPromotionPrice){
						promotionDisplay = frontModel.smbPromotionPriceDisplay;
					}
					
					if(useTaxExPrice){
						if(isTieredPriceSite && _trimToNull(frontModel.taxExTieredPrice)){
							promotionDisplay = frontModel.taxExTieredPriceDisplay 
						} else {
							promotionDisplay = frontModel.taxExPriceDisplay;
						}
					}
				}
				
				if((clSiteCode === "be" || clSiteCode === "be_fr" || clSiteCode === "nl") && isNotNull(promotionDisplay)){
					promotionDisplay = deleteCurrency(promotionDisplay, clPriceCurrency);
				}
				//[EPP] nl/be/be_fr leasing 정보사용 예외처리 (2022.08.24)
				if((clSiteCode==="nl" || clSiteCode==="be" || clSiteCode ==="be_fr" || siteCode ==="pl") && isEppSite){
					useLeasingInfo = false;
					useMonthlyPrice = false;
				}
			} else {
				if(isNotNull(frontModel.monthlyPriceInfo) && 
						isNotNull(frontModel.monthlyPriceInfo.leasingMonthly) && isNotNull(frontModel.monthlyPriceInfo.leasingMonths) && 
						(clSiteCode === "au" || clSiteCode === "nz" || clSiteCode === "ae" || clSiteCode === "my" || clSiteCode === "sg" || clSiteCode === "ca" || clSiteCode === "ca_fr" || 
						clSiteCode === "it" || clSiteCode === "se" || clSiteCode === "dk" || clSiteCode === "fi" || clSiteCode === "no" || clSiteCode === "es" || clSiteCode === "pt" || 
						clSiteCode === "th" || clSiteCode === "tw" || clSiteCode === "ru" || clSiteCode === "ch" || clSiteCode === "ch_fr")){
					let monthlyPriceInfo = frontModel.monthlyPriceInfo;
					monthlyPrice = currencyComma(monthlyPriceInfo.leasingMonthly, clPriceCurrency);
					tenureVal = monthlyPriceInfo.leasingMonths;
					
					useMonthlyPrice = true;
				}
				if(clIsHybrisIntg){
					promotionDisplay = frontModel.promotionPriceDisplay;
				}
			}
			
			if(isNotNull(promotionDisplay) && !usUseTradeInDiscount){
				currentDisplay = promotionDisplay;
			}
			
			//price area build
			let monthlyPriceInfoDesc = "";
			// SAMCOL VAT free
			if(isNotNull(covatClass)){
				
				productCardTemplate +=
					'<p class="compare-popup__samcol-price"><strong>'+Granite.I18n.get("Price without VAT")+': '+frontModel.vatFreePriceDisplay+'</strong></p>';
				if(isNotNull(promotionDisplay)){
					productCardTemplate +=
						'<p class="compare-popup__samcol-special"><strong>'+Granite.I18n.get("Price with discount")+': '+promotionDisplay+'</strong></p>';
				}
				productCardTemplate +=
					'<p class="compare-popup__samcol-rrp">'+Granite.I18n.get("Price before")+': <del>'+priceDisplay+'</del></p>';

			}else{	
				if((upperStock === "NOORDER" || upperStock === "LEARNMORE") && 
						(clSiteCode === "nl" || clSiteCode === "be" || clSiteCode === "be_fr")){
					productCardTemplate +=
						'<div class="compare-popup__price-current" data-pricetext="'+priceDisplay+'">'+
							'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
							'<span class="compare-popup__price-current-payment">'+priceDisplay+'</span>'+
						'</div>';
				}else if(((clIsGPv2 || isNewHybris || isB2bhybris) && upperStock !== "LEARNMORE" && upperStock !== "NOORDER") || 
						(!clIsGPv2 && !isNewHybris && !isB2bhybris && upperStock !== "LEARNMORE")){				//new-hybris
					if(isNotNull(tradeInPriceText)){
						productCardTemplate +=
							'<div class="compare-popup__price-current" data-pricetext="'+tradeInPriceText+'">'+
								'<span class="compare-popup__price-current-text">'+
									tradeInPriceText+
								'</span>'+
							'</div>';
					}else if(useMonthlyPrice && !usUseTradeInDiscount){
						priceTextForCompare = 
							Granite.I18n.get("From {0}/mo",[monthlyPrice])+' ';
						if(leasingInterest !== "" && siteCode !== "pe"){
							priceTextForCompare += 
								Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, leasingInterest])+' ';
						} else {
							priceTextForCompare += 
								Granite.I18n.get("for {0} mos",[tenureVal])+' ';
						}
						monthlyPriceInfoDesc = priceTextForCompare;
						priceTextForCompare += 
							Granite.I18n.get("or")+' ';
						
						let priceTextForCompareAttr = 
							' data-pricetext="'+priceTextForCompare+currentDisplay+'"';
							
						if(clSiteCode === "us"){
							if(isNotNull(usEppCurrentPrice) && usEppCurrentPrice !== 0){
								let eppPriceTextForCompare = 
									Granite.I18n.get("From {0}/mo",[monthlyPrice])+
									' '+ Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, leasingInterest])+
									' '+ Granite.I18n.get("or")+' '+currencyComma(usEppCurrentPrice, clPriceCurrency);
								priceTextForCompareAttr = ' data-pricetext="'+eppPriceTextForCompare+'" data-use-epp-discount="true"';
								currentDisplay = currencyComma(usEppCurrentPrice, clPriceCurrency);
							}
							
							priceTextForCompareAttr += ' data-de-pricetext="'+priceTextForCompare+'" data-de-currentprice="'+usDefaultCurrentPrice+'"'+
							' data-use-monthly="true"';
						}
						if(clSiteCode === "it"){
							productCardTemplate +=
								'<div class="compare-popup__price-current"'+priceTextForCompareAttr+usCurrentPriceAttr+'>'+
									'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
									'<span class="compare-popup__price-current-payment">'+currentDisplay+'</span>'+
								'</div>';
						}else{
							productCardTemplate +=
								'<div class="compare-popup__price-current"'+priceTextForCompareAttr+'>'+
									'<span class="hidden">'+Granite.I18n.get("Monthly Price")+': </span>'+
									'<span class="compare-popup__price-current-text">'+
										Granite.I18n.get("From {0}/mo",[monthlyPrice])+
										' ';
										if(leasingInterest !== "" && siteCode !== "pe" && siteCode !== "de"){
											productCardTemplate += 
												Granite.I18n.get("for {0} mos at {1}% APR",[tenureVal, leasingInterest]);
										} else {
											productCardTemplate += 
												Granite.I18n.get("for {0} mos",[tenureVal]);
										}
									productCardTemplate +=
									'</span>'+
									'<span class="compare-popup__price-current-payment"'+usCurrentPriceAttr+'>'+ 
										'<span class="compare-popup__price-current-text">'+ Granite.I18n.get("or") +'</span>'+
										currentDisplay+
									'</span>'+
								'</div>';
						}
					}else if(useLeasingInfo){
						if(downPaymentFormatted !== "" && tenureUnit !== "" && tenureVal !== "" && monthlyRate !== ""){
							let leasingText = " " + downPaymentFormatted + " + " + 
							tenureVal + " x " +
							monthlyRate + "/" + 
							Granite.I18n.get(tenureUnit);
							
							priceTextForCompare = currentDisplay + ' '+Granite.I18n.get("or")+' ' + leasingText;
								
							let priceTextForCompareAttr = 
								' data-pricetext="'+priceTextForCompare+'"';
							
							productCardTemplate +=
								'<div class="compare-popup__price-current"'+priceTextForCompareAttr+'>'+
									'<span class="hidden">'+Granite.I18n.get("Monthly Price")+': </span>'+
									'<span class="compare-popup__price-current-text">'+ 
										currentDisplay+
									'</span>'+
									'<span class="compare-popup__price-current-payment">'+
										'<span class="compare-popup__price-current-text">'+ Granite.I18n.get("or") +'</span>'+
										leasingText+
									'</span>'+
								'</div>';
						}
					} else {
						let priceTextForCompareAttr = ' data-pricetext="'+currentDisplay+'"';
						let defaultCurrentDisplay = currentDisplay;
								
						if(clSiteCode === "us"){
							if(isNotNull(usEppCurrentPrice) && usEppCurrentPrice !== 0){
								currentDisplay = currencyComma(usEppCurrentPrice, clPriceCurrency);
								let tmp_pricetext = currentDisplay;
								if(frontModel.tradeDiscountPrice > 0){
									// tradeDiscount 가 있는경우 아래 문구로 표시
									tmp_pricetext = 'From '+currentDisplay+' with trade-inθ';
									currentDisplay = 'From '+currentDisplay+' with trade-in<sup>θ</sup>';
								}
								priceTextForCompareAttr = ' data-pricetext="'+tmp_pricetext+'" data-use-epp-discount="true"';
							}
							priceTextForCompareAttr += ' data-de-pricetext="'+defaultCurrentDisplay+'" data-use-monthly="false"';
						}
						productCardTemplate +=
							'<div class="compare-popup__price-current"'+priceTextForCompareAttr+usCurrentPriceAttr+'>'+
								'<span class="hidden">'+Granite.I18n.get("Current Price")+': </span>'+
								'<span class="compare-popup__price-current-payment">'+currentDisplay+'</span>'+
							'</div>';
					}
					
					//Save Text 영역 STR
					productCardTemplate +=
							'<div class="compare-popup__price-next">';
					if(clIsGPv2 || isNewHybris || isB2bhybris){				//new-hybris
						if(isNotNull(promotionDisplay) || usUseTradeInDiscount){
							let listPrice = 0;
							if(frontModel.listPrice !== null){
								listPrice = parseFloat(frontModel.listPrice) - parseFloat(frontModel.price);
							}
							
							let savePrice = parseFloat(frontModel.price) - parseFloat(frontModel.promotionPrice);
							if(useTieredPrice){
								savePrice = parseFloat(frontModel.price) - parseFloat(frontModel.tieredPrice);
							} else if(useSMBPromotionPrice){
								savePrice = parseFloat(frontModel.price) - parseFloat(frontModel.smbPromotionPrice);
							}
							
							// US Epp Exit 시 원래 save 가격 표시를 위한 attr
							let usOriginSaveAttr = "";
							if(clSiteCode === "us"){
								let usOriginSaveText = isNotNull(frontModel.saveText) && savePrice > 0 ? frontModel.saveText : 0;
	
								if(usUseTradeInDiscount){
									savePrice = Number(frontModel.listPrice) - Number(discountPrice);
									usOriginSaveText = currencyComma(savePrice, clPriceCurrency);
									frontModel.saveText = usOriginSaveText;
								}
								usOriginSaveAttr = ' data-de-saveprice="'+usOriginSaveText+'"';
							}
							
							if(clSiteCode === "us" && usEppSavePrice > 0){
								// us epp save price 가 있는 경우
								productCardTemplate +=
									'<span class="compare-popup__price-suggested"'+usSuggestPriceAttr+'>'+
										'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
										'<del>'+currencyComma(frontModel.prdPriceInf, clPriceCurrency)+'</del>'+
									'</span>'+
									'<span class="compare-popup__price-save"'+usOriginSaveAttr+'>'+
										'<span class="compare-popup__price-save-text">'+Granite.I18n.get("Save {0}", [currencyComma(usEppSavePrice, clPriceCurrency)])+'</span>'+
									'</span>';
							//COMP6FE-1599 [EPP] SEPOL MSRP Price 추가건 : && !(isEppSite && clSiteCode === "pl") 추가								
							}else if(savePrice !== 0 && isNotNull(frontModel.saveText) && !(isEppSite && clSiteCode === "pl")){
								let saveText = frontModel.saveText;
								if(useTieredPrice || useSMBPromotionPrice || eppIsUserGroupPricing){
									saveText = savePrice;
								}
								productCardTemplate += 
									'<span class="compare-popup__price-suggested"'+usSuggestPriceAttr+'>'+
										'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>';
								if(clSiteCode === "nl" || clSiteCode === "be" || clSiteCode === "be_fr" || clSiteCode === "de"){
									/* SEBN, DE 국가 정상가 앞에 From 문구 추가*/
									productCardTemplate += Granite.I18n.get("From {0}",['<del>'+priceDisplay+'</del>']);
								}else{
									productCardTemplate += '<del>'+priceDisplay+'</del>';
								}
								productCardTemplate +=
									'</span>';
								if(clSiteCode !== "nl" && clSiteCode !== "be" && clSiteCode !== "be_fr" && !(isStrikethroughRmSite && frontModel.lowestWasPriceUseYn !== "Y")){
									/* GPv2 국가 save 문구 노출
									 * SEBN 국가 save 문구 미노출 처리
									 * lowestWasPrice 국가중 lowestWasPrice 해당 없는 국가 미노출 처리
									 */
									productCardTemplate +=
									'<span class="compare-popup__price-save">'+
										'<span class="compare-popup__price-save-text">'+Granite.I18n.get("Save {0}", [currencyComma(saveText, clPriceCurrency)])+'</span>'+
									'</span>';
								}
								
								if(!usUseTradeInDiscount){
									// tagging data - discountPrice Set ( data-discountprice )
									discountPrice = frontModel.promotionPrice;
								}
							}else if(clSiteCode === "us"){
								//savePrice 가 없는 경우 Epp 선택 후 사용할 save 영역 생성
								productCardTemplate += 
									'<span class="compare-popup__price-suggested" style="display:none;"'+usSuggestPriceAttr+'>'+
										'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
										'<del>'+priceDisplay+'</del>'+
									'</span>'+
									'<span class="compare-popup__price-save"'+usOriginSaveAttr+' style="display:none;"></span>';
							}else if(listPrice > 0 && (clSiteCode === "nl" || clSiteCode === "be" || clSiteCode === "be_fr")){
								productCardTemplate += 
									'<span class="compare-popup__price-suggested">'+
										'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
										'<span>'+Granite.I18n.get("Listprice")+'</span>  '+
											currencyComma(frontModel.listPrice,clPriceCurrency)+
									'</span>';
							}
						}else{
							// US Epp Exit 시 원래 save 가격 표시를 위한 attr
							let usOriginSaveAttr = ' data-de-saveprice="0"';
							if(clSiteCode === "us"){
								let savePriceStyle = ' style="display:none;"';
								if(isNotNull(usEppSavePrice) && usEppSavePrice != 0){
									//Epp Save 정보가 있는 경우 Show 처리
									savePriceStyle = '';
								}
								productCardTemplate += 
									'<span class="compare-popup__price-suggested"'+savePriceStyle+usSuggestPriceAttr+'>'+
										'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
										'<del>'+priceDisplay+'</del>'+
									'</span>'+
									'<span class="compare-popup__price-save"'+savePriceStyle+usOriginSaveAttr+'>'+
										'<span class="compare-popup__price-save-text">'+Granite.I18n.get("Save {0}", [currencyComma(usEppSavePrice, clPriceCurrency)])+'</span>'+
									'</span>';
							}
						}
					} else if (clIsHybrisIntg){
						if(isNotNull(frontModel.promotionPrice) && isNotNull(frontModel.promotionPriceDisplay) && (Number(frontModel.price) > Number(frontModel.promotionPrice))){
							// tagging data - discountPrice Set ( data-discountprice )
							discountPrice = frontModel.promotionPrice;
								
							//promotionPrice 를 사용하는 경우
							productCardTemplate += 
								'<span class="compare-popup__price-suggested">'+
									'<span class="hidden">'+Granite.I18n.get("Original Price")+': </span>'+
									'<del>'+priceDisplay+'</del>'+
								'</span>';
						}
					}else{
						if(siteCode === "it"){
							if(isNotNull(frontModel.lowestWasPrice) && isNotNull(frontModel.promotionPrice) 
									&& frontModel.promotionPrice < frontModel.lowestWasPrice
									){
								let savePrice = parseFloat(frontModel.lowestWasPrice) - parseFloat(frontModel.promotionPrice);
								let savePriceText = "";
								if(siteCode === "it"){
									savePriceText = Granite.I18n.get("Save the {0}%", [getDiscountRate(savePrice, frontModel.lowestWasPrice)]);
								}else{
									savePriceText = Granite.I18n.get("Save {0}", [currencyComma(savePrice, clPriceCurrency)]);
								}
								
								productCardTemplate += `
								<span class="compare-popup__price-suggested">
									<span class="hidden">${Granite.I18n.get("Original Price")}: </span>
									<del>${frontModel.lowestWasPriceDisplay}</del>
									<span class="compare-popup__price-save"><span class="compare-popup__price-save-text">${savePriceText}</span>
								</span>
								`;
							}
						}else{
							//global
							if(isNotNull(frontModel.formattedPriceSave)){
								productCardTemplate += '<span class="compare-popup__price-suggested">' + frontModel.formattedPriceSave + '</span>';
							}
						}
					}
					
					productCardTemplate += 
							'</div>';
					//Save Text 영역 END
					//
					//monthlyPriceInfoDesc
					if(clSiteCode === "it"){
						productCardTemplate +=`
						<div class="compare-popup__price-description">
							<button type="button"><span>${monthlyPriceInfoDesc}</span></button>
						</div>
						`;
					}
				}
			}
		}
		productCardTemplate +=
				'</div>';
				
		if(usePriceArea && clSiteCode === "us"){
			let includeText = '';
			let includeStyle = ' style="display:none;"';
			let tsgmt = isNotNull($.cookies.get("tsgmt")) ? $.cookies.get("tsgmt").toString() : '';
			
			if(isNotNull(frontModel.prdSavePriceTI) && isNotNull(tsgmt)){
				includeText +=
					'Includes '+frontModel.prdSavePriceTI+' '+tsgmt+' Discount';
				includeStyle = '';
			}
			productCardTemplate +=
				'<div class="compare-popup__epp">'+
					'<p class="compare-popup__epp-text"'+includeStyle+'>'+
						includeText+
					'</p>'+
				'</div>';
		}
		
		if(usePriceArea && clSiteCode === "ee" || clSiteCode === "lt" || clSiteCode === "lv"){
			if(isNotNull(frontModel.pricePeriodInfo)){
				productCardTemplate +=
					'<div class="compare-popup__epp">'+
						'<p class="compare-popup__epp-text">'+
							frontModel.pricePeriodInfo+
						'</p>'+
					'</div>';
			} else {
				productCardTemplate +=
					'<div class="compare-popup__epp"></div>';
			}
		}
		
		return productCardTemplate;
	};
	
	/**
	 * viewOptionObj : 현재 그리고 있는 Product 의 전체 옵션정보
	 * optionChip 선택 시 화면에 표시해 줄 sku의 index 를 반환함
	 * selectOptionMoIdx : 현재 선택한 옵션의 moidx 값 
	 * otherSelectedOptionMoIdxList : 현재 선택한 타입을 제외한 타입중 선택된 나머지 옵션 리스트
	 * isColorType : 현재 타입이 color 인지에 대한 여부
	 * optionTypeList : 현재 그리고있는 Product 의  optionTypeList 
	 */
	function getSelectedModelIdx(viewOptionObj, selectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, optionTypeList){
		let modelIdx = 0;
		let modelIdxList = selectOptionMoIdx.split(',');
		let firstIdx = modelIdxList[0];
		let memoryIdx = optionTypeList.indexOf("MEMORY");
		//new-hybris
		if(!clIsGPv2 && !isNewHybris && !isB2bhybris && isColorType && memoryIdx > 0){
			// [global, hybrisIntg] 상위 옵션이 color 이고, 하위에 같이 바뀌는 옵션이 memory 일 때 가장 큰값으로 선택처리
			
			let memoryOptionList = viewOptionObj["MEMORY"].optionList;
			let selectedModelIdx = 0;
			let highestOption = 0;
			for(let moi in memoryOptionList){
				let temp_mi = memoryOptionList[moi].modelIdx.split(',');
				for(let tmi in temp_mi){
					// 선택한 옵션칩의 modelIdx 리스트에 해당하는 model idx 가 있으면  비교 
					if(arrayContains(modelIdxList, temp_mi[tmi])){
						let this_memory_num = memoryOptionList[moi].optionCode.replace("TB","000").replace(/[^0-9]/g,"");
						if(highestOption < this_memory_num){
							highestOption = this_memory_num;
							selectedModelIdx = temp_mi[tmi];
						}
						break;
					}
				}
			}
			modelIdx = selectedModelIdx;
			
		} else {
			let selectModelIdxList = [];
			let tempMappingModelIdx = [];
			
			for(let omi in otherSelectedOptionMoIdxList){
				let otherMoIdx = otherSelectedOptionMoIdxList[omi];
				if(isNotNull(otherMoIdx)){
					let otherMoIdxArr = otherMoIdx.split(',');

					tempMappingModelIdx = [];
					for(let mli in modelIdxList){
						if(otherMoIdxArr.indexOf(String(modelIdxList[mli]))>-1) {
							tempMappingModelIdx.push(modelIdxList[mli]);
						}
					}
					if(tempMappingModelIdx.length > 0){
						modelIdxList = tempMappingModelIdx;
					}
				}
			}
			if(modelIdxList.length > 0){
				modelIdx = modelIdxList[0];
			} else {
				modelIdx = firstIdx;
			}
		}
		
		return modelIdx;
	};
	/*
	* multiColor 유무, optionColorType에 따른 colorOptionHtml 작성(C1타입은 없음)
	*/
	var getColorOptionHtml = function(currentOption, isSelected){
		var resultColorOptionHtml = "";
		let colorOpt = ``;
		// multiColor 인경우
		if(isNotNull(currentOption.multiColorYN) && currentOption.multiColorYN === "Y"){
			const multiColorList = currentOption.multiColorList;
			const optionColorType = multiColorList.optionColorType;
			const optionCodeList = multiColorList.optionCodeList ?? [];
	
			const color1 = optionCodeList.length > 0? optionCodeList[0]: "";
			const color2 = optionCodeList.length > 1? optionCodeList[1]: "";
			const color3 = optionCodeList.length > 2? optionCodeList[2]: "";
			const color4 = optionCodeList.length > 3? optionCodeList[3]: "";
			const color5 = optionCodeList.length > 4? optionCodeList[4]: "";
			const color6 = optionCodeList.length > 5? optionCodeList[5]: "";
			
			if(optionColorType === "C1") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36" height="35.999" viewBox="0 0 36 35.999">
						<g transform="translate(-18.001 9)">
							<rect width="36" height="35.999" transform="translate(18.001 -9)" fill="none" />
							<path d="M18,0A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="${color1}" />
							<path d="M18,1A17,17,0,0,0,5.979,30.019,17,17,0,1,0,30.02,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="rgba(0,0,0,0.5)" />
						</g>
					</svg>
				`;
			} else if(optionColorType === "C2_A") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(-17.999 9)">
							<rect width="36" height="36" transform="translate(18 -9)" fill="none" />
							<g>
								<path d="M-3395,7250a18,18,0,0,1,18-18h0v36h0A18,18,0,0,1-3395,7250Z" transform="translate(3413 -7241)" fill="${color1}" />
								<path d="M-3377,7232a18,18,0,0,1,18,18,18,18,0,0,1-18,18Z" transform="translate(3413 -7241)" fill="${color2}" />
								<path d="M18,1A17,17,0,0,0,5.979,30.019,17,17,0,1,0,30.02,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(17.999 -9)" fill="rgba(0,0,0,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "C2_B") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(-17.999 9)">
							<rect width="36" height="36" transform="translate(18 -9)" fill="none" />
							<g>
								<path d="M-3395,7250a18,18,0,0,1,18-18,18,18,0,0,1,18,18Z" transform="translate(3413 -7241)" fill="${color1}" />
								<path d="M-3395,7250h36a18,18,0,0,1-18,18A18,18,0,0,1-3395,7250Z" transform="translate(3413 -7241)" fill="${color2}" />
								<path d="M18,1A17,17,0,0,0,5.979,30.019,17,17,0,1,0,30.02,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(17.999 -9)" fill="rgba(0,0,0,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "C3_A") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(27.001 -17.999) rotate(90)">
							<rect width="36" height="36" transform="translate(18 -9)" fill="none" />
							<g transform="translate(18 -3.005) rotate(-90)">
								<path d="M-1047.672,8501.792a18.1,18.1,0,0,1-1.321-6.168c0-.027,0-.056,0-.083s0-.06,0-.09a18.092,18.092,0,0,1,1.906-8.522c.009-.017.017-.036.028-.053.017-.036.034-.068.051-.1.028-.054.058-.109.085-.162,0,0,0,0,0-.007.109-.205.22-.405.337-.608l0,0a18.019,18.019,0,0,1,1.92-2.717,18.076,18.076,0,0,1,2.2-2.157,18.042,18.042,0,0,1,2.467-1.712,18.109,18.109,0,0,1,2.674-1.264,18.212,18.212,0,0,1,3.76-.967.18.18,0,0,0,.032,0,.045.045,0,0,0,.017,0A18.394,18.394,0,0,1-1031,8477v18h0l-15.583,9A18.227,18.227,0,0,1-1047.672,8501.792Z" transform="translate(1019 -8477.001)" fill="${color1}" />
								<path d="M-1049,8494.994h0v-18a18.692,18.692,0,0,1,2.051.115,18.089,18.089,0,0,1,4.971,1.313.644.644,0,0,0,.068.025.02.02,0,0,0,.015.009,17.41,17.41,0,0,1,1.889.95,18.359,18.359,0,0,1,2.047,1.374c.015.013.032.023.047.036s.034.028.051.041a18.122,18.122,0,0,1,4.446,5.135h0a18.843,18.843,0,0,1,.9,1.783l.045.1s0,0,0,0a18.093,18.093,0,0,1,1.462,6.915c0,.023,0,.047,0,.073v.1a18.107,18.107,0,0,1-1.622,7.482l-.032.073c-.009.019-.019.038-.028.058-.22.474-.463.94-.73,1.4Z" transform="translate(1037.001 -8477)" fill="${color2}" />
								<path d="M-1034.289,8494.979a18.08,18.08,0,0,1-9.093-2.986c-.017-.013-.036-.023-.053-.036a.663.663,0,0,1-.062-.043,18.052,18.052,0,0,1-4.213-3.972l-.1-.128a18.141,18.141,0,0,1-1.2-1.816l15.589-9,15.585,9a18.048,18.048,0,0,1-2.04,2.858.119.119,0,0,1-.015.016l-.077.089a18.1,18.1,0,0,1-2.673,2.456l-.026.02-.1.077a18.052,18.052,0,0,1-9.792,3.466c-.051,0-.1.007-.158.007a.029.029,0,0,1-.013,0c-.228.009-.458.013-.689.013C-1033.709,8495-1034,8495-1034.289,8494.979Z" transform="translate(1021.412 -8459.007)" fill="${color3}" />
								<path d="M18,1A17,17,0,0,0,5.979,30.021,17,17,0,1,0,30.021,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(-30.004 0)" fill="rgba(29,29,27,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "C3_B") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(-17.999 -4)">
							<rect width="36" height="36" transform="translate(18 4)" fill="none" />
							<g transform="translate(17.999 4.001)">
								<path d="M0,18A18.006,18.006,0,0,1,12,1.024v33.95A18.006,18.006,0,0,1,0,18Z" transform="translate(0 0)" fill="${color1}" />
								<path d="M0,34.974V1.024a18.086,18.086,0,0,1,12,0v33.95a18.085,18.085,0,0,1-12,0Z" transform="translate(12 0)" fill="${color2}" />
								<path d="M0,16.975A18.007,18.007,0,0,0,12,33.95V0A18.007,18.007,0,0,0,0,16.975Z" transform="translate(36 34.975) rotate(180)" fill="${color3}" />
								<path d="M18,35A17,17,0,0,0,30.02,5.979,17,17,0,1,0,5.979,30.019,16.889,16.889,0,0,0,18,35m0,1A18,18,0,1,1,36,18,18,18,0,0,1,18,36Z" transform="translate(0)" fill="rgba(29,29,27,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "C3_C") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36">
						<g transform="translate(-18 -4)">
							<rect width="36" height="36" transform="translate(18 4)" fill="none" />
							<g transform="translate(53.999 4) rotate(90)">
								<path d="M0,18A18.006,18.006,0,0,1,12,1.024v33.95A18.006,18.006,0,0,1,0,18Z" transform="translate(0 0)" fill="${color1}" />
								<path d="M0,34.974V1.024a18.086,18.086,0,0,1,12,0v33.95a18.085,18.085,0,0,1-12,0Z" transform="translate(12 0)" fill="${color2}" />
								<path d="M0,16.975A18.007,18.007,0,0,0,12,33.95V0A18.007,18.007,0,0,0,0,16.975Z" transform="translate(36 34.975) rotate(180)" fill="${color3}" />
								<path d="M18,35A17,17,0,0,0,30.02,5.979,17,17,0,1,0,5.979,30.019,16.889,16.889,0,0,0,18,35m0,1A18,18,0,1,1,36,18,18,18,0,0,1,18,36Z" transform="translate(0)" fill="rgba(29,29,27,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "C4_A") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(-17.999 9)">
							<rect width="36" height="36" transform="translate(18 -9)" fill="none" />
							<g>
								<path d="M-3395,7250a18,18,0,0,1,18-18v18Z" transform="translate(3413 -7241)" fill="${color1}" />
								<path d="M-3377,7250v-18a18,18,0,0,1,18,18Z" transform="translate(3413 -7241)" fill="${color2}" />
								<path d="M-3377,7250h18a18,18,0,0,1-18,18Z" transform="translate(3413 -7241)" fill="${color3}" />
								<path d="M-3395,7250h18v18h0A18,18,0,0,1-3395,7250Z" transform="translate(3413 -7241)" fill="${color4}" />
								<path d="M18,35A17,17,0,0,0,30.02,5.979,17,17,0,1,0,5.979,30.019,16.889,16.889,0,0,0,18,35m0,1A18,18,0,1,1,36,18,18,18,0,0,1,18,36Z" transform="translate(0)" fill="rgba(29,29,27,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else if(optionColorType === "CP") {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36.001" height="36" viewBox="0 0 36.001 36">
						<g transform="translate(-17.999 9)">
							<rect width="36" height="36" transform="translate(18 -9)" fill="none" />
							<g>
								<path d="M1.333,15.8A18.1,18.1,0,0,1,.01,9.628c0-.027,0-.055,0-.082s0-.06,0-.089A18.086,18.086,0,0,1,1.91.935L1.938.88l.053-.1L2.074.614l0-.007Q2.239.3,2.413,0L18,9,2.413,18A18.157,18.157,0,0,1,1.333,15.8Z" transform="translate(-30.005 8.994)" fill="${color1}" />
								<path d="M0,9A17.9,17.9,0,0,1,6.584,2.41,18.351,18.351,0,0,1,9.257,1.145a18.061,18.061,0,0,1,3.667-.95l.132-.019.019,0A18.137,18.137,0,0,1,15.582,0V18Z" transform="translate(-27.587 0)" fill="${color2}" />
								<path d="M0,18V0A18.223,18.223,0,0,1,2.05.115,18.011,18.011,0,0,1,7.021,1.427l.068.026a.028.028,0,0,0,.015.008,17.506,17.506,0,0,1,1.89.949,18.328,18.328,0,0,1,2.047,1.376l.046.035.052.041A18.106,18.106,0,0,1,15.585,9Z" transform="translate(-12.003 0)" fill="${color3}" />
								<path d="M0,9,15.583,0a18.31,18.31,0,0,1,.9,1.785l.045.1v0A18.087,18.087,0,0,1,18,8.808c0,.023,0,.048,0,.072s0,.064,0,.1a18.082,18.082,0,0,1-1.621,7.483l-.033.073-.027.058q-.332.71-.731,1.4Z" transform="translate(-12.004 8.997)" fill="${color4}" />
								<path d="M0,0,15.585,9a18.082,18.082,0,0,1-2.041,2.858l-.014.016-.078.089a18.166,18.166,0,0,1-2.672,2.457l-.027.02-.1.075A18.057,18.057,0,0,1,.86,17.979L.7,17.986H.688C.46,18,.23,18,0,18Z" transform="translate(-12.005 17.994)" fill="${color5}" />
								<path d="M14.717,17.98a18.082,18.082,0,0,1-9.094-2.987l-.054-.036-.062-.042A18.087,18.087,0,0,1,1.3,10.942h0l-.1-.127A18.134,18.134,0,0,1,0,9L15.589,0V18C15.3,18,15.006,17.994,14.717,17.98Z" transform="translate(-27.593 17.993)" fill="${color6}" />
								<path d="M18,1A17,17,0,0,0,5.979,30.021,17,17,0,1,0,30.021,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(-30.004 0)" fill="rgba(29,29,27,0.5)" />
							</g>
						</g>
					</svg>
				`;
			} else {
				colorOpt = `
					<svg xmlns="http://www.w3.org/2000/svg" width="36" height="35.999" viewBox="0 0 36 35.999">
						<g transform="translate(-18.001 9)">
							<rect width="36" height="35.999" transform="translate(18.001 -9)" fill="none" />
							<path d="M18,0A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="${currentOption.optionCode}" />
							<!--/* [D] 제일 마지막 태그인 path의 fill 속성 값 변경 제외 */-->
							<path d="M18,1A17,17,0,0,0,5.979,30.019,17,17,0,1,0,30.02,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="rgba(0,0,0,0.5)" />
						</g>
					</svg>
				`;
			}
		} else {
			colorOpt = `
				<svg xmlns="http://www.w3.org/2000/svg" width="36" height="35.999" viewBox="0 0 36 35.999">
					<g transform="translate(-18.001 9)">
						<rect width="36" height="35.999" transform="translate(18.001 -9)" fill="none" />
						<path d="M18,0A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="${currentOption.optionCode}" />
						<!--/* [D] 제일 마지막 태그인 path의 fill 속성 값 변경 제외 */-->
						<path d="M18,1A17,17,0,0,0,5.979,30.019,17,17,0,1,0,30.02,5.979,16.889,16.889,0,0,0,18,1m0-1A18,18,0,1,1,0,18,18,18,0,0,1,18,0Z" transform="translate(18.001 -9)" fill="rgba(0,0,0,0.5)" />
					</g>
				</svg>
			`;
		}
		let currentOptionLocalNameTag = `<span class="hidden">${currentOption.optionLocalName}</span>`;
		
		resultColorOptionHtml = `
			<span class="option-selector__color-code">
				${colorOpt}
			</span>
			${currentOptionLocalNameTag}
		`;
		return resultColorOptionHtml;
	}
	
	function clProductCardFmyOptionBuild(product){
		let productCardTemplate = "";
		let frontModel = product.modelList[product.frontModelIdx];
		/* option 없을 경우 영역 전체 삭제 */ 
		if(isNotNull(product.viewOptionObj)){
			productCardTemplate += 
				'<div class="option-selector option-selector__color-text">';
			if(isNotNull(product.viewOptionObj) && Object.keys(product.viewOptionObj).length > 0){
				// 옵션침 데이터 없을 경우 빈영역 추가
				if(Object.keys(product.viewOptionObj).length === 1){
					if(Object.keys(product.viewOptionObj)[0] !== "COLOR"){
						productCardTemplate +=
							'<div class="option-selector__wrap option-selector__wrap--color-chip unbind-option is-option-empty">'+
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list"></div>'+
									'</div>'+
								'</div>'+
							'</div>';
					}
				}
				
				// 상위 선택된 옵션칩의 model idx : disable 처리 할때 사용 ( idx에 해당되지않으면 disabled )
				let parentOptionModelIdx = "";
				let viewOptionIdx = 0;
				
				let curViewOptionObj = product.viewOptionObj;
				let curOptionTypeList = product.optionTypeList;
				
				for(let kind in product.viewOptionObj){
					let optionDataType = "";
					optionDataType = kind.toLowerCase().replace(/ /g, "-");
					
					let optionObj = product.viewOptionObj[kind].optionList;
					
					let isSelected = false;
					let currentOption = {};
					let disabledClass = '';
					let chipId = '';
					
					let selectorWrapperStyle = "";
					if(isNotNull(product.viewOptionObj[kind].styleAttr)){
						selectorWrapperStyle = product.viewOptionObj[kind].styleAttr;
					}
					
					let colorNameText = '';
					for(let option in optionObj){
						currentOption = optionObj[option];
						let modelIdxList = currentOption.modelIdx.split(',');
						if(currentOption.modelIdx !== null && arrayContains(modelIdxList, String(product.frontModelIdx))){
							colorNameText = currentOption.optionLocalName;
						}
					}
					
					if(kind === "COLOR"){
						productCardTemplate +=
							'<div class="option-selector__color-name">'+Granite.I18n.get("Color")+' : <span class="color-name-text">'+colorNameText+'</span></div>'+
							'<div class="option-selector__wrap option-selector__wrap--color-chip unbind-option" data-desktop-view="5" data-mobile-view="2">'+
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list" style="'+selectorWrapperStyle+'">';
						let curSelecteModelIdx = '';
						for(let option in optionObj){
							/* 선택되어있는(대표모델) 옵션 flag값 셋팅 */
							currentOption = optionObj[option];
							
							isSelected = false;
							let modelIdxList = currentOption.modelIdx.split(',');
							
							if(currentOption.modelIdx !== null && arrayContains(modelIdxList, String(product.frontModelIdx))){
								isSelected = true;
								curSelecteModelIdx = currentOption.modelIdx;
								disabledClass = '';
							} else {
								disabledClass = ' is-disabled';
								if(viewOptionIdx === 0){
									disabledClass = '';
								} else {
									let parentModelIdxList = parentOptionModelIdx.split(',');
									for(let mli in modelIdxList){
										//상위 선택된 옵션칩 의 model idx 에 일치하는 model idx 가 있는 경우 활성화
										if(arrayContains(parentModelIdxList, modelIdxList[mli])){
											disabledClass = '';
											break;
										}
									}
								}
							}
							
							// 각 옵션칩의 model 정보 셋팅 ( 태깅 )
							let modelCodeAttrForTagging = '';
							let modelNameAttrForTagging = '';
							let modelIdx;
							if(disabledClass === ''){
								let curSelectOptionMoIdx = currentOption.modelIdx;
								let otherSelectedOptionMoIdxList = [];
								let isColorType = true;
								for(let ooi in curViewOptionObj){
									if(ooi !== kind){
										let tmp_optionList = curViewOptionObj[ooi].optionList;
										for(let toi in tmp_optionList){
											let tmp_option = tmp_optionList[toi];
											let tmp_optionMoIdx = tmp_option.modelIdx;
											let tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');
											
											// 현재 선택되어있는 option 색출
											if(tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx))>-1){
												otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
											}
										}
									}
								}
								
								modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
								if(product.modelList.length > modelIdx && isNotNull(product.modelList[modelIdx])){
									modelCodeAttrForTagging = ' data-modelcode="'+product.modelList[modelIdx].modelCode+'"';
									modelNameAttrForTagging = ' data-modelname="'+product.modelList[modelIdx].modelName+'"';
								}
							}
							
							chipId = 'compare-'+optionDataType+'-'+option+'-'+frontModel.modelCode;
							let chipName = 'compare-'+optionDataType+'-'+frontModel.modelCode;
							productCardTemplate +=
											'<span class="option-selector__swiper-slide'+disabledClass+'" role="listitem">'+
												'<span class="option-selector__color js-compare-option-fmychip">'+
													'<input type="radio" id="'+chipId+'" data-optionName="'+currentOption.optionLocalName+'" name="'+chipName+'" data-modeli="'+modelIdx+'"'+
														' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-option" an-ca="option click" an-ac="compare pop-up" an-la="'+kind.toLowerCase()+':'+currentOption.optionName.toLowerCase()+'"'+
														modelCodeAttrForTagging+modelNameAttrForTagging+
														' data-typeidx="'+viewOptionIdx+'" data-code="'+currentOption.optionCode+'"'+(isSelected?' checked':'')+(disabledClass!==''?' disabled':'')+'>'+
													'<label for="'+chipId+'">'+
														getColorOptionHtml(currentOption, isSelected)+
													'</label>'+
												'</span>'+
											'</span>';
						}
						parentOptionModelIdx = curSelecteModelIdx;
						productCardTemplate +=
										'</div>'+//option-selector__swiper-wrapper
									'</div>'+//option-selector__swiper-container
									'<button type="button" class="option-selector__button-prev" aria-label="'+Granite.I18n.get("Previous")+'" role="button" aria-disabled="true"'+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:left">'+
										'<span class="hidden">'+Granite.I18n.get("Previous")+'</span>'+
										'<svg class="icon" focusable="false" aria-hidden="true">'+
											'<use xlink:href="#previous-regular" href="#previous-regular"></use>'+
										'</svg>'+
									'</button>'+
									'<button type="button" class="option-selector__button-next" aria-label="'+Granite.I18n.get("Next")+'" role="button" aria-disabled="true"'+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:right">'+
										'<span class="hidden">'+Granite.I18n.get("Next")+'</span>'+
										'<svg class="icon" focusable="false" aria-hidden="true">'+
											'<use xlink:href="#next-regular" href="#next-regular"></use>'+
										'</svg>'+
									'</button>'+
								'</div>'+//option-selector__swiper
							'</div>';//option-selector__wrap
					} else {
						if(kind === "TV SIZE"){
							productCardTemplate +=
							'<div class="option-selector__wrap option-selector__wrap--capacity unbind-option" data-desktop-view="4" data-mobile-view="1">';
						}else{
							productCardTemplate +=
							'<div class="option-selector__wrap option-selector__wrap--capacity unbind-option" data-desktop-view="3" data-mobile-view="1">';
						}
						
							productCardTemplate +=
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list" style="'+selectorWrapperStyle+'">';
						let curSelecteModelIdx = '';
						for(let oi=0; oi < optionObj.length; oi++){
							/* 선택되어있는(대표모델) 옵션 flag값 셋팅 */
							
							currentOption = optionObj[oi];
							
							isSelected = false;
							let modelIdxList = currentOption.modelIdx.split(',');
							
							if(currentOption.modelIdx !== null && arrayContains(modelIdxList, String(product.frontModelIdx))){
								isSelected = true;
								curSelecteModelIdx = currentOption.modelIdx;
								disabledClass = '';
							} else {
								disabledClass = ' is-disabled';
								if(viewOptionIdx === 0){
									disabledClass = '';
								} else {
									let parentModelIdxList = parentOptionModelIdx.split(',');
									
									for(let mli in modelIdxList){
										//상위 선택된 옵션칩 의 model idx 에 일치하는 model idx 가 있는 경우 활성화
										if(arrayContains(parentModelIdxList, modelIdxList[mli])){
											disabledClass = '';
											break;
										}
									}
								}
							}
							
							// 각 옵션칩의 model 정보 셋팅 ( 태깅 )
							let modelCodeAttrForTagging = '';
							let modelNameAttrForTagging = '';
							
							let modelIdx;
							
							if(disabledClass === ''){
								let curSelectOptionMoIdx = currentOption.modelIdx;
								let otherSelectedOptionMoIdxList = [];
								let isColorType = false;
								
								for(let ooi in curViewOptionObj){
									if(ooi !== kind){
										let tmp_optionList = curViewOptionObj[ooi].optionList;
										for(let toi in tmp_optionList){
											let tmp_option = tmp_optionList[toi];
											let tmp_optionMoIdx = tmp_option.modelIdx;
											let tmp_optionMoIdxArr = tmp_optionMoIdx.split(',');
											
											// 현재 선택되어있는 option 색출
											if(tmp_optionMoIdxArr.indexOf(String(product.frontModelIdx))>-1){
												otherSelectedOptionMoIdxList.push(tmp_optionMoIdx);
											}
										}
										
									}
								}
								
								modelIdx = getSelectedModelIdx(curViewOptionObj, curSelectOptionMoIdx, otherSelectedOptionMoIdxList, isColorType, curOptionTypeList);
								
								if(product.modelList.length > modelIdx && isNotNull(product.modelList[modelIdx])){
									modelCodeAttrForTagging = ' data-modelcode="'+product.modelList[modelIdx].modelCode+'"';
									modelNameAttrForTagging = ' data-modelname="'+product.modelList[modelIdx].modelName+'"';
								}
							}
							
							chipId = 'compare-'+optionDataType+'-'+oi+'-'+frontModel.modelCode;
							let chipName = 'compare-'+optionDataType+'-'+frontModel.modelCode;
							productCardTemplate +=
											'<span class="option-selector__swiper-slide'+disabledClass+'" role="listitem">'+
												'<span class="option-selector__size js-compare-option-fmychip">'+
													'<input type="radio" id="'+chipId+'" data-optionName="'+currentOption.optionLocalName+'" name="'+chipName+'" data-modeli="'+modelIdx+'"'+
														' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-option" an-ca="option click" an-ac="compare pop-up" an-la="'+kind.toLowerCase()+':'+currentOption.optionName.toLowerCase()+'"'+
														modelCodeAttrForTagging+modelNameAttrForTagging+
														' data-typeidx="'+viewOptionIdx+'" data-code="'+currentOption.optionCode+'"'+(isSelected?' checked':'')+(disabledClass!==''?' disabled':'')+'>'+
													'<label class="option-selector__size-label" for="'+chipId+'">'+
														'<span class="option-selector__size-label-text">'+currentOption.optionLocalName+'<span>'+
													'</label>'+
												'</span>'+
											'</span>';
						}
						parentOptionModelIdx = curSelecteModelIdx;
						productCardTemplate +=
											'<div class="option-selector__floating-bar" style="display: none;"></div>'+
										'</div>'+//option-selector__swiper-wrapper
									'</div>'+//option-selector__swiprer-container
									'<button type="button" class="option-selector__button-prev" aria-label="'+Granite.I18n.get("Previous")+'" role="button" aria-disabled="true"'+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:left">'+
										'<span class="hidden">'+Granite.I18n.get("Previous")+'</span>'+
										'<svg class="icon" focusable="false" aria-hidden="true">'+
											'<use xlink:href="#previous-regular" href="#previous-regular"></use>'+
										'</svg>'+
									'</button>'+
									'<button type="button" class="option-selector__button-next" aria-label="'+Granite.I18n.get("Next")+'" role="button" aria-disabled="true"'+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-arrow" an-ca="indication" an-ac="carousel" an-la="carousel:arrow:right">'+
										'<span class="hidden">'+Granite.I18n.get("Next")+'</span>'+
										'<svg class="icon" focusable="false" aria-hidden="true">'+
											'<use xlink:href="#next-regular" href="#next-regular"></use>'+
										'</svg>'+
									'</button>'+
								'</div>'+//option-selector__swipe
							'</div>';//option-selector__wrap
					}
					
					viewOptionIdx++;
				}
				
				// 옵션침 데이터 없을 경우 빈영역 추가
				if(Object.keys(product.viewOptionObj).length === 1){
					if(Object.keys(product.viewOptionObj)[0] === "COLOR"){
						productCardTemplate +=
							'<div class="option-selector__wrap option-selector__wrap--capacity unbind-option is-option-empty">'+
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list"></div>'+
									'</div>'+
								'</div>'+
							'</div>';
					}
				}
			}else{
				productCardTemplate +=
							'<div class="option-selector__wrap option-selector__wrap--color-chip unbind-option is-option-empty">'+
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list"></div>'+
									'</div>'+
								'</div>'+
							'</div>'+
							'<div class="option-selector__wrap option-selector__wrap--capacity unbind-option is-option-empty">'+
								'<div class="option-selector__swiper">'+
									'<div class="option-selector__swiper-container">'+
										'<div class="option-selector__swiper-wrapper" role="list"></div>'+
									'</div>'+
								'</div>'+
							'</div>';
			}
			productCardTemplate +=
					'</div>';//option-selector
		}
		
		return productCardTemplate;
	};
	
	function clProductCardFicheBuild(frontModel){
		let displayName = "";
		if(isNotNull(frontModel.displayName)){
			displayName = escapeHtml(frontModel.displayName.replace(/<br>/ig," ").replace(/<sup>/ig," "));
		}
		
		/* product fiche가 없는 경우 div 영역은 유지하고 내용은 삭제 필요(모든 상품에 product fiche가 없는 경우 div 영역도 삭제) */
		let productCardTemplate = "";
		productCardTemplate +=
			'<div class="compare-popup__fiche">'+
				'<div class="compare-popup__fiche-cta-wrap">';
		if(isNotNull(frontModel.energyLabelGrade) && frontModel.newEnergyLabel != "Y"){ // 기존 에너지라벨
			if(isNotNull(frontModel.ficheFileUrl)){
				productCardTemplate +=
					'<a href="'+frontModel.ficheFileUrl+'" target="_blank" aria-label="'+ Granite.I18n.get("Product Fiche")+": "+displayName+" "+Granite.I18n.get("Open in a new window")+'" class="cta-text"'+
					' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-product fiche" an-ca="option click" an-ac="compare pop-up" an-la="product fiche">'+
						Granite.I18n.get("Product Fiche")+
					'</a>';
			}
			productCardTemplate +=
					'<a class="badge '+frontModel.energyLabelClass2+'" href="'+frontModel.energyFileUrl+'" target="_blank" aria-label="'+ frontModel.energyLabelGrade+", energy level: "+displayName+" "+Granite.I18n.get("Open in a new window")+'"'+
					' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-product fiche" an-ca="option click" an-ac="compare pop-up" an-la="product fiche">'+	
						'<span class="badge__grade--with-text '+frontModel.energyLabelClass1+'">'+
							'<span class="hidden">'+frontModel.energyLabelGrade+'</span>'+
						'</span>'+
					'</a>';
		}else if(isNotNull(frontModel.energyLabelGrade) && frontModel.newEnergyLabel == "Y"){ // 신 에너지라벨
			productCardTemplate +=
					'<div class="badge-energy-label">';
			if(isNotNull(frontModel.ficheFileUrl)){
				productCardTemplate +=
						'<a href="'+frontModel.ficheFileUrl+'" target="_blank" aria-label="'+ Granite.I18n.get("PRODUCT INFORMATION SHEET")+": "+displayName+" "+Granite.I18n.get("Open in a new window")+'" class="badge-energy-label__text"'+
						' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-product fiche" an-ca="option click" an-ac="compare pop-up" an-la="product fiche">'+
							Granite.I18n.get("PRODUCT INFORMATION SHEET")+
						'</a>';
			}
			productCardTemplate +=
						'<a class="badge-energy-label__badge '+frontModel.energyLabelClass1+'" href="'+frontModel.energyFileUrl+'" target="_blank" aria-label="'+ frontModel.energyLabelGrade+", energy level: "+displayName+" "+Granite.I18n.get("Open in a new window")+'"'+
						' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-product fiche" an-ca="option click" an-ac="compare pop-up" an-la="product fiche">'+	
							frontModel.energyLabelGrade+
						'</a>'+
					'</div>';
		}
		productCardTemplate +=
				'</div>';	// cta-wrap end
		if(clSiteCode == "fr" || siteCode == "test"){
			if(isNotNull(frontModel.repairabilityIndex)){
				let repairabilityIndex = frontModel.repairabilityIndex;
				let repairabilityAlt = Granite.I18n.get("Repairability Index : {0} / 10", [repairabilityIndex] );
				let repairabilitySrc = "";
				if(repairabilityIndex.length == 1){
					repairabilitySrc = repairabilityIndex + '0';
				}else{
					repairabilitySrc = repairabilityIndex.replace(".","");
				}
				let reparabiliteUrl = 'https://www.samsung.com/fr/indice-reparabilite/';
                if(isNotNull(frontModel.repairabilityIndexPdfUrl)){
                    reparabiliteUrl = frontModel.repairabilityIndexPdfUrl; 
                }
                
                let tempArr = reparabiliteUrl.split("/");
                let reparabiliteFileName = tempArr[tempArr.length-1];
                
				productCardTemplate +=
					'<span class="badge-repairability">'+
						'<a href="'+ reparabiliteUrl +'" an-tr="pdd13_compare pop up-'+clPageTrack+'-repairability index-option_click4" an-ca="option click" an-ac="compare pop-up" an-la="repairabililty index:'+ reparabiliteFileName +'">' +
							'<img class="badge-repairability__image" src="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/badge-repairability-'+repairabilitySrc+'.jpg" alt="'+repairabilityAlt+'">'+
						'</a>'+
					'</span>';
			}
		}
		productCardTemplate +=
			'</div>';
		return productCardTemplate;
	}
	
	/**
	 * Product Data를 이용하여 Product Card 영역 구성
	 * 
	 * @param product
	 */
	function buildProductCard(product) {
		let model = product.modelList[product.frontModelIdx];
		
		if(product.iaCtaDisplay === 'Y'){
			isButtonShow = true;
		}else if(product.iaCtaDisplay === 'N'){
			isButtonShow = false;
		}

		let upperStock = "";
		if(isNotNull(model.ctaType)){
			upperStock = model.ctaType.toUpperCase();
			model.ctaTypeUpperCase = upperStock;
		}
		
		let productCardTemplate = "";
			/* product card :: S */
			productCardTemplate +=
			'<div class="compare-popup__product-menu">'+
				'<h4 class="compare-popup__product-title">' + model.displayName + '</h4>'+
			'</div>'+
			'<div class="compare-popup__product-card">'+
				/* product code 영역 :: S */
				'<div class="compare-popup__sku" data-modelcode="' + model.modelCode + '">'+
					'<p class="compare-popup__sku-text">' + model.modelCode + '</p>'+
				'</div>'+
				/* product code 영역 :: E */
				
				/* product image 영역 :: S */
				'<div class="compare-popup__product-image">'+
					'<div class="image">'+
						'<img class="image__preview lazy-load responsive-img"'+
							'data-desktop-src="' + clImgDomain(model.thumbUrl, "lazy") + '"'+
							'data-mobile-src="' + clImgDomain(model.thumbUrl, "lazy") + '"'+
							'alt="">'+ //' + model.thumbUrlAlt + '
						'<img class="image__main lazy-load responsive-img"'+
							'data-desktop-src="' + clImgDomain(model.thumbUrl, "desktop") + '"'+
							'data-mobile-src="' + clImgDomain(model.thumbUrl, "mobile") + '"'+
							'alt="">'+ //' + model.thumbUrlAlt + '
					'</div>'+
				'</div>';
				/* product image 영역 :: E */
				
				/* Option Selector Component 영역 :: S */
				productCardTemplate += clProductCardFmyOptionBuild(product);
				/* Option Selector Component 영역 :: E */
				
				/* review 영역 :: S */
				let reviewRedirect = '/'+clSiteCode+"/common/review/"+model.modelCode+'/';
				if(model.reviewUrl !== ""){
					reviewRedirect = model.reviewUrl;
				}
				
				var siteCode = $("#siteCode").val();
				if((clReviewUseYN === "Y" || clReevooUseYN === "Y") &&isNotNull(model.ratingHtml) && siteCode !== "cn" /* && !(clSiteCode === "br" && productGroupCode === GROUPCODE_IM) */){
					let ratingEmptyCls = "";
					let taggingLa = "read review";
					if(model.ratings === 0){
						ratingEmptyCls = " rating--empty";
						taggingLa = "write review";
					}
					productCardTemplate +=
					'<div class="compare-popup__rating">'+
						'<a href="'+reviewRedirect+'" data-modelcode="'+model.modelCode+'" data-modelname="'+model.modelName+'"'+
							' an-tr="pdd13_compare pop up-' + clPageTrack + '-image-link" an-ca="review" an-ac="compare pop-up" an-la="' + taggingLa + '">'+
							'<span class="rating'+ratingEmptyCls+'">'+
								'<span class="hidden">' + Granite.I18n.get("Rating") + '</span>'+
								'<span class="rating__inner">'+
									'<span class="rating__star-list">' + model.ratingHtml + '</span>'+
									'<strong class="rating__point"><span class="hidden">' + Granite.I18n.get("Product Ratings") + ' : </span><span>' + model.ratings + '</span></strong>'+
									'<em class="rating__review-count">(<span class="hidden">' + Granite.I18n.get("Number of Ratings") + ' :</span><span>' + model.reviewCount + '</span>)</em>'+
								'</span>'+
							'</span>'+
						'</a>'+
					'</div>';
				}
				/* review 영역 :: E */
				
				/* fiche 영역 :: S */
				productCardTemplate += clProductCardFicheBuild(model);
				/* fiche 영역 :: E */
			
				/* product 가격 영역 :: S */
				productCardTemplate +=
					buildPriceArea(product, upperStock);
				/* product 가격 영역 :: E */
				//new-hybris
				if(clIsGPv2 || isNewHybris || isB2bhybris){
					let shopSkuCode = "";
					if(isNotNull(model.shopSKU)){
						shopSkuCode = model.shopSKU;
					}else{
						shopSkuCode = model.modelCode;
					}
					product.modelList[product.frontModelIdx].shopSkuCode = shopSkuCode;
				}
				
				/* CTA 버튼 영역 :: S */
				if(isButtonShow){
					productCardTemplate += productCardCTABuild(product);
				}
				/* CTA 버튼 영역 :: E */
		productCardTemplate +=
			'</div>';
			/* product card :: E */
			
		return productCardTemplate;
	}
	
	/**
	 * [2020.12.10] 
	 * Product Card CTA ( global, Hybris, Gpv2 통합 ) 
	 * 
	 * @param product
	 */
	function productCardCTABuild(product){
		let frontModel = product.modelList[product.frontModelIdx];
		
		let displayName = "";
		if(isNotNull(frontModel.displayName)){
			displayName = escapeHtml(frontModel.displayName.replace(/<br>/ig," ").replace(/<sup>/ig," "));
		}

		// pre order, buy now, add to cart 에 사용
		let dataModelCodeAttr = 
			' data-modelcode="'+frontModel.modelCode+'"';
		let dataModelNameAttr = 
			' data-modelname="'+frontModel.modelName+'"';
		let dataShopSkuAttr = 
			' data-sku-code="'+frontModel.shopSkuCode+'"';
		let dataGetStockAttr = '';	//cn getStockAlert/ComingSoon 구분
		if(siteCode == "cn") dataGetStockAttr = ' data-gs-flag="GetStock"';	
		
		let dataEppVirtualModelCodeAttr = "";
		if((eppIsFlash || eppIsRefurbish) && isNotNull(frontModel.virtualModelCode)){
			dataEppVirtualModelCodeAttr=
			' data-virtual-modelcode="'+frontModel.virtualModelCode+'"';
		}
			
		let taggingAttrForBuy = 
			' data-pimsubtype="'+(isNotNull(product.categorySubTypeEngName) ? product.categorySubTypeEngName.toLowerCase():'')+'"'+
			' data-pvitype="'+(isNotNull(frontModel.pviTypeName) ? frontModel.pviTypeName.toLowerCase():'')+'"'+
			' data-pvisubtype="'+(isNotNull(frontModel.pviSubtypeName) ? frontModel.pviSubtypeName.toLowerCase():'')+'"'+
			' data-modelrevenue="'+originPrice+'"'+
			' data-modelprice="'+originPrice+'"'+
			' data-modelqty="1"'+
			' data-modelcurrency="'+clPriceCurrency+'"'+
			dataModelCodeAttr + 
			dataModelNameAttr +
			' data-modeldisplay="'+displayName+'"';
		if(isNotNull(discountPrice)){
			taggingAttrForBuy+=
			' data-discountprice="'+discountPrice+'"';
		}
		
		let useConfiguratorUrl = false;
		let configUrl = "";
		if(isNotNull(frontModel.configuratorUrl)){
			useConfiguratorUrl = true;
			configUrl = frontModel.configuratorUrl;
		}
		
		if(eppIsFlash || eppIsRefurbish){
			useConfiguratorUrl = false;
		}
		
		/*
			US > buyingConfigLinkType 이 pf 일 때만 buyingConfigLink 사용
			B2B 미사용
		*/
		if(clSiteCode === "us" && !isB2b){
			if(frontModel.buyingConfigLinkType === 'pf'){
				useConfiguratorUrl = true;
				configUrl = frontModel.buyingConfigLink;
			}
		}
		
		let ctaTypeUpperCase = frontModel.ctaTypeUpperCase;
		
		let isSimplePD = product.simplePdYN === "Y" ? true : false;
		let buyingPDUrl = frontModel.originPdpUrl;
		if(isSimplePD){
			if(isEppSite){
				if(frontModel.originPdpUrl != null){
					buyingPDUrl = frontModel.originPdpUrl.replace("feature.", "buy.");
				}
			} else {
				buyingPDUrl = frontModel.originPdpUrl + "buy/";
			}
		}
		
		let isSTDPD = false;
		if(!isSimplePD && frontModel.marketingpdpYN === "N"){
			isSTDPD = true;
		}
		//new-hybris
		if(clIsGPv2 || isNewHybris || isB2bhybris){
			/* GPv2 standard pd 이동시 benefits 포커스 이동 :: 확인 필요함 */
			let learnmoreUrl = frontModel.pdpUrl;
			if(isSTDPD && clPdurlAnchorCheckYn === "Y"){
				learnmoreUrl += "#benefits";
			}
			frontModel.pdpUrl = learnmoreUrl;
		}
		
		let priceDisplayNull = false; 
		if(fnIsNull(originPrice)){
			priceDisplayNull = true;
		}

		let cartUrlLink = clStoreDomain + clCartUrl;
		
		if(clCartUrl.indexOf("http://") > -1 || clCartUrl.indexOf("https://") > -1){
			cartUrlLink = clCartUrl;
		}
		
		// COMP6FE-1619 [EPP] SIEL Offline 뱃지 추가건
		let buyNowCta = Granite.I18n.get("Buy now");
		if(isEppSite){
			cartUrlLink = (isNewHybris?storeWebDomain:clStoreDomain) + "/" +eppCompanyCode + "/cart";
			if(clIsGPv2){
				cartUrlLink = clCartUrl;
			}
			if ( window.sg.epp && window.sg.epp.common && ( window.sg.epp.common.ecomStoreType === "offline" || window.sg.epp.common.ecomStoreType === "offline_reverse_o2o" ) ){
				buyNowCta = Granite.I18n.get("Buy Online");
			}
		}

		let tempProductCardTemplate =
		'<div class="compare-popup__cta-area">';
			
			if(!priceDisplayNull){
				if(clSiteCode === "us" && ctaTypeUpperCase !== "PREORDER" && 
					(ctaTypeUpperCase === "WHERETOBUY" || ctaTypeUpperCase === "BACKORDER" || ctaTypeUpperCase === "BACKORDERED" || ctaTypeUpperCase === "INSTOCK" || ctaTypeUpperCase === "OUTOFSTOCK" || ctaTypeUpperCase === "LOWSTOCK")){
					// US 사이트  Buy Now CTA 표시 (PreOrder CTA 제외) 
					if(useConfiguratorUrl){
						tempProductCardTemplate +=
							'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+buyNowCta+' : '+displayName+'" href="javascript:;" data-link_info="" data-config_info="'+configUrl+'"'+taggingAttrForBuy+
							' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="buy now" an-la="compare pop-up:buy now">' + buyNowCta + '</a>';
					} else {
						tempProductCardTemplate +=
							'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+buyNowCta+' : '+displayName+'" href="'+buyingPDUrl+'" data-link_info="'+buyingPDUrl+'" data-config_info=""'+taggingAttrForBuy+
							' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="buy now" an-la="compare pop-up:buy now">' + buyNowCta + '</a>';
					}
				} else if(!isNonShop){
					if(siteCode == "cn" && frontModel.isComingSoon  && frontModel.isComingSoon == "true"){	//SCIC hybris
						dataGetStockAttr = ' data-gs-flag="ComingSoon"';	//cn getStockAlert/ComingSoon 구분
						
						tempProductCardTemplate +=
							'<button class="cta cta--contained cta--black cta--2line-mo cta--dense js-cta-stock" type="button" aria-label="'+Granite.I18n.get("Get stock alert")+' : '+displayName+'"'+dataGetStockAttr +dataModelCodeAttr + dataModelNameAttr+dataEppVirtualModelCodeAttr+
							' an-tr="pdd13_compare pop up-' + clPageTrack + '-button-stock" an-ca="buy cta" an-ac="stock alert" an-la="compare pop-up:stock alert"'+
							' data-antr="pdd13_compare pop up-' + clPageTrack + '-popup-stock">' + Granite.I18n.get("Get stock alert") + '</button>';
						
					}else{
					
						if(ctaTypeUpperCase === "WHERETOBUY" || ctaTypeUpperCase === "BACKORDER" || ctaTypeUpperCase === "BACKORDERED" || ctaTypeUpperCase === "INSTOCK" || ctaTypeUpperCase === "LOWSTOCK"){
							if(useConfiguratorUrl){
								let ctaLocalTemp = isNotNull(frontModel.ctaLocalText) ? frontModel.ctaLocalText : buyNowCta;
								tempProductCardTemplate +=
									'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+ctaLocalTemp+' : '+displayName+'" href="javascript:;" data-link_info="" data-config_info="'+configUrl+'"'+taggingAttrForBuy+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="buy now" an-la="compare pop-up:buy now">' + ctaLocalTemp + '</a>';
							}else{
								if(isSTDPD){
									tempProductCardTemplate +=
										'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+Granite.I18n.get("Add to cart")+' : '+displayName+'" href="javascript:;" data-cart="true" ' + dataShopSkuAttr + ' data-link_info="' + cartUrlLink + '" data-config_info=""'+taggingAttrForBuy+
										' an-tr="pdd13_compare pop up-' + clPageTrack + '-cta-cart page" an-ca="ecommerce" an-ac="addToCart" an-la="compare pop-up:add to cart">' + Granite.I18n.get("Add to cart") + '</a>';
								}else{
									tempProductCardTemplate +=
										'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+buyNowCta+' : '+displayName+'" href="'+buyingPDUrl+'" data-link_info="'+buyingPDUrl+'" data-config_info=""'+taggingAttrForBuy+
										' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="buy now" an-la="compare pop-up:buy now">' + buyNowCta + '</a>';
								}
							}
						} else if (ctaTypeUpperCase === "PREORDER"){
							if(useConfiguratorUrl){
								let ctaLocalTemp = isNotNull(frontModel.ctaLocalText) ? frontModel.ctaLocalText : Granite.I18n.get("pre order");
								tempProductCardTemplate +=
									'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+ctaLocalTemp+' : '+displayName+'" href="javascript:;" data-link_info="" data-config_info="'+configUrl+'"'+taggingAttrForBuy+
									' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="pre-order" an-la="compare pop-up:pre order">' + ctaLocalTemp + '</a>';
							} else {
								if(isSTDPD){
									tempProductCardTemplate +=
										'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+Granite.I18n.get("pre order")+' : '+displayName+'" href="javascript:;" data-cart="true" ' + dataShopSkuAttr + ' data-link_info="' + cartUrlLink + '" data-config_info=""'+taggingAttrForBuy+
										' an-tr="pdd13_compare pop up-' + clPageTrack + '-cta-cart page" an-ca="ecommerce" an-ac="addToCart" an-la="compare pop-up:pre order">' + Granite.I18n.get("pre order") + '</a>';
								} else {
									tempProductCardTemplate +=
										'<a class="cta cta--contained cta--black cta--2line-mo cta--dense cl-buy-now" aria-label="'+Granite.I18n.get("pre order")+' : '+displayName+'" href="'+buyingPDUrl+'" data-link_info="' + buyingPDUrl + '" data-config_info=""'+taggingAttrForBuy+
										' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-button" an-ca="buy cta" an-ac="pre-order" an-la="compare pop-up:pre order">' + Granite.I18n.get("pre order") + '</a>';
								}
							}
						} else if (ctaTypeUpperCase === "OUTOFSTOCK"){
							tempProductCardTemplate +=
								'<button class="cta cta--contained cta--black cta--2line-mo cta--dense js-cta-stock" type="button" aria-label="'+Granite.I18n.get("Get stock alert")+' : '+displayName+'"'+dataGetStockAttr +dataModelCodeAttr + dataModelNameAttr+dataEppVirtualModelCodeAttr+
								' an-tr="pdd13_compare pop up-' + clPageTrack + '-button-stock" an-ca="buy cta" an-ac="stock alert" an-la="compare pop-up:stock alert"'+
								' data-antr="pdd13_compare pop up-' + clPageTrack + '-popup-stock">' + Granite.I18n.get("Get stock alert") + '</button>';
						}
					}
				}
			}
			// learn more
			tempProductCardTemplate +=
				'<div class="compare-popup__cta-learn-more">'+
					'<a class="cta cta--underline cta--black" aria-label="'+Granite.I18n.get("Learn more")+' : '+displayName+'" href="'+frontModel.pdpUrl+'"'+taggingAttrForBuy+
					' an-tr="pdd13_compare pop up-' + clPageTrack + '-text-view more" an-ca="product click" an-ac="compare pop-up" an-la="learn more click">'+ Granite.I18n.get("Learn more") + '</a>'+
				'</div>';
			
		tempProductCardTemplate +=
		'</div>';
		
		return tempProductCardTemplate;
	};
	
	function getProductInfo(product, eppProduct){
		let tempProduct = product;
		let isEppProduct = false;
		
		if(isNotNull(eppProduct.modelList) && eppProduct.modelList.length > 0){
			isEppProduct = true;
		}
		
		/*
		 * viewOptionObj : 전체 옵션칩 리스트 
		 * optionTypeList : 옵션 타입만 담고 있는 리스트 ( 옵션타입의 index 값을 구하기 위해 생성함 )
		 */
		
		let tmpOptionListInModel = {};
		for(let mi in tempProduct.modelList){
			let tmpModel = tempProduct.modelList[mi];
			let tmpFmyChipList = tmpModel.fmyChipList;
			
			if(isEppProduct){
				// epp discount 셋팅
				if(tmpModel.modelCode  === eppProduct.modelList[mi].modelCode){
					tmpModel.prdPriceInf = eppProduct.modelList[mi].prdPriceInf;
					tmpModel.prdSavePriceInf = eppProduct.modelList[mi].prdSavePriceInf;
					tmpModel.prdSavePriceTI = eppProduct.modelList[mi].prdSavePriceTI;
					tmpModel.tradeDiscountPrice = eppProduct.modelList[mi].tradeDiscountPrice;
				}
			}
			
			for(let fci in tmpFmyChipList){
				//fmyChipCode에 " 제거 
				let thisOptionKey = tmpFmyChipList[fci].fmyChipType + '+'+
									tmpFmyChipList[fci].fmyChipCode.replace("\"", "").replace("&quot;", "")+'+'+
									tmpFmyChipList[fci].fmyChipLocalName.replace("\"", "").replace("&quot;", "");
				
				if(tmpOptionListInModel[thisOptionKey] === undefined){
					tmpOptionListInModel[thisOptionKey] = mi;
				} else {
					tmpOptionListInModel[thisOptionKey] += ","+mi;
				}
			}
			// SEF, SEBN, SEDA(rs, al, mk, ba은 스토어국가아니므로 패스), SENA, SEPOL, SEH (우선 pl만 반영)
			// 기존 price(원가, msrp price 포함)가 이미 노출되는 경우에 이를 lowestWasPrice 가 노출되도록 변경하는 작업
			// [EPP] epp meta 체크 추가
			// lowestwasprice 가 price 보다 낮거나 같고, promotion price보다 높을 때만 적용
			tmpModel['lowestWasPriceUseYn'] = "N";
			if(((
				 (isStrikethroughRmSite || siteCode === "ro" )
				 && !isEppSite) || (isEppSite && eppOmniPricingUseYn == "Y"))
			&& isNotNull(tmpModel.lowestWasPrice)
			&& isNotNull(tmpModel.promotionPrice)
			&& (parseFloat(tmpModel.lowestWasPrice) <= parseFloat(tmpModel.price) && parseFloat(tmpModel.promotionPrice) < parseFloat(tmpModel.lowestWasPrice))
			){
				console.log("modelCode [{}] origin price::{}", tmpModel.modelCode, tmpModel.price);
				console.log("origin priceDisplay::"+tmpModel.priceDisplay);
				console.log("origin saveText::"+tmpModel.saveText);
				tmpModel.price = tmpModel.lowestWasPrice;
				tmpModel.priceDisplay = currencyComma(tmpModel.lowestWasPrice, clPriceCurrency);
				/*
				if(siteCode === "hr"){
					tmpModel.priceDisplay = currencyComma(tmpModel.lowestWasPrice, clPriceCurrency)+" ("+euroToKunaPrice(tmpModel.lowestWasPrice)+")";
				}
				*/
				if(isNotNull(tmpModel.msrpPrice)){
					tmpModel.msrpPrice = tmpModel.lowestWasPrice;
					console.log("after msrpPrice::"+tmpModel.msrpPrice);
				}
				tmpModel.saveText = parseFloat(tmpModel.lowestWasPrice) - parseFloat(tmpModel.promotionPrice);
				tmpModel.lowestWasPriceUseYn = "Y";
				console.log("after price::"+tmpModel.price);
				console.log("after priceDisplay::"+tmpModel.priceDisplay);
				console.log("after saveText::"+tmpModel.saveText);
			}
			
		}
		
		let optionTypeList = [];
		let viewOptionObj = {};
		if(isNotNull(tempProduct.chipOptions)){
			for(let a=0; a<tempProduct.chipOptions.length; a++){
				let optionData = tempProduct.chipOptions[a];
				let optionTypeTmp = optionData.fmyChipType;

				let optionListInType = optionData.optionList;
				for(let opl in optionListInType){
					let thisOptionKey = optionData.fmyChipType + '+'+
										optionListInType[opl].optionCode.replace("\"", "").replace("&quot;", "")+'+'+
										optionListInType[opl].optionLocalName.replace("\"", "").replace("&quot;", "");
					if(tmpOptionListInModel[thisOptionKey] !== undefined){
						optionListInType[opl].modelIdx = tmpOptionListInModel[thisOptionKey];
					}
					
				}
				viewOptionObj[optionTypeTmp] = {};
				viewOptionObj[optionTypeTmp]['optionList'] = optionListInType;
				
				optionTypeList.push(optionTypeTmp);
			}
		}
		
		tempProduct["viewOptionObj"] = viewOptionObj;
		tempProduct["optionTypeList"] = optionTypeList;
		
		return tempProduct;
	}

	function getProductModelInfo(product, frontModelIdx) {
		let tempProduct = product;
		
		if(isNotNull(frontModelIdx) && isNotNull(tempProduct.modelList) && isNotNull(tempProduct.modelList[frontModelIdx])){
			let tempModel = tempProduct.modelList[frontModelIdx];
			
			/* B2B Search Api Data :: S */
			if(isB2b){
				if(fnIsNull(tempProduct.iaCtaDisplay)){
					// B2B핌에 없는 기능 관련 엘리먼트 정리로 인해 디폴트 값 셋팅
					tempProduct.iaCtaDisplay = "Y";
				}
				let shopInfoObj = {};
				if(isB2bhybris){
					shopInfoObj = tempModel.b2bHybrisShopInfo;
				} else {
					shopInfoObj = tempModel.globalShopInfo;
				}
				for(let si in shopInfoObj){
					tempProduct.modelList[frontModelIdx][si] = shopInfoObj[si];
				}
			}
			/* B2B Search Api Data :: E */
			
			/* Product Name SKU 단위로 조정  :: S */
			if(fnIsNull(tempModel.displayName)){
				tempProduct.modelList[frontModelIdx].displayName = "";
			}
			/* Product Name SKU 단위로 조정  :: E */
			
			/* 별점 정보 & review Count :: S */
			if((clReviewUseYN === "Y" || clReevooUseYN === "Y")){
				let item = "";
				let ratings = tempModel.ratings;
				if(fnIsNull(ratings)){ ratings = 0; tempProduct.modelList[frontModelIdx].ratings = 0; }
				
				// rating 반올림 처리
				let tmpCount = Math.pow(10,1);
				ratings = Math.round(ratings*tmpCount)/tmpCount;
				
				let ratingValue = parseFloat(ratings).toFixed(1),
					fullStarCnt = parseInt(ratings),
					cutStarWidthStyleNum = 0;
					cutStarWidthStyleNum = parseInt((ratingValue - fullStarCnt) * 100);
				
				if(ratingValue !== "0.0"){
					tempProduct.modelList[frontModelIdx].ratings = ratingValue;
				}
				
				for(let j=0; j<fullStarCnt; j++){
					item += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 100%;"></span></span>';
				}
				if(fullStarCnt<5 && fullStarCnt>0){
					item += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: ' + cutStarWidthStyleNum + '%;"></span></span>';
					for(let k=4; k>fullStarCnt; k--){
						item += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
					}
				}else if(fullStarCnt === 0 && isNotNull(tempProduct.modelList[frontModelIdx].reviewUrl)){
					for(let empty_idx=0; empty_idx<5; empty_idx++){
						item+='<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
					}
				}
				tempProduct.modelList[frontModelIdx].ratingHtml = item;

				if(fnIsNull(tempModel.reviewCount)){
					tempProduct.modelList[frontModelIdx].reviewCount = "0";
				}
				if(fnIsNull(tempModel.reviewUrl)){
					tempProduct.modelList[frontModelIdx].reviewUrl = "";
				}
			}
			/* 별점 정보 & review Count :: E */
			
			/* Energy Label Data :: S */
			if(fnIsNull(tempModel.energyLabelGrade) || tempModel.energyLabelGrade === "N/A"){
				tempProduct.modelList[frontModelIdx].energyLabelGrade = "";
			}
			if(fnIsNull(tempModel.ficheFileUrl)){
				tempProduct.modelList[frontModelIdx].ficheFileUrl = "";
			}
			/* Energy Label Data :: E */
		}
		return tempProduct;
	}
	function toHtml(str){
		str = str.replace(/</g,"");
		str = str.replace(/>/g,"");
		str = str.replace(/\"/g,"");
		str = str.replace(/\'/g,"");
		str = str.replace(/\n/g,"");
		return str;
	}
	function compareSpecsGrid(data){
		$(".compare-popup__detail-spec-disclaimer").empty();	// disclaimer 초기화
		$(".compare-popup__detail-spec-table-body").remove();	// 스팩 영역 초기화
		
		/* ia2lvDesc */
		if(isNotNull(data.ia2lvDesc)){
			$(".compare-popup__detail-spec-disclaimer").html(data.ia2lvDesc);
		}
		let specGridTemplate = "";
		
		groupData = {};
		if(isNotNull(data.compareSpecs) && data.compareSpecs.length > 0){
			for(let si=0; si<data.compareSpecs.length; si++){
				let itemList = data.compareSpecs[si];
				
				if (typeof groupData[itemList.attrKey] === 'undefined') {
					groupData[itemList.attrKey] = new Array();
				}
				groupData[itemList.attrKey].push(itemList);
			}
		}
		
		if(groupData !== null && groupData !== undefined){
			specGridTemplate +=
				'<div class="compare-popup__detail-spec-table-body" role="rowgroup">';
				for (let i in groupData) {
					let items = groupData[i];
					specGridTemplate +=
						`<div class="compare-popup__detail-spec-row" role="row" data-schmattnm="${toHtml(items[0].attrKey)}">`+
							'<strong class="compare-popup__detail-spec-col-title" role="rowheader">' + items[0].attrName + '</strong>'+
							'<div class="compare-popup__detail-spec-col-contents" role="cell"></div>'+
							'<div class="compare-popup__detail-spec-col-contents" role="cell"></div>';
							if(data.modelList.length === 3){
								specGridTemplate +=
									'<div class="compare-popup__detail-spec-col-contents" role="cell"></div>';
							}
					specGridTemplate +=
						'</div>';
				}
			specGridTemplate +=
				'</div>';
		}
		
		if(specGridTemplate !== ""){
			$(".compare-popup__detail-spec-table").append(specGridTemplate);
		}
		
		/* Spec Data Setting : S */
		if(isNotNull(data.modelList) && data.modelList.length > 0){
			for(let sp=0; sp<data.modelList.length; sp++){
				let specModelList = data.modelList[sp];
				if(specModelList.specs.length > 0){
					for(let tn=0; tn<specModelList.specs.length; tn++){
						let specItemTemplate = "";
						let specsItems = specModelList.specs[tn];
						if(specsItems.attrValue === null){
							continue;
						}else{
							specItemTemplate += specsItems.attrValue;
						}
						
						$($(`.compare-popup__detail-spec-row[data-schmattnm='${toHtml(specsItems.attrKey)}']`).find(".compare-popup__detail-spec-col-contents").get(sp)).append(specItemTemplate);
					}
				}
			}
		}
		/* Spec Data Setting : E */
		checkSameSpec();
	}
    /**
     * 3개 제품 비교시 3개중 하나라도 값이 다르면 3개 모두 highligh 
     */
    function checkSameSpec(){
        $(".compare-popup__detail-spec-table-body .compare-popup__detail-spec-row").each(function(){
            let perSpecText;
            let currentSpecText;
            let checkSame = true;
            $(this).find(".compare-popup__detail-spec-col-contents").each(function(){
                currentSpecText = $(this).text();
                currentSpecText = currentSpecText.replace(/&lrm;|\u200E/gi, '');
		
                if(perSpecText == undefined){
                    perSpecText = currentSpecText;
                }else{
                    if(perSpecText !== currentSpecText){
                        checkSame = false;
                        return false;
                    }else{
                        perSpecText = currentSpecText;
                    }
                }
            });
            if(!checkSame){
                $(this).find(".compare-popup__detail-spec-col-contents").each(function(){
                    $(this).html('<mark class="highlight">'+$(this).text()+'</mark>');
                });
            }
        });
	}

	function dataSet(data) {
		let emptyHtml = "";			// Compare Bar 2개 일때 그려주는 영역
		let hiddenHtml = "";		// 웹접근성 화면에 노출안되는 영역
		let cardGridHtml = "";
		let productListIndex = 0;

		let compareModelNameList = ''; // ex) Galaxy S20 5G, Galaxy S20 5G, Galaxy A50
		
		productListData = data.productList;
		
		if(isNotNull(data) && isNotNull(data.productList)){
			hiddenHtml += '<div class="hidden" role="rowheader">' + Granite.I18n.get("Model") + '</div>';
			for(let pr=0; pr<data.productList.length; pr++){
				let tempProduct = data.productList[pr];
				let selectedIdx = 0;	// selected Y값이 여러개 올경우 마지막 모델의 index
				let eppProduct = pfCompareModelList[pr];
				
				if(isNotNull(tempProduct.modelList) && tempProduct.modelList.length > 0){
					/* selected가 Y인 모델의 마지막 index가 변수에 저장됨.*/
					for(let fn=0; fn<tempProduct.modelList.length; fn++){
						let tempModels = tempProduct.modelList[fn];
						
						if(pfCompareModelList[pr].modelCode === tempModels.modelCode){
							selectedIdx = fn;
						}
					}
				}

				tempProduct.frontModelIdx = selectedIdx;
				
				tempProduct = getProductInfo(tempProduct, eppProduct);
				//product까지 가공된 데이터를 productListData 에 저장해줌
				productListData[productListIndex] = tempProduct;
				
				let getCardInfo = getProductModelInfo(tempProduct, selectedIdx);
				cardGridHtml +=
					'<li class="compare-popup__product-item" role="listitem" data-productidx="'+productListIndex+'">'+
						'<h3 class="compare-popup__product-line-title"><span class="compare-popup__product-line-title-text">'+ Granite.I18n.get("Model") +'</span></h3>'+
						buildProductCard(getCardInfo)+
					'</li>';
					
				productListIndex++;
				
				// 웹접근성 화면에 노출안되는 영역
				hiddenHtml += '<div class="hidden" role="columnheader">' + tempProduct.modelList[tempProduct.frontModelIdx].displayName + '</div>';

				if(compareModelNameList  != ''){
					compareModelNameList += ', ';	
				}
				
				let displayName = "";
				if(isNotNull(tempProduct.modelList[tempProduct.frontModelIdx].displayName)){
					displayName = escapeHtml(tempProduct.modelList[tempProduct.frontModelIdx].displayName.replace(/<br>/ig," ").replace(/<sup>/ig," "));
				}
				compareModelNameList += unescapeHtml(displayName);
			}
			
			$(".spec-hidden-area").html(hiddenHtml);
			if(cardGridHtml !== ""){
				$(".compare-popup__product-list").html(cardGridHtml);
			}
			let specTableLabel = compareModelNameList + ' : specification';

			$(".compare-popup__detail-spec-table").attr("aria-label", specTableLabel);
		}
	}
	
	function compareListener(){
		/* 옵션칩(Color, Memory영역) 클릭 Event :: S */
		$(".js-compare-option-fmychip").find("input").off("click");
		$(".js-compare-option-fmychip").find("input").on("click", function(){
			let $optionInputEl = $(this);
			let $targetContentEl = $optionInputEl.closest(".compare-popup__product-item");
			let productIdx = $targetContentEl.data("productidx");
			let modelIdx = $optionInputEl.data("modeli");
			
			let selcardGrid = "";
			setTimeout(function(){
				if(isNotNull(modelIdx)){
					productListData[productIdx].frontModelIdx = modelIdx;
					
					let proObj = getProductModelInfo(productListData[productIdx], modelIdx);
					$targetContentEl.find('.option-selector__wrap:not(".is-option-empty")').each(function(idx){
						let tmpType = productListData[productIdx].optionTypeList[idx];
						let styleAttr = $(this).find('.option-selector__swiper-wrapper').attr("style");
						productListData[productIdx].viewOptionObj[tmpType].styleAttr = styleAttr;
					});
					
					$(this).closest(".compare-popup__product-item").find(".compare-popup__spec-wrap").remove();
					// 웹접근성 화면에 노출안되는 영역
					$($(".spec-hidden-area .hidden:not(:first)").get(productIdx)).empty();
					$($(".spec-hidden-area .hidden:not(:first)").get(productIdx)).html(proObj.modelList[proObj.frontModelIdx].displayName);
					
					selcardGrid +=
						'<h3 class="compare-popup__product-line-title"><span class="compare-popup__product-line-title-text">'+ Granite.I18n.get("Model") +'</span></h3>'+
						buildProductCard(proObj);
					$targetContentEl.html(selcardGrid);
					
					/*
					 * 옵션칩 클릭할때 compare api 호출 하기위한 모델 코드
					*/
					let selectedModel = new Array();
					$(".compare-popup__sku").each(function(){
						let _this = $(this);
						selectedModel.push(_this.data("modelcode"));
					});
			
					if(selectedModel.length > 0){
						specCall(selectedModel.toString());
					}
	
					// product card 를 새로 그려줬으므로 이벤트 새로 지정
					window.sg.components.comparePopup.cardInit($(".compare-popup__product-item").get(productIdx));
					compareListener();
				}
			}, 300);
		});
		/* 옵션칩(Color, Memory영역) 클릭 Event :: E */
		
		/* CTA click event :: S */
		let isBuyNowClicked = false;
		let $ctaBtn = $('.cl-buy-now');
		$ctaBtn.off("click.finder");
		$ctaBtn.on("click.finder", function(e){
			let $targetBtn = $(this);
			let modelCode = "";
			let configInfo = "";
			let configuratorURL = "";

			if(clIsGPv2){
				configInfo = $targetBtn.attr("data-config_info");
				modelCode = $targetBtn.attr("data-modelcode");
				let addToCartFlag = $targetBtn.attr("data-cart");
				let shopSkuCode = $targetBtn.attr("data-sku-code");

				if(addToCartFlag === "true"){
					let addToCartUrl = clCartUrl + "?addItem[]=" + shopSkuCode + ",1";
					if(eppIsFlash || eppIsRefurbish){
						addToCartUrl = clCartUrl + "?flash_skus=" + shopSkuCode;
					}
					window.location.href = addToCartUrl;
				}else{
					if(configInfo !== ""){
						if(configInfo.indexOf("?modelCode") < 0){
							configuratorURL = configInfo + "?modelCode=" + modelCode;
						} else {
							configuratorURL = configInfo;
						}
						window.location.href = configuratorURL;
					}
				}
			} else {
				if(isBuyNowClicked === true){
					return;
				}

				configInfo = $(this).attr("data-config_info");
				modelCode = $(this).attr("data-modelcode");
				let addToCartFlag = $targetBtn.attr("data-cart");
				
				let addCartTimeout = 10000;
				if(clSiteCode === "vn"){
					addCartTimeout = 20000;
				}
				
				if(configInfo !== ""){
					if(configInfo.indexOf("?modelCode") < 0){
						configuratorURL = configInfo + "?modelCode=" + modelCode;
					} else {
						configuratorURL = configInfo;
					}
					window.location.href = configuratorURL;
				}else if(addToCartFlag === "true"){
					let linkInfo = $(this).attr("data-link_info");
					if((clCartUrl.indexOf("http://") > -1 || clCartUrl.indexOf("https://") > -1) && !isEppSite){
						linkInfo = clCartUrl;
					}
					
					
					if(isB2b){
						if(isB2bhybris){ //b2b-hybris
							addToCartNewHybris(modelCode, linkInfo, {}, {}, {}, true, $targetBtn);
						}
					}else{
						if(isNewHybris && (clSiteCode ==='uk'  || clSiteCode === 'cn')){ //202010402 SEBN old hybris 적용, 20210408 id/ph //uk 적용
							addToCartNewHybris(modelCode, linkInfo);
						
						}else if(clSiteCode==="py" || clSiteCode==="ar" || clSiteCode==="br"){
							let storeurl = "";
							if(clSiteCode==="py"){
								storeurl = clStoreDomain + "/getServicesProduct?productCode="+modelCode;
							}else{
								storeurl = clStoreDomain + "/" + clSiteCode + "/getServicesProduct?productCode="+modelCode;
							}
							window.location.href = storeurl;
							
						} else if(addToCartPostYn == "Y"){// addToCart POST 호출 addToCartPostYn meta 정보로 구분 차후 이전 소스제거
							let realSiteCode = clSiteCode;
							if(isNotNull(shopSiteCd)){
								realSiteCode = shopSiteCd;
							}
							if(isEppSite){
								realSiteCode = eppCompanyCode;
							}
							let apiUrl = "";
							if(isNewHybris){
								apiUrl =  storeWebDomain + "/" + realSiteCode + "/servicesv2/addToCart";
							}else{
								apiUrl =  clStoreDomain + "/" + realSiteCode + "/servicesv2/addToCart";
							}
							let postParam = {
	                				'products' : [{
													'productCode' : modelCode,
													'quantity' : 1,
												}]
	                		};
									
							$.ajax({ 
								url: apiUrl,
								type: "POST",
								data: JSON.stringify (postParam),
								contentType : "application/json",
								dataType : "json",
								xhrFields: { withCredentials: true },
								crossDomain : true,
								timeout : addCartTimeout,
								success: function (data) {
									if(data){
										if(data.resultCode === "0000"){
											isBuyNowClicked = true;
											window.location.href = linkInfo;
										}else{
											confirmPopup(data.resultMessage,"error");
										}
									}else{
										confirmPopup("","error");
									}
								},error : function(e){
									var errorText = "";
								    if (e.responseJSON != null) {
								        if (isNotNull(e.responseJSON.message)) {
								            errorText = e.responseJSON.message;
								        }
								    }
									confirmPopup(errorText,"error");
								}
							});
							// addToCart POST 호출 addToCartPostYn meta 정보로 구분 차후 이전 소스제거 STR
						}else if(clHybrisApiJson === "Y"){
							let siteCodeWithEpp = isEppSite ?  eppCompanyCode : clSiteCode;
							let apiUrl = clStoreDomain + "/" + siteCodeWithEpp + "/ng/p4v1/addCart";
							if(isNewHybris  && clSiteCode !== 'uk'){
								apiUrl = storeWebDomain + "/" + siteCodeWithEpp + "/ng/p4v1/addCart";
							}
							$.ajax({
								url : apiUrl,
								type: "GET",
								data: {"productCode" : modelCode, "quantity" : 1},
								contentType : "application/x-www-form-urlencoded",
								dataType : "json",
								xhrFields: { withCredentials: true },
								crossDomain : true,
								timeout : addCartTimeout,
								success: function (data) {
									if(data){
										if(data.resultCode === "0000"){
											isBuyNowClicked = true;
											window.location.href = linkInfo;
										}else{
											confirmPopup(data.resultMessage,"error");
										}
									}else{
										confirmPopup("","error");
									}
								},error : function(e){
									let errorText = "";
									if (e.responseJSON !== null) {
										if (isNotNull(e.responseJSON.message)) {
											errorText = e.responseJSON.message;
										}
									}
									confirmPopup(errorText,"error");
								}
							});
						}else{
							let realSiteCode = clSiteCode;
							if(isNotNull(shopSiteCd)){
								realSiteCode = shopSiteCd;
							}
							if(isEppSite){
								realSiteCode= eppCompanyCode;
							}
							
							let apiUrl =  clStoreDomain + "/" + realSiteCode + "/ng/p4v1/addCart";
							if(isNewHybris && clSiteCode !== 'uk'){				//new-hybris
								apiUrl =  storeWebDomain + "/" + realSiteCode + "/ng/p4v1/addCart";
							}
							
							$.ajax({
								url : apiUrl,
								type : "GET",
								data : {"productCode" : modelCode, "quantity" : 1},
								dataType : "jsonp",
								jsonp : "callback",
								timeout : 10000,
								success : function (data) {
									if(data){
										if(data.resultCode === "0000"){
											isBuyNowClicked = true;
											window.location.href = linkInfo;
										}else{
											confirmPopup(data.resultMessage,"error");
										}
									}else{
										confirmPopup("","error");
									}
								},error : function(e){
									let errorText = "";
									if (e.responseJSON !== null) {
										if (isNotNull(e.responseJSON.message)) {
											errorText = e.responseJSON.message;
										}
									}
									confirmPopup(errorText,"error");
								}
							});
						}
						// addToCart POST 호출 addToCartPostYn meta 정보로 구분 차후 이전 소스제거 STR
					}
				}
			}
		});
	}

	/* Compare popup close event */
	$(document).on("click", ".compare-popup .layer-popup__close", function() {
		$(".compare-popup__product-list").html("");	// 초기화
		window.sg.components.comparePopup.closePopup(document.querySelector(".compare-popup"));
	});
	
	function specCall(modelArr){
		
		if(modelArr !== ""){
			let isB2 = "/b2c";
			if(isB2b){
				isB2 = "/b2b";
			}
			$.ajax({
				url: clSearchDomain + '/' + clApiStageInfo + isB2 +'/product/spec/compare',
				data: {
					"siteCode": clSiteCode,
					"modelList": modelArr
				},
				success: function(data) {
					if(data.response.statusCode === 200 && isNotNull(data.response.resultData)){
						compareSpecsGrid(data.response.resultData);
					}
				}
			});
		}
	}

	function layerGrid() {
		// init
		isSMBUser = false;
		isLogedin = false;
		useTaxExPrice = false;
		
		const useTaxExPriceYN =  $.cookies.get('useTaxExPriceYN', {domain : ".samsung.com"});
		if(useTaxExPriceYN === "Y"){
			useTaxExPrice = true;
		}
	
		if(isB2bhybris){
			isLogedin = commonLoginCheck();
			if(isLogedin && isB2bhybris){
				const isSMBRegisteredUserYN = $.cookies.get("isSMBRegisteredUserYN", {domain : ".samsung.com"});
				if(isSMBRegisteredUserYN === "Y"){
					isSMBUser = true;
				}
			}
		}
		
		let clModelList = "";
		let compareArr = "";
		if(pfCompareModelList.length > 0){
			for(let ed in pfCompareModelList){
				if(ed === "0"){
					clModelList += pfCompareModelList[ed].modelCode;
				}else{
					clModelList += ","+ pfCompareModelList[ed].modelCode;
				}
			}
			clSearchApiParam.modelList = clModelList;
			
			$.ajax({
				url: clSearchApiUrl,
				data: clSearchApiParam,
				success: function(data) {
					if(data.response.statusCode === 200 && isNotNull(data.response.resultData)){
						dataSet(data.response.resultData);
						window.sg.components.comparePopup.reInit();
						window.sg.components.comparePopup.compareFirstFocus();
						compareListener();
					}
				}
			});
			
			let isB2 = "/b2c";
			if(isB2b){
				isB2 = "/b2b";
			}
			if(eppIsFlash || eppIsRefurbish){
				clModelList = isNotNull(pfCompareModelList)? pfCompareModelList.map(item => item.originModelCode).join(",") : "";
			}
			$.ajax({
				url: clSearchDomain + '/' + clApiStageInfo + isB2 + '/product/spec/compare',
				data: {
					"siteCode": clSiteCode,
					"modelList": clModelList
				},
				success: function(data) {
					if(data.response.statusCode === 200 && isNotNull(data.response.resultData)){
						compareSpecsGrid(data.response.resultData);
					}
				}
			});
		}
	}

	pf.compareLayer = (function() {
		return {
			layerGrid: layerGrid
		}
	})();

})(window.jQuery, window.document);

(() => {
  const $q = window.sg.common.$q;
  const BREAKPOINTS = window.sg.common.constants.BREAKPOINTS;
  const utils = window.sg.common.utils;
  const lazyLoad = window.sg.common.lazyLoad;
  const KEYCODE = window.sg.common.constants.KEY_CODE;

  const selector = {
    component: '.where-to-buy',
    container: '.where-to-buy__container.layer-popup',
    tabItem: '.where-to-buy__tab-item button',
    tabPanelOnline: '.where-to-buy__online',
    tabPanelOffline: '.where-to-buy__locator',
    tabPanels: '.where-to-buy__tabpanels div[role="tabpanel"]',
    showMore: '.where-to-buy__store-more-cta',
    onlineListWrap: '.where-to-buy__store-list',
    onlineListItem: '.where-to-buy__store-item',
    distanceBtn: '.where-to-buy__distance-button',
    resultList: '.where-to-buy__result-content:not(.where-to-buy__result-content--disabled)',
    storeDetail: '.where-to-buy__detail',
    backStoreList: '.where-to-buy__detail-close',
    storeListArea: '.where-to-buy__result',
    storeListInner: '.where-to-buy__result-list',
    storeHeader: '.where-to-buy__result-top',
    layerCloseBtn: '.where-to-buy__content > .layer-popup__close',
    layerDim: '.layer-popup-dim',
    activeClsTop: 'where-to-buy__result--top',
    activeClsMiddle: 'where-to-buy__result--middle',
    activeClsBottom: 'where-to-buy__result--bottom',
    activeClsActive: 'where-to-buy__result--active',
    nearbyPop: '.where-to-buy__layer--nearby',
    nearbyPopClose: '.where-to-buy__layer--nearby .layer-popup__close, .where-to-buy__layer--nearby .cta--cancel',
    displayItem: 'display-item',
    isSelected: 'is-selected',
    isActive: 'is-active',
  };

  const el = {
    window: null,
    component: null,
  };

  class WhereToBuy {
    constructor(component) {
      this.el = {
        window: $q(window),
        component: $q(component),
        container: null,
        tabItem: null,
        tabPanelOnline: null,
        tabPanelOffline: null,
        showMore: null,
        onlineListWrap: null,
        onlineListItem: null,
        distanceBtn: null,
        resultList: null,
        storeDetail: null,
        storeHeader: null,
        backStoreList: null,
        storeListArea: null,
        storeListInner: null,
        layerCloseBtn: null,
        layerDim: null,
        isMoving: null,
        activeList: null,
        moveStartY: null,
        curPosition: null,
        closeFocus: null,
        nearbyPop: null,
        nearbyPopClose: null,
      };

      this.handler = {
        resize: this.resize.bind(this),
        slideMoveStart: this.slideMoveStart.bind(this),
        slideMoving: this.slideMoving.bind(this),
        slideMoveEnd: this.slideMoveEnd.bind(this),
        showPopup: this.showPopup.bind(this),
        closePopup: this.closePopup.bind(this),
        focusInnerPopup: (event) => {
          if (event.keyCode === KEYCODE.TAB) {
            if (this.matches(document.activeElement, '.layer-popup__inner') && event.shiftKey) {
              $q(document.activeElement).find('.layer-popup__close').focus();
            } else if (this.matches(document.activeElement, '.layer-popup__close') && event.shiftKey === false) {
              $q(document.activeElement).closest('.layer-popup__inner').focus();
            }
          }
        },
        focusShopDetail: (event) => {
          if (event.keyCode === KEYCODE.TAB) {
            requestAnimationFrame(() => {
              const $wrap = $q(document.activeElement).closest('.where-to-buy__detail');
              if ($wrap.target.length === 0) {
                const $detail = this.el.container.find('.where-to-buy__detail');
                if (event.shiftKey) {
                  const $focusAble = $detail.find('a, button');
                  $focusAble.eq($focusAble.target.length - 1).focus();
                } else {
                  $detail.focus();
                }
              }
            });
          }
        },
      };

      WhereToBuy.instances.set(component, this);

      this.setElement();

      this.init();
    }

    init() {
      this.bindEvents();

      this.resize();
    }

    reInit() {
      this.setElement();

      this.bindEvents();

      this.resize();
    }

    setElement() {
      this.el.container =  this.el.component.find(selector.container);
      this.el.tabItem = this.el.component.find(selector.tabItem);
      this.el.tabPanelOnline = this.el.component.find(selector.tabPanelOnline);
      this.el.tabPanelOffline = this.el.component.find(selector.tabPanelOffline);
      this.el.tabPanels = this.el.component.find(selector.tabPanels);
      this.el.showMore = this.el.component.find(selector.showMore);
      this.el.onlineListWrap = this.el.component.find(selector.onlineListWrap);
      this.el.onlineListItem = this.el.component.find(selector.onlineListItem);
      this.el.distanceBtn = this.el.component.find(selector.distanceBtn);
      this.el.resultList = this.el.component.find(selector.resultList);
      this.el.storeDetail = this.el.component.find(selector.storeDetail);
      this.el.storeHeader = this.el.component.find(selector.storeHeader);
      this.el.backStoreList = this.el.component.find(selector.backStoreList);
      this.el.storeListArea = this.el.component.find(selector.storeListArea);
      this.el.storeListInner = this.el.component.find(selector.storeListInner);
      this.el.layerCloseBtn = this.el.component.find(selector.layerCloseBtn);
      this.el.layerDim = this.el.component.find(selector.layerDim);
      this.el.nearbyPop = this.el.component.find(selector.nearbyPop);
      this.el.nearbyPopClose = this.el.component.find(selector.nearbyPopClose);
      this.el.isMoving = false;
      this.desktopFlag = false;
      this.mobileFlag = false;
      this.closeFocus = this.closeFocus || null;
    }

    activeTab(idx) {
      this.el.tabItem.removeClass(selector.isSelected);
      this.el.tabItem.eq(idx).addClass(selector.isSelected);
      
      this.el.tabPanels.removeClass(selector.isActive);
      this.el.tabPanels.eq(idx).addClass(selector.isActive);
    }

    showMoreItem() {
      const activeItem = [];
      let endCnt = 6;

      this.el.onlineListItem.target.forEach((item) => {
        const $item = $q(item);

        if ($item.css('display') === 'none') {
          activeItem.push($item);
        }
      });

      if (activeItem.length < endCnt) {
        endCnt = activeItem.length;
      }

      for (let i = 0; i < endCnt; i++) {
        activeItem[i].addClass(selector.displayItem);
      }

      if (this.el.onlineListItem.eq(this.el.onlineListItem.target.length - 1).hasClass(selector.displayItem)) {
        this.el.showMore.hide();
      }

      const movePos = this.el.component.find('.where-to-buy__store').target[0].scrollHeight - this.el.component.find('.where-to-buy__online-contents').height();
      this.el.component.find('.where-to-buy__online-contents').moveScroll(movePos, 200);
    }

    activeDistance(item) {
      const addSpan = '<span class="hidden">selected</span>';

      this.el.distanceBtn.removeClass(selector.isSelected);
      // this.el.distanceBtn.attr('aria-selected', false);
      item.addClass(selector.isSelected);
      // item.attr('aria-selected', true);

      this.el.distanceBtn.find('.hidden').remove();
      item.append(addSpan);
    }

    activeStoreList(item) {
      this.el.storeDetail.show();
      this.el.storeDetail.attr('tabindex', 0);
      this.el.storeDetail.focus();

      setTimeout(() => {
        this.resetClass(this.el.storeListArea);
        this.el.storeListArea.addClass(selector.activeClsMiddle);
      }, 200);

      this.el.activeList = item;
    }

    backStoreList() {
      this.el.storeDetail.removeAttr('tabindex');
      this.el.storeDetail.hide();
      this.el.activeList.focus();
    }

    slideMoveStart(e) {
      this.el.moveStartY = e.clientY ? e.clientY : e.changedTouches[0].pageY;
      this.el.curPosition = parseInt(this.el.storeListArea.css('top').replace('px', '')) || this.el.storeListArea.target[0].getBoundingClientRect().top - this.el.tabPanelOffline.target[0].getBoundingClientRect().top;
      this.el.isMoving = true;

      window.addEventListener('mousemove',this.handler.slideMoving,{ passive: false });
      this.el.window.on('mouseup', this.handler.slideMoveEnd);
      window.addEventListener('touchmove',this.handler.slideMoving,{ passive: false });
      this.el.window.on('touchend', this.handler.slideMoveEnd);
    }

    slideMoving(e) {
      if (this.el.isMoving) {
        const distance = (e.clientY ? e.clientY : e.changedTouches[0].pageY) - this.el.moveStartY;
        this.el.curPosition = this.el.curPosition + distance;

        this.resetClass(this.el.storeListArea);

        this.el.storeListInner.show();

        this.el.storeListArea.css({
          'top': `${this.el.curPosition}px`,
        });

        this.el.storeListArea.addClass(selector.activeClsActive);

        this.el.moveStartY = this.el.moveStartY + distance;
      }
      e.preventDefault();
    }

    slideMoveEnd() {
      const areaHeight = this.el.component.find('.where-to-buy__locator').height();
      const areadivMin = areaHeight / 3;
      const areadivMax = areaHeight - areadivMin;
      let positionCls;

      this.el.isMoving = null;
      this.el.moveStartY = 0;
      this.el.curPosition = parseInt(this.el.storeListArea.css('top').replace('px', '')) || null;

      if (this.el.curPosition === null) {
        return;
      }

      this.el.storeListArea.css({
        'top': '',
      });

      this.el.storeListArea.removeClass(selector.activeClsActive);

      if (this.el.curPosition < areadivMin) {
        positionCls = selector.activeClsTop;
      } else if (this.el.curPosition > areadivMax) {
        positionCls = selector.activeClsBottom;
        
        setTimeout(() => {
          this.el.storeListInner.hide();
        },200);
      } else {
        positionCls = selector.activeClsMiddle;
      }

      this.el.storeListArea.addClass(positionCls);

      window.removeEventListener('mousemove',this.handler.slideMoving);
      this.el.window.off('mouseup', this.handler.slideMoveEnd);
      window.removeEventListener('touchmove',this.handler.slideMoving);
      this.el.window.off('touchend', this.handler.slideMoveEnd);
    }

    resetClass(item) {
      [selector.activeClsTop, selector.activeClsMiddle, selector.activeClsBottom].forEach((cls) => {
        item.removeClass(cls);
      });
    }

    closeLayer() {
      this.el.layerDim.hide();
      this.el.container.hide();
    }

    showPopup(btn) {
      this.el.container.show();
      this.el.layerDim.show();

      utils.hiddenScroll();
      this.el.component.setLayerFocus(selector.container, selector.layerCloseBtn);
      const $innerPopup = this.moveFocusInnerPopup();
      if ($innerPopup === null) {
        window.sg.common.utils.setMobileFocusLoop(this.el.component.target[0]);
      }
      this.closeFocus = btn;
    }

    moveFocusInnerPopup(){
      let $innerPopup = null;

      this.el.container.find('.where-to-buy__locator.is-active').find('.where-to-buy__layer--gbs, .where-to-buy__layer--nearby').target.forEach((pop) => {
        if(pop.style.display === 'block'){
          $innerPopup = $q(pop).find('.layer-popup__inner');
          $innerPopup.focus();
        }
      });

      if($innerPopup !== null && $innerPopup.target.length > 0){
        window.sg.common.utils.removeMobileFocusLoop();
        window.sg.common.utils.setMobileFocusLoop($innerPopup.target[0]);
        return $innerPopup.target[0];
      } else {
        return null;
      }
    }

    closePopup(btn = null) {
      const btnEl = btn === null ? this.closeFocus : btn;
      utils.visibleScroll();
      this.el.component.offLayerFocus();
      window.sg.common.utils.removeMobileFocusLoop();
      this.closeLayer();
      this.originFocus(btnEl);
    }

    originFocus(backBtn = null) {
      if (backBtn !== null) {
        backBtn.focus();
      }
    }

    resize() {
      if (BREAKPOINTS.MOBILE > utils.getViewPort().width) {
        if (utils.getViewPort().width > utils.getViewPort().height) {
          this.el.component.addClass('mode--landscape');
        } else {
          this.el.component.removeClass('mode--landscape');
        }
        if (this.mobileFlag === false) {
          this.mobileFlag = true;
          this.desktopFlag = false;

          // drag event(store list)
          this.el.storeHeader.target.forEach((item) => {
            const $item = $q(item);

            $item.on('mousedown', this.handler.slideMoveStart);
            $item.on('touchstart', this.handler.slideMoveStart);
          });

          this.resetClass(this.el.storeListArea);
        }
      } else {
        this.el.component.removeClass('mode--landscape');
        if (this.desktopFlag === false) {
          this.desktopFlag = true;
          this.mobileFlag = false;

          this.el.storeHeader.target.forEach((item) => {
            const $item = $q(item);
    
            $item.off('mousedown', this.handler.slideMoveStart);
            $item.off('touchstart', this.handler.slideMoveStart);
          });

          this.el.storeListInner.show();

          this.resetClass(this.el.storeListArea);
        }
      }
    }

    matches(el, selector) {
      return (el.matches ? el.matches(selector) : el.msMatchesSelector(selector));
    }

    bindEvents() {
      $q(window).off('resize', this.handler.resize).on('resize', this.handler.resize);

      // tab active
      this.el.tabItem.target.forEach((item, idx) => {
        const $item = $q(item);

        $item.off('click').on('click', () => {
          this.activeTab(idx);
          this.moveFocusInnerPopup();
        });
      });

      // show more
      this.el.showMore.target.forEach((item) => {
        const $item = $q(item);

        $item.off('click').on('click', () => {
          this.showMoreItem();
        });
      });

      // distance active
      this.el.distanceBtn.target.forEach((item) => {
        const $item = $q(item);

        // if ($item.hasClass(selector.isSelected)) {
        //   $item.attr('aria-selected', true);
        // } else {
        //   $item.attr('aria-selected', false);
        // }

        $item.off('click').on('click', () => {
          this.activeDistance($item);
        });
      });

      // offline store active
      this.el.resultList.target.forEach((item) => {
        const $item = $q(item);

        $item.off('click').on('click', () => {
          if (!$item.hasClass('new-window')) {
            this.activeStoreList($item);
          }
        });
      });

      // back store list
      this.el.backStoreList.target.forEach((item) => {
        const $item = $q(item);

        $item.off('click').on('click', () => {
          this.backStoreList();
        });
      });

      // popup close
      this.el.nearbyPopClose.off('click').on('click', () => {
        this.el.nearbyPop.hide();

        window.sg.common.utils.removeMobileFocusLoop();
        window.sg.common.utils.setMobileFocusLoop(this.el.component.target[0]);

        this.el.distanceBtn.target.forEach((item) => {
          const $item = $q(item);

          if ($item.hasClass('is-selected')) {
            $item.focus();
          }
        });
      });

      this.el.layerCloseBtn.on('click', () => {
        this.closePopup();
      });

      //inner Popup focus lock
      this.el.container.find('.where-to-buy__locator').find('.where-to-buy__layer--gbs, .where-to-buy__layer--nearby').find('.layer-popup__inner')
        .attr('tabindex', 0)
        .off('keydown', this.handler.focusInnerPopup)
        .on('keydown', this.handler.focusInnerPopup);

      this.el.container.find('.where-to-buy__detail')
        .off('keydown', this.handler.focusShopDetail)
        .on('keydown', this.handler.focusShopDetail);
    }
  }

  const init = () => {
    el.window = $q(window);
    el.component = $q(selector.component);

    if (!el.component.target.length) {
      return;
    }

    lazyLoad.setLazyLoad();

    $q(selector.component).target.forEach((element) => {
      if (!WhereToBuy.instances.has(element)) {
        new WhereToBuy(element);
      }
    });
  };

  const reInit = () => {
    lazyLoad.setLazyLoad();
    
    $q(selector.component).target.forEach((element) => {
      if (WhereToBuy.instances.has(element)) {
        const instances =  WhereToBuy.instances.get(element);
        instances.reInit();
      } else {
        new WhereToBuy(element);
      }
    });
  };

  WhereToBuy.instances = new WeakMap();

  function showPopup(closeEl) {
    $q(selector.component).target.forEach((element) => {
      if (!WhereToBuy.instances.has(element)) {
        new WhereToBuy(element).showPopup(closeEl);
      } else {
        WhereToBuy.instances.get(element).showPopup(closeEl);
      }
    });
  }


  function closePopup(closeEl) {
    $q(selector.component).target.forEach((element) => {
      if (!WhereToBuy.instances.has(element)) {
        new WhereToBuy(element).closePopup(closeEl);
      } else {
        WhereToBuy.instances.get(element).closePopup(closeEl);
      }
    });
  }

  $q.ready(init);

  window.sg.components.whereToBuy = {
    init,
    reInit,
    showPopup,
    closePopup,
  };
})();

(function (win, $) {
	'use strict';
	
	/**
	 * 1. Where To Buy 버튼 class에 'js-cta-buy'를 넣어 주세요. 
	 *   -. P5에서는 js-cta-buy, js-cta-buy-etc 국가 분기에 따라 혼용해서 사용하였는데, 'js-cta-buy' 만 넣으시면 됩니다.
	 *   -. Local WTB ps-widget, cci-trigger-overlay class는 별도 선언 하지 않아도 됩니다.
	 * 2. 적용 attribute (하위 4개 다 넣어주어도 무관함.)
	 *    -. data-modelcode
	 *    -. data-iacode
	 *    -. data-title  (at / ch / ch_fr / de ) 에 사용
	 *    -. data-img-src (at / ch / ch_fr / de ) 에 사용
	 *    위 4개의 attribute를  WTB CTA에 넣어 주시고, 기존에 사용한던 data-sku, data-productcode, ps-sku 등은 넣지 않아도 됩니다.
	 * 3. 페이지 로드 된 후에 JavaScript에서 WTB 버튼을 화면에 넣은 경우(비동기 호출)에는 
	 *    window.smg.wtb.common.reInit(); 함수를 호출 해 주세요.
	 *    종전에 ca/ca_fr 에서 사용하던 PriceSpider.rebind()는 별도로 호출 하실 필요 없습니다.
	 * 4. 각 국가별 외부 WTB를 사용하기 위한 Script 선언은 페이지에서 하셔야 합니다. (pd/pf/search page 참고)
	 */
	
	if('undefined' === typeof win.smg) {
		win.smg = {};
	}
	
	var wtb = win.smg.wtb = win.smg.wtb || {};
	
	wtb.initData = {
			nodePath 				: $("#current_node_path").val(),
			d_modelCode 			: $("#current_model_code").val(),
			d_categorySubTypeCode	: $("#wtb-categorySubTypeCode").val(),
			buyinstoreRedirectYN 	: $("#buyinstoreRedirectYN").val(),
			bvConversationFlag 		: $("#bvConversationFlag").val(),
			bvConversationRTLFlag 	: $("#bvConversationRTLFlag").val(),
			channelCampaignTag		: "N", // 실제 WTB 클릭시 campaign tag (tag=WTBwidget) 를 넣어서 호출 변경위함
			placedWtbResources 		: false,
			useNewWtbFlag 			: $("#useNewWtb").val(),
			distanceUnitValue 		: "",
			modelCodeValue 			: "",
			rtlValue 				: $("#rtlValue").val(),
			apiChangeStockStatus	: "",
			useWtbStockFunction		: ""
	}
	
	wtb.common = (function() {
		return {
			reInit : function() {
				rebindWtbBtn();
			}
		}
	})();
	
	function rebindWtbBtn() {
		var siteCode = $("#siteCode").val();
		
		$(".js-cta-buy, .js-cta-buy-etc").each(function(){
			if(siteCode === 'ca' || siteCode === 'ca_fr') {
				$(this).addClass("ps-widget");
				$(this).attr("ps-sku", $(this).data("modelcode"));
				PriceSpider.rebind();
			}
			
			if(siteCode === "de") {
				/*|| (siteCode === "de" && "010" !== $(this).attr("data-iacode").substring(0,3))*/
				$(this).addClass("cci-trigger-overlay");
				$(this).attr("data-sku", $(this).data("modelcode"));
				$(this).attr("data-productcode", $(this).data("modelcode"));
			}
		});
		
	}
	
	function _init() {
		rebindWtbBtn();
		wtb.bak.init();
	}
	
	$(function () {
		_init();
	});
	
})(window, window.jQuery);
(function (win, $) {
	'use strict';
	
	win.smg = win.smg || {};
	var wtb = win.smg.wtb = win.smg.wtb || {};
	
	wtb.bak = (function() {
		return {
			init : function() {
				callWtb();
			},	
			
			reInit : function() {
				window.sg.components.whereToBuy.reInit();
			}
		}
		
	})();
	
	function callWtb() {
		var initData = win.smg.wtb.initData;
		
	    //offline store set cookie
	    function setOffStoreCookie(cname, cvalue, exdays) {
			var d = new Date();
			d.setTime(d.getTime() + ((exdays || 0) * 24 * 60 * 60 * 1000));
			document.cookie = cname + '=' + cvalue + '; expires=' + d.toUTCString();
		};
		
		//offline store get cookie
		function  getOffStoreCookie(cname) {
			var name = cname + '=',
				ca = document.cookie.split(';'),
				c;

			for(var i=0, leng=ca.length; i<leng; i++) {
				c = ca[i];
				while (c.charAt(0)===' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) !== -1) {
					return c.substring(name.length,c.length);
				}
			}
			return '';
		};
		

		//offline store list 
		var getOffStoreList = function(jsonData) {
			$('#store-list').html("");
			var totalStoreCount = jsonData.common.storesCount;
			var storesData = jsonData.stores;
			var geoInfoData = jsonData.geoInfo;
			$(".where-to-buy__container .where-to-buy__result-count").text(totalStoreCount);
			if(totalStoreCount !== 0) {
				for (var ii = 0; ii < totalStoreCount; ii++) {
					var storeList = "";
				
					storeList += 
						'<li class="where-to-buy__result-item" role="listitem">' + 
							'<a href="javascript:;" class="where-to-buy__result-content ';
							var storeClass = ""; 
							var brandType ="";
							var storeName = storesData[ii].name;
							if(storesData[ii].cityName != null) {
								storeName += " " + storesData[ii].cityName;
							}
								if(storesData[ii].brandTypeCode === 'E') {
									storeClass = "type--experience";
									brandType = "E";
								}else if(storesData[ii].brandTypeCode === 'B') {
									storeClass = "type--brand";
									brandType = "B";
								}else if(storesData[ii].brandTypeCode === 'O') {
									storeClass = "type--other";
									brandType = "O";
								}
					storeList += storeClass + '" role="button"' + 
					            'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-detail view" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+'">' +
								'<div class="where-to-buy__result-info" data-store-id="'+ storesData[ii].id +'">' + 
									'<p class="where-to-buy__result-type">';
					/* SVG Icon 추가 */
					storeList += '<svg class="icon icon--store-experience" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-experience-i"></use>' +
								'</svg>' +
								'<svg class="icon icon--store-brand" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-brand-i"></use>' +
								'</svg>' +
								'<svg class="icon icon--store" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-other-i"></use>' +
								'</svg>';
									if(brandType === "E") {
										storeList += Granite.I18n.get("Samsung Experience Stores");
									}else if(brandType === "B") {
										storeList += Granite.I18n.get("Samsung Brand Store");
									}else if(brandType === "O") {
										storeList += Granite.I18n.get("Other Store");
									}
					/* SVG Icon 추가 */
					storeList += '<svg class="icon icon--next" focusable="false" aria-hidden="true">' +
		                        '<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-bold"></use>' +
		                        '</svg>';
					storeList += '</p>';
					
					storeList += '<p class="where-to-buy__result-name">'+ storesData[ii].name;
									if (storesData[ii].cityName != null) {
										storeList += 
										'<span class="where-to-buy__locator__store-city">'+ ' '+storesData[ii].cityName +'</span></p>';
									}																											
					storeList += '<p class="where-to-buy__result-distance">'+ storesData[ii].distance + initData.distanceUnitValue +'</p>' +
									'<input type="hidden" class="lat" value="'+ storesData[ii].latitude +'">' +
									'<input type="hidden" class="long" value="'+ storesData[ii].longitude +'">' + 
									'<input type="hidden" class="storeId" value="'+ storesData[ii].id +'">' + 
									'<input type="hidden" class="storeindex" value="'+ (ii+1) +'">' + 
									'<input type="hidden" id="markerlatitude_'+ (ii+1) +'" value="'+ storesData[ii].latitude +'">'+
									'<input type="hidden" id="markerlongitude_'+ (ii+1) +'" value="'+ storesData[ii].longitude +'">'+	
									'<input type="hidden" id="markerlongitude_'+ (ii+1) +'" value="'+ storesData[ii].longitude +'">'+
									'<input type="hidden" id="markerbrandtype_'+ (ii+1) +'" value="'+ brandType +'">'+
								'</div>'  +
									'</a>' + 
									'</li>';	
					$('#store-list').append(storeList);
				}
				if(geoInfoData) {
					$("#maxLat").val(geoInfoData.maxLatitude);
					$("#minLat").val(geoInfoData.minLatitude);
					$("#maxLong").val(geoInfoData.maxLongitude);
					$("#minLong").val(geoInfoData.minLongitude);
					$("#store-list li:eq(0)>a").addClass("is-active");
				}
			}
			if(totalStoreCount === 0) {
				$("#store_list_nullYn").val("Y");
				$("#stroelength").val("0");
			}else{
				$("#store_list_nullYn").val("N");
				$("#stroelength").val(totalStoreCount);
			}							
		}
		
		//hatch offlinestore data
		var getHatchOffStoreList = function(jsonData) {
			$('#store-list').html("");
			var totalStoreCount = jsonData.locations.length;
			var storesData = jsonData.locations;
			var geoInfoData = jsonData.geoInfo;
			
			$(".where-to-buy__container .where-to-buy__result-count").text(totalStoreCount);
			if(totalStoreCount !== 0) {
				for (var ii = 0; ii < totalStoreCount; ii++) {
					var initNum = 0;
					var hatchDistance = "";
					if(initData.distanceUnitValue == "Km"){
						hatchDistance = (parseFloat(storesData[ii].distance)/1000).toFixed(2);
					}else if(initData.distanceUnitValue == "Mile"){
						hatchDistance = (parseFloat(storesData[ii].distance)/1609.344).toFixed(2);
					}
					
					var storeList = "";
				
					storeList += 
						'<li class="where-to-buy__result-item" role="listitem">' + 
							'<a href="javascript:;" class="where-to-buy__result-content ';
							var storeClass = ""; 
							var brandType ="";
							var storeName = "";
							if(storesData[ii].name != null && storesData[ii].name != ""){
								storeName = storesData[ii].name;
							}					
								if(storesData[ii].storeTypes == '1_ses') {
									storeClass = "type--experience";
									brandType = "E";
								}else if(storesData[ii].storeTypes == '2_sbs') {
									storeClass = "type--brand";
									brandType = "B";
								}else if(storesData[ii].storeTypes == '3_retailer_store' || storesData[ii].storeTypes == null) {
									storeClass = "type--other";
									brandType = "O";
								}
					storeList += storeClass + '" role="button"' + 
					            'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-detail view" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+'">' +
								'<div class="where-to-buy__result-info" data-store-id="'+ storesData[ii].searchableId +'">' + 
									'<p class="where-to-buy__result-type">';
					/* SVG Icon 추가 */
					storeList += '<svg class="icon icon--store-experience" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-experience-i"></use>' +
								'</svg>' +
								'<svg class="icon icon--store-brand" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-brand-i"></use>' +
								'</svg>' +
								'<svg class="icon icon--store" focusable="false" aria-hidden="true">' +
								'<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#pin-other-i"></use>' +
								'</svg>';
									if(brandType === "E") {
										storeList += Granite.I18n.get("Samsung Experience Stores");
									}else if(brandType === "B") {
										storeList += Granite.I18n.get("Samsung Brand Store");
									}else if(brandType === "O") {
										storeList += Granite.I18n.get("Other Store");
									}
					/* SVG Icon 추가 */
					storeList += '<svg class="icon icon--next" focusable="false" aria-hidden="true">' +
		                        '<use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#next-bold"></use>' +
		                        '</svg>';
					storeList += '</p>';
					
					storeList += '<p class="where-to-buy__result-name">'+ storeName;
									if (storesData[ii].locality != null && storesData[ii].locality != "") {
										storeList += 
										'<span class="where-to-buy__locator__store-city">'+ ' '+storesData[ii].locality +'</span></p>';
									}																											
					storeList += '<p class="where-to-buy__result-distance">'+ hatchDistance + initData.distanceUnitValue +'</p>' +
									'<input type="hidden" class="lat" value="'+ storesData[ii].coordinates.latitude +'">' +
									'<input type="hidden" class="long" value="'+ storesData[ii].coordinates.longitude +'">' + 
									'<input type="hidden" class="storeId" value="'+ storesData[ii].searchableId +'">' + 
									'<input type="hidden" class="storeindex" value="'+ (ii+1) +'">' + 
									'<input type="hidden" id="markerlatitude_'+ (ii+1) +'" value="'+ storesData[ii].coordinates.latitude +'">'+
									'<input type="hidden" id="markerlongitude_'+ (ii+1) +'" value="'+ storesData[ii].coordinates.longitude +'">'+	
									'<input type="hidden" id="markerbrandtype_'+ (ii+1) +'" value="'+ brandType +'">'+
								'</div>'  +
									'</a>' + 
									'</li>';	
					$('#store-list').append(storeList);
				}
			}
			if(totalStoreCount === 0) {
				$("#store_list_nullYn").val("Y");
				$("#stroelength").val("0");
			}else{
				$("#store_list_nullYn").val("N");
				$("#stroelength").val(totalStoreCount);
			}							
		}
		
		//offline store map 

	    var setMapData = function(infowindow, target, offStoreMap, markerlist) {
	    	var hatchOffstoreUse = $("#hatchOffstoreUse").val();
            var currentIndex = target.attr("labelContent");
            var currentStoreId = $("#store-list li:eq("+(currentIndex-1)+") .storeId").val();		                  
            var offDeatilSearchDomain = $("#searchApiDomain").val() + '/' + $("#apiStageInfo").val() + '/b2c/storelocator/detail';
            
            var siteCd = $("#siteCode").val();
			var distanceUnit = $("#offstoreDistanceUnit").val();
			var latitude = $("#offstoreLatitude").val();
            var longitude = $("#offstoreLongitude").val();
			var param = {
				"siteCode":siteCd,
				"latitude":latitude,
        		"longitude":longitude,
        		"distanceUnit":distanceUnit,
        		"storeId":currentStoreId
        		}
			
			if(hatchOffstoreUse != 'Y'){
				$.ajax({
					type: "GET",						
					url: offDeatilSearchDomain,
					data : param,
					async:false,
					success: function (data) {
						var storeData = data.response.resultData.storeDetail; 
						var storeName = storeData.name;
						if(storeData.cityName != null) {
							storeName +=  ' ' + storeData.cityName;
						}
						var context = "";
	                    context += '<div class="where-to-buy__map-tooltip">'+
	                    				'<p class="where-to-buy__map-store-name">'+
	                    					'<button type="button" class="store-arr2" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-detail view" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+'">'+storeName;
	                    		context += 	'</button>' + 
	                    				'</p>';
	                    		if((storeData.phone != null && storeData.phone !== "") || (storeData.email != null && storeData.email !== "")) {						                    				                    				
	                    context += 		'<ul class="where-to-buy__map-info-list">';
	                    			if (storeData.phone != null && storeData.phone !== "") {
	                    				context +=
	                    					'<li class="where-to-buy__map-info-item">'+
                								'<a href="tel:'+storeData.phone+'" class="where-to-buy__map-info-link icon-tel" title="Call '+storeData.phone+'"' +
                								'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+':call">'+storeData.phone+
                								  /* SVG Icon 추가 */
                								  '<svg class="icon icon--tel" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#call-bold"></use></svg>' +
                								'</a>'+
                							'</li>';
									}
	                    			if (storeData.email != null && storeData.email !== "") {
	                    				context +=
	                    					'<li class="where-to-buy__map-info-item">'+
                								'<a href="mailto:'+storeData.email+'" class="where-to-buy__map-info-link icon-mail" title="Mail to '+storeData.email+'"' +
                								'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+':email">'+storeData.email+'</a>'+
                							'</li>';
									}
	                    context += 		'</ul>';
	                    		}
	                    context += 		'<input class="ly_brandType" value="'+storeData.brandType+'" type="hidden">'+
	                    				'<input class="lat" type="hidden" value="'+storeData.latitude+'"/>'+
	                    				'<input class="long" type="hidden" value="'+storeData.longitude+'"/>'+
	                    				'<input id="detail-index" type="hidden" value="'+currentIndex+'">'+
	                    				'<input id="currentStoreId" type="hidden" value="'+currentStoreId+'">'+
	                    			'</div>';						                    						                    					
	                    $("#tv-experience-layer").html(context); 
	                    infowindow.setContent( ""+ context ) ;
	                    infowindow.open(offStoreMap, markerlist);		
	                    $('.where-to-buy__result-content').removeClass('is-active');
	                    $('#store-list li:eq('+(currentIndex-1)+') .where-to-buy__result-content').addClass('is-active');
	                    $(".where-to-buy__result-content").eq(currentIndex-1).focus();
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
					}
				});	
			}else{							
				var hatchOffstoreUrl = $("#hatchOffstoreUrl").val();
				var hatchOffstoreBrandID =  $("#hatchOffstoreBrandID").val();
				var hatchOffstoreRegion = $("#hatchOffstoreRegion").val();
				var hatchOffstoreLang = $("#hatchOffstoreLang").val();
				var offHatchDomain = hatchOffstoreUrl + hatchOffstoreBrandID + "/geo/list";			
				var offHatchnRadius = $("button.where-to-buy__distance-button.is-selected").attr("data-value");
				if(initData.distanceUnitValue == "Mile"){
					offHatchnRadius = offHatchnRadius*1609.344;
				}else{
					offHatchnRadius = offHatchnRadius*1000;
				}			
				var modelCode = "";
				if ($("#selectModelCode").val() == null || $("#selectModelCode").val() === undefined || $("#selectModelCode").val() === "" ) {
					modelCode = $("#current_model_code").val();
				}else{
					modelCode = $("#selectModelCode").val();
				}
				var hatchParam = "";
				if(hatchOffstoreLang != "" && hatchOffstoreLang != null){
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"segment": hatchOffstoreLang,
						"filters":[
							{
							  "columnName": "searchableId",
							  "operation": "equal",
							  "value": [currentStoreId]
							  }
						]
					};
				}else{
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"filters":[
							{
							"columnName": "searchableId",
							  "operation": "equal",
							  "value": [currentStoreId]
							  }
						]
					};
				}
				
				$.ajax({
					headers: {
						"Content-Type": "application/json",
						//"Cookie" : "icl_opt_out=true"
					},
					type: "POST",						
					url: offHatchDomain,
					data: JSON.stringify(hatchParam),
					cache: true,
					timeout: 20000,
					success: function (data) {
						var storeData = data.locations[0];	
						var storeName = "";
						if(storeData.name != null && storeData.name != ""){
							storeName = storeData.name;
						}					
						if(storeData.locality != null && storeData.locality != "") {
							storeName	+= ' ' + storeData.locality;	
						}
						var brandType ="";
						if(storeData.storeTypes == '1_ses') {
							brandType = "E";
						}else if(storeData.storeTypes == '2_sbs') {
							brandType = "B";
						}else{
							brandType = "O";
						}
						
						var context = "";
	                    context += '<div class="where-to-buy__map-tooltip">'+
	                    				'<p class="where-to-buy__map-store-name">'+
	                    					'<button type="button" class="store-arr2" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-detail view" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+'">'+storeName;
	                    		context += 	'</button>' + 
	                    				'</p>';
	                    		if((storeData.telephone != null && storeData.telephone !== "") || (storeData.email != null && storeData.email !== "")) {						                    				                    				
	                    context += 		'<ul class="where-to-buy__map-info-list">';
	                    			if (storeData.telephone != null && storeData.telephone !== "") {
	                    				context +=
	                    					'<li class="where-to-buy__map-info-item">'+
                								'<a href="tel:'+storeData.telephone+'" class="where-to-buy__map-info-link icon-tel" title="Call '+storeData.telephone+'"' +
                								'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+':call">'+storeData.telephone+
                								  
                								  '<svg class="icon icon--tel" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#call-bold"></use></svg>' +
                								'</a>'+
                							'</li>';
									}
	                    			if (storeData.email != null && storeData.email !== "") {
	                    				context +=
	                    					'<li class="where-to-buy__map-info-item">'+
                								'<a href="mailto:'+storeData.email+'" class="where-to-buy__map-info-link icon-mail" title="Mail to '+storeData.email+'"' +
                								'an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeName+':email">'+storeData.email+'</a>'+
                							'</li>';
									}
	                    context += 		'</ul>';
	                    		}
	                    context += 		'<input class="ly_brandType" value="'+brandType+'" type="hidden">'+
	                    				'<input class="lat" type="hidden" value="'+storeData.coordinates.latitude+'"/>'+
	                    				'<input class="long" type="hidden" value="'+storeData.coordinates.longitude+'"/>'+
	                    				'<input id="detail-index" type="hidden" value="'+currentIndex+'">'+
	                    				'<input id="currentStoreId" type="hidden" value="'+currentStoreId+'">'+
	                    			'</div>';						                    						                    					
	                    $("#tv-experience-layer").html(context); 
	                    infowindow.setContent( ""+ context ) ;
	                    infowindow.open(offStoreMap, markerlist);		
	                    $('.where-to-buy__result-content').removeClass('is-active');
	                    $('#store-list li:eq('+(currentIndex-1)+') .where-to-buy__result-content').addClass('is-active');
	                    $(".where-to-buy__result-content").eq(currentIndex-1).focus();
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
					}
				});
			}
	    }
	    
		var markers = [];
	    var initMap = function (latitude, longitude, gpsNRadius) {			    	
			var defaultLocation = new google.maps.LatLng(latitude, longitude);
			var offStoreMap;			    
	        var nRadius;
	        var nRadiusTemp = $("button.where-to-buy__distance-button.is-selected").attr("data-value");
	        if(nRadiusTemp) {
	        	nRadius = nRadiusTemp;
	        } else {
	        	if(gpsNRadius === 'Y') {
	        		nRadius = 5;		        	
			    } else {
			    	nRadius = 10;
			    }	
	        }
	        
	        var zoomSet = 15;

	        if(parseInt(nRadius) <= 1) {
	        	zoomSet = 15;
	        }else if(parseInt(nRadius) > 1 && parseInt(nRadius) <= 2) {
	        	zoomSet = 14;
	        }else if(parseInt(nRadius) > 2 && parseInt(nRadius) <= 5) {
	        	zoomSet = 13;
	        }else if(parseInt(nRadius) > 5 && parseInt(nRadius) <= 10) {
	        	zoomSet = 12;
	        }else if(parseInt(nRadius) > 10 && parseInt(nRadius) <= 25) {
	        	zoomSet = 11;
	        }else if (parseInt(nRadius) > 25 && parseInt(nRadius) <= 50) {
	        	zoomSet = 10;
	        }else if (parseInt(nRadius) > 50) {
	        	zoomSet = 9;
	        }
	        
	        var controlPosition = rtlValue === "Y" ? google.maps.ControlPosition.LEFT_TOP : google.maps.ControlPosition.RIGHT_TOP;
	        
	        var mapOptions = {
	        		scaleControl: true,
	                scaleControlOptions: {
	                    position: google.maps.ControlPosition.BOTTOM_CENTER
	                },
	                mapTypeControl: false,
	                panControl: true,
	                panControlOptions : {
	                    position: controlPosition
	                },
	                zoomControl: true,
	                zoomControlOptions: {
	                    style: google.maps.ZoomControlStyle.SMALL,
	                    position: controlPosition
	                },
	                streetViewControl: true,
	                streetViewControlOptions: {
	                    position: controlPosition
	                },
	              center: defaultLocation,		             
	              zoom: zoomSet,		             
	              mapTypeId: google.maps.MapTypeId.ROADMAP
	            };
	        			        
	        offStoreMap = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
	        
	        var gpsMarker = "";
	        var circle = "";
	        if(getOffStoreCookie("newwtb_offstore") == 'true'){
	        	gpsMarker = new google.maps.Marker({
	        		position: defaultLocation,
	                map: offStoreMap,
	                icon : {
                        	scaledSize: new google.maps.Size(50, 50),
	                		origin: new google.maps.Point(0,0), 
	                        anchor: new google.maps.Point(0,0)
	                     }
	                });    
	                 
	        	circle = new google.maps.Circle({
	        		map: null
	        	});
	                 
	        	circle = new google.maps.Circle({
	        		map: offStoreMap,
	        		center : defaultLocation,
	        		radius: 5000, 
	        		fillColor: '#AA0000', 
	        		strokeColor :'#AA0000', 
	        		strokeOpacity:0 
	        	});

	        }
	        
	        var infowindow = new google.maps.InfoWindow();
	        
	        $('#store-list').children('li').each(function(index) {
	        	var indexData = index+1;
	    	    var markerlatitude = Number($("#markerlatitude_"+indexData).val());
	    	    var markerlongitude = Number($("#markerlongitude_"+indexData).val());
	            var marklistLocation = new google.maps.LatLng(markerlatitude, markerlongitude);
	            
	            var labelNum = 0;
	            labelNum += indexData;
	            
	    	    var markerlist;
	    	    
	    	    var imageIconUrl = "";
	    	    var markerType = $("#markerbrandtype_"+indexData).val();
	    	  
	    	    if(markerType === "E") {
	    	    	imageIconUrl = "/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/icon-pin-experience.svg";
	    	    }else if(markerType === "B") {
	    	    	imageIconUrl = "/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/icon-pin-brand.svg";
	    	    }else if(markerType === "O") {
	    	    	imageIconUrl = "/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/icon-pin-other.svg";
	    	    }		    	   
	    	    
	    	    markerlist = new google.maps.Marker({
	    			position: marklistLocation,
	    			labelContent: ''+labelNum,
	    			map: offStoreMap,
	    			icon : {
	    		    	    url: imageIconUrl, 
	    		    	    origin: new google.maps.Point(0,0), 
	    		    	    anchor: new google.maps.Point(0,0), 
	    		    	    scaledSize: new google.maps.Size(60, 60)
    	    	    }
	    		});
	    	    		  	    
	    	    markers[labelNum] = markerlist;
	    	    
	    	    var	openWindowFn = function() {
                    if (infowindow) {
                        infowindow.close();
                    }
                    setMapData(infowindow, $(this), offStoreMap, markerlist);                    		                    
            	}
	    	    markerlist.addListener('click', function() {		    	    	
	    	    	offStoreMap.setCenter(markerlist.getPosition());
	            });
	            google.maps.event.clearListeners(markerlist, 'click');
	            google.maps.event.addListener(markerlist, 'click', openWindowFn);				          			            
	        });	
	        
	        $('.where-to-buy__container .where-to-buy__result-content').on('click', function () {	
            	var indexValue = $(this).find(".storeindex").val();
	            google.maps.event.trigger(markers[indexValue], 'click');
	        });		       
	    }	
	    

		//call offlines store v2 api(default)
		var getStorelocatorDefault = function() {
			var hatchOffstoreUse = $("#hatchOffstoreUse").val();
			var offSearchDomain = $("#searchApiDomain").val() + '/' + $("#apiStageInfo").val() + '/b2c/storelocator/list';
			var latitude = $("#offstoreLatitude").val();
			var longitude = $("#offstoreLongitude").val();
			var siteCd = $("#siteCode").val();				
			var distanceUnit = $("#offstoreDistanceUnit").val();
			var nRadius ='';
			var nRadiusTemp = $(".where-to-buy__container button.where-to-buy__distance-button.is-selected").attr("data-value");
			var distanceText ='';
			var selectedHtml ='';
			if(nRadiusTemp != null) {
	        	nRadius = nRadiusTemp;
			}else if(siteCd == 'ae' || siteCd == 'ae_ar'){
				nRadius = 1;
				$(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").addClass("is-selected");
				distanceText = $(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").text();
				selectedHtml = distanceText+'<span class="hidden">selected</span>';
				$(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").html(selectedHtml);
			}else{
				nRadius = 10;
				$(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").addClass("is-selected");
                distanceText = $(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").text();
				selectedHtml = distanceText+'<span class="hidden">selected</span>';
				$(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").html(selectedHtml);
			}	
			
			var modelCode = "";
			if ($("#selectModelCode").val() == null || $("#selectModelCode").val() === undefined || $("#selectModelCode").val() === "" ) {
				modelCode = $("#current_model_code").val();
			}else{
				modelCode = $("#selectModelCode").val();
			}
			var iaCode = $("#categoryInfo").val();
			
			var param = {
        			"siteCode":siteCd,
        			"latitude":latitude,
        			"longitude":longitude,
        			"distanceUnit":distanceUnit,
        			"nRadius":nRadius,
        			"modelCode":modelCode,
        			"iaCode" : iaCode
        		};
			
			if(hatchOffstoreUse == 'Y'){
				var hatchOffstoreUrl = $("#hatchOffstoreUrl").val();
				var hatchOffstoreBrandID =  $("#hatchOffstoreBrandID").val();
				var hatchOffstoreRegion = $("#hatchOffstoreRegion").val();
				var hatchOffstoreLang = $("#hatchOffstoreLang").val();
				var offHatchDomain = hatchOffstoreUrl + hatchOffstoreBrandID + "/geo/list";
				var offHatchnRadius = "";
				var offHatchIacode = [];
				var offHatchTypecode = iaCode.substr(0,2) + "000000";
				var offHatchSubTypecode = iaCode.substr(0,4) + "0000";						
				offHatchIacode.push(offHatchTypecode);
				offHatchIacode.push(offHatchSubTypecode);	
				
				if(initData.distanceUnitValue == "Mile"){
					offHatchnRadius = nRadius*1609.344;
				}else{
					offHatchnRadius = nRadius*1000;
				}
				var hatchParam = "";
				if(hatchOffstoreLang != "" && hatchOffstoreLang != null){
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"segment": hatchOffstoreLang,
						"filters":[
							{
							 "columnName": "productTags",
							 "operation": "equal",
							 "value": offHatchIacode
							}
						]
					};
				}else{
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"filters":[
							{
							 "columnName": "productTags",
							 "operation": "equal",
							 "value": offHatchIacode
							}
						]
					};
				}
				$.ajax({
					headers: {
						"Content-Type": "application/json",
						//"Cookie" : "icl_opt_out=true"
					},
					type: "POST",						
					url: offHatchDomain,
					data: JSON.stringify(hatchParam),
					cache: true,
					timeout: 20000,
					success: function (data) {			
						getHatchOffStoreList(data);	
						initMap(latitude, longitude, "N");
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
					},
					complete: function() {
						wtb.bak.reInit();
					}
				});
			}else{
				$.ajax({						
					type: "GET",						
					url: offSearchDomain,
        			data : param,
        			async:false,
        			success: function (data) {														
						getOffStoreList(data.response.resultData);	
						initMap(latitude, longitude, "N");
        			},
        			error: function(XMLHttpRequest, textStatus, errorThrown) {
        			},
        			complete: function() {
        				wtb.bak.reInit();
				}
			});
			}
		}
		

		//call offline store v2 api		
		var getStorelocator = function(latitude, longitude, gpsNRadius) {
			var hatchOffstoreUse = $("#hatchOffstoreUse").val();
			var offSearchDomain = $("#searchApiDomain").val() + '/' + $("#apiStageInfo").val() + '/b2c/storelocator/list';
			var siteCd = $("#siteCode").val();				
			var distanceUnit = $("#offstoreDistanceUnit").val();
			var nRadius ='';
			var nRadiusTemp = $("button.where-to-buy__distance-button.is-selected").attr("data-value");
			var distanceText ='';
			var selectedHtml ='';
			if(nRadiusTemp) {
	        	nRadius = nRadiusTemp;
	        }else {
	        	if(gpsNRadius === 'Y' && siteCd != 'ae') {
	        		nRadius = 5;
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='5']").addClass("is-selected");
					distanceText = $(".where-to-buy__container button.where-to-buy__distance-button[data-value='5']").text();
					selectedHtml = distanceText+'<span class="hidden">selected</span>';
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='5']").html(selectedHtml);
	        	}else if(siteCd == 'ae' || siteCd == 'ae_ar'){
					nRadius = 1;
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").addClass("is-selected");
					distanceText = $(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").text();
					selectedHtml = distanceText+'<span class="hidden">selected</span>';
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='1']").html(selectedHtml);
				}else{
	        		nRadius = 10;
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").addClass("is-selected");
					distanceText = $(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").text();
					selectedHtml = distanceText+'<span class="hidden">selected</span>';
					$(".where-to-buy__container button.where-to-buy__distance-button[data-value='10']").html(selectedHtml);
	        	}	
	        }
			
			var modelCode = "";
			if ($("#selectModelCode").val() == null || $("#selectModelCode").val() === undefined || $("#selectModelCode").val() === "" ) {
				modelCode = $("#current_model_code").val();
			}else{
				modelCode = $("#selectModelCode").val();
			}				
			var iaCode = $("#categoryInfo").val();
			
			var param = {
        			"siteCode":siteCd,
        			"latitude":latitude,
        			"longitude":longitude,
        			"distanceUnit":distanceUnit,
        			"nRadius":nRadius,
        			"modelCode":modelCode,
        			"iaCode" : iaCode
        		};
							
			if(hatchOffstoreUse == 'Y'){
				var hatchOffstoreUrl = $("#hatchOffstoreUrl").val();
				var hatchOffstoreBrandID =  $("#hatchOffstoreBrandID").val();
				var hatchOffstoreRegion = $("#hatchOffstoreRegion").val();
				var hatchOffstoreLang = $("#hatchOffstoreLang").val();
				var offHatchDomain = hatchOffstoreUrl + hatchOffstoreBrandID + "/geo/list";
				var offHatchIacode = [];
				var offHatchTypecode = iaCode.substr(0,2) + "000000";		
				var offHatchSubTypecode = iaCode.substr(0,4) + "0000";	
				var offHatchnRadius = nRadius*1000; 
				var offHatchnRadius = "";
				if(initData.distanceUnitValue == "Mile"){
					offHatchnRadius = nRadius*1609.344;
				}else{
					offHatchnRadius = nRadius*1000;
				}
							
				offHatchIacode.push(offHatchTypecode);
				offHatchIacode.push(offHatchSubTypecode);	
				
				var hatchParam = "";
				if(hatchOffstoreLang != "" && hatchOffstoreLang != null){
					hatchParam = {
							"countryCode":hatchOffstoreRegion,
							"geoCenterArea": {
								"center": {
									"latitude":latitude,
									"longitude":longitude
								},
								"distance":offHatchnRadius
							},
							"product":modelCode,
							"segment": hatchOffstoreLang,
							"filters":[
								{
								 "columnName": "productTags",
								 "operation": "equal",
								 "value": offHatchIacode
								}
							]
						};
				}else{
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"filters":[
							{
							 "columnName": "productTags",					 
							 "operation": "equal",
							 "value": offHatchIacode
							}
						]
					};
				}
				
					
				$.ajax({
					headers: {
						"Content-Type": "application/json",
						//"Cookie" : "icl_opt_out=true"
					},
					type: "POST",						
					url: offHatchDomain,
					data: JSON.stringify(hatchParam),
					cache: true,
					timeout: 20000,
					success: function (data) {
						getHatchOffStoreList(data);	
						initMap(latitude, longitude, gpsNRadius);	
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
					},
					complete: function() {
						wtb.bak.reInit();
					}
				});
			}else{
				$.ajax({
					type: "GET",						
					url: offSearchDomain,
					data : param,
					async:false,
					success: function (data) {													
						getOffStoreList(data.response.resultData);
						initMap(latitude, longitude, gpsNRadius);	
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
					},
					complete: function() {
						wtb.bak.reInit();
					}
				});
			}
		}
		
		
		//offline store get gps info
		var setGeoLocation = function(jsonData) {
			
			function handleGeolocationError() {
			//Error
				console.warn('ERROR');
			}
			
			function geolocateByIP() {
				$.getJSON('http://freegeoip.net/json/?callback=?').then(handleGeolocationResult, handleGeolocationError);
				return;
			}
			
			function handleGeolocationDenyResult(err) {
				//console.warn('ERROR(' + err.code + '): ' + err.message);
				setOffStoreCookie("newwtb_offstore","false",5);
				getStorelocatorDefault();
			}				
	
			function handleGeolocationResult(location) {
				//Modernizr.geolocation might come true still when the user rejects the geolocation, so we are better off using hasOwnProperty.
				var lat = typeof location.coords !== 'undefined' ? location.coords.latitude : location.latitude,
					lng = typeof location.coords !== 'undefined' ? location.coords.longitude : location.longitude;
				
				if (!lat || !lng || isNaN(lat) || isNaN(lng)) {
					var latitude = $("#offstoreLatitude").val();
					var longitude = $("#offstoreLongitude").val();
					getStorelocator(latitude,longitude, "N");
				} else {
					$("#offstoreLatitude").val(lat);
					$("#offstoreLongitude").val(lng);
					getStorelocator(lat, lng, "Y");
				}
			}
			
			function geolocateUser(coarseGrainedCallback) {
			
				if(navigator.geolocation) { // geolocation이 지원하는 브라우져
					navigator.geolocation.getCurrentPosition(handleGeolocationResult, handleGeolocationDenyResult);
					return;
				} else if (coarseGrainedCallback) { // geolocation이 지원하지않는 브라우져
					geolocateByIP();
				}
			}
			
			geolocateUser(true);
		}
		
		
		
		//offline store check gps cookie
		var offStoreCookieCheck = function() {
			var cookieCheck ="";
			if(getOffStoreCookie("newwtb_offstore") != null && getOffStoreCookie("newwtb_offstore") !== '') {
				cookieCheck = getOffStoreCookie("newwtb_offstore");
				if(cookieCheck === 'true') {
					setGeoLocation();
				}else{
					var latitude = $("#offstoreLatitude").val();
					var longitude = $("#offstoreLongitude").val();
					getStorelocator(latitude,longitude, "N");
				}
			}else{
				getStorelocatorDefault();
				layerOpen('.where-to-buy__container .where-to-buy__layer--gbs');
			}
		};
		
		var getWtbData = function(wtbPath) {
			
			var siteCode = $("#siteCode").val();

			var drawLocatorBtn = function() {
				//uk, it, fr, za, in만  Search Store 영역 노출
				if(siteCode === 'uk' || siteCode === 'it' || siteCode === 'fr' || siteCode === 'za' || siteCode === 'in' || siteCode === 'tr') {
					$(".where-to-buy__container .where-to-buy__search").show();
				}
			};
			var drawMoreBtn = function() {
				var onlinstore = $(".where-to-buy__store");
				var onlinstorelistlength = $(".where-to-buy__store-list a.where-to-buy__store-link").length;
				if(onlinstore.hasClass("where-to-buy__column--4")) {
					if(onlinstorelistlength > 12) {
						$(".where-to-buy__container .where-to-buy__store-more-cta").show();
					}
				}else{
					if(onlinstorelistlength > 6) {
						$(".where-to-buy__container .where-to-buy__store-more-cta").show();
					}
				}
			};
			var drawReviews = function() {
				if("Y" === $("#bvFlag").val() || "Y" === $("#bvRTLFlag").val() || "Y" === $("#aplautYn").val()) {
					var ratings = 0;
					var reviewCount = 0;
					if($("#ratingsValue").val()) {
						ratings = parseFloat($("#ratingsValue").val()).toFixed(1);
					}
					if($("#reviewCountValue").val()) {
						reviewCount = parseFloat($("#reviewCountValue").val() || "0");
					}
					
					var ratingsHtml = "";
					var ratingPointHtml = "";
					var reviewCountHtml = "";
					var fullStarRatings = Math.floor(ratings);
					var starWidth = parseInt((ratings-fullStarRatings)*100);
					
					for(var k=0; k<fullStarRatings; k++) {
						ratingsHtml += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 100%;"></span></span>';
					}			
					if(fullStarRatings<5) {
						ratingsHtml += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: '+starWidth+'%;"></span></span>';
					}
					for(var l = 4; l > fullStarRatings; l--) {
						ratingsHtml += '<span class="rating__star-item"><span class="rating__star-empty"></span><span class="rating__star-filled" style="width: 0%;"></span></span>';
					}
					ratingPointHtml += '<span class="hidden">Product Ratings : </span><span>'+ratings+'</span>';
					reviewCountHtml += '(<span class="hidden">Number of Ratings :</span><span>'+reviewCount+'</span>)';
					
					$(".where-to-buy__container .where-to-buy__product-rating .rating__star-list").html(ratingsHtml);
					$(".where-to-buy__container .where-to-buy__product-rating .rating__point").html(ratingPointHtml);
					$(".where-to-buy__container .where-to-buy__product-rating .rating__review-count").html(reviewCountHtml);	
					
					if(ratings === 0 && reviewCount === 0) {
						$(".where-to-buy__container .where-to-buy__product-info .where-to-buy__product-rating .rating").addClass("rating--empty");
					}
				}
			};
			
			$.ajax({
				type: "GET",						
				url: wtbPath,
				async:false,
				success: function (data) {
					$(".where-to-buy").html(data);
					$(".where-to-buy__container.layer-popup [an-tr]").each(function(){
					    $(this).attr("an-tr", $(this).attr("an-tr").replace("{{pageTrack}}", digitalData.page.pageInfo.pageTrack));
					});
					
					initData.modelCodeValue = $("#wtbModelCode").val();
					var distanceUnit = $("#offstoreDistanceUnit").val();
					if(distanceUnit === "3959") {
						initData.distanceUnitValue = "Mile";
					}else{
						initData.distanceUnitValue = "Km";
					}
					
					var etaleYn = $("#etailinUrlYn").val();
					var onlineStoreUse = $("#onlineUse").val();
					var offlineStoreUse = $("#inStoreUse").val();
					var instoreIAFlag = $("#instoreIAFlag").val(); //N일 때 offlinstore 미사용 카테고리임 default는 Y
					var onlineRetailorsSize = $("#wtbOnlineRetailorsSize").val();
					var buyonlineDisplayYn = $("#wtbOnlineStoreDisplayYn").val(); 	
					//재고에 따른 onlineStore 노출 기능 사용 시 재고가 있는 경우는 onlinestore 미노출
					var stockStatusText = initData.apiChangeStockStatus;
					var wtbStockStatus = "N";	
					var onlineDisplayByStock = "Y"
					
					if(stockStatusText != null && stockStatusText != 'null'){
						stockStatusText = stockStatusText.replace(/\s/gi, "").toUpperCase();
						if(stockStatusText == "INSTOCK" || stockStatusText == "LOWSTOCK" || stockStatusText == "PREORDER"){
							wtbStockStatus = "Y";
						}
					}
					
					if(initData.useWtbStockFunction == 'Y' && wtbStockStatus == 'Y'){
						onlineDisplayByStock = 'N';
					}
					
					if(siteCode === 'cz' || siteCode === 'sk' ) {
						$("#whereToBuyLocator").addClass("is-selected");			
						$("#whereToBuyLocator").attr("aria-selected", true);
						$(".where-to-buy__locator").addClass("is-active");
						
						if(((onlineStoreUse === 'N' || !onlineRetailorsSize || onlineRetailorsSize === "0") && etaleYn !== 'Y') || buyonlineDisplayYn === 'N' || onlineDisplayByStock === 'N') {
							$("#whereToBuyOnline").parent().remove();
							$("#whereToBuyOnline").attr("aria-selected", false);
							$(".where-to-buy__online").remove();
							$("#whereToBuyOnline").removeClass("is-selected");
						}
						offStoreCookieCheck();
						
					}else{
						if(offlineStoreUse === 'Y' && instoreIAFlag === 'Y') {
							if(((onlineStoreUse === 'N' || !onlineRetailorsSize || onlineRetailorsSize === "0") && etaleYn !== 'Y') || buyonlineDisplayYn === 'N' || onlineDisplayByStock === 'N') {
								$("#whereToBuyOnline").parent().remove();
								$("#whereToBuyLocator").addClass("is-selected");						
								$("#whereToBuyLocator").attr("aria-selected", true);
								$(".where-to-buy__online").remove();
								$(".where-to-buy__locator").addClass("is-active");
							}
							if(siteCode !== 'cn') {
								offStoreCookieCheck();
							}
						}else if(offlineStoreUse !== 'Y' || instoreIAFlag === 'N') { 					
							$("#whereToBuyLocator").parent().remove();
							if(onlineDisplayByStock === 'N'){
								var outofstockText = "<p>"+Granite.I18n.get('We are sorry, but this product is currently not available from any of our retail partners.') + "</p>";
								$(".where-to-buy__store").html(outofstockText);
							}
						}
					}			
					//html 코드 포함 케이스가 있어서 js에서 처리하는걸로 수정
					var displayName = $("#wtbDisplayName").val();
					$(".where-to-buy__container .where-to-buy__product-name").html(displayName);
					
					drawLocatorBtn();
					drawMoreBtn();
					drawReviews();
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
				},
				complete: function() {
					wtb.bak.reInit();
				}
			});
		}
		
		//offline store detail 
		var getOffStoreDetail = function(jsonData) {
			var storeDetailData = jsonData;		
			var storeDetailHeadline = "";
			var storeDetailType = "";
			var storeDetail = "";
			var storeLat = storeDetailData.latitude;
			var storeLog = storeDetailData.longitude;
			var brandTypeValue = "";
			var googleMapUrl = "https://www.google.com/maps/search/?api=1&query="+storeLat+","+storeLog;
								
			storeDetailHeadline += storeDetailData.name;
			if(storeDetailData.cityName != null) {
				storeDetailHeadline	+= ' ' + storeDetailData.cityName;	
			}
			$(".where-to-buy__container .where-to-buy__detail-headline").text(storeDetailHeadline);
			
			
			if(storeDetailData.brandTypeCode === 'E') {
				brandTypeValue = Granite.I18n.get("Samsung Experience Stores");
			}else if(storeDetailData.brandTypeCode === 'B') {
				brandTypeValue = Granite.I18n.get("Samsung Brand Store");
			}else if(storeDetailData.brandTypeCode === 'O') {
				brandTypeValue = Granite.I18n.get("Other Store");
			}
			
			storeDetailType +=
				brandTypeValue + 
				'<span class="where-to-buy__detail-distance">'+ (storeDetailData.distance+initData.distanceUnitValue) +'</span>'; 			
			$(".where-to-buy__container .where-to-buy__detail-type").html(storeDetailType);		
			
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="'+googleMapUrl+'" class="where-to-buy__detail-info-link icon-location" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':address" aria-label="'+storeDetailData.address+' Google map : Open in a new window" target="_blank">'+storeDetailData.address+
				/* SVG Icon 추가 */
				'<svg class="icon icon--location" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#location-bold"></use></svg>' +
				'</a></li>';
			if(storeDetailData.phone != null && storeDetailData.phone !== "") {
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="tel:'+storeDetailData.phone+'" class="where-to-buy__detail-info-link icon-tel" title="Call '+storeDetailData.phone+'" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':call">'+storeDetailData.phone+
				/* SVG Icon 추가 */
				'<svg class="icon icon--tel" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#call-bold"></use></svg>' +
				'</a></li>';
			}
			if(storeDetailData.email != null && storeDetailData.email !== "") {
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="mailto:'+storeDetailData.email+'" class="where-to-buy__detail-info-link icon-mail" title="Mail to "'+storeDetailData.email+' an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':email">'+storeDetailData.email+'</a></li>';	
			}
			$(".where-to-buy__container .where-to-buy__detail-info-list").html(storeDetail);
			
		}
		
		//hatch offline store detail 
		var getHatchOffStoreDetail = function(jsonData) {
			var storeDetailData = jsonData.locations[0];		
			var storeDetailHeadline = "";
			var storeDetailType = "";
			var storeDetail = "";
			var storeLat = storeDetailData.coordinates.latitude;
			var storeLog = storeDetailData.coordinates.longitude;
			var brandTypeValue = "";
			var googleMapUrl = "https://www.google.com/maps/search/?api=1&query="+storeLat+","+storeLog;
						
			if(storeDetailData.name != null && storeDetailData.name != ""){
				storeDetailHeadline += storeDetailData.name;
			}
			
			if(storeDetailData.locality != null && storeDetailData.locality != "") {
				storeDetailHeadline	+= ' ' + storeDetailData.locality;	
			}
			$(".where-to-buy__container .where-to-buy__detail-headline").text(storeDetailHeadline);			
			
			if(storeDetailData.storeTypes == '1_ses') {
				brandTypeValue = Granite.I18n.get("Samsung Experience Stores");
			}else if(storeDetailData.storeTypes == '2_sbs') {
				brandTypeValue = Granite.I18n.get("Samsung Brand Store");
			}else{
				brandTypeValue = Granite.I18n.get("Other Store");
			}
			
			var hatchDistance = "";
			if(initData.distanceUnitValue == "Km"){
				hatchDistance = (parseFloat(storeDetailData.distance)/1000).toFixed(2);
			}else if(initData.distanceUnitValue == "Mile"){
				hatchDistance = (parseFloat(storeDetailData.distance)/1609.344).toFixed(2);
			}
			
			storeDetailType +=
				brandTypeValue + 
				'<span class="where-to-buy__detail-distance">'+ (hatchDistance+initData.distanceUnitValue) +'</span>'; 			
			$(".where-to-buy__container .where-to-buy__detail-type").html(storeDetailType);		
			
			if(storeDetailData.address.street != null && storeDetailData.address.street !== "") {
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="'+googleMapUrl+'" class="where-to-buy__detail-info-link icon-location" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':address" aria-label="'+storeDetailData.address.street+' Google map : Open in a new window" target="_blank">'+storeDetailData.address.street+
				/* SVG Icon 추가 */
				'<svg class="icon icon--location" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#location-bold"></use></svg>' +
				'</a></li>';
			}
			if(storeDetailData.telephone != null && storeDetailData.telephone !== "") {
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="tel:'+storeDetailData.phone+'" class="where-to-buy__detail-info-link icon-tel" title="Call '+storeDetailData.phone+'" an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':call">'+storeDetailData.telephone+
				/* SVG Icon 추가 */
				'<svg class="icon icon--tel" focusable="false" aria-hidden="true"><use xlink:href="/etc.clientlibs/samsung/clientlibs/consumer/global/clientlib-common/resources/images/svg-sprite.svg#call-bold"></use></svg>' +
				'</a></li>';
			}
			if(storeDetailData.email != null && storeDetailData.email !== "") {
			storeDetail +=
				'<li class="where-to-buy__detail-info-item" role="listitem"><a href="mailto:'+storeDetailData.email+'" class="where-to-buy__detail-info-link icon-mail" title="Mail to "'+storeDetailData.email+' an-tr="where to buy popup-'+digitalData.page.pageInfo.pageTrack+'-text-contact" an-ca="store locator" an-ac="store detail view" an-la="store detail view:'+storeDetailHeadline+':email">'+storeDetailData.email+'</a></li>';	
			}
			$(".where-to-buy__container .where-to-buy__detail-info-list").html(storeDetail);
			
		}
		
		//call offline store detail api
		var getStorelocatorDetail = function(storeId, latitude, longitude) {
			var hatchOffstoreUse = $("#hatchOffstoreUse").val();
			var offDeatilSearchDomain = $("#searchApiDomain").val() + '/' + $("#apiStageInfo").val() + '/b2c/storelocator/detail';
			var siteCd = $("#siteCode").val();
			var distanceUnit = $("#offstoreDistanceUnit").val();
			var param = {
				"siteCode":siteCd,
				"latitude":latitude,
        		"longitude":longitude,
        		"distanceUnit":distanceUnit,
        		"storeId":storeId
        		}
			
			if(hatchOffstoreUse != 'Y'){
				$.ajax({
					type: "GET",						
					url: offDeatilSearchDomain,
        			data : param,
        			async:false,
        			success: function (data) {								
        				getOffStoreDetail(data.response.resultData.storeDetail);
        			},
        			error: function(XMLHttpRequest, textStatus, errorThrown) {
        			}
				});
			}else{
				var hatchOffstoreUrl = $("#hatchOffstoreUrl").val();
				var hatchOffstoreBrandID =  $("#hatchOffstoreBrandID").val();
				var hatchOffstoreRegion = $("#hatchOffstoreRegion").val();
				var hatchOffstoreLang = $("#hatchOffstoreLang").val();
				var offHatchDomain = hatchOffstoreUrl + hatchOffstoreBrandID + "/geo/list";			
				var offHatchnRadius = $("button.where-to-buy__distance-button.is-selected").attr("data-value");
				if(initData.distanceUnitValue == "Mile"){
					offHatchnRadius = offHatchnRadius*1609.344;
				}else{
					offHatchnRadius = offHatchnRadius*1000;
				}
				var modelCode = "";
				if ($("#selectModelCode").val() == null || $("#selectModelCode").val() === undefined || $("#selectModelCode").val() === "" ) {
					modelCode = $("#current_model_code").val();
				}else{
					modelCode = $("#selectModelCode").val();
				}
				var hatchParam = "";
				if(hatchOffstoreLang != "" && hatchOffstoreLang != null){
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"segment": hatchOffstoreLang,
						"filters":[
							{
							  "columnName": "searchableId",
							  "operation": "equal",
							  "value": [storeId]
							  }
						]
					};
				}else{
					hatchParam = {
						"countryCode":hatchOffstoreRegion,
						"geoCenterArea": {
							"center": {
								"latitude":latitude,
								"longitude":longitude
							},
							"distance":offHatchnRadius
						},
						"product":modelCode,
						"filters":[
							{
							  "columnName": "searchableId",
							  "operation": "equal",
							  "value": [storeId]
							  }
						]
					};
				}
				$.ajax({
					headers: {
						"Content-Type": "application/json",
						//"Cookie" : "icl_opt_out=true"
					},
					type: "POST",						
					url: offHatchDomain,
					data: JSON.stringify(hatchParam),
					cache: true,
					timeout: 20000,
					success: function (data) {
						getHatchOffStoreDetail(data);
					}
				});
				
			}
		}
		

		//online store search store click
		$(document).on('click', '.where-to-buy__container .where-to-buy__search', function(e) {
			var siteCode = $("#siteCode").val();
			var storelocatorUrl = "/"+siteCode+"/storelocator";
			var openStorelocator = window.open("about:blank");
			openStorelocator.location.href = storelocatorUrl;
		});
		
		//offline store distance filter click
		$(document).on('click', '.where-to-buy__container .where-to-buy__distance-button', function(e) {
			$(".where-to-buy__distance-list li button").removeClass("is-selected");
			$(this).addClass("is-selected");
			offStoreCookieCheck();
		});
		
		//offline store list click
		$(document).on('click', '.where-to-buy__container .where-to-buy__result-content', function(e) {
			var storeId = $(this).find(".where-to-buy__result-info").attr("data-store-id");
			var lat = $("#offstoreLatitude").val();
			var long = $("#offstoreLongitude").val();					
			$('.where-to-buy__result-content').removeClass('is-active');
			$(this).addClass('is-active');
			getStorelocatorDetail(storeId, lat, long);
		});
		
		//offline store gps approval click
		$(document).on('click', '.where-to-buy__container .where-to-buy__layer--gbs .cta--contained.cta--emphasis', function(e) {
			setOffStoreCookie("newwtb_offstore","true",5);
			offStoreCookieCheck();
			layerClose(".where-to-buy__layer--gbs", false);
		});
		
		//offline store gps cancel click
		$(document).on('click', '.where-to-buy__container .where-to-buy__layer--gbs .cta--outlined.cta--black', function(e) {
			setOffStoreCookie("newwtb_offstore","false",5);
			getStorelocatorDefault();
			layerClose(".where-to-buy__layer--gbs", false);
		});
		
		//offline store gps close click
		$(document).on('click', '.where-to-buy__container .where-to-buy__layer--gbs .layer-popup__close', function(e) {					
			setOffStoreCookie("newwtb_offstore","false",5);
			getStorelocatorDefault();
			layerClose(".where-to-buy__layer--gbs", false);
		});
		
		//offlines store tooltip title click
		$(document).on('click', '.where-to-buy__container .store-arr2', function(e) {
			var storeId = $("#currentStoreId").val();
			var lat = $("#offstoreLatitude").val();
			var long = $("#offstoreLongitude").val();
			getStorelocatorDetail(storeId,lat,long);
			$(".where-to-buy__detail").show();
			$("#store-Detail-Layer").attr("data-store-detail-id",storeId);
		});
		
		//offline store tooltip close click
		$(document).on('click', '.where-to-buy__container .gm-ui-hover-effect', function(e) {
			$(".where-to-buy__detail").hide();
			$('.where-to-buy__result-content').removeClass('is-active');
		});
		
		//Where to buy lay close click
		$(document).on('click', '.where-to-buy__container .where-to-buy__content > .layer-popup__close', function(e) {
			layerClose(".where-to-buy__container", true);
		});
		
		//Where to buy lay close click
		$(document).on('click', '.where-to-buy__container .where-to-buy__store-link', function(e) {
			window.open($(this).data("deeplink"), "_blank");
		});
		
		$(document).on('click', '.js-cta-buy, .js-cta-buy-etc', function(e) {
			var iaCode = $(this).attr("data-iaCode"); 
			var siteCode = $("#siteCode").val();
			var tempModelCode = $(this).attr("data-modelcode");
			var modelCode = tempModelCode.replace("/","+");
			var modelName = $(this).attr("data-modelname");
			var channelCampaignTag = "Y";
			var countryCookie = getOffStoreCookie("country_codes") !== ''?  getOffStoreCookie("country_codes") : "kr";
			var language = $("#language").val().replace("-", "_");
			var wtbPath = "/samsung/common/wheretobuy.cm-g-where-to-buy-bak."+iaCode+"."+siteCode+"."+modelCode+"."+channelCampaignTag+"."+countryCookie+"."+language+"."+"html";
			
			if(location.href.indexOf(".html") <= -1) {
				wtbPath = wtbPath.replace(".html","/");
			}
			
			$("#current_model_code").val(tempModelCode);
			$("#wtb-categorySubTypeCode").val(iaCode);								
				
			switch (siteCode) {
				case "ru":
				case "ge":
				case "test":
					// wtb-init 미 포함인 경우 초기화후 click
					if(!$(this).hasClass('wtb-init')){ // wtb-init https://widget.24wtb.com/samsung/wtbWidget.js에 포함 되어있음
						var wtbWidget = new WtbWidget();
						wtbWidget.init({});
						document.addEventListener("click", function(e) {
							if(e.target && e.target.className && e.target.className.indexOf("js-cta-buy") !== -1) {
								wtbWidget.callPopup(e.target);
							}
						});
						$(this).get(0).click();
					}
					break;
				case "be":
				case "be_fr":
				case "nl":
					if (document.querySelector("#wtb-id-span") === null) {
	        	    	var idSpan = document.createElement('span');
	        	    	idSpan.dataset.mpn = tempModelCode;
	        	    	idSpan.id = "wtb-id-span";
	        	    	$('body').append(idSpan);
	        	    } else {
	        	    	document.querySelector("#wtb-id-span").dataset.mpn = tempModelCode;
	        	    }

	        	    //modal
	        	    switchModal(initData);
					break;
				case "pl":
					var source = "/pl/where-to-buy.html?model="+ tempModelCode +"&locale=pl-PL&iaUrlNamePath=" + digitalData.page.pageInfo.pageName + "&pageTrack=" + digitalData.page.pageInfo.pageTrack + "&urlPath="+window.location.href;
					if(location.href.indexOf(".html") <= -1) {
						source = source.replace(".html","/");
					}
					if("admin" === $("#apiStageInfo").val()){
						source = "/content/samsung" + source;
					}
					$.magnificPopup.open({
						  items: {src: source},
						  type: 'iframe',
						  callbacks: {
							    open: function() {
							    	window.sg.common.utils.hiddenScroll();
								},
							    close: function() {
							    	window.sg.common.utils.visibleScroll();
							    }
						  }    
					});
					break;
				case "de":
					break;							
				default:	
				
					//재고에 따른 onlineStore 노출 기능 
					var templateType = digitalData.page.pageInfo.pageTrack;
					if(templateType == 'product finder'){
						initData.apiChangeStockStatus = $(this).parent().find(".wtbStockStatusText").val();				
						initData.useWtbStockFunction = $(this).parent().find(".useWtbStockFunction").val();				
					}else{
						initData.apiChangeStockStatus = $("#apiChangeStockStatus").val();
						initData.useWtbStockFunction = $("#useWtbStockFunction").val();
					}
				
					getWtbData(wtbPath);
					$("#selectModelName").val(modelName);
					$("#selectModelCode").val(tempModelCode);
					
					if(siteCode === 'ca' || siteCode === 'ca_fr') {
						if(typeof $("#cnWtbUrlPath").val() !== 'undefined' && $("#cnWtbUrlPath").val()!== '') {
							pswtb.sandbox.openWTB(this, $("#cnWtbUrlPath").val());
						}
					} else {
						if(siteCode === 'cn') {
							if ($(".where-to-buy__tab li").length === 1 && $(".where-to-buy__tab li a").attr("id") === "whereToBuyLocator") {
								location.href = $("#cnWtbUrlPath").val();
								return;
							}
						}
						// offline store modelcode/modelname attribute 추가
						$(".where-to-buy__container .where-to-buy__store-link").attr("data-modelcode", tempModelCode);
						$(".where-to-buy__container .where-to-buy__store-link").attr("data-modelname", modelName);
						
						// br 모바일(01) 인 경우 review 감춤 처리
//						if('br' === siteCode && '01' === iaCode.substr(0,2)) {
//							$(".where-to-buy__container .where-to-buy__product-rating").hide();
//						}
						
						layerOpen(".where-to-buy__container");
						window.sg.common.icon.update();
						window.sg.common.lazyLoad.setLazyLoad();
					}
					break;
			}
			
			if(initData.bvConversationFlag === "Y" || initData.bvConversationRTLFlag === "Y") {
				window.bvCallback = function (BV) {
					BV.pixel.trackConversion({
						"type" : "WhereToBuy",
						"label" : "ProductPage",
						"value" : modelCode
					});
				};
			}
		});
		
	};
	
	function layerOpen(layerSelector) {
		$(".where-to-buy .layer-popup-dim").show();
		$(".where-to-buy " + layerSelector).show();
	};
	
	function layerClose(layerSelector, isWtbLayer) {
		if(isWtbLayer) {
			$(".where-to-buy .layer-popup-dim").hide();
		}
		$(".where-to-buy " + layerSelector).hide();
	};
	
	function placeResources() {
		 var script = document.createElement("script")
		 if (location.host.indexOf("www") > -1) {
			 script.src = "https://sebn.ams3.cdn.digitaloceanspaces.com/src/wtb/latest/js/app.js";
		 } else {
			 script.src = "https://sebn.ams3.digitaloceanspaces.com/src/wtb/latest/staging/js/app.js";
		 }
		 script.type = "text/javascript";
		 document.getElementsByTagName("head")[0].appendChild(script);
	};

  	function createModal(initData) {
  		  var html = document.createElement('div');
  		  html.innerHTML =
	  	      "<div id='wtb-modal-container' class='modal-container'>"
	  	    	+ "<div class='modal-overlay'></div>"
	  	    	+ "<div class='modal-window default settings'>"
	  	    		+ "<div class='internal-container'>"
	  	    			+ "<div class='modal-top-bar'>"
	  	    				+ "<div class='close-button'><img src='https://image.samsung.com/uk/smartphones/galaxy-note9/buy/shop_popup_close_btn_mo.png'/></div>"
	  	    			+ "</div>"
	  	    			+ "<div id='where-to-buy-local'>"
	  	    			+ "</div>"
	  	    		+ "</div>"
		    	+ "</div>"
		     + "</div>";
  		  $('body').append(html);
  		  $('.close-button').on('click', function (e) {
  			  switchModal(initData);
  		  });
  		  $('.modal-overlay').on('click', function (e) {
  			  switchModal(initData);
  	      });
  	};
	
  	function switchModal(initData) {
  		  if (document.querySelector("#wtb-modal-container") === null) {
  			  createModal(initData);
  		  }
  		  if (!initData.placedWtbResources) {
  			  placeResources();
  			  initData.placedWtbResources = true;
  		  }
  		  $("body").toggleClass("modal-open");
  	};
	
})(window, window.jQuery);	
/*! iFrame Resizer (jquery.iframeSizer.min.js )
 *  Desc: Force cross domain iframes to size to content.
 *  Requires: iframeSizer.contentWindow.min.js to be loaded into the target frame.
 *  Copyright: (c) 2013 David J. Bradshaw - dave@bradshaw.net
 *  License: MIT and GPL
 */

(function(e){function o(e){i.log&&window.console&&console.log(t+" "+e)}var t="[iFrameSizer]",n=t.length,r=0,i,s={log:!1,contentWindowBodyMargin:8,doHeight:!0,doWidth:!1,interval:0,callback:function(){}};e(window).on("message",function(e){function r(e){function r(){function e(e){u.iframe.style[e]=u[e]+"px",o(u.iframe.id+" "+e+" set to "+u[e]+"px")}i.doHeight&&e("height"),i.doWidth&&e("width")}function s(){var t=e.substr(n).split(":");u={iframe:document.getElementById(t[0]),height:t[1],width:t[2]}}var u={};t===e&&e.substr(0,n)&&(s(),r(),i.callback(u))}r(e.originalEvent.data)}),e.fn.iFrameSizer=function(n){return i=e.extend({},s,n),this.each(function(){function n(){return a.contentWindow?!0:!1}function s(){a.style.overflow="hidden",a.scrolling="no",e(a).on("load",function(){u(a)}),u(a)}function u(){function e(){""===a.id&&(a.id="iFrameSizer"+r++,o("Added missing iframe ID: "+a.id))}function n(){var e=a.id+":"+i.contentWindowBodyMargin+":"+i.doWidth+":"+i.log+":"+i.interval;o("Sending init msg to iframe ("+e+")"),a.contentWindow.postMessage(t+e,"*")}e(),n()}var a=this;n()&&s()})}})(window.jQuery);
